###############################################################################
#                                                                             #
#                                                       19/Sep/2012  16:16:00 #
# IAR ANSI C/C++ Compiler V6.40.2.33884/W32 KICKSTART for ARM                 #
# Copyright 1999-2012 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\src\ #
#                    app.c                                                    #
#    Command line =  \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\src\ #
#                    app.c -D USE_STDPERIPH_DRIVER -D STM32F4XX -D            #
#                    USE_STM324xG_EVAL -D USE_USB_OTG_FS -lcN                 #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\STM324xG-EVAL_USBD-FS\List\ -o                         #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\STM324xG-EVAL_USBD-FS\Obj\ --debug --endian=little     #
#                    --cpu=Cortex-M4 -e --fpu=None --dlib_config "C:\Program  #
#                    Files (x86)\IAR Systems\Embedded Workbench 6.4           #
#                    Kickstart\arm\INC\c\DLib_Config_Full.h" -I               #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\..\ -I \\psf\Home\Documents\Eclipse\Workspace\ARM\STM3 #
#                    2_USB-Host-Device_Lib_V2.1.0\Project\USB_Device_Examples #
#                    \DFU\EWARM\..\inc\ -I \\psf\Home\Documents\Eclipse\Works #
#                    pace\ARM\STM32_USB-Host-Device_Lib_V2.1.0\Project\USB_De #
#                    vice_Examples\DFU\EWARM\..\..\..\..\Libraries\CMSIS\Devi #
#                    ce\ST\STM32F4xx\Include\ -I                              #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\..\..\..\..\Libraries\STM32F4xx_StdPeriph_Driver\inc\  #
#                    -I \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB- #
#                    Host-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\E #
#                    WARM\..\..\..\..\Libraries\STM32_USB_OTG_Driver\inc\ -I  #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\..\..\..\..\Libraries\STM32_USB_Device_Library\Core\in #
#                    c\ -I \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_U #
#                    SB-Host-Device_Lib_V2.1.0\Project\USB_Device_Examples\DF #
#                    U\EWARM\..\..\..\..\Libraries\STM32_USB_Device_Library\C #
#                    lass\dfu\inc\ -I \\psf\Home\Documents\Eclipse\Workspace\ #
#                    ARM\STM32_USB-Host-Device_Lib_V2.1.0\Project\USB_Device_ #
#                    Examples\DFU\EWARM\..\..\..\..\Utilities\STM32_EVAL\ -I  #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\..\..\..\..\Utilities\STM32_EVAL\Common\ -I            #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\..\..\..\..\Utilities\STM32_EVAL\STM3240_41_G_EVAL\    #
#                    -Ohz --use_c++_inline -I "C:\Program Files (x86)\IAR     #
#                    Systems\Embedded Workbench 6.4                           #
#                    Kickstart\arm\CMSIS\Include\"                            #
#    List file    =  \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\STM324xG-EVAL_USBD-FS\List\app.lst                     #
#    Object file  =  \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\STM324xG-EVAL_USBD-FS\Obj\app.o                        #
#                                                                             #
#                                                                             #
###############################################################################

\\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Host-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\src\app.c
      1          /**
      2            ******************************************************************************
      3            * @file    app.c
      4            * @author  MCD Application Team
      5            * @version V1.1.0
      6            * @date    19-March-2012
      7            * @brief   This file provides all the Application firmware functions.
      8            ******************************************************************************
      9            * @attention
     10            *
     11            * <h2><center>&copy; COPYRIGHT 2012 STMicroelectronics</center></h2>
     12            *
     13            * Licensed under MCD-ST Liberty SW License Agreement V2, (the "License");
     14            * You may not use this file except in compliance with the License.
     15            * You may obtain a copy of the License at:
     16            *
     17            *        http://www.st.com/software_license_agreement_liberty_v2
     18            *
     19            * Unless required by applicable law or agreed to in writing, software 
     20            * distributed under the License is distributed on an "AS IS" BASIS, 
     21            * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     22            * See the License for the specific language governing permissions and
     23            * limitations under the License.
     24            *
     25            ******************************************************************************
     26            */ 
     27          
     28          /* Includes ------------------------------------------------------------------*/ 
     29          
     30          #include "usbd_dfu_core.h"
     31          #include "usbd_usr.h"
     32          #include "usbd_desc.h"
     33          #include "usb_conf.h"
     34          
     35          /** @addtogroup STM32_USB_OTG_DEVICE_LIBRARY
     36            * @{
     37            */
     38          
     39          
     40          /** @defgroup APP_DFU 
     41            * @brief Mass storage application module
     42            * @{
     43            */ 
     44          
     45          /** @defgroup APP_DFU_Private_TypesDefinitions
     46            * @{
     47            */ 
     48          /**
     49            * @}
     50            */ 
     51          
     52          
     53          /** @defgroup APP_DFU_Private_Defines
     54            * @{
     55            */ 
     56          
     57          /**
     58            * @}
     59            */ 
     60          
     61          
     62          /** @defgroup APP_DFU_Private_Macros
     63            * @{
     64            */ 
     65          /**
     66            * @}
     67            */ 
     68          
     69          
     70          /** @defgroup APP_DFU_Private_Variables
     71            * @{
     72            */ 
     73            
     74          #ifdef USB_OTG_HS_INTERNAL_DMA_ENABLED
     75            #if defined ( __ICCARM__ ) /*!< IAR Compiler */
     76              #pragma data_alignment=4   
     77            #endif
     78          #endif /* USB_OTG_HS_INTERNAL_DMA_ENABLED */
     79          
     80          __ALIGN_BEGIN USB_OTG_CORE_HANDLE    USB_OTG_dev __ALIGN_END ;
     81          
     82          
     83          pFunction Jump_To_Application;
     84          uint32_t JumpAddress;
     85          /**
     86            * @}
     87            */ 
     88          
     89          
     90          /** @defgroup APP_DFU_Private_FunctionPrototypes
     91            * @{
     92            */ 
     93          /**
     94            * @}
     95            */ 
     96          
     97          
     98          /** @defgroup APP_DFU_Private_Functions
     99            * @{
    100            */ 
    101          
    102          /**
    103            * @brief  Program entry point
    104            * @param  None
    105            * @retval None
    106            */
    107          int main(void)
    108          {
    109            /* Counter for the LED toggling delay */
    110            __IO uint32_t i = 0; 
    111            
    112            
    113            /*!< At this stage the microcontroller clock setting is already configured, 
    114            this is done through SystemInit() function which is called from startup
    115            file (startup_stm32fxxx_xx.s) before to branch to application main.
    116            To reconfigure the default setting of SystemInit() function, refer to
    117            system_stm32fxxx.c file
    118            */  
    119             
    120            /* Configure "DFU enter" button */
    121            STM_EVAL_PBInit(Button_KEY, Mode_GPIO);
    122          
    123            /* Check if the Key push-button on STM32-EVAL Board is pressed */
    124            if (STM_EVAL_PBGetState(Button_KEY) != 0x00)
    125            { /* Test if user code is programmed starting from address 0x800C000 */
    126              if (((*(__IO uint32_t*)APP_DEFAULT_ADD) & 0x2FFE0000 ) == 0x20000000)
    127              { /* Jump to user application */
    128          
    129                JumpAddress = *(__IO uint32_t*) (APP_DEFAULT_ADD + 4);
    130                Jump_To_Application = (pFunction) JumpAddress;
    131                /* Initialize user application's Stack Pointer */
    132                __set_MSP(*(__IO uint32_t*) APP_DEFAULT_ADD);
    133                Jump_To_Application();
    134              }
    135            } /* Otherwise enters DFU mode to allow user to program his application */
    136          
    137            
    138            USBD_Init(&USB_OTG_dev,
    139          #ifdef USE_USB_OTG_HS 
    140                      USB_OTG_HS_CORE_ID,
    141          #else            
    142                      USB_OTG_FS_CORE_ID,
    143          #endif 
    144                      &USR_desc, 
    145                      &DFU_cb, 
    146                      &USR_cb);
    147            
    148            /* Setup SysTick Timer for 10 msec interrupts 
    149               This interrupt is used to display the current state of the DFU core */
    150            if (SysTick_Config(SystemCoreClock / 100))
    151            { 
    152              /* Capture error */ 
    153              while (1);
    154            } 
    155            
    156            /* Main loop */
    157            while (1)
    158            {
    159              if (i++ == 0x100000)
    160              {
    161                STM_EVAL_LEDToggle(LED1);
    162                STM_EVAL_LEDToggle(LED2);
    163                STM_EVAL_LEDToggle(LED3);
    164                STM_EVAL_LEDToggle(LED4);
    165                i = 0;
    166              }
    167            }
    168          } 
    169          
    170          #ifdef USE_FULL_ASSERT
    171          /**
    172          * @brief  assert_failed
    173          *         Reports the name of the source file and the source line number
    174          *         where the assert_param error has occurred.
    175          * @param  File: pointer to the source file name
    176          * @param  Line: assert_param error line source number
    177          * @retval None
    178          */
    179          void assert_failed(uint8_t* file, uint32_t line)
    180          {
    181            /* User can add his own implementation to report the file name and line number,
    182            ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
    183            
    184            /* Infinite loop */
    185            while (1)
    186            {}
    187          }
    188          #endif
    189          
    190          /**
    191            * @}
    192            */ 
    193          
    194          
    195          /**
    196            * @}
    197            */ 
    198          
    199          
    200          /**
    201            * @}
    202            */ 
    203          
    204          /************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
        8  main
             8 -- Indirect call
             8 -> STM_EVAL_LEDToggle
             8 -> STM_EVAL_PBGetState
             8 -> STM_EVAL_PBInit
             8 -> USBD_Init


   Section sizes:

   Bytes  Function/Label
   -----  --------------
    1532  Jump_To_Application
          JumpAddress
          USB_OTG_dev
     192  main

 
 1 532 bytes in section .bss
   192 bytes in section .text
 
   192 bytes of CODE memory
 1 532 bytes of DATA memory

Errors: none
Warnings: none
