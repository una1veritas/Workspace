###############################################################################
#                                                                             #
#                                                       19/Sep/2012  16:16:25 #
# IAR ANSI C/C++ Compiler V6.40.2.33884/W32 KICKSTART for ARM                 #
# Copyright 1999-2012 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\src\ #
#                    usbd_usr.c                                               #
#    Command line =  \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\src\ #
#                    usbd_usr.c -D USE_STDPERIPH_DRIVER -D STM32F4XX -D       #
#                    USE_STM324xG_EVAL -D USE_USB_OTG_FS -lcN                 #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\STM324xG-EVAL_USBD-FS\List\ -o                         #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\STM324xG-EVAL_USBD-FS\Obj\ --debug --endian=little     #
#                    --cpu=Cortex-M4 -e --fpu=None --dlib_config "C:\Program  #
#                    Files (x86)\IAR Systems\Embedded Workbench 6.4           #
#                    Kickstart\arm\INC\c\DLib_Config_Full.h" -I               #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\..\ -I \\psf\Home\Documents\Eclipse\Workspace\ARM\STM3 #
#                    2_USB-Host-Device_Lib_V2.1.0\Project\USB_Device_Examples #
#                    \DFU\EWARM\..\inc\ -I \\psf\Home\Documents\Eclipse\Works #
#                    pace\ARM\STM32_USB-Host-Device_Lib_V2.1.0\Project\USB_De #
#                    vice_Examples\DFU\EWARM\..\..\..\..\Libraries\CMSIS\Devi #
#                    ce\ST\STM32F4xx\Include\ -I                              #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\..\..\..\..\Libraries\STM32F4xx_StdPeriph_Driver\inc\  #
#                    -I \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB- #
#                    Host-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\E #
#                    WARM\..\..\..\..\Libraries\STM32_USB_OTG_Driver\inc\ -I  #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\..\..\..\..\Libraries\STM32_USB_Device_Library\Core\in #
#                    c\ -I \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_U #
#                    SB-Host-Device_Lib_V2.1.0\Project\USB_Device_Examples\DF #
#                    U\EWARM\..\..\..\..\Libraries\STM32_USB_Device_Library\C #
#                    lass\dfu\inc\ -I \\psf\Home\Documents\Eclipse\Workspace\ #
#                    ARM\STM32_USB-Host-Device_Lib_V2.1.0\Project\USB_Device_ #
#                    Examples\DFU\EWARM\..\..\..\..\Utilities\STM32_EVAL\ -I  #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\..\..\..\..\Utilities\STM32_EVAL\Common\ -I            #
#                    \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\..\..\..\..\Utilities\STM32_EVAL\STM3240_41_G_EVAL\    #
#                    -Ohz --use_c++_inline -I "C:\Program Files (x86)\IAR     #
#                    Systems\Embedded Workbench 6.4                           #
#                    Kickstart\arm\CMSIS\Include\"                            #
#    List file    =  \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\STM324xG-EVAL_USBD-FS\List\usbd_usr.lst                #
#    Object file  =  \\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Hos #
#                    t-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\EWAR #
#                    M\STM324xG-EVAL_USBD-FS\Obj\usbd_usr.o                   #
#                                                                             #
#                                                                             #
###############################################################################

\\psf\Home\Documents\Eclipse\Workspace\ARM\STM32_USB-Host-Device_Lib_V2.1.0\Project\USB_Device_Examples\DFU\src\usbd_usr.c
      1          /**
      2            ******************************************************************************
      3            * @file    usbd_usr.c
      4            * @author  MCD Application Team
      5            * @version V1.1.0
      6            * @date    19-March-2012
      7            * @brief   This file includes the user application layer
      8            ******************************************************************************
      9            * @attention
     10            *
     11            * <h2><center>&copy; COPYRIGHT 2012 STMicroelectronics</center></h2>
     12            *
     13            * Licensed under MCD-ST Liberty SW License Agreement V2, (the "License");
     14            * You may not use this file except in compliance with the License.
     15            * You may obtain a copy of the License at:
     16            *
     17            *        http://www.st.com/software_license_agreement_liberty_v2
     18            *
     19            * Unless required by applicable law or agreed to in writing, software 
     20            * distributed under the License is distributed on an "AS IS" BASIS, 
     21            * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     22            * See the License for the specific language governing permissions and
     23            * limitations under the License.
     24            *
     25            ******************************************************************************
     26            */ 
     27          
     28          /* Includes ------------------------------------------------------------------*/
     29          #include "usbd_usr.h"
     30          #include "usbd_ioreq.h"
     31          #include "lcd_log.h"
     32          
     33          /** @addtogroup STM32_USB_OTG_DEVICE_LIBRARY
     34          * @{
     35          */
     36          
     37          /** @defgroup USBD_USR 
     38          * @brief    This file includes the user application layer
     39          * @{
     40          */ 
     41          
     42          /** @defgroup USBD_USR_Private_TypesDefinitions
     43          * @{
     44          */ 
     45          /**
     46          * @}
     47          */ 
     48          
     49          
     50          /** @defgroup USBD_USR_Private_Defines
     51          * @{
     52          */ 
     53          /**
     54          * @}
     55          */ 
     56          
     57          
     58          /** @defgroup USBD_USR_Private_Macros
     59          * @{
     60          */ 
     61          /**
     62          * @}
     63          */ 
     64          
     65          
     66          /** @defgroup USBD_USR_Private_Variables
     67          * @{
     68          */ 
     69          
     70          USBD_Usr_cb_TypeDef USR_cb =
     71          {
     72            USBD_USR_Init,
     73            USBD_USR_DeviceReset,
     74            USBD_USR_DeviceConfigured,
     75            USBD_USR_DeviceSuspended,
     76            USBD_USR_DeviceResumed,
     77            
     78            USBD_USR_DeviceConnected,
     79            USBD_USR_DeviceDisconnected,    
     80          };
     81          
     82          uint8_t State = 0;
     83          /**
     84          * @}
     85          */
     86          
     87          /** @defgroup USBD_USR_Private_Constants
     88          * @{
     89          */ 
     90          
     91          /**
     92          * @}
     93          */
     94          
     95          
     96          
     97          /** @defgroup USBD_USR_Private_FunctionPrototypes
     98          * @{
     99          */ 
    100          /**
    101          * @}
    102          */ 
    103          
    104          
    105          /** @defgroup USBD_USR_Private_Functions
    106          * @{
    107          */ 
    108          
    109          #define USER_INFORMATION1      "[Key]:Enter DFU mode after reset"
    110          /**
    111          * @brief  USBD_USR_Init 
    112          *         Displays the message on LCD for host lib initialization
    113          * @param  None
    114          * @retval None
    115          */
    116          void USBD_USR_Init(void)
    117          {  
    118            /* Initialize LEDs */
    119            STM_EVAL_LEDInit(LED1);
    120            STM_EVAL_LEDInit(LED2);
    121            STM_EVAL_LEDInit(LED3);
    122            STM_EVAL_LEDInit(LED4);   
    123            
    124            /* Initialize the LCD */
    125          #if defined (USE_STM322xG_EVAL)
    126            STM322xG_LCD_Init();
    127          #elif defined(USE_STM324xG_EVAL)
    128            STM324xG_LCD_Init();
    129          #elif defined (USE_STM3210C_EVAL)
    130            STM3210C_LCD_Init();
    131          #else
    132           #error "Missing define: Evaluation board (ie. USE_STM322xG_EVAL)"
    133          #endif
    134            
    135            LCD_LOG_Init();
    136            
    137          #ifdef USE_USB_OTG_HS 
    138            LCD_LOG_SetHeader(" USB OTG HS DFU Device");
    139          #else
    140            LCD_LOG_SetHeader(" USB OTG FS DFU Device");
    141          #endif
    142            
    143            LCD_UsrLog("> USB device library started.\n"); 
    144            LCD_LOG_SetFooter ("     USB Device Library v1.1.0" ); 
    145            
    146            /* Information panel */
    147            LCD_SetTextColor(Green);
    148            LCD_DisplayStringLine( LCD_PIXEL_HEIGHT - 30, USER_INFORMATION1);
    149            LCD_SetTextColor(LCD_LOG_DEFAULT_COLOR);
    150          }
    151          
    152          /**
    153          * @brief  USBD_USR_DeviceReset 
    154          *         Displays the message on LCD on device Reset Event
    155          * @param  speed : device speed
    156          * @retval None
    157          */
    158          void USBD_USR_DeviceReset(uint8_t speed )
    159          {
    160           switch (speed)
    161           {
    162             case USB_OTG_SPEED_HIGH: 
    163               LCD_LOG_SetFooter ("     USB Device Library v1.1.0 [HS]" );
    164               break;
    165          
    166            case USB_OTG_SPEED_FULL: 
    167               LCD_LOG_SetFooter ("     USB Device Library v1.1.0 [FS]" );
    168               break;
    169           default:
    170               LCD_LOG_SetFooter ("     USB Device Library v1.1.0 [??]" );
    171               
    172           }
    173          }
    174          
    175          
    176          /**
    177          * @brief  USBD_USR_DeviceConfigured
    178          *         Displays the message on LCD on device configuration Event
    179          * @param  None
    180          * @retval Staus
    181          */
    182          void USBD_USR_DeviceConfigured (void)
    183          {
    184            if (State == 0)
    185            {
    186              LCD_UsrLog("> DFU Interface Started.\n");
    187            }
    188            else if (State == 1)
    189            {
    190              LCD_UsrLog("> DFU Interface Configured.\n");
    191            }
    192          
    193            State++;
    194          }
    195          /**
    196          * @brief  USBD_USR_DeviceSuspended 
    197          *         Displays the message on LCD on device suspend Event
    198          * @param  None
    199          * @retval None
    200          */
    201          void USBD_USR_DeviceSuspended(void)
    202          {
    203            LCD_UsrLog("> USB Device in Suspend Mode.\n");
    204            /* Users can do their application actions here for the USB-Reset */
    205          }
    206          
    207          
    208          /**
    209          * @brief  USBD_USR_DeviceResumed 
    210          *         Displays the message on LCD on device resume Event
    211          * @param  None
    212          * @retval None
    213          */
    214          void USBD_USR_DeviceResumed(void)
    215          {
    216              LCD_UsrLog("> USB Device in Idle Mode.\n");
    217            /* Users can do their application actions here for the USB-Reset */
    218          }
    219          
    220          /**
    221          * @brief  USBD_USR_DeviceConnected
    222          *         Displays the message on LCD on device connection Event
    223          * @param  None
    224          * @retval Staus
    225          */
    226          void USBD_USR_DeviceConnected (void)
    227          {
    228            LCD_UsrLog("> USB Device Connected.\n");
    229          }
    230          
    231          
    232          /**
    233          * @brief  USBD_USR_DeviceDisonnected
    234          *         Displays the message on LCD on device disconnection Event
    235          * @param  None
    236          * @retval Staus
    237          */
    238          void USBD_USR_DeviceDisconnected (void)
    239          {
    240            LCD_UsrLog("> USB Device Disconnected.\n");
    241          }
    242          /**
    243          * @}
    244          */ 
    245          
    246          /**
    247          * @}
    248          */ 
    249          
    250          /************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/
    251          

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
        8  USBD_USR_DeviceConfigured
              8 -> printf
        0  USBD_USR_DeviceConnected
              0 -> printf
        0  USBD_USR_DeviceDisconnected
              0 -> printf
        0  USBD_USR_DeviceReset
              0 -> LCD_LOG_SetFooter
        0  USBD_USR_DeviceResumed
              0 -> printf
        0  USBD_USR_DeviceSuspended
              0 -> printf
       16  USBD_USR_Init
             16 -> LCD_DisplayStringLine
             16 -> LCD_LOG_Init
             16 -> LCD_LOG_SetFooter
             16 -> LCD_LOG_SetHeader
              0 -> LCD_SetTextColor
             16 -> LCD_SetTextColor
             16 -> STM324xG_LCD_Init
             16 -> STM_EVAL_LEDInit
             16 -> printf


   Section sizes:

   Bytes  Function/Label
   -----  --------------
     108  ?<Constant "     USB Device Libra...">_1
     124  ?<Constant " USB OTG FS DFU Device">
      60  ?<Constant "> DFU Interface Start...">
      28  ?<Constant "> USB Device Connected.\n">
      28  ?<Constant "> USB Device Disconne...">
      28  ?<Constant "> USB Device in Idle ...">
      32  ?<Constant "> USB Device in Suspe...">
       4  ??DataTable6
       4  ??DataTable6_1
       4  ??DataTable6_2
       4  ??DataTable6_3
       4  ??DataTable6_4
       4  ??DataTable6_5
       4  ??DataTable6_6
       4  ??DataTable6_7
       4  ??DataTable6_8
       1  State
      40  USBD_USR_DeviceConfigured
      14  USBD_USR_DeviceConnected
      14  USBD_USR_DeviceDisconnected
      28  USBD_USR_DeviceReset
      14  USBD_USR_DeviceResumed
      14  USBD_USR_DeviceSuspended
      94  USBD_USR_Init
      28  USR_cb

 
   1 byte  in section .bss
  28 bytes in section .data
 408 bytes in section .rodata
 254 bytes in section .text
 
 254 bytes of CODE  memory
 408 bytes of CONST memory
  29 bytes of DATA  memory

Errors: none
Warnings: none
