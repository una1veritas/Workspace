   1               		.file	"spi.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               	.global	spiInit
  12               	spiInit:
  13               	.LFB7:
  14               		.file 1 "../../os/hal/src/spi.c"
   1:../../os/hal/src/spi.c **** /*
   2:../../os/hal/src/spi.c ****     ChibiOS/RT - Copyright (C) 2006,2007,2008,2009,2010,
   3:../../os/hal/src/spi.c ****                  2011,2012 Giovanni Di Sirio.
   4:../../os/hal/src/spi.c **** 
   5:../../os/hal/src/spi.c ****     This file is part of ChibiOS/RT.
   6:../../os/hal/src/spi.c **** 
   7:../../os/hal/src/spi.c ****     ChibiOS/RT is free software; you can redistribute it and/or modify
   8:../../os/hal/src/spi.c ****     it under the terms of the GNU General Public License as published by
   9:../../os/hal/src/spi.c ****     the Free Software Foundation; either version 3 of the License, or
  10:../../os/hal/src/spi.c ****     (at your option) any later version.
  11:../../os/hal/src/spi.c **** 
  12:../../os/hal/src/spi.c ****     ChibiOS/RT is distributed in the hope that it will be useful,
  13:../../os/hal/src/spi.c ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  14:../../os/hal/src/spi.c ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  15:../../os/hal/src/spi.c ****     GNU General Public License for more details.
  16:../../os/hal/src/spi.c **** 
  17:../../os/hal/src/spi.c ****     You should have received a copy of the GNU General Public License
  18:../../os/hal/src/spi.c ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  19:../../os/hal/src/spi.c **** */
  20:../../os/hal/src/spi.c **** 
  21:../../os/hal/src/spi.c **** /**
  22:../../os/hal/src/spi.c ****  * @file    spi.c
  23:../../os/hal/src/spi.c ****  * @brief   SPI Driver code.
  24:../../os/hal/src/spi.c ****  *
  25:../../os/hal/src/spi.c ****  * @addtogroup SPI
  26:../../os/hal/src/spi.c ****  * @{
  27:../../os/hal/src/spi.c ****  */
  28:../../os/hal/src/spi.c **** 
  29:../../os/hal/src/spi.c **** #include "ch.h"
  30:../../os/hal/src/spi.c **** #include "hal.h"
  31:../../os/hal/src/spi.c **** 
  32:../../os/hal/src/spi.c **** #if HAL_USE_SPI || defined(__DOXYGEN__)
  33:../../os/hal/src/spi.c **** 
  34:../../os/hal/src/spi.c **** /*===========================================================================*/
  35:../../os/hal/src/spi.c **** /* Driver local definitions.                                                 */
  36:../../os/hal/src/spi.c **** /*===========================================================================*/
  37:../../os/hal/src/spi.c **** 
  38:../../os/hal/src/spi.c **** /*===========================================================================*/
  39:../../os/hal/src/spi.c **** /* Driver exported variables.                                                */
  40:../../os/hal/src/spi.c **** /*===========================================================================*/
  41:../../os/hal/src/spi.c **** 
  42:../../os/hal/src/spi.c **** /*===========================================================================*/
  43:../../os/hal/src/spi.c **** /* Driver local variables.                                                   */
  44:../../os/hal/src/spi.c **** /*===========================================================================*/
  45:../../os/hal/src/spi.c **** 
  46:../../os/hal/src/spi.c **** /*===========================================================================*/
  47:../../os/hal/src/spi.c **** /* Driver local functions.                                                   */
  48:../../os/hal/src/spi.c **** /*===========================================================================*/
  49:../../os/hal/src/spi.c **** 
  50:../../os/hal/src/spi.c **** /*===========================================================================*/
  51:../../os/hal/src/spi.c **** /* Driver exported functions.                                                */
  52:../../os/hal/src/spi.c **** /*===========================================================================*/
  53:../../os/hal/src/spi.c **** 
  54:../../os/hal/src/spi.c **** /**
  55:../../os/hal/src/spi.c ****  * @brief   SPI Driver initialization.
  56:../../os/hal/src/spi.c ****  * @note    This function is implicitly invoked by @p halInit(), there is
  57:../../os/hal/src/spi.c ****  *          no need to explicitly initialize the driver.
  58:../../os/hal/src/spi.c ****  *
  59:../../os/hal/src/spi.c ****  * @init
  60:../../os/hal/src/spi.c ****  */
  61:../../os/hal/src/spi.c **** void spiInit(void) {
  15               		.loc 1 61 0
  16               		.cfi_startproc
  17               	/* prologue: function */
  18               	/* frame size = 0 */
  19               	/* stack size = 0 */
  20               	.L__stack_usage = 0
  62:../../os/hal/src/spi.c **** 
  63:../../os/hal/src/spi.c ****   spi_lld_init();
  21               		.loc 1 63 0
  22 0000 0C94 0000 		jmp spi_lld_init
  23               	.LVL0:
  24               		.cfi_endproc
  25               	.LFE7:
  27               	.global	spiObjectInit
  29               	spiObjectInit:
  30               	.LFB8:
  64:../../os/hal/src/spi.c **** }
  65:../../os/hal/src/spi.c **** 
  66:../../os/hal/src/spi.c **** /**
  67:../../os/hal/src/spi.c ****  * @brief   Initializes the standard part of a @p SPIDriver structure.
  68:../../os/hal/src/spi.c ****  *
  69:../../os/hal/src/spi.c ****  * @param[out] spip     pointer to the @p SPIDriver object
  70:../../os/hal/src/spi.c ****  *
  71:../../os/hal/src/spi.c ****  * @init
  72:../../os/hal/src/spi.c ****  */
  73:../../os/hal/src/spi.c **** void spiObjectInit(SPIDriver *spip) {
  31               		.loc 1 73 0
  32               		.cfi_startproc
  33               	.LVL1:
  34               	/* prologue: function */
  35               	/* frame size = 0 */
  36               	/* stack size = 0 */
  37               	.L__stack_usage = 0
  74:../../os/hal/src/spi.c **** 
  75:../../os/hal/src/spi.c ****   spip->state = SPI_STOP;
  38               		.loc 1 75 0
  39 0004 21E0      		ldi r18,lo8(1)
  40 0006 FC01      		movw r30,r24
  41 0008 2083      		st Z,r18
  76:../../os/hal/src/spi.c ****   spip->config = NULL;
  42               		.loc 1 76 0
  43 000a 1282      		std Z+2,__zero_reg__
  44 000c 1182      		std Z+1,__zero_reg__
  77:../../os/hal/src/spi.c **** #if SPI_USE_WAIT
  78:../../os/hal/src/spi.c ****   spip->thread = NULL;
  45               		.loc 1 78 0
  46 000e 1482      		std Z+4,__zero_reg__
  47 0010 1382      		std Z+3,__zero_reg__
  79:../../os/hal/src/spi.c **** #endif /* SPI_USE_WAIT */
  80:../../os/hal/src/spi.c **** #if SPI_USE_MUTUAL_EXCLUSION
  81:../../os/hal/src/spi.c **** #if CH_USE_MUTEXES
  82:../../os/hal/src/spi.c ****   chMtxInit(&spip->mutex);
  48               		.loc 1 82 0
  49 0012 0596      		adiw r24,5
  50               	.LVL2:
  51 0014 0C94 0000 		jmp chMtxInit
  52               	.LVL3:
  53               		.cfi_endproc
  54               	.LFE8:
  56               	.global	spiStart
  58               	spiStart:
  59               	.LFB9:
  83:../../os/hal/src/spi.c **** #else
  84:../../os/hal/src/spi.c ****   chSemInit(&spip->semaphore, 1);
  85:../../os/hal/src/spi.c **** #endif
  86:../../os/hal/src/spi.c **** #endif /* SPI_USE_MUTUAL_EXCLUSION */
  87:../../os/hal/src/spi.c **** #if defined(SPI_DRIVER_EXT_INIT_HOOK)
  88:../../os/hal/src/spi.c ****   SPI_DRIVER_EXT_INIT_HOOK(spip);
  89:../../os/hal/src/spi.c **** #endif
  90:../../os/hal/src/spi.c **** }
  91:../../os/hal/src/spi.c **** 
  92:../../os/hal/src/spi.c **** /**
  93:../../os/hal/src/spi.c ****  * @brief   Configures and activates the SPI peripheral.
  94:../../os/hal/src/spi.c ****  *
  95:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
  96:../../os/hal/src/spi.c ****  * @param[in] config    pointer to the @p SPIConfig object
  97:../../os/hal/src/spi.c ****  *
  98:../../os/hal/src/spi.c ****  * @api
  99:../../os/hal/src/spi.c ****  */
 100:../../os/hal/src/spi.c **** void spiStart(SPIDriver *spip, const SPIConfig *config) {
  60               		.loc 1 100 0
  61               		.cfi_startproc
  62               	.LVL4:
  63 0018 CF93      		push r28
  64               	.LCFI0:
  65               		.cfi_def_cfa_offset 3
  66               		.cfi_offset 28, -2
  67 001a DF93      		push r29
  68               	.LCFI1:
  69               		.cfi_def_cfa_offset 4
  70               		.cfi_offset 29, -3
  71               	/* prologue: function */
  72               	/* frame size = 0 */
  73               	/* stack size = 2 */
  74               	.L__stack_usage = 2
  75 001c EC01      		movw r28,r24
 101:../../os/hal/src/spi.c **** 
 102:../../os/hal/src/spi.c ****   chDbgCheck((spip != NULL) && (config != NULL), "spiStart");
 103:../../os/hal/src/spi.c **** 
 104:../../os/hal/src/spi.c ****   chSysLock();
  76               		.loc 1 104 0
  77               	/* #APP */
  78               	 ;  104 "../../os/hal/src/spi.c" 1
  79 001e F894      		cli
  80               	 ;  0 "" 2
 105:../../os/hal/src/spi.c ****   chDbgAssert((spip->state == SPI_STOP) || (spip->state == SPI_READY),
  81               		.loc 1 105 0
  82               	/* #NOAPP */
  83 0020 8881      		ld r24,Y
  84               	.LVL5:
  85 0022 8130      		cpi r24,lo8(1)
  86 0024 01F0      		breq .L4
  87               		.loc 1 105 0 is_stmt 0 discriminator 2
  88 0026 8881      		ld r24,Y
  89               	.L4:
 106:../../os/hal/src/spi.c ****               "spiStart(), #1", "invalid state");
 107:../../os/hal/src/spi.c ****   spip->config = config;
  90               		.loc 1 107 0 is_stmt 1
  91 0028 7A83      		std Y+2,r23
  92 002a 6983      		std Y+1,r22
 108:../../os/hal/src/spi.c ****   spi_lld_start(spip);
  93               		.loc 1 108 0
  94 002c CE01      		movw r24,r28
  95 002e 0E94 0000 		call spi_lld_start
  96               	.LVL6:
 109:../../os/hal/src/spi.c ****   spip->state = SPI_READY;
  97               		.loc 1 109 0
  98 0032 82E0      		ldi r24,lo8(2)
  99 0034 8883      		st Y,r24
 110:../../os/hal/src/spi.c ****   chSysUnlock();
 100               		.loc 1 110 0
 101               	/* #APP */
 102               	 ;  110 "../../os/hal/src/spi.c" 1
 103 0036 7894      		sei
 104               	 ;  0 "" 2
 105               	/* epilogue start */
 111:../../os/hal/src/spi.c **** }
 106               		.loc 1 111 0
 107               	/* #NOAPP */
 108 0038 DF91      		pop r29
 109 003a CF91      		pop r28
 110               	.LVL7:
 111 003c 0895      		ret
 112               		.cfi_endproc
 113               	.LFE9:
 115               	.global	spiStop
 117               	spiStop:
 118               	.LFB10:
 112:../../os/hal/src/spi.c **** 
 113:../../os/hal/src/spi.c **** /**
 114:../../os/hal/src/spi.c ****  * @brief Deactivates the SPI peripheral.
 115:../../os/hal/src/spi.c ****  * @note  Deactivating the peripheral also enforces a release of the slave
 116:../../os/hal/src/spi.c ****  *        select line.
 117:../../os/hal/src/spi.c ****  *
 118:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 119:../../os/hal/src/spi.c ****  *
 120:../../os/hal/src/spi.c ****  * @api
 121:../../os/hal/src/spi.c ****  */
 122:../../os/hal/src/spi.c **** void spiStop(SPIDriver *spip) {
 119               		.loc 1 122 0
 120               		.cfi_startproc
 121               	.LVL8:
 122 003e CF93      		push r28
 123               	.LCFI2:
 124               		.cfi_def_cfa_offset 3
 125               		.cfi_offset 28, -2
 126 0040 DF93      		push r29
 127               	.LCFI3:
 128               		.cfi_def_cfa_offset 4
 129               		.cfi_offset 29, -3
 130               	/* prologue: function */
 131               	/* frame size = 0 */
 132               	/* stack size = 2 */
 133               	.L__stack_usage = 2
 134 0042 EC01      		movw r28,r24
 123:../../os/hal/src/spi.c **** 
 124:../../os/hal/src/spi.c ****   chDbgCheck(spip != NULL, "spiStop");
 125:../../os/hal/src/spi.c **** 
 126:../../os/hal/src/spi.c ****   chSysLock();
 135               		.loc 1 126 0
 136               	/* #APP */
 137               	 ;  126 "../../os/hal/src/spi.c" 1
 138 0044 F894      		cli
 139               	 ;  0 "" 2
 127:../../os/hal/src/spi.c ****   chDbgAssert((spip->state == SPI_STOP) || (spip->state == SPI_READY),
 140               		.loc 1 127 0
 141               	/* #NOAPP */
 142 0046 8881      		ld r24,Y
 143               	.LVL9:
 144 0048 8130      		cpi r24,lo8(1)
 145 004a 01F0      		breq .L10
 146               		.loc 1 127 0 is_stmt 0 discriminator 2
 147 004c 8881      		ld r24,Y
 148               	.L10:
 128:../../os/hal/src/spi.c ****               "spiStop(), #1", "invalid state");
 129:../../os/hal/src/spi.c ****   spi_lld_unselect(spip);
 149               		.loc 1 129 0 is_stmt 1
 150 004e CE01      		movw r24,r28
 151 0050 0E94 0000 		call spi_lld_unselect
 152               	.LVL10:
 130:../../os/hal/src/spi.c ****   spi_lld_stop(spip);
 153               		.loc 1 130 0
 154 0054 CE01      		movw r24,r28
 155 0056 0E94 0000 		call spi_lld_stop
 156               	.LVL11:
 131:../../os/hal/src/spi.c ****   spip->state = SPI_STOP;
 157               		.loc 1 131 0
 158 005a 81E0      		ldi r24,lo8(1)
 159 005c 8883      		st Y,r24
 132:../../os/hal/src/spi.c ****   chSysUnlock();
 160               		.loc 1 132 0
 161               	/* #APP */
 162               	 ;  132 "../../os/hal/src/spi.c" 1
 163 005e 7894      		sei
 164               	 ;  0 "" 2
 165               	/* epilogue start */
 133:../../os/hal/src/spi.c **** }
 166               		.loc 1 133 0
 167               	/* #NOAPP */
 168 0060 DF91      		pop r29
 169 0062 CF91      		pop r28
 170               	.LVL12:
 171 0064 0895      		ret
 172               		.cfi_endproc
 173               	.LFE10:
 175               	.global	spiSelect
 177               	spiSelect:
 178               	.LFB11:
 134:../../os/hal/src/spi.c **** 
 135:../../os/hal/src/spi.c **** /**
 136:../../os/hal/src/spi.c ****  * @brief   Asserts the slave select signal and prepares for transfers.
 137:../../os/hal/src/spi.c ****  *
 138:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 139:../../os/hal/src/spi.c ****  *
 140:../../os/hal/src/spi.c ****  * @api
 141:../../os/hal/src/spi.c ****  */
 142:../../os/hal/src/spi.c **** void spiSelect(SPIDriver *spip) {
 179               		.loc 1 142 0
 180               		.cfi_startproc
 181               	.LVL13:
 182               	/* prologue: function */
 183               	/* frame size = 0 */
 184               	/* stack size = 0 */
 185               	.L__stack_usage = 0
 143:../../os/hal/src/spi.c **** 
 144:../../os/hal/src/spi.c ****   chDbgCheck(spip != NULL, "spiSelect");
 145:../../os/hal/src/spi.c **** 
 146:../../os/hal/src/spi.c ****   chSysLock();
 186               		.loc 1 146 0
 187               	/* #APP */
 188               	 ;  146 "../../os/hal/src/spi.c" 1
 189 0066 F894      		cli
 190               	 ;  0 "" 2
 147:../../os/hal/src/spi.c ****   chDbgAssert(spip->state == SPI_READY, "spiSelect(), #1", "not ready");
 191               		.loc 1 147 0
 192               	/* #NOAPP */
 193 0068 FC01      		movw r30,r24
 194 006a 2081      		ld r18,Z
 148:../../os/hal/src/spi.c ****   spiSelectI(spip);
 195               		.loc 1 148 0
 196 006c 0E94 0000 		call spi_lld_select
 197               	.LVL14:
 149:../../os/hal/src/spi.c ****   chSysUnlock();
 198               		.loc 1 149 0
 199               	/* #APP */
 200               	 ;  149 "../../os/hal/src/spi.c" 1
 201 0070 7894      		sei
 202               	 ;  0 "" 2
 203               	/* #NOAPP */
 204 0072 0895      		ret
 205               		.cfi_endproc
 206               	.LFE11:
 208               	.global	spiUnselect
 210               	spiUnselect:
 211               	.LFB12:
 150:../../os/hal/src/spi.c **** }
 151:../../os/hal/src/spi.c **** 
 152:../../os/hal/src/spi.c **** /**
 153:../../os/hal/src/spi.c ****  * @brief   Deasserts the slave select signal.
 154:../../os/hal/src/spi.c ****  * @details The previously selected peripheral is unselected.
 155:../../os/hal/src/spi.c ****  *
 156:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 157:../../os/hal/src/spi.c ****  *
 158:../../os/hal/src/spi.c ****  * @api
 159:../../os/hal/src/spi.c ****  */
 160:../../os/hal/src/spi.c **** void spiUnselect(SPIDriver *spip) {
 212               		.loc 1 160 0
 213               		.cfi_startproc
 214               	.LVL15:
 215               	/* prologue: function */
 216               	/* frame size = 0 */
 217               	/* stack size = 0 */
 218               	.L__stack_usage = 0
 161:../../os/hal/src/spi.c **** 
 162:../../os/hal/src/spi.c ****   chDbgCheck(spip != NULL, "spiUnselect");
 163:../../os/hal/src/spi.c **** 
 164:../../os/hal/src/spi.c ****   chSysLock();
 219               		.loc 1 164 0
 220               	/* #APP */
 221               	 ;  164 "../../os/hal/src/spi.c" 1
 222 0074 F894      		cli
 223               	 ;  0 "" 2
 165:../../os/hal/src/spi.c ****   chDbgAssert(spip->state == SPI_READY, "spiUnselect(), #1", "not ready");
 224               		.loc 1 165 0
 225               	/* #NOAPP */
 226 0076 FC01      		movw r30,r24
 227 0078 2081      		ld r18,Z
 166:../../os/hal/src/spi.c ****   spiUnselectI(spip);
 228               		.loc 1 166 0
 229 007a 0E94 0000 		call spi_lld_unselect
 230               	.LVL16:
 167:../../os/hal/src/spi.c ****   chSysUnlock();
 231               		.loc 1 167 0
 232               	/* #APP */
 233               	 ;  167 "../../os/hal/src/spi.c" 1
 234 007e 7894      		sei
 235               	 ;  0 "" 2
 236               	/* #NOAPP */
 237 0080 0895      		ret
 238               		.cfi_endproc
 239               	.LFE12:
 241               	.global	spiStartIgnore
 243               	spiStartIgnore:
 244               	.LFB13:
 168:../../os/hal/src/spi.c **** }
 169:../../os/hal/src/spi.c **** 
 170:../../os/hal/src/spi.c **** /**
 171:../../os/hal/src/spi.c ****  * @brief   Ignores data on the SPI bus.
 172:../../os/hal/src/spi.c ****  * @details This asynchronous function starts the transmission of a series of
 173:../../os/hal/src/spi.c ****  *          idle words on the SPI bus and ignores the received data.
 174:../../os/hal/src/spi.c ****  * @pre     A slave must have been selected using @p spiSelect() or
 175:../../os/hal/src/spi.c ****  *          @p spiSelectI().
 176:../../os/hal/src/spi.c ****  * @post    At the end of the operation the configured callback is invoked.
 177:../../os/hal/src/spi.c ****  *
 178:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 179:../../os/hal/src/spi.c ****  * @param[in] n         number of words to be ignored
 180:../../os/hal/src/spi.c ****  *
 181:../../os/hal/src/spi.c ****  * @api
 182:../../os/hal/src/spi.c ****  */
 183:../../os/hal/src/spi.c **** void spiStartIgnore(SPIDriver *spip, size_t n) {
 245               		.loc 1 183 0
 246               		.cfi_startproc
 247               	.LVL17:
 248               	/* prologue: function */
 249               	/* frame size = 0 */
 250               	/* stack size = 0 */
 251               	.L__stack_usage = 0
 184:../../os/hal/src/spi.c **** 
 185:../../os/hal/src/spi.c ****   chDbgCheck((spip != NULL) && (n > 0), "spiStartIgnore");
 186:../../os/hal/src/spi.c **** 
 187:../../os/hal/src/spi.c ****   chSysLock();
 252               		.loc 1 187 0
 253               	/* #APP */
 254               	 ;  187 "../../os/hal/src/spi.c" 1
 255 0082 F894      		cli
 256               	 ;  0 "" 2
 188:../../os/hal/src/spi.c ****   chDbgAssert(spip->state == SPI_READY, "spiStartIgnore(), #1", "not ready");
 257               		.loc 1 188 0
 258               	/* #NOAPP */
 259 0084 FC01      		movw r30,r24
 260 0086 2081      		ld r18,Z
 189:../../os/hal/src/spi.c ****   spiStartIgnoreI(spip, n);
 261               		.loc 1 189 0
 262 0088 23E0      		ldi r18,lo8(3)
 263 008a 2083      		st Z,r18
 264 008c 0E94 0000 		call spi_lld_ignore
 265               	.LVL18:
 190:../../os/hal/src/spi.c ****   chSysUnlock();
 266               		.loc 1 190 0
 267               	/* #APP */
 268               	 ;  190 "../../os/hal/src/spi.c" 1
 269 0090 7894      		sei
 270               	 ;  0 "" 2
 271               	/* #NOAPP */
 272 0092 0895      		ret
 273               		.cfi_endproc
 274               	.LFE13:
 276               	.global	spiStartExchange
 278               	spiStartExchange:
 279               	.LFB14:
 191:../../os/hal/src/spi.c **** }
 192:../../os/hal/src/spi.c **** 
 193:../../os/hal/src/spi.c **** /**
 194:../../os/hal/src/spi.c ****  * @brief   Exchanges data on the SPI bus.
 195:../../os/hal/src/spi.c ****  * @details This asynchronous function starts a simultaneous transmit/receive
 196:../../os/hal/src/spi.c ****  *          operation.
 197:../../os/hal/src/spi.c ****  * @pre     A slave must have been selected using @p spiSelect() or
 198:../../os/hal/src/spi.c ****  *          @p spiSelectI().
 199:../../os/hal/src/spi.c ****  * @post    At the end of the operation the configured callback is invoked.
 200:../../os/hal/src/spi.c ****  * @note    The buffers are organized as uint8_t arrays for data sizes below
 201:../../os/hal/src/spi.c ****  *          or equal to 8 bits else it is organized as uint16_t arrays.
 202:../../os/hal/src/spi.c ****  *
 203:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 204:../../os/hal/src/spi.c ****  * @param[in] n         number of words to be exchanged
 205:../../os/hal/src/spi.c ****  * @param[in] txbuf     the pointer to the transmit buffer
 206:../../os/hal/src/spi.c ****  * @param[out] rxbuf    the pointer to the receive buffer
 207:../../os/hal/src/spi.c ****  *
 208:../../os/hal/src/spi.c ****  * @api
 209:../../os/hal/src/spi.c ****  */
 210:../../os/hal/src/spi.c **** void spiStartExchange(SPIDriver *spip, size_t n,
 211:../../os/hal/src/spi.c ****                       const void *txbuf, void *rxbuf) {
 280               		.loc 1 211 0
 281               		.cfi_startproc
 282               	.LVL19:
 283               	/* prologue: function */
 284               	/* frame size = 0 */
 285               	/* stack size = 0 */
 286               	.L__stack_usage = 0
 212:../../os/hal/src/spi.c **** 
 213:../../os/hal/src/spi.c ****   chDbgCheck((spip != NULL) && (n > 0) && (rxbuf != NULL) && (txbuf != NULL),
 214:../../os/hal/src/spi.c ****              "spiStartExchange");
 215:../../os/hal/src/spi.c **** 
 216:../../os/hal/src/spi.c ****   chSysLock();
 287               		.loc 1 216 0
 288               	/* #APP */
 289               	 ;  216 "../../os/hal/src/spi.c" 1
 290 0094 F894      		cli
 291               	 ;  0 "" 2
 217:../../os/hal/src/spi.c ****   chDbgAssert(spip->state == SPI_READY, "spiStartExchange(), #1", "not ready");
 292               		.loc 1 217 0
 293               	/* #NOAPP */
 294 0096 DC01      		movw r26,r24
 295 0098 EC91      		ld r30,X
 218:../../os/hal/src/spi.c ****   spiStartExchangeI(spip, n, txbuf, rxbuf);
 296               		.loc 1 218 0
 297 009a E3E0      		ldi r30,lo8(3)
 298 009c EC93      		st X,r30
 299 009e 0E94 0000 		call spi_lld_exchange
 300               	.LVL20:
 219:../../os/hal/src/spi.c ****   chSysUnlock();
 301               		.loc 1 219 0
 302               	/* #APP */
 303               	 ;  219 "../../os/hal/src/spi.c" 1
 304 00a2 7894      		sei
 305               	 ;  0 "" 2
 306               	/* #NOAPP */
 307 00a4 0895      		ret
 308               		.cfi_endproc
 309               	.LFE14:
 311               	.global	spiStartSend
 313               	spiStartSend:
 314               	.LFB15:
 220:../../os/hal/src/spi.c **** }
 221:../../os/hal/src/spi.c **** 
 222:../../os/hal/src/spi.c **** /**
 223:../../os/hal/src/spi.c ****  * @brief   Sends data over the SPI bus.
 224:../../os/hal/src/spi.c ****  * @details This asynchronous function starts a transmit operation.
 225:../../os/hal/src/spi.c ****  * @pre     A slave must have been selected using @p spiSelect() or
 226:../../os/hal/src/spi.c ****  *          @p spiSelectI().
 227:../../os/hal/src/spi.c ****  * @post    At the end of the operation the configured callback is invoked.
 228:../../os/hal/src/spi.c ****  * @note    The buffers are organized as uint8_t arrays for data sizes below
 229:../../os/hal/src/spi.c ****  *          or equal to 8 bits else it is organized as uint16_t arrays.
 230:../../os/hal/src/spi.c ****  *
 231:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 232:../../os/hal/src/spi.c ****  * @param[in] n         number of words to send
 233:../../os/hal/src/spi.c ****  * @param[in] txbuf     the pointer to the transmit buffer
 234:../../os/hal/src/spi.c ****  *
 235:../../os/hal/src/spi.c ****  * @api
 236:../../os/hal/src/spi.c ****  */
 237:../../os/hal/src/spi.c **** void spiStartSend(SPIDriver *spip, size_t n, const void *txbuf) {
 315               		.loc 1 237 0
 316               		.cfi_startproc
 317               	.LVL21:
 318               	/* prologue: function */
 319               	/* frame size = 0 */
 320               	/* stack size = 0 */
 321               	.L__stack_usage = 0
 238:../../os/hal/src/spi.c **** 
 239:../../os/hal/src/spi.c ****   chDbgCheck((spip != NULL) && (n > 0) && (txbuf != NULL),
 240:../../os/hal/src/spi.c ****              "spiStartSend");
 241:../../os/hal/src/spi.c **** 
 242:../../os/hal/src/spi.c ****   chSysLock();
 322               		.loc 1 242 0
 323               	/* #APP */
 324               	 ;  242 "../../os/hal/src/spi.c" 1
 325 00a6 F894      		cli
 326               	 ;  0 "" 2
 243:../../os/hal/src/spi.c ****   chDbgAssert(spip->state == SPI_READY, "spiStartSend(), #1", "not ready");
 327               		.loc 1 243 0
 328               	/* #NOAPP */
 329 00a8 FC01      		movw r30,r24
 330 00aa 2081      		ld r18,Z
 244:../../os/hal/src/spi.c ****   spiStartSendI(spip, n, txbuf);
 331               		.loc 1 244 0
 332 00ac 23E0      		ldi r18,lo8(3)
 333 00ae 2083      		st Z,r18
 334 00b0 0E94 0000 		call spi_lld_send
 335               	.LVL22:
 245:../../os/hal/src/spi.c ****   chSysUnlock();
 336               		.loc 1 245 0
 337               	/* #APP */
 338               	 ;  245 "../../os/hal/src/spi.c" 1
 339 00b4 7894      		sei
 340               	 ;  0 "" 2
 341               	/* #NOAPP */
 342 00b6 0895      		ret
 343               		.cfi_endproc
 344               	.LFE15:
 346               	.global	spiStartReceive
 348               	spiStartReceive:
 349               	.LFB16:
 246:../../os/hal/src/spi.c **** }
 247:../../os/hal/src/spi.c **** 
 248:../../os/hal/src/spi.c **** /**
 249:../../os/hal/src/spi.c ****  * @brief   Receives data from the SPI bus.
 250:../../os/hal/src/spi.c ****  * @details This asynchronous function starts a receive operation.
 251:../../os/hal/src/spi.c ****  * @pre     A slave must have been selected using @p spiSelect() or
 252:../../os/hal/src/spi.c ****  *          @p spiSelectI().
 253:../../os/hal/src/spi.c ****  * @post    At the end of the operation the configured callback is invoked.
 254:../../os/hal/src/spi.c ****  * @note    The buffers are organized as uint8_t arrays for data sizes below
 255:../../os/hal/src/spi.c ****  *          or equal to 8 bits else it is organized as uint16_t arrays.
 256:../../os/hal/src/spi.c ****  *
 257:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 258:../../os/hal/src/spi.c ****  * @param[in] n         number of words to receive
 259:../../os/hal/src/spi.c ****  * @param[out] rxbuf    the pointer to the receive buffer
 260:../../os/hal/src/spi.c ****  *
 261:../../os/hal/src/spi.c ****  * @api
 262:../../os/hal/src/spi.c ****  */
 263:../../os/hal/src/spi.c **** void spiStartReceive(SPIDriver *spip, size_t n, void *rxbuf) {
 350               		.loc 1 263 0
 351               		.cfi_startproc
 352               	.LVL23:
 353               	/* prologue: function */
 354               	/* frame size = 0 */
 355               	/* stack size = 0 */
 356               	.L__stack_usage = 0
 264:../../os/hal/src/spi.c **** 
 265:../../os/hal/src/spi.c ****   chDbgCheck((spip != NULL) && (n > 0) && (rxbuf != NULL),
 266:../../os/hal/src/spi.c ****              "spiStartReceive");
 267:../../os/hal/src/spi.c **** 
 268:../../os/hal/src/spi.c ****   chSysLock();
 357               		.loc 1 268 0
 358               	/* #APP */
 359               	 ;  268 "../../os/hal/src/spi.c" 1
 360 00b8 F894      		cli
 361               	 ;  0 "" 2
 269:../../os/hal/src/spi.c ****   chDbgAssert(spip->state == SPI_READY, "spiStartReceive(), #1", "not ready");
 362               		.loc 1 269 0
 363               	/* #NOAPP */
 364 00ba FC01      		movw r30,r24
 365 00bc 2081      		ld r18,Z
 270:../../os/hal/src/spi.c ****   spiStartReceiveI(spip, n, rxbuf);
 366               		.loc 1 270 0
 367 00be 23E0      		ldi r18,lo8(3)
 368 00c0 2083      		st Z,r18
 369 00c2 0E94 0000 		call spi_lld_receive
 370               	.LVL24:
 271:../../os/hal/src/spi.c ****   chSysUnlock();
 371               		.loc 1 271 0
 372               	/* #APP */
 373               	 ;  271 "../../os/hal/src/spi.c" 1
 374 00c6 7894      		sei
 375               	 ;  0 "" 2
 376               	/* #NOAPP */
 377 00c8 0895      		ret
 378               		.cfi_endproc
 379               	.LFE16:
 381               	.global	spiIgnore
 383               	spiIgnore:
 384               	.LFB17:
 272:../../os/hal/src/spi.c **** }
 273:../../os/hal/src/spi.c **** 
 274:../../os/hal/src/spi.c **** #if SPI_USE_WAIT || defined(__DOXYGEN__)
 275:../../os/hal/src/spi.c **** /**
 276:../../os/hal/src/spi.c ****  * @brief   Ignores data on the SPI bus.
 277:../../os/hal/src/spi.c ****  * @details This synchronous function performs the transmission of a series of
 278:../../os/hal/src/spi.c ****  *          idle words on the SPI bus and ignores the received data.
 279:../../os/hal/src/spi.c ****  * @pre     In order to use this function the option @p SPI_USE_WAIT must be
 280:../../os/hal/src/spi.c ****  *          enabled.
 281:../../os/hal/src/spi.c ****  * @pre     In order to use this function the driver must have been configured
 282:../../os/hal/src/spi.c ****  *          without callbacks (@p end_cb = @p NULL).
 283:../../os/hal/src/spi.c ****  *
 284:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 285:../../os/hal/src/spi.c ****  * @param[in] n         number of words to be ignored
 286:../../os/hal/src/spi.c ****  *
 287:../../os/hal/src/spi.c ****  * @api
 288:../../os/hal/src/spi.c ****  */
 289:../../os/hal/src/spi.c **** void spiIgnore(SPIDriver *spip, size_t n) {
 385               		.loc 1 289 0
 386               		.cfi_startproc
 387               	.LVL25:
 388 00ca CF93      		push r28
 389               	.LCFI4:
 390               		.cfi_def_cfa_offset 3
 391               		.cfi_offset 28, -2
 392 00cc DF93      		push r29
 393               	.LCFI5:
 394               		.cfi_def_cfa_offset 4
 395               		.cfi_offset 29, -3
 396               	/* prologue: function */
 397               	/* frame size = 0 */
 398               	/* stack size = 2 */
 399               	.L__stack_usage = 2
 400 00ce EC01      		movw r28,r24
 290:../../os/hal/src/spi.c **** 
 291:../../os/hal/src/spi.c ****   chDbgCheck((spip != NULL) && (n > 0), "spiIgnoreWait");
 292:../../os/hal/src/spi.c **** 
 293:../../os/hal/src/spi.c ****   chSysLock();
 401               		.loc 1 293 0
 402               	/* #APP */
 403               	 ;  293 "../../os/hal/src/spi.c" 1
 404 00d0 F894      		cli
 405               	 ;  0 "" 2
 294:../../os/hal/src/spi.c ****   chDbgAssert(spip->state == SPI_READY, "spiIgnore(), #1", "not ready");
 406               		.loc 1 294 0
 407               	/* #NOAPP */
 408 00d2 8881      		ld r24,Y
 409               	.LVL26:
 295:../../os/hal/src/spi.c ****   chDbgAssert(spip->config->end_cb == NULL, "spiIgnore(), #2", "has callback");
 296:../../os/hal/src/spi.c ****   spiStartIgnoreI(spip, n);
 410               		.loc 1 296 0
 411 00d4 83E0      		ldi r24,lo8(3)
 412 00d6 8883      		st Y,r24
 413 00d8 CE01      		movw r24,r28
 414 00da 0E94 0000 		call spi_lld_ignore
 415               	.LVL27:
 297:../../os/hal/src/spi.c ****   _spi_wait_s(spip);
 416               		.loc 1 297 0
 417 00de 8091 0000 		lds r24,rlist+11
 418 00e2 9091 0000 		lds r25,rlist+11+1
 419 00e6 9C83      		std Y+4,r25
 420 00e8 8B83      		std Y+3,r24
 421 00ea 82E0      		ldi r24,lo8(2)
 422 00ec 0E94 0000 		call chSchGoSleepS
 423               	.LVL28:
 298:../../os/hal/src/spi.c ****   chSysUnlock();
 424               		.loc 1 298 0
 425               	/* #APP */
 426               	 ;  298 "../../os/hal/src/spi.c" 1
 427 00f0 7894      		sei
 428               	 ;  0 "" 2
 429               	/* epilogue start */
 299:../../os/hal/src/spi.c **** }
 430               		.loc 1 299 0
 431               	/* #NOAPP */
 432 00f2 DF91      		pop r29
 433 00f4 CF91      		pop r28
 434               	.LVL29:
 435 00f6 0895      		ret
 436               		.cfi_endproc
 437               	.LFE17:
 439               	.global	spiExchange
 441               	spiExchange:
 442               	.LFB18:
 300:../../os/hal/src/spi.c **** 
 301:../../os/hal/src/spi.c **** /**
 302:../../os/hal/src/spi.c ****  * @brief   Exchanges data on the SPI bus.
 303:../../os/hal/src/spi.c ****  * @details This synchronous function performs a simultaneous transmit/receive
 304:../../os/hal/src/spi.c ****  *          operation.
 305:../../os/hal/src/spi.c ****  * @pre     In order to use this function the option @p SPI_USE_WAIT must be
 306:../../os/hal/src/spi.c ****  *          enabled.
 307:../../os/hal/src/spi.c ****  * @pre     In order to use this function the driver must have been configured
 308:../../os/hal/src/spi.c ****  *          without callbacks (@p end_cb = @p NULL).
 309:../../os/hal/src/spi.c ****  * @note    The buffers are organized as uint8_t arrays for data sizes below
 310:../../os/hal/src/spi.c ****  *          or equal to 8 bits else it is organized as uint16_t arrays.
 311:../../os/hal/src/spi.c ****  *
 312:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 313:../../os/hal/src/spi.c ****  * @param[in] n         number of words to be exchanged
 314:../../os/hal/src/spi.c ****  * @param[in] txbuf     the pointer to the transmit buffer
 315:../../os/hal/src/spi.c ****  * @param[out] rxbuf    the pointer to the receive buffer
 316:../../os/hal/src/spi.c ****  *
 317:../../os/hal/src/spi.c ****  * @api
 318:../../os/hal/src/spi.c ****  */
 319:../../os/hal/src/spi.c **** void spiExchange(SPIDriver *spip, size_t n,
 320:../../os/hal/src/spi.c ****                  const void *txbuf, void *rxbuf) {
 443               		.loc 1 320 0
 444               		.cfi_startproc
 445               	.LVL30:
 446 00f8 CF93      		push r28
 447               	.LCFI6:
 448               		.cfi_def_cfa_offset 3
 449               		.cfi_offset 28, -2
 450 00fa DF93      		push r29
 451               	.LCFI7:
 452               		.cfi_def_cfa_offset 4
 453               		.cfi_offset 29, -3
 454               	/* prologue: function */
 455               	/* frame size = 0 */
 456               	/* stack size = 2 */
 457               	.L__stack_usage = 2
 458 00fc EC01      		movw r28,r24
 321:../../os/hal/src/spi.c **** 
 322:../../os/hal/src/spi.c ****   chDbgCheck((spip != NULL) && (n > 0) && (rxbuf != NULL) && (txbuf != NULL),
 323:../../os/hal/src/spi.c ****              "spiExchange");
 324:../../os/hal/src/spi.c **** 
 325:../../os/hal/src/spi.c ****   chSysLock();
 459               		.loc 1 325 0
 460               	/* #APP */
 461               	 ;  325 "../../os/hal/src/spi.c" 1
 462 00fe F894      		cli
 463               	 ;  0 "" 2
 326:../../os/hal/src/spi.c ****   chDbgAssert(spip->state == SPI_READY, "spiExchange(), #1", "not ready");
 464               		.loc 1 326 0
 465               	/* #NOAPP */
 466 0100 8881      		ld r24,Y
 467               	.LVL31:
 327:../../os/hal/src/spi.c ****   chDbgAssert(spip->config->end_cb == NULL,
 328:../../os/hal/src/spi.c ****               "spiExchange(), #2", "has callback");
 329:../../os/hal/src/spi.c ****   spiStartExchangeI(spip, n, txbuf, rxbuf);
 468               		.loc 1 329 0
 469 0102 83E0      		ldi r24,lo8(3)
 470 0104 8883      		st Y,r24
 471 0106 CE01      		movw r24,r28
 472 0108 0E94 0000 		call spi_lld_exchange
 473               	.LVL32:
 330:../../os/hal/src/spi.c ****   _spi_wait_s(spip);
 474               		.loc 1 330 0
 475 010c 8091 0000 		lds r24,rlist+11
 476 0110 9091 0000 		lds r25,rlist+11+1
 477 0114 9C83      		std Y+4,r25
 478 0116 8B83      		std Y+3,r24
 479 0118 82E0      		ldi r24,lo8(2)
 480 011a 0E94 0000 		call chSchGoSleepS
 481               	.LVL33:
 331:../../os/hal/src/spi.c ****   chSysUnlock();
 482               		.loc 1 331 0
 483               	/* #APP */
 484               	 ;  331 "../../os/hal/src/spi.c" 1
 485 011e 7894      		sei
 486               	 ;  0 "" 2
 487               	/* epilogue start */
 332:../../os/hal/src/spi.c **** }
 488               		.loc 1 332 0
 489               	/* #NOAPP */
 490 0120 DF91      		pop r29
 491 0122 CF91      		pop r28
 492               	.LVL34:
 493 0124 0895      		ret
 494               		.cfi_endproc
 495               	.LFE18:
 497               	.global	spiSend
 499               	spiSend:
 500               	.LFB19:
 333:../../os/hal/src/spi.c **** 
 334:../../os/hal/src/spi.c **** /**
 335:../../os/hal/src/spi.c ****  * @brief   Sends data over the SPI bus.
 336:../../os/hal/src/spi.c ****  * @details This synchronous function performs a transmit operation.
 337:../../os/hal/src/spi.c ****  * @pre     In order to use this function the option @p SPI_USE_WAIT must be
 338:../../os/hal/src/spi.c ****  *          enabled.
 339:../../os/hal/src/spi.c ****  * @pre     In order to use this function the driver must have been configured
 340:../../os/hal/src/spi.c ****  *          without callbacks (@p end_cb = @p NULL).
 341:../../os/hal/src/spi.c ****  * @note    The buffers are organized as uint8_t arrays for data sizes below
 342:../../os/hal/src/spi.c ****  *          or equal to 8 bits else it is organized as uint16_t arrays.
 343:../../os/hal/src/spi.c ****  *
 344:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 345:../../os/hal/src/spi.c ****  * @param[in] n         number of words to send
 346:../../os/hal/src/spi.c ****  * @param[in] txbuf     the pointer to the transmit buffer
 347:../../os/hal/src/spi.c ****  *
 348:../../os/hal/src/spi.c ****  * @api
 349:../../os/hal/src/spi.c ****  */
 350:../../os/hal/src/spi.c **** void spiSend(SPIDriver *spip, size_t n, const void *txbuf) {
 501               		.loc 1 350 0
 502               		.cfi_startproc
 503               	.LVL35:
 504 0126 CF93      		push r28
 505               	.LCFI8:
 506               		.cfi_def_cfa_offset 3
 507               		.cfi_offset 28, -2
 508 0128 DF93      		push r29
 509               	.LCFI9:
 510               		.cfi_def_cfa_offset 4
 511               		.cfi_offset 29, -3
 512               	/* prologue: function */
 513               	/* frame size = 0 */
 514               	/* stack size = 2 */
 515               	.L__stack_usage = 2
 516 012a EC01      		movw r28,r24
 351:../../os/hal/src/spi.c **** 
 352:../../os/hal/src/spi.c ****   chDbgCheck((spip != NULL) && (n > 0) && (txbuf != NULL), "spiSend");
 353:../../os/hal/src/spi.c **** 
 354:../../os/hal/src/spi.c ****   chSysLock();
 517               		.loc 1 354 0
 518               	/* #APP */
 519               	 ;  354 "../../os/hal/src/spi.c" 1
 520 012c F894      		cli
 521               	 ;  0 "" 2
 355:../../os/hal/src/spi.c ****   chDbgAssert(spip->state == SPI_READY, "spiSend(), #1", "not ready");
 522               		.loc 1 355 0
 523               	/* #NOAPP */
 524 012e 8881      		ld r24,Y
 525               	.LVL36:
 356:../../os/hal/src/spi.c ****   chDbgAssert(spip->config->end_cb == NULL, "spiSend(), #2", "has callback");
 357:../../os/hal/src/spi.c ****   spiStartSendI(spip, n, txbuf);
 526               		.loc 1 357 0
 527 0130 83E0      		ldi r24,lo8(3)
 528 0132 8883      		st Y,r24
 529 0134 CE01      		movw r24,r28
 530 0136 0E94 0000 		call spi_lld_send
 531               	.LVL37:
 358:../../os/hal/src/spi.c ****   _spi_wait_s(spip);
 532               		.loc 1 358 0
 533 013a 8091 0000 		lds r24,rlist+11
 534 013e 9091 0000 		lds r25,rlist+11+1
 535 0142 9C83      		std Y+4,r25
 536 0144 8B83      		std Y+3,r24
 537 0146 82E0      		ldi r24,lo8(2)
 538 0148 0E94 0000 		call chSchGoSleepS
 539               	.LVL38:
 359:../../os/hal/src/spi.c ****   chSysUnlock();
 540               		.loc 1 359 0
 541               	/* #APP */
 542               	 ;  359 "../../os/hal/src/spi.c" 1
 543 014c 7894      		sei
 544               	 ;  0 "" 2
 545               	/* epilogue start */
 360:../../os/hal/src/spi.c **** }
 546               		.loc 1 360 0
 547               	/* #NOAPP */
 548 014e DF91      		pop r29
 549 0150 CF91      		pop r28
 550               	.LVL39:
 551 0152 0895      		ret
 552               		.cfi_endproc
 553               	.LFE19:
 555               	.global	spiReceive
 557               	spiReceive:
 558               	.LFB20:
 361:../../os/hal/src/spi.c **** 
 362:../../os/hal/src/spi.c **** /**
 363:../../os/hal/src/spi.c ****  * @brief   Receives data from the SPI bus.
 364:../../os/hal/src/spi.c ****  * @details This synchronous function performs a receive operation.
 365:../../os/hal/src/spi.c ****  * @pre     In order to use this function the option @p SPI_USE_WAIT must be
 366:../../os/hal/src/spi.c ****  *          enabled.
 367:../../os/hal/src/spi.c ****  * @pre     In order to use this function the driver must have been configured
 368:../../os/hal/src/spi.c ****  *          without callbacks (@p end_cb = @p NULL).
 369:../../os/hal/src/spi.c ****  * @note    The buffers are organized as uint8_t arrays for data sizes below
 370:../../os/hal/src/spi.c ****  *          or equal to 8 bits else it is organized as uint16_t arrays.
 371:../../os/hal/src/spi.c ****  *
 372:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 373:../../os/hal/src/spi.c ****  * @param[in] n         number of words to receive
 374:../../os/hal/src/spi.c ****  * @param[out] rxbuf    the pointer to the receive buffer
 375:../../os/hal/src/spi.c ****  *
 376:../../os/hal/src/spi.c ****  * @api
 377:../../os/hal/src/spi.c ****  */
 378:../../os/hal/src/spi.c **** void spiReceive(SPIDriver *spip, size_t n, void *rxbuf) {
 559               		.loc 1 378 0
 560               		.cfi_startproc
 561               	.LVL40:
 562 0154 CF93      		push r28
 563               	.LCFI10:
 564               		.cfi_def_cfa_offset 3
 565               		.cfi_offset 28, -2
 566 0156 DF93      		push r29
 567               	.LCFI11:
 568               		.cfi_def_cfa_offset 4
 569               		.cfi_offset 29, -3
 570               	/* prologue: function */
 571               	/* frame size = 0 */
 572               	/* stack size = 2 */
 573               	.L__stack_usage = 2
 574 0158 EC01      		movw r28,r24
 379:../../os/hal/src/spi.c **** 
 380:../../os/hal/src/spi.c ****   chDbgCheck((spip != NULL) && (n > 0) && (rxbuf != NULL),
 381:../../os/hal/src/spi.c ****              "spiReceive");
 382:../../os/hal/src/spi.c **** 
 383:../../os/hal/src/spi.c ****   chSysLock();
 575               		.loc 1 383 0
 576               	/* #APP */
 577               	 ;  383 "../../os/hal/src/spi.c" 1
 578 015a F894      		cli
 579               	 ;  0 "" 2
 384:../../os/hal/src/spi.c ****   chDbgAssert(spip->state == SPI_READY, "spiReceive(), #1", "not ready");
 580               		.loc 1 384 0
 581               	/* #NOAPP */
 582 015c 8881      		ld r24,Y
 583               	.LVL41:
 385:../../os/hal/src/spi.c ****   chDbgAssert(spip->config->end_cb == NULL,
 386:../../os/hal/src/spi.c ****               "spiReceive(), #2", "has callback");
 387:../../os/hal/src/spi.c ****   spiStartReceiveI(spip, n, rxbuf);
 584               		.loc 1 387 0
 585 015e 83E0      		ldi r24,lo8(3)
 586 0160 8883      		st Y,r24
 587 0162 CE01      		movw r24,r28
 588 0164 0E94 0000 		call spi_lld_receive
 589               	.LVL42:
 388:../../os/hal/src/spi.c ****   _spi_wait_s(spip);
 590               		.loc 1 388 0
 591 0168 8091 0000 		lds r24,rlist+11
 592 016c 9091 0000 		lds r25,rlist+11+1
 593 0170 9C83      		std Y+4,r25
 594 0172 8B83      		std Y+3,r24
 595 0174 82E0      		ldi r24,lo8(2)
 596 0176 0E94 0000 		call chSchGoSleepS
 597               	.LVL43:
 389:../../os/hal/src/spi.c ****   chSysUnlock();
 598               		.loc 1 389 0
 599               	/* #APP */
 600               	 ;  389 "../../os/hal/src/spi.c" 1
 601 017a 7894      		sei
 602               	 ;  0 "" 2
 603               	/* epilogue start */
 390:../../os/hal/src/spi.c **** }
 604               		.loc 1 390 0
 605               	/* #NOAPP */
 606 017c DF91      		pop r29
 607 017e CF91      		pop r28
 608               	.LVL44:
 609 0180 0895      		ret
 610               		.cfi_endproc
 611               	.LFE20:
 613               	.global	spiAcquireBus
 615               	spiAcquireBus:
 616               	.LFB21:
 391:../../os/hal/src/spi.c **** #endif /* SPI_USE_WAIT */
 392:../../os/hal/src/spi.c **** 
 393:../../os/hal/src/spi.c **** #if SPI_USE_MUTUAL_EXCLUSION || defined(__DOXYGEN__)
 394:../../os/hal/src/spi.c **** /**
 395:../../os/hal/src/spi.c ****  * @brief   Gains exclusive access to the SPI bus.
 396:../../os/hal/src/spi.c ****  * @details This function tries to gain ownership to the SPI bus, if the bus
 397:../../os/hal/src/spi.c ****  *          is already being used then the invoking thread is queued.
 398:../../os/hal/src/spi.c ****  * @pre     In order to use this function the option @p SPI_USE_MUTUAL_EXCLUSION
 399:../../os/hal/src/spi.c ****  *          must be enabled.
 400:../../os/hal/src/spi.c ****  *
 401:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 402:../../os/hal/src/spi.c ****  *
 403:../../os/hal/src/spi.c ****  * @api
 404:../../os/hal/src/spi.c ****  */
 405:../../os/hal/src/spi.c **** void spiAcquireBus(SPIDriver *spip) {
 617               		.loc 1 405 0
 618               		.cfi_startproc
 619               	.LVL45:
 620               	/* prologue: function */
 621               	/* frame size = 0 */
 622               	/* stack size = 0 */
 623               	.L__stack_usage = 0
 406:../../os/hal/src/spi.c **** 
 407:../../os/hal/src/spi.c ****   chDbgCheck(spip != NULL, "spiAcquireBus");
 408:../../os/hal/src/spi.c **** 
 409:../../os/hal/src/spi.c **** #if CH_USE_MUTEXES
 410:../../os/hal/src/spi.c ****   chMtxLock(&spip->mutex);
 624               		.loc 1 410 0
 625 0182 0596      		adiw r24,5
 626               	.LVL46:
 627 0184 0C94 0000 		jmp chMtxLock
 628               	.LVL47:
 629               		.cfi_endproc
 630               	.LFE21:
 632               	.global	spiReleaseBus
 634               	spiReleaseBus:
 635               	.LFB22:
 411:../../os/hal/src/spi.c **** #elif CH_USE_SEMAPHORES
 412:../../os/hal/src/spi.c ****   chSemWait(&spip->semaphore);
 413:../../os/hal/src/spi.c **** #endif
 414:../../os/hal/src/spi.c **** }
 415:../../os/hal/src/spi.c **** 
 416:../../os/hal/src/spi.c **** /**
 417:../../os/hal/src/spi.c ****  * @brief   Releases exclusive access to the SPI bus.
 418:../../os/hal/src/spi.c ****  * @pre     In order to use this function the option @p SPI_USE_MUTUAL_EXCLUSION
 419:../../os/hal/src/spi.c ****  *          must be enabled.
 420:../../os/hal/src/spi.c ****  *
 421:../../os/hal/src/spi.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 422:../../os/hal/src/spi.c ****  *
 423:../../os/hal/src/spi.c ****  * @api
 424:../../os/hal/src/spi.c ****  */
 425:../../os/hal/src/spi.c **** void spiReleaseBus(SPIDriver *spip) {
 636               		.loc 1 425 0
 637               		.cfi_startproc
 638               	.LVL48:
 639               	/* prologue: function */
 640               	/* frame size = 0 */
 641               	/* stack size = 0 */
 642               	.L__stack_usage = 0
 426:../../os/hal/src/spi.c **** 
 427:../../os/hal/src/spi.c ****   chDbgCheck(spip != NULL, "spiReleaseBus");
 428:../../os/hal/src/spi.c **** 
 429:../../os/hal/src/spi.c **** #if CH_USE_MUTEXES
 430:../../os/hal/src/spi.c ****   (void)spip;
 431:../../os/hal/src/spi.c ****   chMtxUnlock();
 643               		.loc 1 431 0
 644 0188 0C94 0000 		jmp chMtxUnlock
 645               	.LVL49:
 646               		.cfi_endproc
 647               	.LFE22:
 649               	.Letext0:
 650               		.file 2 "/usr/local/cross/lib/gcc/avr/4.7.2/include/stddef.h"
 651               		.file 3 "/usr/local/cross/lib/gcc/avr/4.7.2/../../../../avr/include/stdint.h"
 652               		.file 4 "../../os/ports/GCC/AVR/chtypes.h"
 653               		.file 5 "../../os/kernel/include/chlists.h"
 654               		.file 6 "../../os/kernel/include/chthreads.h"
 655               		.file 7 "../../os/ports/GCC/AVR/chcore.h"
 656               		.file 8 "../../os/kernel/include/chschd.h"
 657               		.file 9 "../../os/kernel/include/chmtx.h"
 658               		.file 10 "../../os/hal/include/spi.h"
 659               		.file 11 "../../os/hal/platforms/AVR/spi_lld.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 spi.c
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:2      *ABS*:000000000000003e __SP_H__
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:3      *ABS*:000000000000003d __SP_L__
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:4      *ABS*:000000000000003f __SREG__
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:5      *ABS*:0000000000000000 __tmp_reg__
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:6      *ABS*:0000000000000001 __zero_reg__
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:12     .text:0000000000000000 spiInit
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:29     .text:0000000000000004 spiObjectInit
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:58     .text:0000000000000018 spiStart
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:117    .text:000000000000003e spiStop
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:177    .text:0000000000000066 spiSelect
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:210    .text:0000000000000074 spiUnselect
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:243    .text:0000000000000082 spiStartIgnore
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:278    .text:0000000000000094 spiStartExchange
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:313    .text:00000000000000a6 spiStartSend
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:348    .text:00000000000000b8 spiStartReceive
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:383    .text:00000000000000ca spiIgnore
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:441    .text:00000000000000f8 spiExchange
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:499    .text:0000000000000126 spiSend
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:557    .text:0000000000000154 spiReceive
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:615    .text:0000000000000182 spiAcquireBus
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//cc9wEjdg.s:634    .text:0000000000000188 spiReleaseBus

UNDEFINED SYMBOLS
spi_lld_init
chMtxInit
spi_lld_start
spi_lld_unselect
spi_lld_stop
spi_lld_select
spi_lld_ignore
spi_lld_exchange
spi_lld_send
spi_lld_receive
rlist
chSchGoSleepS
chMtxLock
chMtxUnlock
