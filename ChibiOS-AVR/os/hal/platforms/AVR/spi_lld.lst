   1               		.file	"spi_lld.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  11               	spi_start_transmission:
  12               	.LFB7:
  13               		.file 1 "../../os/hal/platforms/AVR/spi_lld.c"
   1:../../os/hal/platforms/AVR/spi_lld.c **** /*
   2:../../os/hal/platforms/AVR/spi_lld.c ****     ChibiOS/RT - Copyright (C) 2006,2007,2008,2009,2010,
   3:../../os/hal/platforms/AVR/spi_lld.c ****                  2011,2012 Giovanni Di Sirio.
   4:../../os/hal/platforms/AVR/spi_lld.c **** 
   5:../../os/hal/platforms/AVR/spi_lld.c ****     This file is part of ChibiOS/RT.
   6:../../os/hal/platforms/AVR/spi_lld.c **** 
   7:../../os/hal/platforms/AVR/spi_lld.c ****     ChibiOS/RT is free software; you can redistribute it and/or modify
   8:../../os/hal/platforms/AVR/spi_lld.c ****     it under the terms of the GNU General Public License as published by
   9:../../os/hal/platforms/AVR/spi_lld.c ****     the Free Software Foundation; either version 3 of the License, or
  10:../../os/hal/platforms/AVR/spi_lld.c ****     (at your option) any later version.
  11:../../os/hal/platforms/AVR/spi_lld.c **** 
  12:../../os/hal/platforms/AVR/spi_lld.c ****     ChibiOS/RT is distributed in the hope that it will be useful,
  13:../../os/hal/platforms/AVR/spi_lld.c ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  14:../../os/hal/platforms/AVR/spi_lld.c ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  15:../../os/hal/platforms/AVR/spi_lld.c ****     GNU General Public License for more details.
  16:../../os/hal/platforms/AVR/spi_lld.c **** 
  17:../../os/hal/platforms/AVR/spi_lld.c ****     You should have received a copy of the GNU General Public License
  18:../../os/hal/platforms/AVR/spi_lld.c ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  19:../../os/hal/platforms/AVR/spi_lld.c **** */
  20:../../os/hal/platforms/AVR/spi_lld.c **** 
  21:../../os/hal/platforms/AVR/spi_lld.c **** /**
  22:../../os/hal/platforms/AVR/spi_lld.c ****  * @file    templates/spi_lld.c
  23:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   SPI Driver subsystem low level driver source template.
  24:../../os/hal/platforms/AVR/spi_lld.c ****  *
  25:../../os/hal/platforms/AVR/spi_lld.c ****  * @addtogroup SPI
  26:../../os/hal/platforms/AVR/spi_lld.c ****  * @{
  27:../../os/hal/platforms/AVR/spi_lld.c ****  */
  28:../../os/hal/platforms/AVR/spi_lld.c **** 
  29:../../os/hal/platforms/AVR/spi_lld.c **** #include "ch.h"
  30:../../os/hal/platforms/AVR/spi_lld.c **** #include "hal.h"
  31:../../os/hal/platforms/AVR/spi_lld.c **** 
  32:../../os/hal/platforms/AVR/spi_lld.c **** #if HAL_USE_SPI || defined(__DOXYGEN__)
  33:../../os/hal/platforms/AVR/spi_lld.c **** 
  34:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
  35:../../os/hal/platforms/AVR/spi_lld.c **** /* Driver local definitions.                                                 */
  36:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
  37:../../os/hal/platforms/AVR/spi_lld.c **** 
  38:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
  39:../../os/hal/platforms/AVR/spi_lld.c **** /* Driver exported variables.                                                */
  40:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
  41:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI1 || defined(__DOXYGEN__)
  42:../../os/hal/platforms/AVR/spi_lld.c **** SPIDriver SPID1;
  43:../../os/hal/platforms/AVR/spi_lld.c **** #endif
  44:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI2 || defined(__DOXYGEN__)
  45:../../os/hal/platforms/AVR/spi_lld.c **** SPIDriver SPID2;
  46:../../os/hal/platforms/AVR/spi_lld.c **** #endif
  47:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
  48:../../os/hal/platforms/AVR/spi_lld.c **** /* Driver local variables.                                                   */
  49:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
  50:../../os/hal/platforms/AVR/spi_lld.c **** 
  51:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
  52:../../os/hal/platforms/AVR/spi_lld.c **** /* Driver local functions.                                                   */
  53:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
  54:../../os/hal/platforms/AVR/spi_lld.c **** static void spi_start_transmission(SPIDriver *spip)
  55:../../os/hal/platforms/AVR/spi_lld.c **** {
  14               		.loc 1 55 0
  15               		.cfi_startproc
  16               	.LVL0:
  17 0000 CF93      		push r28
  18               	.LCFI0:
  19               		.cfi_def_cfa_offset 3
  20               		.cfi_offset 28, -2
  21 0002 DF93      		push r29
  22               	.LCFI1:
  23               		.cfi_def_cfa_offset 4
  24               		.cfi_offset 29, -3
  25 0004 1F92      		push __zero_reg__
  26               	.LCFI2:
  27               		.cfi_def_cfa_offset 5
  28 0006 CDB7      		in r28,__SP_L__
  29 0008 DEB7      		in r29,__SP_H__
  30               	.LCFI3:
  31               		.cfi_def_cfa_register 28
  32               	/* prologue: function */
  33               	/* frame size = 1 */
  34               	/* stack size = 3 */
  35               	.L__stack_usage = 3
  36 000a FC01      		movw r30,r24
  56:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI1 || defined(__DOXYGEN__)
  57:../../os/hal/platforms/AVR/spi_lld.c ****     if(spip->untransmitted_bytes> 0)
  37               		.loc 1 57 0
  38 000c 8585      		ldd r24,Z+13
  39 000e 9685      		ldd r25,Z+14
  40               	.LVL1:
  41 0010 1816      		cp __zero_reg__,r24
  42 0012 1906      		cpc __zero_reg__,r25
  43 0014 04F4      		brge .L1
  58:../../os/hal/platforms/AVR/spi_lld.c ****     {
  59:../../os/hal/platforms/AVR/spi_lld.c ****         if(spip->tx_buffer != NULL)
  44               		.loc 1 59 0
  45 0016 A785      		ldd r26,Z+15
  46 0018 B089      		ldd r27,Z+16
  47 001a 1097      		sbiw r26,0
  48 001c 01F0      		breq .L3
  60:../../os/hal/platforms/AVR/spi_lld.c ****         {
  61:../../os/hal/platforms/AVR/spi_lld.c ****             SPDR =  *spip->tx_buffer;
  49               		.loc 1 61 0
  50 001e 8C91      		ld r24,X
  51 0020 8EBD      		out 0x2e,r24
  62:../../os/hal/platforms/AVR/spi_lld.c ****             spip->tx_buffer++;
  52               		.loc 1 62 0
  53 0022 8785      		ldd r24,Z+15
  54 0024 9089      		ldd r25,Z+16
  55 0026 0196      		adiw r24,1
  56 0028 908B      		std Z+16,r25
  57 002a 8787      		std Z+15,r24
  58               	.LVL2:
  59               	.L4:
  63:../../os/hal/platforms/AVR/spi_lld.c ****         }
  64:../../os/hal/platforms/AVR/spi_lld.c ****         else
  65:../../os/hal/platforms/AVR/spi_lld.c ****         {
  66:../../os/hal/platforms/AVR/spi_lld.c ****             volatile uint8_t tempSPDR = SPDR;
  67:../../os/hal/platforms/AVR/spi_lld.c ****             SPDR = tempSPDR;
  68:../../os/hal/platforms/AVR/spi_lld.c ****         }
  69:../../os/hal/platforms/AVR/spi_lld.c ****         spip->untransmitted_bytes--;
  60               		.loc 1 69 0
  61 002c 8585      		ldd r24,Z+13
  62 002e 9685      		ldd r25,Z+14
  63 0030 0197      		sbiw r24,1
  64 0032 9687      		std Z+14,r25
  65 0034 8587      		std Z+13,r24
  66               	.L1:
  67               	/* epilogue start */
  70:../../os/hal/platforms/AVR/spi_lld.c ****     }
  71:../../os/hal/platforms/AVR/spi_lld.c **** 
  72:../../os/hal/platforms/AVR/spi_lld.c **** #endif
  73:../../os/hal/platforms/AVR/spi_lld.c **** 
  74:../../os/hal/platforms/AVR/spi_lld.c **** 
  75:../../os/hal/platforms/AVR/spi_lld.c **** }
  68               		.loc 1 75 0
  69 0036 0F90      		pop __tmp_reg__
  70 0038 DF91      		pop r29
  71 003a CF91      		pop r28
  72 003c 0895      		ret
  73               	.LVL3:
  74               	.L3:
  75               	.LBB10:
  66:../../os/hal/platforms/AVR/spi_lld.c ****             volatile uint8_t tempSPDR = SPDR;
  76               		.loc 1 66 0
  77 003e 8EB5      		in r24,0x2e
  78               	.LVL4:
  79 0040 8983      		std Y+1,r24
  67:../../os/hal/platforms/AVR/spi_lld.c ****             SPDR = tempSPDR;
  80               		.loc 1 67 0
  81 0042 8981      		ldd r24,Y+1
  82               	.LVL5:
  83 0044 8EBD      		out 0x2e,r24
  84 0046 00C0      		rjmp .L4
  85               	.LBE10:
  86               		.cfi_endproc
  87               	.LFE7:
  89               	.global	__vector_17
  91               	__vector_17:
  92               	.LFB9:
  76:../../os/hal/platforms/AVR/spi_lld.c **** 
  77:../../os/hal/platforms/AVR/spi_lld.c **** static void spi_setup_transmission(SPIDriver *spip,size_t n, const uint8_t *txbuf, uint8_t *rxbuf)
  78:../../os/hal/platforms/AVR/spi_lld.c **** {
  79:../../os/hal/platforms/AVR/spi_lld.c ****     spip->tx_buffer= txbuf;
  80:../../os/hal/platforms/AVR/spi_lld.c ****     spip->rx_buffer= rxbuf;
  81:../../os/hal/platforms/AVR/spi_lld.c ****     spip->untransmitted_bytes= n;
  82:../../os/hal/platforms/AVR/spi_lld.c **** 
  83:../../os/hal/platforms/AVR/spi_lld.c **** }
  84:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
  85:../../os/hal/platforms/AVR/spi_lld.c **** /* Driver interrupt handlers.                                                */
  86:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
  87:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI1 || defined(__DOXYGEN_)
  88:../../os/hal/platforms/AVR/spi_lld.c **** CH_IRQ_HANDLER(SPI_STC_vect)   //SPI1 interrupt
  89:../../os/hal/platforms/AVR/spi_lld.c **** {
  93               		.loc 1 89 0
  94               		.cfi_startproc
  95 0048 1F92      		push r1
  96               	.LCFI4:
  97               		.cfi_def_cfa_offset 3
  98               		.cfi_offset 1, -2
  99 004a 0F92      		push r0
 100               	.LCFI5:
 101               		.cfi_def_cfa_offset 4
 102               		.cfi_offset 0, -3
 103 004c 0FB6      		in r0,__SREG__
 104 004e 0F92      		push r0
 105 0050 1124      		clr __zero_reg__
 106 0052 2F93      		push r18
 107               	.LCFI6:
 108               		.cfi_def_cfa_offset 5
 109               		.cfi_offset 18, -4
 110 0054 3F93      		push r19
 111               	.LCFI7:
 112               		.cfi_def_cfa_offset 6
 113               		.cfi_offset 19, -5
 114 0056 4F93      		push r20
 115               	.LCFI8:
 116               		.cfi_def_cfa_offset 7
 117               		.cfi_offset 20, -6
 118 0058 5F93      		push r21
 119               	.LCFI9:
 120               		.cfi_def_cfa_offset 8
 121               		.cfi_offset 21, -7
 122 005a 6F93      		push r22
 123               	.LCFI10:
 124               		.cfi_def_cfa_offset 9
 125               		.cfi_offset 22, -8
 126 005c 7F93      		push r23
 127               	.LCFI11:
 128               		.cfi_def_cfa_offset 10
 129               		.cfi_offset 23, -9
 130 005e 8F93      		push r24
 131               	.LCFI12:
 132               		.cfi_def_cfa_offset 11
 133               		.cfi_offset 24, -10
 134 0060 9F93      		push r25
 135               	.LCFI13:
 136               		.cfi_def_cfa_offset 12
 137               		.cfi_offset 25, -11
 138 0062 AF93      		push r26
 139               	.LCFI14:
 140               		.cfi_def_cfa_offset 13
 141               		.cfi_offset 26, -12
 142 0064 BF93      		push r27
 143               	.LCFI15:
 144               		.cfi_def_cfa_offset 14
 145               		.cfi_offset 27, -13
 146 0066 EF93      		push r30
 147               	.LCFI16:
 148               		.cfi_def_cfa_offset 15
 149               		.cfi_offset 30, -14
 150 0068 FF93      		push r31
 151               	.LCFI17:
 152               		.cfi_def_cfa_offset 16
 153               		.cfi_offset 31, -15
 154               	/* prologue: Signal */
 155               	/* frame size = 0 */
 156               	/* stack size = 15 */
 157               	.L__stack_usage = 15
  90:../../os/hal/platforms/AVR/spi_lld.c **** 
  91:../../os/hal/platforms/AVR/spi_lld.c ****     CH_IRQ_PROLOGUE();
 158               		.loc 1 91 0
  92:../../os/hal/platforms/AVR/spi_lld.c **** 
  93:../../os/hal/platforms/AVR/spi_lld.c ****     if(SPCR & (1<<MSTR))
 159               		.loc 1 93 0
 160 006a 0CB4      		in __tmp_reg__,0x2c
 161 006c 04FE      		sbrs __tmp_reg__,4
 162 006e 00C0      		rjmp .L7
  94:../../os/hal/platforms/AVR/spi_lld.c ****     {
  95:../../os/hal/platforms/AVR/spi_lld.c ****         if(SPID1.rx_buffer != NULL)
 163               		.loc 1 95 0
 164 0070 E091 0000 		lds r30,SPID1+17
 165 0074 F091 0000 		lds r31,SPID1+17+1
 166 0078 3097      		sbiw r30,0
 167 007a 01F0      		breq .L8
  96:../../os/hal/platforms/AVR/spi_lld.c ****         {
  97:../../os/hal/platforms/AVR/spi_lld.c ****             *SPID1.rx_buffer=SPDR;
 168               		.loc 1 97 0
 169 007c 8EB5      		in r24,0x2e
 170 007e 8083      		st Z,r24
  98:../../os/hal/platforms/AVR/spi_lld.c ****             SPID1.rx_buffer++;
 171               		.loc 1 98 0
 172 0080 8091 0000 		lds r24,SPID1+17
 173 0084 9091 0000 		lds r25,SPID1+17+1
 174 0088 0196      		adiw r24,1
 175 008a 9093 0000 		sts SPID1+17+1,r25
 176 008e 8093 0000 		sts SPID1+17,r24
 177               	.L8:
  99:../../os/hal/platforms/AVR/spi_lld.c ****         }
 100:../../os/hal/platforms/AVR/spi_lld.c ****         if(SPID1.untransmitted_bytes> 0)
 178               		.loc 1 100 0
 179 0092 8091 0000 		lds r24,SPID1+13
 180 0096 9091 0000 		lds r25,SPID1+13+1
 181 009a 1816      		cp __zero_reg__,r24
 182 009c 1906      		cpc __zero_reg__,r25
 183 009e 04F4      		brge .L9
 101:../../os/hal/platforms/AVR/spi_lld.c ****         {
 102:../../os/hal/platforms/AVR/spi_lld.c ****             spi_start_transmission(&SPID1);
 184               		.loc 1 102 0
 185 00a0 80E0      		ldi r24,lo8(SPID1)
 186 00a2 90E0      		ldi r25,hi8(SPID1)
 187 00a4 0E94 0000 		call spi_start_transmission
 188               	.LVL6:
 189 00a8 00C0      		rjmp .L10
 190               	.L7:
 103:../../os/hal/platforms/AVR/spi_lld.c ****         }
 104:../../os/hal/platforms/AVR/spi_lld.c ****         else
 105:../../os/hal/platforms/AVR/spi_lld.c ****         {
 106:../../os/hal/platforms/AVR/spi_lld.c ****             _spi_isr_code(&SPID1);
 107:../../os/hal/platforms/AVR/spi_lld.c **** 
 108:../../os/hal/platforms/AVR/spi_lld.c ****         }
 109:../../os/hal/platforms/AVR/spi_lld.c ****     }
 110:../../os/hal/platforms/AVR/spi_lld.c ****     else
 111:../../os/hal/platforms/AVR/spi_lld.c ****     {
 112:../../os/hal/platforms/AVR/spi_lld.c ****         if(SPID1.config->slave_cb == NULL)
 191               		.loc 1 112 0
 192 00aa E091 0000 		lds r30,SPID1+1
 193 00ae F091 0000 		lds r31,SPID1+1+1
 194 00b2 0380      		ldd __tmp_reg__,Z+3
 195 00b4 F481      		ldd r31,Z+4
 196 00b6 E02D      		mov r30,__tmp_reg__
 197 00b8 3097      		sbiw r30,0
 198 00ba 01F0      		breq .L24
 199               	.L13:
 113:../../os/hal/platforms/AVR/spi_lld.c ****             SPDR = SPID1.config->slave_cb(&SPID1,SPDR);
 114:../../os/hal/platforms/AVR/spi_lld.c ****         SPCR |=(1<<MSTR);
 200               		.loc 1 114 0
 201 00bc 8CB5      		in r24,0x2c
 202 00be 8061      		ori r24,lo8(16)
 203 00c0 8CBD      		out 0x2c,r24
 204               	.L10:
 115:../../os/hal/platforms/AVR/spi_lld.c **** 
 116:../../os/hal/platforms/AVR/spi_lld.c ****     }
 117:../../os/hal/platforms/AVR/spi_lld.c **** 
 118:../../os/hal/platforms/AVR/spi_lld.c ****     CH_IRQ_EPILOGUE();
 205               		.loc 1 118 0
 206 00c2 0E94 0000 		call chSchIsPreemptionRequired
 207               	.LVL7:
 208 00c6 8111      		cpse r24,__zero_reg__
 209               		.loc 1 118 0 is_stmt 0 discriminator 1
 210 00c8 0E94 0000 		call chSchDoReschedule
 211               	.LVL8:
 212               	.L6:
 213               	/* epilogue start */
 119:../../os/hal/platforms/AVR/spi_lld.c **** }
 214               		.loc 1 119 0 is_stmt 1
 215 00cc FF91      		pop r31
 216 00ce EF91      		pop r30
 217 00d0 BF91      		pop r27
 218 00d2 AF91      		pop r26
 219 00d4 9F91      		pop r25
 220 00d6 8F91      		pop r24
 221 00d8 7F91      		pop r23
 222 00da 6F91      		pop r22
 223 00dc 5F91      		pop r21
 224 00de 4F91      		pop r20
 225 00e0 3F91      		pop r19
 226 00e2 2F91      		pop r18
 227 00e4 0F90      		pop r0
 228 00e6 0FBE      		out __SREG__,r0
 229 00e8 0F90      		pop r0
 230 00ea 1F90      		pop r1
 231 00ec 1895      		reti
 232               	.L9:
 106:../../os/hal/platforms/AVR/spi_lld.c ****             _spi_isr_code(&SPID1);
 233               		.loc 1 106 0
 234 00ee E091 0000 		lds r30,SPID1+1
 235 00f2 F091 0000 		lds r31,SPID1+1+1
 236 00f6 0190      		ld __tmp_reg__,Z+
 237 00f8 F081      		ld r31,Z
 238 00fa E02D      		mov r30,__tmp_reg__
 239 00fc 3097      		sbiw r30,0
 240 00fe 01F0      		breq .L11
 106:../../os/hal/platforms/AVR/spi_lld.c ****             _spi_isr_code(&SPID1);
 241               		.loc 1 106 0 is_stmt 0 discriminator 1
 242 0100 84E0      		ldi r24,lo8(4)
 243 0102 8093 0000 		sts SPID1,r24
 244 0106 80E0      		ldi r24,lo8(SPID1)
 245 0108 90E0      		ldi r25,hi8(SPID1)
 246 010a 0995      		icall
 247               	.LVL9:
 248 010c 8091 0000 		lds r24,SPID1
 249 0110 8430      		cpi r24,lo8(4)
 250 0112 01F0      		breq .L11
 251               	.L12:
 106:../../os/hal/platforms/AVR/spi_lld.c ****             _spi_isr_code(&SPID1);
 252               		.loc 1 106 0 discriminator 4
 253 0114 8091 0000 		lds r24,SPID1+3
 254 0118 9091 0000 		lds r25,SPID1+3+1
 255 011c 0097      		sbiw r24,0
 256 011e 01F0      		breq .L10
 257               	.LVL10:
 258               	.LBB11:
 106:../../os/hal/platforms/AVR/spi_lld.c ****             _spi_isr_code(&SPID1);
 259               		.loc 1 106 0 discriminator 5
 260 0120 1092 0000 		sts SPID1+3+1,__zero_reg__
 261 0124 1092 0000 		sts SPID1+3,__zero_reg__
 262 0128 0E94 0000 		call chSchReadyI
 263               	.LVL11:
 264 012c 00C0      		rjmp .L10
 265               	.L11:
 266               	.LBE11:
 106:../../os/hal/platforms/AVR/spi_lld.c ****             _spi_isr_code(&SPID1);
 267               		.loc 1 106 0 discriminator 2
 268 012e 82E0      		ldi r24,lo8(2)
 269 0130 8093 0000 		sts SPID1,r24
 270 0134 00C0      		rjmp .L12
 271               	.L24:
 113:../../os/hal/platforms/AVR/spi_lld.c ****             SPDR = SPID1.config->slave_cb(&SPID1,SPDR);
 272               		.loc 1 113 0 is_stmt 1
 273 0136 6EB5      		in r22,0x2e
 274 0138 80E0      		ldi r24,lo8(SPID1)
 275 013a 90E0      		ldi r25,hi8(SPID1)
 276 013c 0995      		icall
 277               	.LVL12:
 278 013e 8EBD      		out 0x2e,r24
 279 0140 00C0      		rjmp .L13
 280               		.cfi_endproc
 281               	.LFE9:
 283               	.global	spi_lld_init
 285               	spi_lld_init:
 286               	.LFB10:
 120:../../os/hal/platforms/AVR/spi_lld.c **** #endif
 121:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
 122:../../os/hal/platforms/AVR/spi_lld.c **** /* Driver exported functions.                                                */
 123:../../os/hal/platforms/AVR/spi_lld.c **** /*===========================================================================*/
 124:../../os/hal/platforms/AVR/spi_lld.c **** 
 125:../../os/hal/platforms/AVR/spi_lld.c **** /**
 126:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   Low level SPI driver initialization.
 127:../../os/hal/platforms/AVR/spi_lld.c ****  *
 128:../../os/hal/platforms/AVR/spi_lld.c ****  * @notapi
 129:../../os/hal/platforms/AVR/spi_lld.c ****  */
 130:../../os/hal/platforms/AVR/spi_lld.c **** void spi_lld_init(void)
 131:../../os/hal/platforms/AVR/spi_lld.c **** {
 287               		.loc 1 131 0
 288               		.cfi_startproc
 289               	/* prologue: function */
 290               	/* frame size = 0 */
 291               	/* stack size = 0 */
 292               	.L__stack_usage = 0
 132:../../os/hal/platforms/AVR/spi_lld.c **** 
 133:../../os/hal/platforms/AVR/spi_lld.c **** 
 134:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI1 || defined(__DOXYGEN__)
 135:../../os/hal/platforms/AVR/spi_lld.c ****     spiObjectInit(&SPID1);
 293               		.loc 1 135 0
 294 0142 80E0      		ldi r24,lo8(SPID1)
 295 0144 90E0      		ldi r25,hi8(SPID1)
 296 0146 0C94 0000 		jmp spiObjectInit
 297               	.LVL13:
 298               		.cfi_endproc
 299               	.LFE10:
 301               	.global	spi_lld_start
 303               	spi_lld_start:
 304               	.LFB11:
 136:../../os/hal/platforms/AVR/spi_lld.c **** 
 137:../../os/hal/platforms/AVR/spi_lld.c **** #endif
 138:../../os/hal/platforms/AVR/spi_lld.c **** 
 139:../../os/hal/platforms/AVR/spi_lld.c **** 
 140:../../os/hal/platforms/AVR/spi_lld.c **** 
 141:../../os/hal/platforms/AVR/spi_lld.c **** }
 142:../../os/hal/platforms/AVR/spi_lld.c **** 
 143:../../os/hal/platforms/AVR/spi_lld.c **** /**
 144:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   Configures and activates the SPI peripheral.
 145:../../os/hal/platforms/AVR/spi_lld.c ****  *
 146:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 147:../../os/hal/platforms/AVR/spi_lld.c ****  *
 148:../../os/hal/platforms/AVR/spi_lld.c ****  * @notapi
 149:../../os/hal/platforms/AVR/spi_lld.c ****  */
 150:../../os/hal/platforms/AVR/spi_lld.c **** void spi_lld_start(SPIDriver *spip)
 151:../../os/hal/platforms/AVR/spi_lld.c **** {
 305               		.loc 1 151 0
 306               		.cfi_startproc
 307               	.LVL14:
 308               	/* prologue: function */
 309               	/* frame size = 0 */
 310               	/* stack size = 0 */
 311               	.L__stack_usage = 0
 152:../../os/hal/platforms/AVR/spi_lld.c **** 
 153:../../os/hal/platforms/AVR/spi_lld.c ****     if (spip->state == SPI_STOP)
 312               		.loc 1 153 0
 313 014a FC01      		movw r30,r24
 314 014c 2081      		ld r18,Z
 315 014e 2130      		cpi r18,lo8(1)
 316 0150 01F0      		breq .L30
 154:../../os/hal/platforms/AVR/spi_lld.c ****     {
 155:../../os/hal/platforms/AVR/spi_lld.c ****         /* Clock activation.*/
 156:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI1 || defined(__DOXYGEN__)
 157:../../os/hal/platforms/AVR/spi_lld.c ****         if(spip == &SPID1)
 158:../../os/hal/platforms/AVR/spi_lld.c ****         {
 159:../../os/hal/platforms/AVR/spi_lld.c ****             SPCR = (1<<MSTR)|
 160:../../os/hal/platforms/AVR/spi_lld.c ****                    (1<<SPIE)| //enable interrupt
 161:../../os/hal/platforms/AVR/spi_lld.c ****                    (1<<SPR1)|(1<<SPR0)| //Clk/128
 162:../../os/hal/platforms/AVR/spi_lld.c ****                    ((spip->config->spi_mode & 0x3)<<CPHA);
 163:../../os/hal/platforms/AVR/spi_lld.c ****         }
 164:../../os/hal/platforms/AVR/spi_lld.c **** #endif
 165:../../os/hal/platforms/AVR/spi_lld.c **** 
 166:../../os/hal/platforms/AVR/spi_lld.c ****     }
 167:../../os/hal/platforms/AVR/spi_lld.c ****     /* Configuration.*/
 168:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI1 || defined(__DOXYGEN__)
 169:../../os/hal/platforms/AVR/spi_lld.c ****     if(spip == &SPID1)
 317               		.loc 1 169 0
 318 0152 8050      		subi r24,lo8(SPID1)
 319 0154 9040      		sbci r25,hi8(SPID1)
 320 0156 01F0      		breq .L29
 321               	.L26:
 322 0158 0895      		ret
 323               	.L30:
 157:../../os/hal/platforms/AVR/spi_lld.c ****         if(spip == &SPID1)
 324               		.loc 1 157 0
 325 015a 8050      		subi r24,lo8(SPID1)
 326 015c 9040      		sbci r25,hi8(SPID1)
 327 015e 01F4      		brne .L26
 162:../../os/hal/platforms/AVR/spi_lld.c ****                    ((spip->config->spi_mode & 0x3)<<CPHA);
 328               		.loc 1 162 0
 329 0160 E091 0000 		lds r30,SPID1+1
 330 0164 F091 0000 		lds r31,SPID1+1+1
 331 0168 8281      		ldd r24,Z+2
 332               	.LVL15:
 333 016a 8370      		andi r24,lo8(3)
 334 016c 90E0      		ldi r25,0
 335 016e 880F      		lsl r24
 336 0170 991F      		rol r25
 337 0172 880F      		lsl r24
 338 0174 991F      		rol r25
 159:../../os/hal/platforms/AVR/spi_lld.c ****             SPCR = (1<<MSTR)|
 339               		.loc 1 159 0
 340 0176 8369      		ori r24,147
 341 0178 9F6F      		ori r25,255
 342 017a 8CBD      		out 0x2c,r24
 343               	.L29:
 170:../../os/hal/platforms/AVR/spi_lld.c ****     {
 171:../../os/hal/platforms/AVR/spi_lld.c ****         /*mosi, sck and ss output*/
 172:../../os/hal/platforms/AVR/spi_lld.c ****         PORT_SPI1 |= (1<<SPI1_SCK)|(1<<SPI1_MOSI)|(1<<SPI1_SS);
 344               		.loc 1 172 0
 345 017c 85B1      		in r24,0x5
 346 017e 8C62      		ori r24,lo8(44)
 347 0180 85B9      		out 0x5,r24
 173:../../os/hal/platforms/AVR/spi_lld.c ****         PORT_SPI1 &= ~(1<<SPI1_MISO);
 348               		.loc 1 173 0
 349 0182 2C98      		cbi 0x5,4
 174:../../os/hal/platforms/AVR/spi_lld.c ****         SPCR |= (1<<SPE);
 350               		.loc 1 174 0
 351 0184 8CB5      		in r24,0x2c
 352 0186 8064      		ori r24,lo8(64)
 353 0188 8CBD      		out 0x2c,r24
 354 018a 0895      		ret
 355               		.cfi_endproc
 356               	.LFE11:
 358               	.global	spi_lld_stop
 360               	spi_lld_stop:
 361               	.LFB12:
 175:../../os/hal/platforms/AVR/spi_lld.c ****     }
 176:../../os/hal/platforms/AVR/spi_lld.c **** #endif
 177:../../os/hal/platforms/AVR/spi_lld.c **** }
 178:../../os/hal/platforms/AVR/spi_lld.c **** 
 179:../../os/hal/platforms/AVR/spi_lld.c **** /**
 180:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   Deactivates the SPI peripheral.
 181:../../os/hal/platforms/AVR/spi_lld.c ****  *
 182:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 183:../../os/hal/platforms/AVR/spi_lld.c ****  *
 184:../../os/hal/platforms/AVR/spi_lld.c ****  * @notapi
 185:../../os/hal/platforms/AVR/spi_lld.c ****  */
 186:../../os/hal/platforms/AVR/spi_lld.c **** void spi_lld_stop(SPIDriver *spip)
 187:../../os/hal/platforms/AVR/spi_lld.c **** {
 362               		.loc 1 187 0
 363               		.cfi_startproc
 364               	.LVL16:
 365               	/* prologue: function */
 366               	/* frame size = 0 */
 367               	/* stack size = 0 */
 368               	.L__stack_usage = 0
 188:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI1 || defined(__DOXYGEN__)
 189:../../os/hal/platforms/AVR/spi_lld.c ****     if(spip == &SPID1)
 369               		.loc 1 189 0
 370 018c 8050      		subi r24,lo8(SPID1)
 371 018e 9040      		sbci r25,hi8(SPID1)
 372 0190 01F0      		breq .L33
 373 0192 0895      		ret
 374               	.L33:
 190:../../os/hal/platforms/AVR/spi_lld.c ****     {
 191:../../os/hal/platforms/AVR/spi_lld.c ****         /*all input*/
 192:../../os/hal/platforms/AVR/spi_lld.c ****         PORT_SPI1 &= ~((1<<SPI1_MISO)|(1<<SPI1_SCK)|(1<<SPI1_MOSI)|(1<<SPI1_SS));
 375               		.loc 1 192 0
 376 0194 85B1      		in r24,0x5
 377               	.LVL17:
 378 0196 837C      		andi r24,lo8(-61)
 379 0198 85B9      		out 0x5,r24
 193:../../os/hal/platforms/AVR/spi_lld.c ****         SPCR &=~(1<<SPE);
 380               		.loc 1 193 0
 381 019a 8CB5      		in r24,0x2c
 382 019c 8F7B      		andi r24,lo8(-65)
 383 019e 8CBD      		out 0x2c,r24
 384 01a0 0895      		ret
 385               		.cfi_endproc
 386               	.LFE12:
 388               	.global	spi_lld_select
 390               	spi_lld_select:
 391               	.LFB13:
 194:../../os/hal/platforms/AVR/spi_lld.c ****     }
 195:../../os/hal/platforms/AVR/spi_lld.c **** #endif
 196:../../os/hal/platforms/AVR/spi_lld.c **** }
 197:../../os/hal/platforms/AVR/spi_lld.c **** 
 198:../../os/hal/platforms/AVR/spi_lld.c **** /**
 199:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   Asserts the slave select signal and prepares for transfers.
 200:../../os/hal/platforms/AVR/spi_lld.c ****  *
 201:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 202:../../os/hal/platforms/AVR/spi_lld.c ****  *
 203:../../os/hal/platforms/AVR/spi_lld.c ****  * @notapi
 204:../../os/hal/platforms/AVR/spi_lld.c ****  */
 205:../../os/hal/platforms/AVR/spi_lld.c **** void spi_lld_select(SPIDriver *spip)
 206:../../os/hal/platforms/AVR/spi_lld.c **** {
 392               		.loc 1 206 0
 393               		.cfi_startproc
 394               	.LVL18:
 395               	/* prologue: function */
 396               	/* frame size = 0 */
 397               	/* stack size = 0 */
 398               	.L__stack_usage = 0
 207:../../os/hal/platforms/AVR/spi_lld.c **** 
 208:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI1 || defined(__DOXYGEN__)
 209:../../os/hal/platforms/AVR/spi_lld.c ****     if(spip == &SPID1)
 399               		.loc 1 209 0
 400 01a2 8050      		subi r24,lo8(SPID1)
 401 01a4 9040      		sbci r25,hi8(SPID1)
 402 01a6 01F0      		breq .L36
 403 01a8 0895      		ret
 404               	.L36:
 210:../../os/hal/platforms/AVR/spi_lld.c ****     {
 211:../../os/hal/platforms/AVR/spi_lld.c **** 
 212:../../os/hal/platforms/AVR/spi_lld.c ****         PORT_SPI1 &= ~_BV(SPI1_SS);
 405               		.loc 1 212 0
 406 01aa 2A98      		cbi 0x5,2
 213:../../os/hal/platforms/AVR/spi_lld.c ****         DDR_SPI1  |= _BV(SPI1_SS);
 407               		.loc 1 213 0
 408 01ac 229A      		sbi 0x4,2
 409 01ae 0895      		ret
 410               		.cfi_endproc
 411               	.LFE13:
 413               	.global	spi_lld_unselect
 415               	spi_lld_unselect:
 416               	.LFB14:
 214:../../os/hal/platforms/AVR/spi_lld.c **** 
 215:../../os/hal/platforms/AVR/spi_lld.c ****     }
 216:../../os/hal/platforms/AVR/spi_lld.c **** #endif
 217:../../os/hal/platforms/AVR/spi_lld.c **** }
 218:../../os/hal/platforms/AVR/spi_lld.c **** 
 219:../../os/hal/platforms/AVR/spi_lld.c **** /**
 220:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   Deasserts the slave select signal.
 221:../../os/hal/platforms/AVR/spi_lld.c ****  * @details The previously selected peripheral is unselected.
 222:../../os/hal/platforms/AVR/spi_lld.c ****  *
 223:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 224:../../os/hal/platforms/AVR/spi_lld.c ****  *
 225:../../os/hal/platforms/AVR/spi_lld.c ****  * @notapi
 226:../../os/hal/platforms/AVR/spi_lld.c ****  */
 227:../../os/hal/platforms/AVR/spi_lld.c **** void spi_lld_unselect(SPIDriver *spip)
 228:../../os/hal/platforms/AVR/spi_lld.c **** {
 417               		.loc 1 228 0
 418               		.cfi_startproc
 419               	.LVL19:
 420               	/* prologue: function */
 421               	/* frame size = 0 */
 422               	/* stack size = 0 */
 423               	.L__stack_usage = 0
 229:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI1 || defined(__DOXYGEN__)
 230:../../os/hal/platforms/AVR/spi_lld.c ****     if(spip == &SPID1)
 424               		.loc 1 230 0
 425 01b0 8050      		subi r24,lo8(SPID1)
 426 01b2 9040      		sbci r25,hi8(SPID1)
 427 01b4 01F0      		breq .L39
 428 01b6 0895      		ret
 429               	.L39:
 231:../../os/hal/platforms/AVR/spi_lld.c ****     {
 232:../../os/hal/platforms/AVR/spi_lld.c ****         DDR_SPI1  &= ~_BV(SPI1_SS);
 430               		.loc 1 232 0
 431 01b8 2298      		cbi 0x4,2
 233:../../os/hal/platforms/AVR/spi_lld.c ****         PORT_SPI1 |= _BV(SPI1_SS);
 432               		.loc 1 233 0
 433 01ba 2A9A      		sbi 0x5,2
 434 01bc 0895      		ret
 435               		.cfi_endproc
 436               	.LFE14:
 438               	.global	spi_lld_ignore
 440               	spi_lld_ignore:
 441               	.LFB15:
 234:../../os/hal/platforms/AVR/spi_lld.c **** 
 235:../../os/hal/platforms/AVR/spi_lld.c **** 
 236:../../os/hal/platforms/AVR/spi_lld.c ****     }
 237:../../os/hal/platforms/AVR/spi_lld.c **** #endif
 238:../../os/hal/platforms/AVR/spi_lld.c **** 
 239:../../os/hal/platforms/AVR/spi_lld.c **** }
 240:../../os/hal/platforms/AVR/spi_lld.c **** 
 241:../../os/hal/platforms/AVR/spi_lld.c **** /**
 242:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   Ignores data on the SPI bus.
 243:../../os/hal/platforms/AVR/spi_lld.c ****  * @details This asynchronous function starts the transmission of a series of
 244:../../os/hal/platforms/AVR/spi_lld.c ****  *          idle words on the SPI bus and ignores the received data.
 245:../../os/hal/platforms/AVR/spi_lld.c ****  * @post    At the end of the operation the configured callback is invoked.
 246:../../os/hal/platforms/AVR/spi_lld.c ****  *
 247:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 248:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] n         number of words to be ignored
 249:../../os/hal/platforms/AVR/spi_lld.c ****  *
 250:../../os/hal/platforms/AVR/spi_lld.c ****  * @notapi
 251:../../os/hal/platforms/AVR/spi_lld.c ****  */
 252:../../os/hal/platforms/AVR/spi_lld.c **** void spi_lld_ignore(SPIDriver *spip, size_t n)
 253:../../os/hal/platforms/AVR/spi_lld.c **** {
 442               		.loc 1 253 0
 443               		.cfi_startproc
 444               	.LVL20:
 445               	/* prologue: function */
 446               	/* frame size = 0 */
 447               	/* stack size = 0 */
 448               	.L__stack_usage = 0
 449               	.LBB12:
 450               	.LBB13:
  79:../../os/hal/platforms/AVR/spi_lld.c ****     spip->tx_buffer= txbuf;
 451               		.loc 1 79 0
 452 01be FC01      		movw r30,r24
 453 01c0 108A      		std Z+16,__zero_reg__
 454 01c2 1786      		std Z+15,__zero_reg__
  80:../../os/hal/platforms/AVR/spi_lld.c ****     spip->rx_buffer= rxbuf;
 455               		.loc 1 80 0
 456 01c4 128A      		std Z+18,__zero_reg__
 457 01c6 118A      		std Z+17,__zero_reg__
  81:../../os/hal/platforms/AVR/spi_lld.c ****     spip->untransmitted_bytes= n;
 458               		.loc 1 81 0
 459 01c8 7687      		std Z+14,r23
 460 01ca 6587      		std Z+13,r22
 461               	.LBE13:
 462               	.LBE12:
 254:../../os/hal/platforms/AVR/spi_lld.c ****     spi_setup_transmission(spip, n, NULL,NULL);
 255:../../os/hal/platforms/AVR/spi_lld.c ****     spi_start_transmission(spip);
 463               		.loc 1 255 0
 464 01cc 0C94 0000 		jmp spi_start_transmission
 465               	.LVL21:
 466               		.cfi_endproc
 467               	.LFE15:
 469               	.global	spi_lld_exchange
 471               	spi_lld_exchange:
 472               	.LFB16:
 256:../../os/hal/platforms/AVR/spi_lld.c **** }
 257:../../os/hal/platforms/AVR/spi_lld.c **** 
 258:../../os/hal/platforms/AVR/spi_lld.c **** /**
 259:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   Exchanges data on the SPI bus.
 260:../../os/hal/platforms/AVR/spi_lld.c ****  * @details This asynchronous function starts a simultaneous transmit/receive
 261:../../os/hal/platforms/AVR/spi_lld.c ****  *          operation.
 262:../../os/hal/platforms/AVR/spi_lld.c ****  * @post    At the end of the operation the configured callback is invoked.
 263:../../os/hal/platforms/AVR/spi_lld.c ****  * @note    The buffers are organized as uint8_t arrays for data sizes below or
 264:../../os/hal/platforms/AVR/spi_lld.c ****  *          equal to 8 bits else it is organized as uint16_t arrays.
 265:../../os/hal/platforms/AVR/spi_lld.c ****  *
 266:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 267:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] n         number of words to be exchanged
 268:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] txbuf     the pointer to the transmit buffer
 269:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[out] rxbuf    the pointer to the receive buffer
 270:../../os/hal/platforms/AVR/spi_lld.c ****  *
 271:../../os/hal/platforms/AVR/spi_lld.c ****  * @notapi
 272:../../os/hal/platforms/AVR/spi_lld.c ****  */
 273:../../os/hal/platforms/AVR/spi_lld.c **** void spi_lld_exchange(SPIDriver *spip, size_t n,
 274:../../os/hal/platforms/AVR/spi_lld.c ****                       const void *txbuf, void *rxbuf)
 275:../../os/hal/platforms/AVR/spi_lld.c **** {
 473               		.loc 1 275 0
 474               		.cfi_startproc
 475               	.LVL22:
 476               	/* prologue: function */
 477               	/* frame size = 0 */
 478               	/* stack size = 0 */
 479               	.L__stack_usage = 0
 480               	.LBB14:
 481               	.LBB15:
  79:../../os/hal/platforms/AVR/spi_lld.c ****     spip->tx_buffer= txbuf;
 482               		.loc 1 79 0
 483 01d0 FC01      		movw r30,r24
 484 01d2 508B      		std Z+16,r21
 485 01d4 4787      		std Z+15,r20
  80:../../os/hal/platforms/AVR/spi_lld.c ****     spip->rx_buffer= rxbuf;
 486               		.loc 1 80 0
 487 01d6 328B      		std Z+18,r19
 488 01d8 218B      		std Z+17,r18
  81:../../os/hal/platforms/AVR/spi_lld.c ****     spip->untransmitted_bytes= n;
 489               		.loc 1 81 0
 490 01da 7687      		std Z+14,r23
 491 01dc 6587      		std Z+13,r22
 492               	.LBE15:
 493               	.LBE14:
 276:../../os/hal/platforms/AVR/spi_lld.c ****     spi_setup_transmission(spip, n, txbuf, rxbuf);
 277:../../os/hal/platforms/AVR/spi_lld.c ****     spi_start_transmission(spip);
 494               		.loc 1 277 0
 495 01de 0C94 0000 		jmp spi_start_transmission
 496               	.LVL23:
 497               		.cfi_endproc
 498               	.LFE16:
 500               	.global	spi_lld_send
 502               	spi_lld_send:
 503               	.LFB17:
 278:../../os/hal/platforms/AVR/spi_lld.c **** }
 279:../../os/hal/platforms/AVR/spi_lld.c **** 
 280:../../os/hal/platforms/AVR/spi_lld.c **** /**
 281:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   Sends data over the SPI bus.
 282:../../os/hal/platforms/AVR/spi_lld.c ****  * @details This asynchronous function starts a transmit operation.
 283:../../os/hal/platforms/AVR/spi_lld.c ****  * @post    At the end of the operation the configured callback is invoked.
 284:../../os/hal/platforms/AVR/spi_lld.c ****  * @note    The buffers are organized as uint8_t arrays for data sizes below or
 285:../../os/hal/platforms/AVR/spi_lld.c ****  *          equal to 8 bits else it is organized as uint16_t arrays.
 286:../../os/hal/platforms/AVR/spi_lld.c ****  *
 287:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 288:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] n         number of words to send
 289:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] txbuf     the pointer to the transmit buffer
 290:../../os/hal/platforms/AVR/spi_lld.c ****  *
 291:../../os/hal/platforms/AVR/spi_lld.c ****  * @notapi
 292:../../os/hal/platforms/AVR/spi_lld.c ****  */
 293:../../os/hal/platforms/AVR/spi_lld.c **** void spi_lld_send(SPIDriver *spip, size_t n, const void *txbuf)
 294:../../os/hal/platforms/AVR/spi_lld.c **** {
 504               		.loc 1 294 0
 505               		.cfi_startproc
 506               	.LVL24:
 507               	/* prologue: function */
 508               	/* frame size = 0 */
 509               	/* stack size = 0 */
 510               	.L__stack_usage = 0
 511               	.LBB16:
 512               	.LBB17:
  79:../../os/hal/platforms/AVR/spi_lld.c ****     spip->tx_buffer= txbuf;
 513               		.loc 1 79 0
 514 01e2 FC01      		movw r30,r24
 515 01e4 508B      		std Z+16,r21
 516 01e6 4787      		std Z+15,r20
  80:../../os/hal/platforms/AVR/spi_lld.c ****     spip->rx_buffer= rxbuf;
 517               		.loc 1 80 0
 518 01e8 128A      		std Z+18,__zero_reg__
 519 01ea 118A      		std Z+17,__zero_reg__
  81:../../os/hal/platforms/AVR/spi_lld.c ****     spip->untransmitted_bytes= n;
 520               		.loc 1 81 0
 521 01ec 7687      		std Z+14,r23
 522 01ee 6587      		std Z+13,r22
 523               	.LBE17:
 524               	.LBE16:
 295:../../os/hal/platforms/AVR/spi_lld.c ****     spi_setup_transmission(spip, n, txbuf, NULL);
 296:../../os/hal/platforms/AVR/spi_lld.c ****     spi_start_transmission(spip);
 525               		.loc 1 296 0
 526 01f0 0C94 0000 		jmp spi_start_transmission
 527               	.LVL25:
 528               		.cfi_endproc
 529               	.LFE17:
 531               	.global	spi_lld_receive
 533               	spi_lld_receive:
 534               	.LFB18:
 297:../../os/hal/platforms/AVR/spi_lld.c **** }
 298:../../os/hal/platforms/AVR/spi_lld.c **** 
 299:../../os/hal/platforms/AVR/spi_lld.c **** /**
 300:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   Receives data from the SPI bus.
 301:../../os/hal/platforms/AVR/spi_lld.c ****  * @details This asynchronous function starts a receive operation.
 302:../../os/hal/platforms/AVR/spi_lld.c ****  * @post    At the end of the operation the configured callback is invoked.
 303:../../os/hal/platforms/AVR/spi_lld.c ****  * @note    The buffers are organized as uint8_t arrays for data sizes below or
 304:../../os/hal/platforms/AVR/spi_lld.c ****  *          equal to 8 bits else it is organized as uint16_t arrays.
 305:../../os/hal/platforms/AVR/spi_lld.c ****  *
 306:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 307:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] n         number of words to receive
 308:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[out] rxbuf    the pointer to the receive buffer
 309:../../os/hal/platforms/AVR/spi_lld.c ****  *
 310:../../os/hal/platforms/AVR/spi_lld.c ****  * @notapi
 311:../../os/hal/platforms/AVR/spi_lld.c ****  */
 312:../../os/hal/platforms/AVR/spi_lld.c **** void spi_lld_receive(SPIDriver *spip, size_t n, void *rxbuf)
 313:../../os/hal/platforms/AVR/spi_lld.c **** {
 535               		.loc 1 313 0
 536               		.cfi_startproc
 537               	.LVL26:
 538               	/* prologue: function */
 539               	/* frame size = 0 */
 540               	/* stack size = 0 */
 541               	.L__stack_usage = 0
 542               	.LBB18:
 543               	.LBB19:
  79:../../os/hal/platforms/AVR/spi_lld.c ****     spip->tx_buffer= txbuf;
 544               		.loc 1 79 0
 545 01f4 FC01      		movw r30,r24
 546 01f6 108A      		std Z+16,__zero_reg__
 547 01f8 1786      		std Z+15,__zero_reg__
  80:../../os/hal/platforms/AVR/spi_lld.c ****     spip->rx_buffer= rxbuf;
 548               		.loc 1 80 0
 549 01fa 528B      		std Z+18,r21
 550 01fc 418B      		std Z+17,r20
  81:../../os/hal/platforms/AVR/spi_lld.c ****     spip->untransmitted_bytes= n;
 551               		.loc 1 81 0
 552 01fe 7687      		std Z+14,r23
 553 0200 6587      		std Z+13,r22
 554               	.LBE19:
 555               	.LBE18:
 314:../../os/hal/platforms/AVR/spi_lld.c ****     spi_setup_transmission(spip, n, NULL, rxbuf);
 315:../../os/hal/platforms/AVR/spi_lld.c ****     spi_start_transmission(spip);
 556               		.loc 1 315 0
 557 0202 0C94 0000 		jmp spi_start_transmission
 558               	.LVL27:
 559               		.cfi_endproc
 560               	.LFE18:
 562               	.global	spi_lld_polled_exchange
 564               	spi_lld_polled_exchange:
 565               	.LFB19:
 316:../../os/hal/platforms/AVR/spi_lld.c **** }
 317:../../os/hal/platforms/AVR/spi_lld.c **** 
 318:../../os/hal/platforms/AVR/spi_lld.c **** /**
 319:../../os/hal/platforms/AVR/spi_lld.c ****  * @brief   Exchanges one frame using a polled wait.
 320:../../os/hal/platforms/AVR/spi_lld.c ****  * @details This synchronous function exchanges one frame using a polled
 321:../../os/hal/platforms/AVR/spi_lld.c ****  *          synchronization method. This function is useful when exchanging
 322:../../os/hal/platforms/AVR/spi_lld.c ****  *          small amount of data on high speed channels, usually in this
 323:../../os/hal/platforms/AVR/spi_lld.c ****  *          situation is much more efficient just wait for completion using
 324:../../os/hal/platforms/AVR/spi_lld.c ****  *          polling than suspending the thread waiting for an interrupt.
 325:../../os/hal/platforms/AVR/spi_lld.c ****  *
 326:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] spip      pointer to the @p SPIDriver object
 327:../../os/hal/platforms/AVR/spi_lld.c ****  * @param[in] frame     the data frame to send over the SPI bus
 328:../../os/hal/platforms/AVR/spi_lld.c ****  * @return              The received data frame from the SPI bus.
 329:../../os/hal/platforms/AVR/spi_lld.c ****  */
 330:../../os/hal/platforms/AVR/spi_lld.c **** uint8_t spi_lld_polled_exchange(SPIDriver *spip, uint8_t frame)
 331:../../os/hal/platforms/AVR/spi_lld.c **** {
 566               		.loc 1 331 0
 567               		.cfi_startproc
 568               	.LVL28:
 569               	/* prologue: function */
 570               	/* frame size = 0 */
 571               	/* stack size = 0 */
 572               	.L__stack_usage = 0
 573 0206 FC01      		movw r30,r24
 574               	.LVL29:
 575               	.L45:
 332:../../os/hal/platforms/AVR/spi_lld.c ****     while(spip->state !=SPI_READY)
 576               		.loc 1 332 0 discriminator 1
 577 0208 8081      		ld r24,Z
 578 020a 8230      		cpi r24,lo8(2)
 579 020c 01F4      		brne .L45
 333:../../os/hal/platforms/AVR/spi_lld.c ****         ;
 334:../../os/hal/platforms/AVR/spi_lld.c **** #if USE_AVR_SPI1 || defined(__DOXYGEN__)
 335:../../os/hal/platforms/AVR/spi_lld.c ****     if(spip == &SPID1)
 580               		.loc 1 335 0
 581 020e E050      		subi r30,lo8(SPID1)
 582 0210 F040      		sbci r31,hi8(SPID1)
 583 0212 01F0      		breq .L51
 336:../../os/hal/platforms/AVR/spi_lld.c ****     {
 337:../../os/hal/platforms/AVR/spi_lld.c ****         SPCR &= ~(1<<SPIE);
 338:../../os/hal/platforms/AVR/spi_lld.c **** 
 339:../../os/hal/platforms/AVR/spi_lld.c ****         SPDR = frame;
 340:../../os/hal/platforms/AVR/spi_lld.c **** 
 341:../../os/hal/platforms/AVR/spi_lld.c ****         while(!(SPSR & (1<<SPIF)))
 342:../../os/hal/platforms/AVR/spi_lld.c ****             ;
 343:../../os/hal/platforms/AVR/spi_lld.c ****         uint8_t retval = SPDR; //this is needed to clear spif
 344:../../os/hal/platforms/AVR/spi_lld.c ****         SPCR |= (1<<SPIE);
 345:../../os/hal/platforms/AVR/spi_lld.c ****         return retval;
 346:../../os/hal/platforms/AVR/spi_lld.c **** 
 347:../../os/hal/platforms/AVR/spi_lld.c ****     }
 348:../../os/hal/platforms/AVR/spi_lld.c **** #endif
 349:../../os/hal/platforms/AVR/spi_lld.c **** }
 584               		.loc 1 349 0
 585 0214 0895      		ret
 586               	.L51:
 587               	.LBB20:
 337:../../os/hal/platforms/AVR/spi_lld.c ****         SPCR &= ~(1<<SPIE);
 588               		.loc 1 337 0
 589 0216 8CB5      		in r24,0x2c
 590 0218 8F77      		andi r24,lo8(127)
 591 021a 8CBD      		out 0x2c,r24
 339:../../os/hal/platforms/AVR/spi_lld.c ****         SPDR = frame;
 592               		.loc 1 339 0
 593 021c 6EBD      		out 0x2e,r22
 594               	.L47:
 341:../../os/hal/platforms/AVR/spi_lld.c ****         while(!(SPSR & (1<<SPIF)))
 595               		.loc 1 341 0 discriminator 1
 596 021e 0DB4      		in __tmp_reg__,0x2d
 597 0220 07FE      		sbrs __tmp_reg__,7
 598 0222 00C0      		rjmp .L47
 343:../../os/hal/platforms/AVR/spi_lld.c ****         uint8_t retval = SPDR; //this is needed to clear spif
 599               		.loc 1 343 0
 600 0224 8EB5      		in r24,0x2e
 601               	.LVL30:
 344:../../os/hal/platforms/AVR/spi_lld.c ****         SPCR |= (1<<SPIE);
 602               		.loc 1 344 0
 603 0226 9CB5      		in r25,0x2c
 604 0228 9068      		ori r25,lo8(-128)
 605 022a 9CBD      		out 0x2c,r25
 606 022c 0895      		ret
 607               	.LBE20:
 608               		.cfi_endproc
 609               	.LFE19:
 611               		.comm	SPID1,19,1
 612               	.Letext0:
 613               		.file 2 "/usr/local/cross/lib/gcc/avr/4.7.2/include/stddef.h"
 614               		.file 3 "/usr/local/cross/lib/gcc/avr/4.7.2/../../../../avr/include/stdint.h"
 615               		.file 4 "../../os/ports/GCC/AVR/chtypes.h"
 616               		.file 5 "../../os/kernel/include/chlists.h"
 617               		.file 6 "../../os/kernel/include/chthreads.h"
 618               		.file 7 "../../os/ports/GCC/AVR/chcore.h"
 619               		.file 8 "../../os/kernel/include/chmtx.h"
 620               		.file 9 "../../os/hal/include/spi.h"
 621               		.file 10 "../../os/hal/platforms/AVR/spi_lld.h"
 622               		.file 11 "../../os/kernel/include/chschd.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 spi_lld.c
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:2      *ABS*:000000000000003e __SP_H__
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:3      *ABS*:000000000000003d __SP_L__
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:4      *ABS*:000000000000003f __SREG__
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:5      *ABS*:0000000000000000 __tmp_reg__
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:6      *ABS*:0000000000000001 __zero_reg__
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:11     .text:0000000000000000 spi_start_transmission
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:91     .text:0000000000000048 __vector_17
                            *COM*:0000000000000013 SPID1
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:285    .text:0000000000000142 spi_lld_init
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:303    .text:000000000000014a spi_lld_start
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:360    .text:000000000000018c spi_lld_stop
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:390    .text:00000000000001a2 spi_lld_select
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:415    .text:00000000000001b0 spi_lld_unselect
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:440    .text:00000000000001be spi_lld_ignore
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:471    .text:00000000000001d0 spi_lld_exchange
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:502    .text:00000000000001e2 spi_lld_send
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:533    .text:00000000000001f4 spi_lld_receive
/var/folders/5n/p_75w94d66l9ssrldxqdhh700000gn/T//ccT0MLGy.s:564    .text:0000000000000206 spi_lld_polled_exchange

UNDEFINED SYMBOLS
chSchIsPreemptionRequired
chSchDoReschedule
chSchReadyI
spiObjectInit
__do_clear_bss
