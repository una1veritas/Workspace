ARM GAS  startup.s 			page 1


   1              		.text
   2              	
   3              		.extern		main
   4              		.extern		_sp_base
   5              	#======================================
   6              	#      Initialize vectors
   7              	#
   8              	##     0x00 	 Reset
   9              	##     0x04 	 Undefined Instruction
  10              	##     0x08 	 Software Interrupt
  11              	##     0x0c 	 Abort(prefetch)
  12              	##     0x10 	 Abort(data)
  13              	##     0x14 	 Reserved
  14              	##     0x18 	 IRQ
  15              	##     0x1c 	 FIQ
  16              	#======================================
  17              		.global _startup
  18              	
  19 0000 FEFFFFEA 		B	_startup
  20 0004 0000A0E1 		nop
  21 0008 0000A0E1 		nop
  22 000c 0000A0E1 		nop
  23 0010 0000A0E1 		nop
  24 0014 0000A0E1 		nop
  25 0018 100000EA 		B	_IRQ_handle
  26 001c 0000A0E1 		nop
  27              		.org 0x20	
  28              	_startup:
  29              		#IRQ通知を受け取るように設定する
  30 0020 00000FE1 		MRS	R0, cpsr
  31 0024 800020E2 		eor	R0, R0, #0x80
  32 0028 00F029E1 		MSR	cpsr, R0
  33              		#プロセッサモードをIRQモードへ	
  34 002c 00100FE1 		MRS	r1, CPSR
  35 0030 1F10C1E3 		BIC	R1, R1, #0x1F
  36 0034 121081E3 		ORR	R1, R1, #0x12
  37 0038 01F029E1 		MSR	CPSR, R1
  38              		#例外ハンドラ用スタックを設定
  39 003c 3CD09FE5 		LDR	sp, = _exception_sp_base
  40              	
  41              		#プロセッサモードをスーパーバイザモードへ戻す
  42 0040 00100FE1 		MRS	r1, CPSR
  43 0044 1F10C1E3 		BIC	R1, R1, #0x1F
  44 0048 131081E3 		ORR	R1, R1, #0x13
  45 004c 01F029E1 		MSR	CPSR, R1
  46              	
  47              		# スタックを設定
  48 0050 2CD09FE5 		LDR	R13,=_sp_base
  49              	.ifdef THUMB
  50              		LDR     R1,=main
  51              		ORR     R1, R1 ,#1
  52              		BX      R1
  53              	.else
  54 0054 FEFFFFEB 		BL	main
  55              	.endif
  56 0058 0000A0E1 		.align 0x4
  56      0000A0E1 
ARM GAS  startup.s 			page 2


  57              	_IRQ_handle:
  58              		#例外用スタックにレジスタ退避	
  59 0060 FF5F2DE9 		STMDB	sp!,{r0-r12, r14}
  60 0064 00004FE1 		MRS	r0, spsr
  61 0068 01002DE9 		STMDB	sp!, {r0}
  62              	
  63 006c FEFFFFEB 		bl	IRQ_func
  64              			
  65              		#例外用スタックからレジスタ復帰	
  66 0070 0100BDE8 		LDMIA	sp!, {r0}
  67 0074 00F069E1 		MSR	spsr_cf, r0
  68 0078 FF5FBDE8 		LDMIA	sp!,{r0-r12,r14}
  69              			
  70 007c 04F05EE2 		SUBS	PC, R14, #4
  70      00000000 
  70      00000000 
  70      0000A0E1 
  70      0000A0E1 
ARM GAS  startup.s 			page 3


DEFINED SYMBOLS
           startup.s:28     .text:00000020 _startup
           startup.s:19     .text:00000000 $a
           startup.s:57     .text:00000060 _IRQ_handle
           startup.s:70     .text:00000080 $d

UNDEFINED SYMBOLS
_exception_sp_base
_sp_base
main
IRQ_func
