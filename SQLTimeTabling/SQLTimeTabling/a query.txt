mysql -h daisygw timetable --exec "set @project_id = 5; set @last= (select MAX(create_date) from timetable where project_id = @project_id); create temporary table tt as select task_id, timetable.period_id, processor_id from timetable where project_id = @project_id and number = 1 and create_date = @last; create temporary table a as select period_id, pp.day_id, days.number as day_order, pp.hour_id, hours.number as hour_order from (select * from periods left join period_properties using (period_id) where periods.project_id = @project_id) as pp, days, hours where pp.day_id = days.day_id and pp.hour_id = hours.hour_id; create temporary table b as select * from a; select processor_id, a.period_id, a.day_id, a.hour_order, b.period_id, MIN(b.hour_order) - a.hour_order as diff from tt, a, b where tt.period_id = a.period_id and a.day_id = b.day_id and a.hour_order < b.hour_order group by processor_id, a.period_id order by processor_id, day_id, hour_order"select processor_id, a.period_id, a.day_id, a.hour_order, b.period_id, b.hour_order from sampletimetable as tt, sampleperiods as a, sampleperiods as b where tt.period_id = a.period_id and a.day_id = b.day_id and b.hour_order = (select MIN(hour_order) from sampletimetable left join sampleperiods as c using (period_id) where processor_id = tt.processor_id and hour_order > a.hour_order) order by processor_id, a.day_id, a.hour_order;