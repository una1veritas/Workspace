Z80/8080-Macro-Assembler  Release 2.1

LOC   OBJECT CODE   LINE   STMT SOURCE CODE
                       1      1 ;
                       2      2 ; Page 1
                       3      3 ;
                       4      4
                       5      5 ;
                       6      6 ;
                       7      7 ;  SYSTEM INTERFACE
                       8      8 ;
                       9      9 ;	file	'8k Basic'
                      10     10
0000                  11     11 BASIC:				;FULL RESTART INITIALIZATION
0000                  12     12 SYSINITJ:
0000  c3 9b 20        13     13 	JMP	INITIALZ
0003                  14     14 REENTERBASIC:			;REENTER AFTER PAUSE
0003  c3 61 06        15     15 	JMP	cmndrstr
                      16     16
                      17     17 ;
                      18     18 ;  Monitor Routines
                      19     19 ;
                      20     20 ;co	equ	406h	;c -> screen
                      21     21 ;cinb	equ	409h	;keyboard -> ac, carry set if any
                      22     22 ;dclr	equ	538h	;clear screen
                      23     23 ;xco	equ	4f4h	;c -> printer (blocking)
                      24     24
                      25     25 ;
                      26     26 ; I don't know which monitor was used here. So instead the i/o functions
                      27     27 ; are added for the Altair 88-SIO2.
                      28     28 ;
                      29     29 ; July 2014, Udo Munk
                      30     30 ;
                      31     31
0006  db 10           32     32 co:	in	10h		;read console status
0008  e6 02           33     33 	ani	2		;if not ready
000a  ca 06 00        34     34 	jz	co		;keep waiting
000d  79              35     35 	mov	a,c		;get character
000e  d3 11           36     36 	out	11h		;and print it
0010  c9              37     37 	ret
                      38     38
0011  db 10           39     39 cinb:	in	10h		;read console status
0013  e6 01           40     40 	ani	1		;check if character available
0015  c8              41     41 	rz			;return if not with carry clear
0016  db 11           42     42 	in	11h		;get character
0018  37              43     43 	stc			;and set carry flag
0019  c9              44     44 	ret
                      45     45
001a                  46     46 dclr:				;not implemented yet
001a  c9              47     47 	ret
                      48     48
001b                  49     49 xco:				;not implemented yet
001b  c9              50     50 	ret
                      51     51
                      52     52 ;
                      53     53 ;  NON-BLOCKING INPUT
                      54     54 ;   CHAR IN AC IF NOT ZERO
                      55     55 ;   ZERO SET IF NONE
                      56     56 ;
001c                  57     57 SYSKEYIN:
001c  c5              58     58 	push	b
001d  d5              59     59 	push	d
001e  e5              60     60 	push	h
001f  cd 11 00        61     61 	call	cinb	;get char
0022  d2 33 00        62     62 	jnc	syskeynone
0025  fe 00           63     63 	cpi	0
0027  ca 37 00        64     64 	jz	clearscreen
002a  fe 1f           65     65 	cpi	1fh	;us to bring to 14
002c  ca 3d 00        66     66 	jz	gomonitor
002f                  67     67 syskeyinret:
002f  e1              68     68 	pop	h
0030  d1              69     69 	pop	d
0031  c1              70     70 	pop	b
0032  c9              71     71 	ret
0033                  72     72 syskeynone:
0033  97              73     73 	sub	a	;set zero
0034  c3 2f 00        74     74 	jmp	syskeyinret
0037                  75     75 clearscreen:
0037  cd 1a 00        76     76 	call	dclr	;clear screen
003a  c3 33 00        77     77 	jmp	syskeynone
003d                  78     78 gomonitor:
003d  cf              79     79 	rst	1	;about using us (^_)
003e  00              80     80 	nop	
003f  00              81     81 	nop
                      82     82 ;
                      83     83 ;  SEND AC TO SCREEN
                      84     84 ;
0040                  85     85 SYSDISPL:
0040  f5              86     86 	push	psw
0041  c5              87     87 	push	b
0042  d5              88     88 	push	d
                      89     89
                      90     90 ;
                      91     91 ; Page 2
                      92     92 ;
                      93     93
0043  e5              94     94 	push	h
0044  4f              95     95 	mov	c,a
0045  cd 06 00        96     96 	call	co	;c to screen
0048  3a 79 03        97     97 	lda	p3010	;print on the 3010 if zero
004b  a7              98     98 	ana	a	
004c  cc 1b 00        99     99 	cz	xco	;yes print
004f  e1             100    100 	pop	h
0050  d1             101    101 	pop	d
0051  c1             102    102 	pop	b
0052  f1             103    103 	pop	psw
0053  c9             104    104 	RET
                     105    105 ;
                     106    106 ;  CHECK FOR BREAK REQUEST
                     107    107 ;   SET ZERO TO BREAK
                     108    108 ;
0054                 109    109 SYSBREAK:
0054  cd 1c 00       110    110 	call	syskeyin
0057  ca 5c 00       111    111 	jz	nobreak
005a  97             112    112 	sub	a
005b  c9             113    113 	ret
005c                 114    114 nobreak:
005c  3e 01          115    115 	mvi	a,1
005e  b7             116    116 	ora	a
005f  c9             117    117 	ret
                     118    118 ;
                     119    119 ;  DELAY
                     120    120 ;
0060                 121    121 SYSWAIT:
0060  c9             122    122 	RET
                     123    123 ;
                     124    124 ;  RETURN TO MONITOR
                     125    125 ;
b400  =              126    126 MONITOR	EQU	0B400H
0061                 127    127 SYSQUIT:
0061  c3 00 b4       128    128 	JMP	MONITOR
                     129    129
                     130    130 ;
                     131    131 ;  Page 3
                     132    132 ;
                     133    133
000d  =              134    134 CR	EQU	0DH
000a  =              135    135 LF	EQU	0AH
0007  =              136    136 BEL	EQU	07H
0008  =              137    137 BS	EQU	08H
0009  =              138    138 TAB	EQU	09H
0009  =              139    139 HT	EQU	09H
0011  =              140    140 CD1	EQU	11H
007f  =              141    141 DEL	EQU	7FH
000f  =              142    142 SI	EQU	0FH
0003  =              143    143 ETX	EQU	03H
000c  =              144    144 FF	EQU	0CH
0018  =              145    145 ESC	EQU	18H
                     146    146
                     147    147 ;
                     148    148 ;  Page 4
                     149    149 ;
                     150    150
0080  =              151    151 KEYSTM	EQU	80H		;STATEMENT CODES
0080  =              152    152 KEYDAT	EQU	KEYSTM
0081  =              153    153 KEYREM	EQU	KEYDAT+1
0082  =              154    154 KEYLSAL	EQU	KEYREM+1
0082  =              155    155 KEYEND	EQU	KEYLSAL
0083  =              156    156 KEYFOR	EQU	KEYEND+1
0084  =              157    157 KEYNEX	EQU	KEYFOR+1
0085  =              158    158 KEYINPT	EQU	KEYNEX+1
0086  =              159    159 KEYDIM	EQU	KEYINPT+1
0087  =              160    160 KEYREA	EQU	KEYDIM+1
0088  =              161    161 KEYLET	EQU	KEYREA+1
0089  =              162    162 KEYGTO	EQU	KEYLET+1
008a  =              163    163 KEYRUN	EQU	KEYGTO+1
008b  =              164    164 KEYIF	EQU	KEYRUN+1
008c  =              165    165 KEYELS	EQU	KEYIF+1
008d  =              166    166 KEYRES	EQU	KEYELS+1
008e  =              167    167 KEYGSB	EQU	KEYRES+1
008f  =              168    168 KEYRET	EQU	KEYGSB+1
0090  =              169    169 KEYSTOP	EQU	KEYRET+1
0091  =              170    170 KEYON	EQU	KEYSTOP+1
0092  =              171    171 KEYAUT	EQU	KEYON+1
0093  =              172    172 KEYDEL	EQU	KEYAUT+1
0094  =              173    173 KEYPLT	EQU	KEYDEL+1
0095  =              174    174 KEYWAI	EQU	KEYPLT+1
0096  =              175    175 KEYPRT	EQU	KEYWAI+1
0097  =              176    176 KEYDEF	EQU	KEYPRT+1
0098  =              177    177 KEYCON	EQU	KEYDEF+1
0099  =              178    178 KEYLIS	EQU	KEYCON+1
009a  =              179    179 KEYEDI	EQU	KEYLIS+1
009b  =              180    180 KEYCLR	EQU	KEYEDI+1
009c  =              181    181 KEYCLD	EQU	KEYCLR+1
009d  =              182    182 KEYCSV	EQU	KEYCLD+1
009e  =              183    183 KEYNEW	EQU	KEYCSV+1
009f  =              184    184 KEYSET	EQU	KEYNEW+1
00a0  =              185    185 KEYSUGR	EQU	KEYSET+1
00a0  =              186    186 KEYLSBL	EQU	KEYSUGR
00a0  =              187    187 KEYTHEN	EQU	KEYSUGR
00a1  =              188    188 KEYTO	EQU	KEYTHEN+1
00a2  =              189    189 KEYSTEP	EQU	KEYTO+1
00a3  =              190    190 KEYLSBH	EQU	KEYSTEP+1
00a3  =              191    191 KEYPRM	EQU	KEYLSBH
00a4  =              192    192 KEYLINE	EQU	KEYPRM+1
00a5  =              193    193 KEYLSAH	EQU	KEYLINE+1
00a5  =              194    194 KEYTAB	EQU	KEYLSAH
00a6  =              195    195 KEYSPC	EQU	KEYTAB+1
00a7  =              196    196 KEYFN	EQU	KEYSPC+1
00a8  =              197    197 KEYNOT	EQU	KEYFN+1
00a9  =              198    198 KEYOFF	EQU	KEYNOT+1
                     199    199 ;
00aa  =              200    200 KEYOPR	EQU	KEYOFF+1	;OPERATOR CODES
00aa  =              201    201 KEYADD	EQU	KEYOPR
00ab  =              202    202 KEYSUB	EQU	KEYADD+1
00ac  =              203    203 KEYMUL	EQU	KEYSUB+1
00ad  =              204    204 KEYDIV	EQU	KEYMUL+1
00ae  =              205    205 KEYMOD	EQU	KEYDIV+1
00af  =              206    206 KEYEXPT	EQU	KEYMOD+1
                     207    207
                     208    208 ;
                     209    209 ;  Page 5
                     210    210 ;
                     211    211
00b0  =              212    212 KEYAND	EQU	KEYEXPT+1
00b1  =              213    213 KEYOR	EQU	KEYAND+1
00b2  =              214    214 KEYMAX	EQU	KEYOR+1
00b3  =              215    215 KEYMIN	EQU	KEYMAX+1
                     216    216 ;
00b4  =              217    217 KEYREL	EQU	KEYMIN+1	;RELATION CODES
00b4  =              218    218 KEYGT	EQU	KEYREL
00b5  =              219    219 KEYEQ	EQU	KEYGT+1
00b6  =              220    220 KEYLT	EQU	KEYEQ+1
                     221    221 ;
00b7  =              222    222 KEYFCT	EQU	KEYLT+1		;FUNCTION CODES
00b7  =              223    223 KEYSGN	EQU	KEYFCT
00b8  =              224    224 KEYINT	EQU	KEYSGN+1
00b9  =              225    225 KEYABS	EQU	KEYINT+1
00ba  =              226    226 KEYSQR	EQU	KEYABS+1
00bb  =              227    227 KEYRND	EQU	KEYSQR+1
00bc  =              228    228 KEYLOG	EQU	KEYRND+1
00bd  =              229    229 KEYEXP	EQU	KEYLOG+1
00be  =              230    230 KEYCOS	EQU	KEYEXP+1
00bf  =              231    231 KEYSIN	EQU	KEYCOS+1
00c0  =              232    232 KEYTAN	EQU	KEYSIN+1
00c1  =              233    233 KEYATA	EQU	KEYTAN+1
00c2  =              234    234 KEYUSR	EQU	KEYATA+1
00c3  =              235    235 KEYFRE	EQU	KEYUSR+1
00c4  =              236    236 KEYPORT	EQU	KEYFRE+1
00c5  =              237    237 KEYPOS	EQU	KEYPORT+1
00c6  =              238    238 KEYMEM	EQU	KEYPOS+1
00c7  =              239    239 KEYLEN	EQU	KEYMEM+1
00c8  =              240    240 KEYSTR	EQU	KEYLEN+1
00c9  =              241    241 KEYVAL	EQU	KEYSTR+1
00ca  =              242    242 KEYASC	EQU	KEYVAL+1
00cb  =              243    243 KEYCHR	EQU	KEYASC+1
00cc  =              244    244 KEYHEX	EQU	KEYCHR+1
00cd  =              245    245 KEYHXV	EQU	KEYHEX+1
00ce  =              246    246 KEYUPR	EQU	KEYHXV+1
00cf  =              247    247 KEYLFT	EQU	KEYUPR+1
00d0  =              248    248 KEYRIG	EQU	KEYLFT+1
00d1  =              249    249 KEYMID	EQU	KEYRIG+1
00d2  =              250    250 KEYINS	EQU	KEYMID+1
                     251    251 ;
00d3  =              252    252 KEYS	EQU	KEYINS+1	;LAST ENTRY
                     253    253
                     254    254 ;
                     255    255 ;  Page 6
                     256    256 ;
                     257    257
0064                 258    258 STMTABL:			;STATEMENT ROUTINES
0064  7f 0b          259    259 	DW	DATSTM
0066  84 0b          260    260 	DW	REMSTM
                     261    261 				;LISTED WITH BLANK AFTER
0068  27 0b          262    262 	DW	ENDSTM
006a  37 0a          263    263 	DW	FORSTM
006c  56 0f          264    264 	DW	NEXSTM
006e  32 0e          265    265 	DW	INPSTM
0070  3f 12          266    266 	DW	DIMSTM
0072  74 0e          267    267 	DW	REASTM
0074  c0 0b          268    268 	DW	LETSTM
0076  42 0b          269    269 	DW	GTOSTM
0078  1b 0b          270    270 	DW	RUNSTM
007a  ef 0c          271    271 	DW	IFSTM
007c  84 0b          272    272 	DW	ELSSTM
007e  61 05          273    273 	DW	RESSTM
0080  31 0b          274    274 	DW	GSBSTM
0082  65 0b          275    275 	DW	RETSTM
0084  e0 0a          276    276 	DW	STPSTM
0086  d1 0c          277    277 	DW	ONSTM
0088  7a 06          278    278 	DW	AUTSTM
008a  13 08          279    279 	DW	DELSTM
008c  e9 0d          280    280 	DW	PLTSTM
008e  49 18          281    281 	DW	WAISTM
0090  5c 0d          282    282 	DW	PRTSTM
0092  1a 14          283    283 	DW	DEFSTM
0094  07 0b          284    284 	DW	CONSTM
0096  30 08          285    285 	DW	LISSTM
0098  04 09          286    286 	DW	EDISTM
009a  7d 05          287    287 	DW	CLRSTM
009c  76 18          288    288 	DW	CLDSTM
009e  90 18          289    289 	DW	CSVSTM
00a0  0c 05          290    290 	DW	NEWSTM
00a2  df 07          291    291 	DW	SETSTM
                     292    292
                     293    293 ;
                     294    294 ;  Page 7
                     295    295 ;
                     296    296
00a4                 297    297 OPRTABL:			;OPERATORS AND PRECEDENCE
00a4  79             298    298 	DB	79H
00a5  6c 1d          299    299 	DW	ADDOPR
00a7  79             300    300 	DB	79H
00a8  c5 19          301    301 	DW	SUBOPR
00aa  7b             302    302 	DB	7BH
00ab  b5 1a          303    303 	DW	MULOPR
00ad  7b             304    304 	DB	7BH
00ae  41 1b          305    305 	DW	DIVOPR
00b0  7b             306    306 	DB	7BH
00b1  84 19          307    307 	DW	MODOPR
00b3  7f             308    308 	DB	7FH
00b4  c7 1e          309    309 	DW	EXPOPR
00b6  50             310    310 	DB	50H
00b7  44 19          311    311 	DW	ANDOPR
00b9  46             312    312 	DB	46H
00ba  40 19          313    313 	DW	ORNOPR
00bc  76             314    314 	DB	76H
00bd  9e 19          315    315 	DW	MAXOPR
00bf  76             316    316 	DB	76H
00c0  aa 19          317    317 	DW	MINOPR
                     318    318
                     319    319 ;
                     320    320 ;  Page 8
                     321    321 ;
                     322    322
00c2                 323    323 FCTTABL:				;FUNCTION ROUTINES
00c2  94 1c          324    324 	DW	SGNFCT
00c4  b6 1c          325    325 	DW	INTFCT
00c6  aa 1c          326    326 	DW	ABSFCT
00c8  be 1e          327    327 	DW	SQRFCT
00ca  95 1f          328    328 	DW	RNDFCT
00cc  7d 1e          329    329 	DW	LOGFCT
00ce  05 1f          330    330 	DW	EXPFCT
00d0  c9 1f          331    331 	DW	COSFCT
00d2  cf 1f          332    332 	DW	SINFCT
00d4  30 20          333    333 	DW	TANFCT
00d6  45 20          334    334 	DW	ATNFCT
00d8  39 0c          335    335 	DW	ERRAFC
00da  c4 17          336    336 	DW	FREFCT
00dc  21 18          337    337 	DW	PORFCT
00de  e1 0d          338    338 	DW	POSFCT
00e0  f1 17          339    339 	DW	MEMFCT
00e2  23 16          340    340 	DW	LENFCT
00e4  6f 16          341    341 	DW	STRFCT
00e6  53 16          342    342 	DW	VALFCT
00e8  36 16          343    343 	DW	ASCFCT
00ea  43 16          344    344 	DW	CHRFCT
00ec  c5 16          345    345 	DW	HEXFCT
00ee  91 16          346    346 	DW	HXVFCT
00f0  eb 16          347    347 	DW	UPRFCT
00f2  0f 17          348    348 	DW	LFTFCT
00f4  4a 17          349    349 	DW	RIGFCT
00f6  54 17          350    350 	DW	MIDFCT
00f8  7d 17          351    351 	DW	INSFCT
                     352    352
                     353    353 ;
                     354    354 ;  Page 9
                     355    355 ;
                     356    356
00fa                 357    357 KEYWADDS:			;POINTERS TO KEYWORD GROUPS
00fa  1a 01 35 01    358    358 	DW	KEYWRD0, KEYWRD1, KEYWRD2, KEYWRD3
00fe  4a 01 71 01    358    359
0102  ad 01 d1 01    359    360 	DW	KEYWRD4, KEYWRD5, KEYWRD6, KEYWRD7
0106  ee 01 fd 01    359    361
010a  0d 02 17 02    360    362 	DW	KEYWRD8, KEYWRD9, KEYWRDA, KEYWRDB
010e  2a 02 2c 02    360    363
0112  2e 02 51 02    361    364 	DW	KEYWRDC, KEYWRDD, KEYWRDE, KEYWRDF
0116  6a 02 7b 02    361    365
011a                 362    366 KEYWORDS:
011a                 363    367 KEYWRD0:
011a  94 50 4c 4f    364    368 	DB	KEYPLT, 'PLO', 'T'+128
011e  d4             364    369
011f  96 50 52 49    365    370 	DB	KEYPRT, 'PRIN', 'T'+128
0123  4e d4          365    371
0125  a3 50 52 4f    366    372 	DB	KEYPRM, 'PROMP', 'T'+128
0129  4d 50 d4       366    373
012c  c4 50 4f 52    367    374 	DB	KEYPORT, 'POR', 'T'+128
0130  d4             367    375
0131  45 50 4f d3    368    376 	DB	KEYPOS-80H, 'PO', 'S'+128
0135                 369    377 KEYWRD1:
0135  92 41 55 54    370    378 	DB	KEYAUT, 'AUT', 'O'+128
0139  cf             370    379
013a  b0 41 4e c4    371    380 	DB	KEYAND, 'AN', 'D'+128
013e  b9 41 42 d3    372    381 	DB	KEYABS, 'AB', 'S'+128
0142  c1 41 54 ce    373    382 	DB	KEYATA, 'AT', 'N'+128
0146  4a 41 53 c3    374    383 	DB	KEYASC-80H, 'AS', 'C'+128
014a                 375    384 KEYWRD2:
014a  81 52 45 cd    376    385 	DB	KEYREM, 'RE', 'M'+128
014e  87 52 45 41    377    386 	DB	KEYREA, 'REA', 'D'+128
0152  c4             377    387
0153  8a 52 55 ce    378    388 	DB	KEYRUN, 'RU', 'N'+128
0157  8d 52 45 53    379    389 	DB	KEYRES, 'RESTOR', 'E'+128
015b  54 4f 52 c5    379    390
015f  8f 52 45 54    380    391 	DB	KEYRET, 'RETUR', 'N'+128
0163  55 52 ce       380    392
0166  bb 52 4e c4    381    393 	DB	KEYRND, 'RN', 'D'+128
016a  50 52 49 47    382    394 	DB	KEYRIG-80H, 'RIGHT', '$'+128
016e  48 54 a4       382    395
0171                 383    396 KEYWRD3:
                     384    397
                     385    398 ;
                     386    399 ;  Page 10
                     387    400 ;
                     388    401
0171  90 53 54 4f    389    402 	DB	KEYSTOP, 'STO', 'P'+128
0175  d0             389    403
0176  98 43 4f 4e    390    404 	DB	KEYCON, 'CON', 'T'+128
017a  d4             390    405
017b  9b 43 4c 45    391    406 	DB	KEYCLR, 'CLEA', 'R'+128
017f  41 d2          391    407
0181  9d 53 41 56    392    408 	DB	KEYCSV, 'SAV', 'E'+128
0185  c5             392    409
0186  9f 53 45 d4    393    410 	DB	KEYSET, 'SE', 'T'+128
018a  a2 53 54 45    394    411 	DB	KEYSTEP, 'STE', 'P'+128
018e  d0             394    412
018f  a6 53 50 c3    395    413 	DB	KEYSPC, 'SP', 'C'+128
0193  b7 53 47 ce    396    414 	DB	KEYSGN, 'SG', 'N'+128
0197  ba 53 51 d2    397    415 	DB	KEYSQR, 'SQ', 'R'+128
019b  be 43 4f d3    398    416 	DB	KEYCOS, 'CO', 'S'+128
019f  bf 53 49 ce    399    417 	DB	KEYSIN, 'SI', 'N'+128
01a3  c8 53 54 52    400    418 	DB	KEYSTR, 'STR', '$'+128
01a7  a4             400    419
01a8  4b 43 48 52    401    420 	DB	KEYCHR-80H, 'CHR', '$'+128
01ac  a4             401    421
01ad                 402    422 KEYWRD4:
01ad  80 44 41 54    403    423 	DB	KEYDAT, 'DAT', 'A'+128
01b1  c1             403    424
01b2  86 44 49 cd    404    425 	DB	KEYDIM, 'DI', 'M'+128
01b6  93 44 45 4c    405    426 	DB	KEYDEL, 'DELET', 'E'+128
01ba  45 54 c5       405    427
01bd  97 44 45 c6    406    428 	DB	KEYDEF, 'DE', 'F'+128
01c1  a0 54 48 45    407    429 	DB	KEYTHEN, 'THE', 'N'+128
01c5  ce             407    430
01c6  a1 54 cf       408    431 	DB	KEYTO, 'T', 'O'+128
01c9  a5 54 41 c2    409    432 	DB	KEYTAB, 'TA', 'B'+128
01cd  40 54 41 ce    410    433 	DB	KEYTAN-80H, 'TA', 'N'+128
01d1                 411    434 KEYWRD5:
01d1  82 45 4e c4    412    435 	DB	KEYEND, 'EN', 'D'+128
01d5  8c 45 4c 53    413    436 	DB	KEYELS, 'ELS', 'E'+128
01d9  c5             413    437
01da  9a 45 44 49    414    438 	DB	KEYEDI, 'EDI', 'T'+128
01de  d4             414    439
01df  bd 45 58 d0    415    440 	DB	KEYEXP, 'EX', 'P'+128
01e3  c2 55 53 d2    416    441 	DB	KEYUSR, 'US', 'R'+128
01e7  4e 55 50 50    417    442 	DB	KEYUPR-80H, 'UPPER', '$'+128
01eb  45 52 a4       417    443
                     418    444
                     419    445 ;
                     420    446 ;  Page 11
                     421    447 ;
                     422    448
01ee                 423    449 KEYWRD6:
01ee  83 46 4f d2    424    450 	DB	KEYFOR, 'FO', 'R'+128
01f2  a7 46 ce       425    451 	DB	KEYFN, 'F', 'N'+128
01f5  c3 46 52 c5    426    452 	DB	KEYFRE, 'FR', 'E'+128
01f9  49 56 41 cc    427    453 	DB	KEYVAL-80H, 'VA', 'L'+128
01fd                 428    454 KEYWRD7:
01fd  89 47 4f 54    429    455 	DB	KEYGTO, 'GOT', 'O'+128
0201  cf             429    456
0202  8e 47 4f 53    430    457 	DB	KEYGSB, 'GOSU', 'B'+128
0206  55 c2          430    458
0208  15 57 41 49    431    459 	DB	KEYWAI-80H, 'WAI', 'T'+128
020c  d4             431    460
020d                 432    461 KEYWRD8:
020d  cc 48 45 58    433    462 	DB	KEYHEX, 'HEX', '$'+128
0211  a4             433    463
0212  4d 48 45 58    434    464 	DB	KEYHXV-80H, 'HEX', 'V'+128
0216  d6             434    465
0217                 435    466 KEYWRD9:
0217  85 49 4e 50    436    467 	DB	KEYINPT, 'INPU', 'T'+128
021b  55 d4          436    468
021d  8b 49 c6       437    469 	DB	KEYIF, 'I', 'F'+128
0220  b8 49 4e d4    438    470 	DB	KEYINT, 'IN', 'T'+128
0224  52 49 4e 53    439    471 	DB	KEYINS-80H, 'INST', 'R'+128
0228  54 d2          439    472
022a                 440    473 KEYWRDA:
022a  2c aa          441    474 	DB	KEYMUL-80H, '*'+128
022c                 442    475 KEYWRDB:
022c  2a ab          443    476 	DB	KEYADD-80H, '+'+128
022e                 444    477 KEYWRDC:
022e  88 4c 45 d4    445    478 	DB	KEYLET, 'LE', 'T'+128
0232  99 4c 49 53    446    479 	DB	KEYLIS, 'LIS', 'T'+128
0236  d4             446    480
0237  9c 4c 4f 41    447    481 	DB	KEYCLD, 'LOA', 'D'+128
023b  c4             447    482
023c  a4 4c 49 4e    448    483 	DB	KEYLINE, 'LIN', 'E'+128
0240  c5             448    484
0241  b6 bc          449    485 	DB	KEYLT, '<'+128
0243  bc 4c 4f c7    450    486 	DB	KEYLOG, 'LO', 'G'+128
0247  c7 4c 45 ce    451    487 	DB	KEYLEN, 'LE', 'N'+128
024b  4f 4c 45 46    452    488 	DB	KEYLFT-80H, 'LEFT', '$'+128
024f  54 a4          452    489
0251                 453    490 KEYWRDD:
0251  ab ad          454    491 	DB	KEYSUB, '-'+128
0253  ae 4d 4f c4    455    492 	DB	KEYMOD, 'MO', 'D'+128
0257  b2 4d 41 d8    456    493 	DB	KEYMAX, 'MA', 'X'+128
025b  b3 4d 49 ce    457    494 	DB	KEYMIN, 'MI', 'N'+128
                     458    495
                     459    496 ;
                     460    497 ;  Page 12
                     461    498 ;
                     462    499
025f  b5 bd          463    500 	DB	KEYEQ, '='+128
0261  c6 4d 45 cd    464    501 	DB	KEYMEM, 'ME', 'M'+128
0265  51 4d 49 44    465    502 	DB	KEYMID-80H, 'MID', '$'+128
0269  a4             465    503
026a                 466    504 KEYWRDE:
026a  84 4e 45 58    467    505 	DB	KEYNEX, 'NEX','T'+128
026e  d4             467    506
026f  9e 4e 45 d7    468    507 	DB	KEYNEW, 'NE','W'+128
0273  a8 4e 4f d4    469    508 	DB	KEYNOT, 'NO','T'+128
0277  af de          470    509 	DB	KEYEXPT, '^'+128
0279  34 be          471    510 	DB	KEYGT-80H, '>'+128
027b                 472    511 KEYWRDF:
027b  96 bf          473    512 	DB	KEYPRT, '?'+128
027d  91 4f ce       474    513 	DB	KEYON, 'O', 'N'+128
0280  a9 4f 46 c6    475    514 	DB	KEYOFF, 'OF', 'F'+128
0284  ad af          476    515 	DB	KEYDIV, '/'+128
0286  31 4f d2       477    516 	DB	KEYOR-80H, 'O', 'R'+128
                     478    517
                     479    518 ;
                     480    519 ;  Page 13
                     481    520
0289                 482    521 ERRN:					;ERROR CODES
0289                 483    522 ERRNCN:
0289  43 4f 4e 54    484    523 	DB	'CONTINUE',0		;CONTINUE ERROR
028d  49 4e 55 45    484    524
0291  00             484    525
0292                 485    526 ERRNSL:
0292  44 45 56 49    486    527 	DB	'DEVICE',0		;SAVE/LOAD DEVICE ERROR
0296  43 45 00       486    528
0299                 487    529 ERRNDD:
0299  44 49 4d 45    488    530 	DB	'DIMENSION',0		;DOUBLE DIMENSION
029d  4e 53 49 4f    488    531
02a1  4e 00          488    532
02a3                 489    533 ERRNID:
02a3  44 49 52 45    490    534 	DB	'DIRECT',0		;ILLEGAL DIRECT
02a7  43 54 00       490    535
02aa                 491    536 ERRND0:
02aa  44 49 56 49    492    537 	DB	'DIVIDE BY 0',0		;DIVISION BY ZERO
02ae  44 45 20 42    492    538
02b2  59 20 30 00    492    539
02b6                 493    540 ERRNFC:
02b6  46 55 4e 43    494    541 	DB	'FUNCTION CALL',0	;FUNCTION CALL
02ba  54 49 4f 4e    494    542
02be  20 43 41 4c    494    543
02c2  4c 00          494    544
02c4                 495    545 ERRNLS:
02c4  4c 4f 4e 47    496    546 	DB	'LONG STRING',0		;LONG STRING
02c8  20 53 54 52    496    547
02cc  49 4e 47 00    496    548
02d0                 497    549 ERRNOM:
02d0  4d 45 4d 4f    498    550 	DB	'MEMORY SPACE',0	;OUT OF MEMORY
02d4  52 59 20 53    498    551
02d8  50 41 43 45    498    552
02dc  00             498    553
02dd                 499    554 ERRNNF:
02dd  4e 45 58 54    500    555 	DB	'NEXT W/O FOR',0	;NEXT WITHOUT FOR
02e1  20 57 2f 4f    500    556
02e5  20 46 4f 52    500    557
02e9  00             500    558
02ea                 501    559 ERRNOD:
02ea  4f 55 54 20    502    560 	DB	'OUT OF DATA',0		;OUT OF DATA
02ee  4f 46 20 44    502    561
02f2  41 54 41 00    502    562
02f6                 503    563 ERRNOV:
02f6  4f 56 45 52    504    564 	DB	'OVERFLOW',0		;OVERFLOW
02fa  46 4c 4f 57    504    565
02fe  00             504    566
02ff                 505    567 ERRNRG:
                     506    568
                     507    569 ;
                     508    570 ;  Page 14
                     509    571 ;
                     510    572
02ff  52 45 54 4e    511    573 	DB	'RETN W/O GOSUB',0	;RETURN WITHOUT GOSUB
0303  20 57 2f 4f    511    574
0307  20 47 4f 53    511    575
030b  55 42 00       511    576
030e                 512    577 ERRNOS:
030e  53 54 52 49    513    578 	DB	'STRING SPACE',0	;OUT OF STRING SPACE
0312  4e 47 20 53    513    579
0316  50 41 43 45    513    580
031a  00             513    581
031b                 514    582 ERRNST:
031b  53 54 52 49    515    583 	DB	'STRING TEMPS',0	;STRING TEMPORARIES
031f  4e 47 20 54    515    584
0323  45 4d 50 53    515    585
0327  00             515    586
0328                 516    587 ERRNBS:
0328  53 55 42 53    517    588 	DB	'SUBSCRIPT',0		;BAD SUBSCRIPT
032c  43 52 49 50    517    589
0330  54 00          517    590
0332                 518    591 ERRNSN:
0332  53 59 4e 54    519    592 	DB	'SYNTAX',0		;SYNTAX ERROR
0336  41 58 00       519    593
0339                 520    594 ERRNTM:
0339  54 59 50 45    521    595 	DB	'TYPE',0		;TYPE MISMATCH
033d  00             521    596
033e                 522    597 ERRNUF:
033e  55 4e 44 46    523    598 	DB	'UNDFND FUNCTION',0	;UNDEFINED FUNCTION
0342  4e 44 20 46    523    599
0346  55 4e 43 54    523    600
034a  49 4f 4e 00    523    601
034e                 524    602 ERRNUS:
034e  55 4e 44 46    525    603 	DB	'UNDFND LINE',0		;UNDEFINED STATEMENT
0352  4e 44 20 4c    525    604
0356  49 4e 45 00    525    605
035a                 526    606 ERRNUV:
035a  55 4e 44 46    527    607 	DB	'UNDFND VARIABLE',0	;UNDEFINED VARIABLE
035e  4e 44 20 56    527    608
0362  41 52 49 41    527    609
0366  42 4c 45 00    527    610
036a                 528    611 ERRNFI:
036a  46 69 6c 65    529    612 	DB	'File not Saved',0	;unknown file name
036e  20 6e 6f 74    529    613
0372  20 53 61 76    529    614
0376  65 64 00       529    615
                     530    616
                     531    617 ;
                     532    618 ;  Page 15
                     533    619 ;
                     534    620
                     535    621 ;
                     536    622 ;  INTERPRETER VARIABLES
                     537    623 ;
                     538    624 ;            VARIABLES MARKED WITH SAME CHARACTER IN COLUMN 71
                     539    625 ;               ARE FIXED IN THAT ORDER.
                     540    626 ;
                     541    627
                     542    628
0379  01             543    629 p3010:	    db	1		;0 to print on 3010	
037a  00             544    630 REAINPFL:   DB	0		;READ/INPUT FLAG	
037b  00             545    631 PRINTFLG:   DB	0		;PRINT/NO PRINT FLAG	
037c  01             546    632 TRACEFLG:   DB	1		;TRACE/NO TRACE FLAG
037d  00             547    633 SCANPFLG:   DB	0		;SCAN/NOSCAN PARENTHESIS FLAG
037e  01             548    634 SCANPFLE:   DB	1		;ARRAY NAME FOR ERASE
00ab  =              549    635 SCANPFLD    EQU	KEYS-'('	;NO ARRAY ELEMENTS WANTED
037f  00             550    636 MATSCCNT:   DB	0		;SUBSCRIPT COUNT
0380  00             551    637 MATDMFLG:   DB	0		;SCANNING FOR VAR/DIMENSION V
0381  00             552    638 TYPEFLG:    DB	0		;TYPE FLAG                  V
0002  =              553    639 TYPEINTG    EQU	2		;TYPE OF INTEGER
0003  =              554    640 TYPESTRG    EQU	3		;TYPE OF STRING
0004  =              555    641 TYPESING    EQU	4		;TYPE OF SINGLE FLOATING POINT
0008  =              556    642 TYPEDUBL    EQU	8		;TYPE OF DOUBLE FLOATING POINT
0020  =              557    643 TYPEDEF     EQU	080H/4		;MARKING BIT FOR USER-FUNCTION
                     558    644
                     559    645
0382  00             560    646 STRGTMPL:   DB	0		;TEMP STRING DESCRIPTR, LEN  S
0383  00 00          561    647 STRGTMPA:   DW	0		;TEMP STRING DESCRIPTR, ADDR S
0385  00 00          562    648 SCANPTR1:   DW	0		;SCAN POINTER
0387  00 00          563    649 SCANPTR2:   DW	0		;SCAN POINTER
0389  ff ff          564    650 CURLINE:    DW	-1		;CURRENT LINE NUMBER
038b  00 00          565    651 CURLINES:   DW	0		;SAVED CURRENT LINE NUMBER
038d  a6 20          566    652 PROGCNTR:   DW	ENDINTRP+12	;CURRENT PROGRAM LOCATION
038d  =              567    653 VARINDEX    EQU	PROGCNTR	;INDEX VARIABLE OF FOR
038f  00 00          568    654 PROGCNTS:   DW	0		;SAVED CURRENT PROGRAMLOCATION
0391  00 00          569    655 CURLDATA:   DW	0		;CURRENT DATA LINE NUMBER
0393  9a 20          570    656 CURDATAP:   DW	ENDINTRP	;CURRENT DATA POINTER
0395  2d 21          571    657 INPTBUFR:   DW	INITSTSP	;INPUT BUFFER ADDRESS
0064  =              572    658 PREDREL	    EQU	064H		;PRECEDENCE OF RELATION
0070  =              573    659 PREDNUM	    EQU	070H		;LOWER BNDRY OF NUM OP PREC.
005a  =              574    660 PREDNOT	    EQU	05AH		;PRECEDENCE OF NOT OPERATOR
007d  =              575    661 PREDUMIN    EQU	07DH		;PRECEDENCE OF UNARY MINUS
009d  =              576    662 LINESYZE    EQU	79+78		;DEFAULT LINESYZE
000e  =              577    663 ITEMSIZE    EQU	14		;DEFAULT WIDTH OF PRINT ITEM
                     578    664
                     579    665 ;
                     580    666 ;  Page 16
                     581    667 ;
                     582    668
                     583    669 ;
                     584    670 ;  MEMORY ALLOCATIN POINTERS
                     585    671 ;
                     586    672
                     587    673
                     588    674 ;
8000  =              589    675 LIMLOWER   EQU	08000H
af00  =              590    676 LIMUPPER   EQU	0AF00H
                     591    677 ;
                     592    678 ;  MEMORY LAYOUT
                     593    679 ;
                     594    680 ;  ENCODE BUFFER
                     595    681 ;  PROGRAM
                     596    682 ;  VARIABLES
                     597    683 ;  ARRAYS
                     598    684 ;  FREE SPACE  /  STACK (INCLUDING BUFFERS)
                     599    685 ;  FREE STRING SPACE
                     600    686 ;  STRINGS
                     601    687 ;  STRING TEMPORARIES
                     602    688 ;  FREE STRING TEMPORARIES
                     603    689 ;
0397  a7 20          604    690 PROGBASE:    DW	ENDINTRP+13	;BASE OF PROGRAM SPACE
0399  a9 20          605    691 VARTABLE:    DW	ENDINTRP+15	;BASE OF VARIABLE TABLE
039b  a9 20          606    692 MATTABLE:    DW	ENDINTRP+15	;BASE OF ARRAY TABLE
039d  a9 20          607    693 FREELIMT:    DW ENDINTRP+15	;LOWER LIMIT OF FREE SPACE
039f  06 22          608    694 STCKBASE:    DW	INITSTCK	;BASE OF STACK
03a1  10 22          609    695 STRGFREE:    DW	INITSTCK+10	;FIRST FREE STRING SPACE	
03a3  10 22          610    696 STRGBASE:    DW	INITSTCK+10	;BASE OF STRING SPACE
03a5  11 22          611    697 STRGTMPP:    DW	INITSTCK+11	;STRING TEMPORARY ALLOC PTR
03a7  16 22          612    698 STRGTLIM:    DW	INITSTCK+10+2*3	;STRING TEMPORARY LIMIT
                     613    699
                     614    700
03a9  00 00          615    701 ACCUMLTR:    DB	0,0		;ACCUMULATOR			A
03ab  00             616    702 FLACCMSB:    DB	0		;SIGN-BIT/HIGH-ORDER MANTISSA	A
03ac  00             617    703 FLACCEXP:    DB	0		;EXPONENT			A
03ad  00             618    704 FLACCSSV:    DB	0		;SAVED SIGN			A
                     619    705
03ae  01             620    706 NULLCNT:     DB 1		;# OF NULLS TO INSERT AFTER (CR)
03af  01             621    707 CURSPOS:     DB	1		;CHARACTER CURSOR POSITION	C
03b0  63             622    708 CURSLIM:     DB 256-LINESYZE	;OUTPUT CURSOR LIMIT		C
                     623    709
03b1  00             624    710 FLSCR0:      DB	0		;FLOATING POINT SCRATCH AREA
03b2  01             625    711 FLSCR1:      DB 1
03b3  02             626    712 FLSCR2:      DB	2
03b4  03             627    713 FLSCR3:      DB	3
                     628    714
03b1  =              629    715 INOTINS      EQU FLSCR0		;INPUT/OUTPUT INSTRUCTIONS
00db  =              630    716 OPCINP       EQU 0DBH		;INPUT INSTRUCTION
00d3  =              631    717 OPCOUT       EQU 0D3H		;OUTPUT INSTRUCTION
00c9  =              632    718 OPCRET       EQU 0C9H		;RETURN INSTRUCTION
                     633    719
03b5  52 c7 4f 80    634    720 RNDFCTSD:    DB  052h, 0c7h, 04fh, 080h   ;RANDOM SEED
                     635    721
                     636    722 ;
                     637    723 ; Page 17
                     638    724 ;
                     639    725
                     640    726 ;
                     641    727 ;
                     642    728 ;  GENERAL USE SUBROUTINES
                     643    729 ;
                     644    730 ;
                     645    731 ;  SCAN ONE CHARACTER AND CLASSIFY
                     646    732 ;
03b9                 647    733 SCANNXTV:
03b9  7e             648    734 	MOV	A,M		;SCAN CURRENT BYTE,
03ba  e3             649    735 	XTHL
03bb  be             650    736 	CMP	M		;VERIFY MATCH,
03bc  23             651    737 	INX	H
03bd  e3             652    738 	XTHL
03be  c2 05 06       653    739 	JNZ	ERRASN		;SQUAWK ABOUT SYNTAX ERROR
03c1                 654    740 SCANNXT:
03c1  23             655    741 	INX	H		;SCAN FOR NEXT NON-BLANK CHAR
03c2  7e             656    742 	MOV	A,M		;C=NUMERIC CHARACTER
03c3  fe 3a          657    743 	CPI	':'		;Z=END OF STATEMENT
03c5  d0             658    744 	RNC
03c6  fe 20          659    745 	CPI	' '
03c8  ca c1 03       660    746 	JZ	SCANNXT
03cb  fe 30          661    747 	CPI	'0'
03cd  3f             662    748 	CMC
03ce  3c             663    749 	INR	A
03cf  3d             664    750 	DCR	A
03d0  c9             665    751 	RET
                     666    752
                     667    753 ;
                     668    754 ;  Page 18
                     669    755 ;
                     670    756
                     671    757 ;
                     672    758 ;  TEST FOR ALPHABETIC CHARACTER
                     673    759 ;
03d1                 674    760 ALPHACHK:
03d1  7e             675    761 	MOV	A,M		;TEST FOR ALPHABETIC CHARACTER
03d2                 676    762 ALPHACHA:
03d2  fe 7b          677    763 	CPI	'z'+1		;LOWER CASE
03d4  d0             678    764 	RNC
03d5  fe 61          679    765 	CPI	'a'		;LOWER CASE
03d7  d2 e1 03       680    766 	JNC	ALPHACHL
03da  fe 5b          681    767 	CPI	'Z'+1		;C=ALPHABETIC
03dc  d0             682    768 	RNC
03dd  fe 41          683    769 	CPI	'A'		;UPPER CASE
03df  3f             684    770 	CMC
03e0  c9             685    771 	RET
03e1                 686    772 ALPHACHL:
03e1  c6 e0          687    773 	ADI	'A'-'a'		;CONVERT LOWER TO UPPER
03e3  c9             688    774 	RET
                     689    775
                     690    776 ;
                     691    777 ;  MATCH CHARACTER OF BUFFER AGAINST CHARACTER IN A
                     692    778 ;
03e4                 693    779 CHARMTCH:
03e4  ae             694    780 	XRA	M		;MAKE MATCH TEST
03e5  c8             695    781 	RZ			;Z-SUCCESS]
03e6  fe 20          696    782 	CPI	'a'-'A'		;LOWER CASE - UPPER CASE
03e8  c0             697    783 	RNZ			;NOT LOWER-UPPER DIFFERENCE
03e9  cd d1 03       698    784 	CALL	ALPHACHK	;ALPHABETIC?
03ec  9f             699    785 	SBB	A
03ed  3c             700    786 	INR	A		;Z=C,S=0
03ee  c9             701    787 	RET
                     702    788
                     703    789 ;
                     704    790 ;  CHECK TYPE OF EXPRESSION	       LEN     CHAR
                     705    791 ;            RETURNS:  S => INTEGER	2	%
                     706    792 ;		       Z => STRING	3	$
                     707    793 ;		      PO => SINGLE	4	@
                     708    794 ;		      NC => DOUBLE	8	#
03ef                 709    795 TYPECHK:
03ef  3a 81 03       710    796 	LDA	TYPEFLG
03f2                 711    797 TYPECHKA:
03f2  fe 05          712    798 	CPI	TYPESING+1
03f4  3d             713    799 	DCR	A
03f5  3d             714    800 	DCR	A
03f6  3d             715    801 	DCR	A
03f7  b7             716    802 	ORA	A
03f8  37             717    803 	STC
03f9  c9             718    804 	RET
                     719    805
                     720    806 ;
                     721    807 ;  Page 19
                     722    808 ;
                     723    809
                     724    810 ;
                     725    811 ;  SCAN A PAIR OF LINE NUMBER PARAMETERS
                     726    812 ;
03fa                 727    813 SCANLPRZ:
03fa  01 00 00       728    814 	LXI	B,0		;DEFAULT SECOND IS FIRST
03fd                 729    815 SCANLPRM:
03fd  c4 21 04       730    816 	CNZ	SCANLINN	;DEFAULT FIRST IS IN DE
0400  f5             731    817 	PUSH	PSW
0401  78             732    818 	MOV	A,B
0402  b1             733    819 	ORA	C		;ZERO DEFAULT IS FIRST PARAMETER
0403  c2 08 04       734    820 	JNZ	SCANLPR1
0406  42             735    821 	MOV	B,D
0407  4b             736    822 	MOV	C,E
0408                 737    823 SCANLPR1:
0408  f1             738    824 	POP	PSW
0409  eb             739    825 	XCHG
040a  e3             740    826 	XTHL			;PUT FIRST ONTO STACK
040b  e5             741    827 	PUSH	H
040c  eb             742    828 	XCHG
040d  50             743    829 	MOV	D,B
040e  59             744    830 	MOV	E,C
040f  c8             745    831 	RZ
0410  fe ad          746    832 	CPI	KEYDIV		;SEPARATOR MUST BE '/'.
0412  ca 1a 04       747    833 	JZ	SCANLPR2
0415  cd b9 03       748    834 	CALL	SCANNXTV	;bscan (val)
0418  2c             749    835 	DB	','		;   OR ','
0419  2b             750    836 	DCX	H
041a                 751    837 SCANLPR2:
041a  11 ff ff       752    838 	LXI	D,0FFFFH	;EMPTY SECOND OPERAND = END
041d  cd c1 03       753    839 	CALL	SCANNXT		;bscan ,
0420  c8             754    840 	RZ
                     755    841
                     756    842 ;
                     757    843 ;  SCAN A LINE NUMBER
                     758    844 ;
0421                 759    845 SCANLINN:
0421  2b             760    846 	DCX	H		;SCAN LINE # IN COMMAND/STATEMENT
0422                 761    847 SCANLINR:
0422  11 00 00       762    848 	LXI	D,0		;DEFAULT LINE IS 0, INITIALIZE
0425                 763    849 SCANLINL:
0425  cd c1 03       764    850 	CALL	SCANNXT		;bscan ,
0428  d0             765    851 	RNC
0429  e5             766    852 	PUSH	H
042a  f5             767    853 	PUSH	PSW
042b  21 98 19       768    854 	LXI	H,0FFFFH/10-1
042e  cd d7 04       769    855 	CALL	CMHLLTDE
0431  da 05 06       770    856 	JC	ERRASN
0434  62             771    857 	MOV	H,D
0435  6b             772    858 	MOV	L,E		;HL=10*DE
0436  19             773    859 	DAD	D
0437  29             774    860 	DAD	H
0438  19             775    861 	DAD	D
0439  29             776    862 	DAD	H
043a  f1             777    863 	POP	PSW
043b  d6 30          778    864 	SUI	'0'		;GET VALUE OF NEXT DIGIT
                     779    865
                     780    866 ;
                     781    867 ;  Page 20
                     782    868 ;
                     783    869
043d  5f             784    870 	MOV	E,A
043e  16 00          785    871 	MVI	D,000H
0440  19             786    872 	DAD	D		;AND ADD IT ON
0441  eb             787    873 	XCHG
0442  e1             788    874 	POP	H
0443  c3 25 04       789    875 	JMP	SCANLINL
                     790    876
                     791    877 ;
                     792    878 ;  Page 21
                     793    879 ;
                     794    880
                     795    881 ;
                     796    882 ;  SEARCH FOR A GIVEN LINE NUMBER
                     797    883 ;
0446                 798    884 LINESRCH:
0446  2a 97 03       799    885 	LHLD	PROGBASE	;LOOK FOR LINE NUMBER IN DE
0449                 800    886 LINESRCL:
0449  e5             801    887 	PUSH	H		;C=LINE FOUND
044a  cd 63 04       802    888 	CALL	LINELINK	;BC=LINE LOCATION, IF FOUND
044d  ca 86 08       803    889 	JZ	POPHLRET	;=NEXT LINE, IF NOT FOUND
0450  c5             804    890 	PUSH	B		;ADDRESS OF NEXT LINE
0451  7e             805    891 	MOV	A,M		;GET NUMBER OF CURRENT LINE
0452  23             806    892 	INX	H
0453  66             807    893 	MOV	H,M		;(from HL,MA)
0454  6f             808    894 	MOV	L,A
0455  cd d7 04       809    895 	CALL	CMHLLTDE
0458  e1             810    896 	POP	H		;HL=NEXT LINE
0459  c1             811    897 	POP	B
045a  3f             812    898 	CMC
045b  c8             813    899 	RZ
045c  d2 49 04       814    900 	JNC	LINESRCL
045f  60             815    901 	MOV	H,B
0460  69             816    902 	MOV	L,C
0461  3f             817    903 	CMC
0462  c9             818    904 	RET
                     819    905
                     820    906 ;
                     821    907 ;  LINK TO NEXT LINE
                     822    908 ;
0463                 823    909 LINELINK:
0463  e5             824    910 	PUSH	H		;FIND ADDRESS OF NEXT LINE
0464  4e             825    911 	MOV	C,M		;Z=END OF PROGRAM
0465  23             826    912 	INX	H
0466  46             827    913 	MOV	B,M
0467  23             828    914 	INX	H
0468  e3             829    915 	XTHL
0469  09             830    916 	DAD	B		;ADD LENGTH TO ADDRESS
046a  e3             831    917 	XTHL
046b  78             832    918 	MOV	A,B
046c  b1             833    919 	ORA	C
046d  c1             834    920 	POP	B
046e  c9             835    921 	RET
                     836    922
                     837    923 ;
                     838    924 ;  Page 22
                     839    925 ;
                     840    926
                     841    927 ;
                     842    928 ;  INSERT/REPLACE LINE OF PROGRAM
                     843    929 ;
046f                 844    930 LINEINS:
046f  d5             845    931 	PUSH	D		;DE=LINE NUMBER
0470  d4 a7 06       846    932 	CNC	KEYSCAN		;C=ALREADY KEY-SCANNED
0473  cd c1 03       847    933 	CALL	SCANNXT		;bscan , NC=MUST BE KEY-SCANNED
0476  d1             848    934 	POP	D
0477  e5             849    935 	PUSH	H		;HL=TEXT TO INSERT
0478  d5             850    936 	PUSH	D
0479  c5             851    937 	PUSH	B		;BC=LENGTH OF TEXT
047a  f5             852    938 	PUSH	PSW		;Z=DELETE, NO REPLACE
047b  cd 46 04       853    939 	CALL	LINESRCH	;LOOK FOR LINE
047e  c5             854    940 	PUSH	B		;SAVE LOCATION
047f  dc a9 04       855    941 	CC	LINEDEL		;DELETE IF PRESENT
0482  d1             856    942 	POP	D
0483  f1             857    943 	POP	PSW
0484  ca 84 08       858    944 	JZ	POPHL3RT	;EXIT IF NOTHING MORE
0487  2a 9d 03       859    945 	LHLD	FREELIMT	;PULL APART FOR NEW LINE
048a  e3             860    946 	XTHL
048b  c1             861    947 	POP	B
048c  e5             862    948 	PUSH	H
048d  09             863    949 	DAD	B
048e  cd dd 04       864    950 	CALL	COPYCHK
0491  eb             865    951 	XCHG
0492  c1             866    952 	POP	B
0493  71             867    953 	MOV	M,C		;BEGINNING OF NEW LINE
0494  23             868    954 	INX	H
0495  70             869    955 	MOV	M,B
0496  23             870    956 	INX	H
0497  d1             871    957 	POP	D
0498  73             872    958 	MOV	M,E		;INSERT LINE NUMBER
0499  23             873    959 	INX	H
049a  72             874    960 	MOV	M,D
049b  23             875    961 	INX	H
049c  eb             876    962 	XCHG
049d  e1             877    963 	POP	H		;RECOVER TEXT POINTER
049e                 878    964 LINEINSL:
049e  7e             879    965 	MOV	A,M		;INSERT TEXT OF NEW LINE
049f  12             880    966 	STAX	D
04a0  23             881    967 	INX	H
04a1  13             882    968 	INX	D
04a2  b7             883    969 	ORA	A
04a3  c2 9e 04       884    970 	JNZ	LINEINSL
04a6  c3 bf 04       885    971 	JMP	LINEDELU
                     886    972
                     887    973
                     888    974 ;
                     889    975 ;  Page 23
                     890    976 ;
                     891    977
                     892    978 ;
                     893    979 ;  DELETE TEXT FROM PROGRAM
                     894    980 ;
04a9                 895    981 LINEDEL:
04a9  eb             896    982 	XCHG			;BC=BEGINNING OF TEXT TO REMOVE
04aa  79             897    983 	MOV	A,C
04ab  93             898    984 	SUB	E		;COMPUTE NETATIVE OF
04ac  6f             899    985 	MOV	L,A		;NUMBER OF BYTES DELETED
04ad  78             900    986 	MOV	A,B
04ae  9a             901    987 	SBB	D
04af  67             902    988 	MOV	H,A
04b0  e5             903    989 	PUSH	H
04b1  2a 9d 03       904    990 	LHLD	FREELIMT	;HL=BEGINNING OF TEXT SURVIVING
04b4                 905    991 LINEDELL:
04b4  1a             906    992 	LDAX	D
04b5  02             907    993 	STAX	B
04b6  03             908    994 	INX	B
04b7  13             909    995 	INX	D
04b8  cd d7 04       910    996 	CALL	CMHLLTDE
04bb  d2 b4 04       911    997 	JNC	LINEDELL
04be  c1             912    998 	POP	B
04bf                 913    999 LINEDELU:
04bf  2a 9d 03       914   1000 	LHLD	FREELIMT	;UPDATE DATA POINTERS
04c2  09             915   1001 	DAD	B		;BC=INCREMENT
04c3  22 9d 03       916   1002 	SHLD	FREELIMT
04c6  2a 9b 03       917   1003 	LHLD	MATTABLE
04c9  09             918   1004 	DAD	B
04ca  22 9b 03       919   1005 	SHLD	MATTABLE
04cd  2a 99 03       920   1006 	LHLD	VARTABLE
04d0  09             921   1007 	DAD	B
04d1  22 99 03       922   1008 	SHLD	VARTABLE
04d4  c3 51 05       923   1009 	JMP	CLEARPCN
                     924   1010
                     925   1011 ;
                     926   1012 ;  MAKE SIXTEEN BIT COMPARISON
                     927   1013 ;
04d7                 928   1014 CMHLLTDE:
04d7  7c             929   1015 	MOV	A,H		;COMPARE DE VS HL
04d8  92             930   1016 	SUB	D		;C=HL<DE
04d9  c0             931   1017 	RNZ
04da  7d             932   1018 	MOV	A,L
04db  93             933   1019 	SUB	E
04dc  c9             934   1020 	RET
                     935   1021
                     936   1022 ;
                     937   1023 ;  Page 24
                     938   1024 ;
                     939   1025
                     940   1026 ;
                     941   1027 ;  MOVE LONG TO HIGHER ADDRESS
                     942   1028 ;
04dd                 943   1029 COPYCHK:
04dd  cd fb 04       944   1030 	CALL	SPACECHK
04e0                 945   1031 COPYTEXT:
04e0  c5             946   1032 	PUSH	B		;COPY SECTION DE-BC TO AREA
04e1  e3             947   1033 	XTHL			;ENDING AT HL
04e2  c1             948   1034 	POP	B
04e3                 949   1035 COPYTXTL:
04e3  cd d7 04       950   1036 	CALL	CMHLLTDE
04e6  7e             951   1037 	MOV	A,M
04e7  02             952   1038 	STAX	B
04e8  c8             953   1039 	RZ
04e9  0b             954   1040 	DCX	B
04ea  2b             955   1041 	DCX	H
04eb  c3 e3 04       956   1042 	JMP	COPYTXTL
                     957   1043
                     958   1044 ;
                     959   1045 ;  CHECK SPACE FOR STACK ALLOCATION
                     960   1046 ;
04ee                 961   1047 SPACESTK:
04ee  e5             962   1048 	PUSH	H		;VERIFY STACK HAS ROOM ENOUGH
04ef  2a 9d 03       963   1049 	LHLD	FREELIMT	;C=NUMBER OF WORKS NEEDED
04f2  06 00          964   1050 	MVI	B,000H
04f4  09             965   1051 	DAD	B
04f5  09             966   1052 	DAD	B
04f6  cd fb 04       967   1053 	CALL	SPACECHK
04f9  e1             968   1054 	POP	H
04fa  c9             969   1055 	RET
                     970   1056
                     971   1057 ;
                     972   1058 ;  CHECK SPACE FOR PROGRAM OR VARIABLE ALLOCATION
                     973   1059 ;
04fb                 974   1060 SPACECHK:
04fb  d5             975   1061 	PUSH	D		;CHECK THAT ENOUGH SPACE IS LEFT
04fc  eb             976   1062 	XCHG			;ON STACK ABOVE HL
04fd  21 da ff       977   1063 	LXI	H,-38
0500  39             978   1064 	DAD	SP
0501  cd d7 04       979   1065 	CALL	CMHLLTDE
0504  eb             980   1066 	XCHG
0505  d1             981   1067 	POP	D
0506  d0             982   1068 	RNC
0507                 983   1069 ERRAOM:
0507  1e 47          984   1070 	MVI	E,ERRNOM-ERRN
0509  c3 07 06       985   1071 	JMP	ERRMSG
                     986   1072
                     987   1073 ;
                     988   1074 ;  Page 25
                     989   1075 ;
                     990   1076
                     991   1077 ;
                     992   1078 ;  RE-INITIALIZATION ROUTINES
                     993   1079 ;
050c                 994   1080 NEWSTM:
050c  c0             995   1081 	RNZ			;NEW COMMAND
050d                 996   1082 CLEARPGM:
050d  2a 97 03       997   1083 	LHLD	PROGBASE	;CLEAR PROGRAM
0510  af             998   1084 	XRA	A
0511  77             999   1085 	MOV	M,A
0512  23            1000   1086 	INX	H
0513  77            1001   1087 	MOV	M,A
0514  23            1002   1088 	INX	H
0515                1003   1089 NEWLOAD:
0515  22 99 03      1004   1090 	SHLD	VARTABLE
0518                1005   1091 CLEARSET:
0518  cd 51 05      1006   1092 	CALL	CLEARPCN	;CLEAR PROGRAM POINTERS
051b                1007   1093 CLEARVST:
051b  22 8d 03      1008   1094 	SHLD	PROGCNTR	;UPDATE PROGRAM COUNTER
051e  cd 41 05      1009   1095 	CALL	CLEARVAR	;CLEAR VARIABLES
0521                1010   1096 CLEARSTK:
0521  c1            1011   1097 	POP	B		;RESET STACK,
0522  2a 9f 03      1012   1098 	LHLD	STCKBASE
0525  f9            1013   1099 	SPHL
0526  21 60 ff      1014   1100 	LXI	H,0-LINESYZE-3
0529  39            1015   1101 	DAD	SP
052a  f9            1016   1102 	SPHL			;CREATE INPUT BUFFER
052b  22 95 03      1017   1103 	SHLD	INPTBUFR
052e  2a a3 03      1018   1104 	LHLD	STRGBASE	;CLEAR STRING TEMPORARIES,
0531  23            1019   1105 	INX	H
0532  22 a5 03      1020   1106 	SHLD	STRGTMPP
0535  21 00 00      1021   1107 	LXI	H,0
0538  e5            1022   1108 	PUSH	H
0539  22 8f 03      1023   1109 	SHLD	PROGCNTS	;SET NO CONTINUE
053c  2a 8d 03      1024   1110 	LHLD	PROGCNTR
053f  c5            1025   1111 	PUSH	B
0540  c9            1026   1112 	RET
                    1027   1113
0541                1028   1114 CLEARVAR:
0541  2a 99 03      1029   1115 	LHLD	VARTABLE	;CLEAR ALL VARIABLES
0544  22 9b 03      1030   1116 	SHLD	MATTABLE
0547  22 9d 03      1031   1117 	SHLD	FREELIMT
054a  2a a3 03      1032   1118 	LHLD	STRGBASE
054d  22 a1 03      1033   1119 	SHLD	STRGFREE
0550  c9            1034   1120 	RET
                    1035   1121
0551                1036   1122 CLEARPCN:
0551  21 00 00      1037   1123 	LXI	H,0		;CLEAR PROGRAM POINTERS
0554  22 8f 03      1038   1124 	SHLD	PROGCNTS
0557  2a 97 03      1039   1125 	LHLD	PROGBASE
055a  2b            1040   1126 	DCX	H
055b  36 00         1041   1127 	MVI	M,0		;END OF LINE -1
055d  22 8d 03      1042   1128 	SHLD	PROGCNTR
0560  af            1043   1129 	XRA	A
                    1044   1130
                    1045   1131 ;
                    1046   1132 ;  Page 26
                    1047   1133 ;
                    1048   1134
                    1049   1135 ;
                    1050   1136 ;  RESTORE:  REWIND DATA STATEMENTS
                    1051   1137 ;
0561                1052   1138 RESSTM:
0561  ca 73 05      1053   1139 	JZ	RESSTMDF	;RESTORE STATEMENT
0564  cd 21 04      1054   1140 	CALL	SCANLINN
0567  e5            1055   1141 	PUSH	H
0568  cd 46 04      1056   1142 	CALL	LINESRCH
056b  d2 60 0b      1057   1143 	JNC	ERRAUS
056e  e1            1058   1144 	POP	H
056f  eb            1059   1145 	XCHG
0570  c3 77 05      1060   1146 	JMP	RESSTMBU
0573                1061   1147 RESSTMDF:
0573  eb            1062   1148 	XCHG			;DEFAULT IS RESTORE TO BEGINING
0574  2a 97 03      1063   1149 	LHLD	PROGBASE
0577                1064   1150 RESSTMBU:
0577  2b            1065   1151 	DCX	H		;BACK UP BEFORE LINE
0578                1066   1152 RESDTPTR:
0578  22 93 03      1067   1153 	SHLD	CURDATAP	;SET DATA POINTER
057b  eb            1068   1154 	XCHG
057c  c9            1069   1155 	RET
                    1070   1156
                    1071   1157 ;
                    1072   1158 ;  CLEAR:  CLEAR VARIABLES, REALLOCATE STRING SPACE
                    1073   1159 ;
057d                1074   1160 CLRSTM:
057d  ca 1b 05      1075   1161 	JZ	CLEARVST	;CLEAR STATEMENT
0580  cd 1d 0c      1076   1162 	CALL	VALINTDE
0583  2b            1077   1163 	DCX	H		;bscan -
0584  cd c1 03      1078   1164 	CALL	SCANNXT		;bscan ,
0587  c0            1079   1165 	RNZ
0588  e5            1080   1166 	PUSH	H
0589  2a a3 03      1081   1167 	LHLD	STRGBASE
058c  7d            1082   1168 	MOV	A,L
058d  93            1083   1169 	SUB	E
058e  5f            1084   1170 	MOV	E,A
058f  7c            1085   1171 	MOV	A,H
0590  9a            1086   1172 	SBB	D
0591  57            1087   1173 	MOV	D,A
0592  da 05 06      1088   1174 	JC	ERRASN
0595  2a 99 03      1089   1175 	LHLD	VARTABLE
0598  01 28 00      1090   1176 	LXI	B,40
059b  09            1091   1177 	DAD	B
059c  cd d7 04      1092   1178 	CALL	CMHLLTDE
059f  d2 07 05      1093   1179 	JNC	ERRAOM
05a2  eb            1094   1180 	XCHG
05a3  22 9f 03      1095   1181 	SHLD	STCKBASE
05a6  e1            1096   1182 	POP	H
05a7  c3 1b 05      1097   1183 	JMP	CLEARVST
                    1098   1184
                    1099   1185 ;
                    1100   1186 ;  Page 27
                    1101   1187 ;
                    1102   1188
                    1103   1189 ;
                    1104   1190 ;  LOW-LEVEL CHARACTER I/O ROUTINES
                    1105   1191 ;
05aa                1106   1192 PRNTCHRI:
05aa  e3            1107   1193 	XTHL
05ab  7e            1108   1194 	MOV	A,M
05ac  23            1109   1195 	INX	H
05ad  e3            1110   1196 	XTHL
05ae                1111   1197 PRNTCHRA:
05ae  f5            1112   1198 	PUSH	PSW		;TRANSMIT CHARACTER
05af  3a 7b 03      1113   1199 	LDA	PRINTFLG
05b2  b7            1114   1200 	ORA	A
05b3  c2 55 15      1115   1201 	JNZ	POPAFRET
05b6  f1            1116   1202 	POP	PSW
05b7  f5            1117   1203 	PUSH	PSW
05b8  fe 20         1118   1204 	CPI	' '
05ba  da cc 05      1119   1205 	JC	PRNTCHRW
05bd  e5            1120   1206 	PUSH	H
05be  2a af 03      1121   1207 	LHLD	CURSPOS		;LINE TOO LONG?
05c1  7c            1122   1208 	MOV	A,H
05c2  85            1123   1209 	ADD	L
05c3  7d            1124   1210 	MOV	A,L
05c4  e1            1125   1211 	POP	H
05c5  dc 5f 0d      1126   1212 	CC	PRNTCRLF
05c8  3c            1127   1213 	INR	A
05c9  32 af 03      1128   1214 	STA	CURSPOS
05cc                1129   1215 PRNTCHRW:
05cc  f1            1130   1216 	POP	PSW		;SEND CHARACTER
05cd  cd 40 00      1131   1217 	CALL	SYSDISPL
05d0  c9            1132   1218 	RET
                    1133   1219
05d1                1134   1220 INPTCHAR:
05d1  cd 1c 00      1135   1221 	CALL	SYSKEYIN	;RECEIVE A CHARACTER
05d4  ca d1 05      1136   1222 	JZ	INPTCHAR	;WAIT FOR ONE
05d7  fe 0f         1137   1223 	CPI	SI
05d9  c0            1138   1224 	RNZ
05da  3a 7b 03      1139   1225 	LDA	PRINTFLG
05dd  2f            1140   1226 	CMA
05de  32 7b 03      1141   1227 	STA	PRINTFLG
05e1  c3 d1 05      1142   1228 	JMP	INPTCHAR
                    1143   1229
                    1144   1230 ;
                    1145   1231 ;  Page 28
                    1146   1232 ;
                    1147   1233
                    1148   1234 ;
                    1149   1235 ;  ERROR PROCESSING
                    1150   1236 ;
05e4                1151   1237 MSGERROR:
05e4  20 45 52 52   1152   1238 	DB	' ERROR',0
05e8  4f 52 00      1152   1239
05eb                1153   1240 MSGIN:
05eb  20 49 4e 20   1154   1241 	DB	' IN ',0
05ef  00            1154   1242
05f0                1155   1243 MSGOK:
05f0  0d 0a 4f 4b   1156   1244 	DB	CR,LF,'OK',CR,LF,0
05f4  0d 0a 00      1156   1245
05f7                1157   1246 MSGBREAK:
05f7  0d 0a 42 52   1158   1247 	DB	CR,LF,'BREAK',0
05fb  45 41 4b 00   1158   1248
                    1159   1249
05ff                1160   1250 ERRDATA:
05ff  2a 91 03      1161   1251 	LHLD	CURLDATA
0602  22 89 03      1162   1252 	SHLD	CURLINE
0605                1163   1253 ERRASN:
0605  1e a9         1164   1254 	MVI	E,ERRNSN-ERRN
0607                1165   1255 ERRMSG:
0607  cd 21 05      1166   1256 	CALL	CLEARSTK
060a  af            1167   1257 	XRA	A
060b  32 7b 03      1168   1258 	STA	PRINTFLG	;TURN ON PRINTING
060e  32 7d 03      1169   1259 	STA	SCANPFLG	;ALLOW SUBSCRIPTING
0611  cd 5f 0d      1170   1260 	CALL	PRNTCRLF
0614  21 89 02      1171   1261 	LXI	H,ERRN
0617  57            1172   1262 	MOV	D,A
0618  cd aa 05      1173   1263 	CALL	PRNTCHRI	;print (val)
061b  3f            1174   1264 	DB	'?'
061c  19            1175   1265 	DAD	D		;PRINT ERROR CODE
061d  cd c2 0d      1176   1266 	CALL	PRNTMSG
0620  21 e4 05      1177   1267 	LXI	H,MSGERROR
0623                1178   1268 ERRMSGPR:
0623  cd c2 0d      1179   1269 	CALL	PRNTMSG
0626  2a 89 03      1180   1270 	LHLD	CURLINE
0629  7c            1181   1271 	MOV	A,H
062a  a5            1182   1272 	ANA	L
062b  3c            1183   1273 	INR	A
062c  c4 71 1d      1184   1274 	CNZ	ERRMSGIN
                    1185   1275
                    1186   1276 ;
                    1187   1277 ;  Page 29
                    1188   1278 ;
                    1189   1279
                    1190   1280 ;
                    1191   1281 ;  COMMAND/LINE INPUT
                    1192   1282 ;
062f                1193   1283 CMNDSTRT:
062f  af            1194   1284 	XRA	A		;TOP LEVEL EXECUTIVE
0630  32 7b 03      1195   1285 	STA	PRINTFLG	;TURN ON PRINTING
0633  32 7d 03      1196   1286 	STA	SCANPFLG	;ALLOW SUBSCRIPTINT
0636  21 ff ff      1197   1287 	LXI	H,-1
0639  22 89 03      1198   1288 	SHLD	CURLINE
063c  21 f0 05      1199   1289 	LXI	H,MSGOK
063f  cd c2 0d      1200   1290 	CALL	PRNTMSG		;REQUEST COMMAND
0642                1201   1291 CMNDINPT:
0642  11 dd 07      1202   1292 	LXI	D,MSGSTARS+2	;INPUT COMMAND
0645  cd 81 07      1203   1293 	CALL	INPTRQST
0648  da 42 06      1204   1294 	JC	CMNDINPT
064b  cd c1 03      1205   1295 	CALL	SCANNXT		;bscan ,
064e  f5            1206   1296 	PUSH	PSW
064f  cd 21 04      1207   1297 	CALL	SCANLINN	;SCAN OFF LINE NUMBER
0652  d5            1208   1298 	PUSH	D
0653  cd a7 06      1209   1299 	CALL	KEYSCAN		;SCAN STATEMENT
0656  d1            1210   1300 	POP	D
0657  f1            1211   1301 	POP	PSW
0658  d2 ba 0a      1212   1302 	JNC	EXECUTE		;DIRECT IF NO LINE NUMBER
065b  cd 6f 04      1213   1303 	CALL	LINEINS		;INSERT LINE AS REQUESTED
065e  c3 42 06      1214   1304 	JMP	CMNDINPT
                    1215   1305
0661                1216   1306 CMNDRSTR:
0661  cd 21 05      1217   1307 	CALL	CLEARSTK	;ENTRY FOR RESTARTING
0664  cd 5f 0d      1218   1308 	CALL	PRNTCRLF
0667  21 19 0e      1219   1309 	LXI	H,MSGREDO+11	;TELL HIM WE'RE STARTING
066a  c3 23 06      1220   1310 	JMP	ERRMSGPR
                    1221   1311
                    1222   1312 ;
                    1223   1313 ;  Page 30
                    1224   1314 ;
                    1225   1315
                    1226   1316 ;
                    1227   1317 ;  AUTOMATIC LINE-NUMBERED INPUT
                    1228   1318 ;
066d                1229   1319 AUTSTMIN:
066d  d5            1230   1320 	PUSH	D		;SAVE LINE NUMBER
066e  cd 6f 04      1231   1321 	CALL	LINEINS		;INSERT LINE
0671  e1            1232   1322 	POP	H		;RECOVER LINE NUMBER,
0672  d1            1233   1323 	POP	D		;INCREMENT
0673  19            1234   1324 	DAD	D
0674  da 6c 1a      1235   1325 	JC	ERRAOV
0677  c3 8b 06      1236   1326 	JMP	AUTSTMN
067a                1237   1327 AUTSTM:
067a  c1            1238   1328 	POP	B		;REMOVE CALLER
067b                1239   1329 AUTSTMS:
067b  11 e8 03      1240   1330 	LXI	D,1000		;DEFAULT STARTING LINE NUMBER
067e  01 64 00      1241   1331 	LXI	B,100		;DEFAULT INCREMENT VALUE
0681  cd fd 03      1242   1332 	CALL	SCANLPRM	;SCAN PARAMETERS
0684  c2 05 06      1243   1333 	JNZ	ERRASN
0687  e1            1244   1334 	POP	H
0688  cd 5f 0d      1245   1335 	CALL	PRNTCRLF
068b                1246   1336 AUTSTMN:
068b  d5            1247   1337 	PUSH	D		;SAVE INCREMENT
068c  e5            1248   1338 	PUSH	H		;AND NEXT LINE NUMBER
068d  cd 7e 1d      1249   1339 	CALL	ENCODEHL	;PROMPT WITH LINE NUMBER
0690  eb            1250   1340 	XCHG
0691  13            1251   1341 	INX	D
0692  cd 81 07      1252   1342 	CALL	INPTRQST
0695  d1            1253   1343 	POP	D
0696  da a0 06      1254   1344 	JC	AUTSTMBR
0699  cd c1 03      1255   1345 	CALL	SCANNXT		;bscan ,
069c  d2 6d 06      1256   1346 	JNC	AUTSTMIN
069f  3f            1257   1347 	CMC
06a0                1258   1348 AUTSTMBR:
06a0  d1            1259   1349 	POP	D		;TAKE A BREAK
06a1  da 2f 06      1260   1350 	JC	CMNDSTRT	;END OF AUTO
06a4  c3 7b 06      1261   1351 	JMP	AUTSTMS		;GET NEW LINE NUMBER, INCREMENT
                    1262   1352
                    1263   1353 ;
                    1264   1354 ;  Page 31
                    1265   1355 ;
                    1266   1356
                    1267   1357 ;
                    1268   1358 ;  LEXICAL SCANNER / KEYWORD RECOGNITION
                    1269   1359 ;
06a7                1270   1360 KEYSCAN:
06a7  0e 05         1271   1361 	MVI	C,5		;SCAN INPUT LINE FOR KEYWORDS,
06a9  54            1272   1362 	MOV	D,H		;CONDENSE LINE ON TOP OF SELF
06aa  5d            1273   1363 	MOV	E,L
06ab  2b            1274   1364 	DCX	H		;bscan -
06ac  e5            1275   1365 	PUSH	H
06ad  cd c1 03      1276   1366 	CALL	SCANNXT		;bscan +
06b0                1277   1367 KEYSCANL:
06b0  7e            1278   1368 	MOV	A,M
06b1  fe 20         1279   1369 	CPI	' '
06b3  ca 40 07      1280   1370 	JZ	KEYSCANH	;DELETE BLANKS
06b6  47            1281   1371 	MOV	B,A
06b7  fe 22         1282   1372 	CPI	'"'
06b9  ca 36 07      1283   1373 	JZ	KEYSCANI	;SWALLOW WHOLE STRING
06bc  b7            1284   1374 	ORA	A
06bd  ca 44 07      1285   1375 	JZ	KEYSCANX
06c0  fe 30         1286   1376 	CPI	'0'		;NON-KEYWORD
06c2  da ca 06      1287   1377 	JC	KEYSCANK
06c5  fe 3c         1288   1378 	CPI	'<'		;   SO WE DON'T SCAN
06c7  da 3d 07      1289   1379 	JC	KEYSCANP
06ca                1290   1380 KEYSCANK:
06ca  c5            1291   1381 	PUSH	B		;SCAN FOR MATCHING KEYWORD
06cb  d5            1292   1382 	PUSH	D
06cc  e5            1293   1383 	PUSH	H
06cd  e6 0f         1294   1384 	ANI	00FH		;HASH CHARACTER
06cf  5f            1295   1385 	MOV	E,A
06d0  16 00         1296   1386 	MVI	D,0
06d2  21 fa 00      1297   1387 	LXI	H,KEYWADDS	;ADDRESS C'SPONDING KEYWORDS
06d5  19            1298   1388 	DAD	D
06d6  19            1299   1389 	DAD	D
06d7  5e            1300   1390 	MOV	E,M
06d8  23            1301   1391 	INX	H
06d9  56            1302   1392 	MOV	D,M
06da  eb            1303   1393 	XCHG
06db  c3 09 07      1304   1394 	JMP	KEYSCANB
                    1305   1395
06de                1306   1396 KEYSCANZ:
06de  1a            1307   1397 	LDAX	D
06df  b7            1308   1398 	ORA	A
06e0  f2 e9 06      1309   1399 	JP	KEYSCANN
06e3                1310   1400 KEYSCANM:
06e3  78            1311   1401 	MOV	A,B		;MATCH, GET SYMBOL NUMBER
06e4  f6 80         1312   1402 	ORI	080H
06e6  c3 14 07      1313   1403 	JMP	KEYSCANF
06e9                1314   1404 KEYSCANN:
06e9  23            1315   1405 	INX	H		;ADDRESS NEXT CHAR IN LINE
06ea  13            1316   1406 	INX	D
06eb  0c            1317   1407 	INR	C
06ec                1318   1408 KEYSCANC:
06ec  1a            1319   1409 	LDAX	D		;COMPARE LINE WITH KEYWORD
06ed  e6 7f         1320   1410 	ANI	07FH
06ef  cd e4 03      1321   1411 	CALL	CHARMTCH	;COMPARE CHARACTERS
                    1322   1412
                    1323   1413 ;
                    1324   1414 ;  Page 32
                    1325   1415 ;
                    1326   1416
06f2  ca de 06      1327   1417 	JZ	KEYSCANZ
06f5  79            1328   1418 	MOV	A,C		;MATCH ENOUGH YET?
06f6  fe 03         1329   1419 	CPI	3
06f8  da 02 07      1330   1420 	JC	KEYSCANA
                    1331   1421
06fb  cd d1 03      1332   1422 	CALL	ALPHACHK	;STOP ON BREAK CHAR OK
06fe  2b            1333   1423 	DCX	H
06ff  d2 e3 06      1334   1424 	JNC	KEYSCANM
0702                1335   1425 KEYSCANA:
0702  eb            1336   1426 	XCHG
0703                1337   1427 KEYSCANW:
0703  b6            1338   1428 	ORA	M		;SKIP OVER REST OF KEYWORD
0704  23            1339   1429 	INX	H
0705  f2 03 07      1340   1430 	JP	KEYSCANW
0708  a8            1341   1431 	XRA	B
0709                1342   1432 KEYSCANB:
0709  46            1343   1433 	MOV	B,M		;GET CODE FOR KEYWORD
070a  23            1344   1434 	INX	H
070b  eb            1345   1435 	XCHG
070c  e1            1346   1436 	POP	H		;RESTORE STARTING POSITION
070d  e5            1347   1437 	PUSH	H
070e  0e 00         1348   1438 	MVI	C,0
0710  f2 ec 06      1349   1439 	JP	KEYSCANC
0713  7e            1350   1440 	MOV	A,M		;NO MATCH, GET CHARACTER
0714                1351   1441 KEYSCANF:
0714  d1            1352   1442 	POP	D		;RECOVER OUTPUT POINTER
0715  d1            1353   1443 	POP	D
0716  c1            1354   1444 	POP	B
0717  06 3a         1355   1445 	MVI	B,':'		;CHECK SPECIAL PROCESSING
0719  fe 8c         1356   1446 	CPI	KEYELS
071b  c2 23 07      1357   1447 	JNZ	KEYSCAND
071e  eb            1358   1448 	XCHG
071f  70            1359   1449 	MOV	M,B		;INSERT COLON BEFORE ELSE
0720  eb            1360   1450 	XCHG
0721  13            1361   1451 	INX	D
0722  0c            1362   1452 	INR	C
0723                1363   1453 KEYSCAND:
0723  fe 80         1364   1454 	CPI	KEYDAT
0725  ca 36 07      1365   1455 	JZ	KEYSCANI
0728  06 00         1366   1456 	MVI	B,0
072a  fe 81         1367   1457 	CPI	KEYREM
072c  ca 36 07      1368   1458 	jz	keyscani
072f  fe 9c         1369   1459 	cpi	keycld		;pass file name in load and save
0731  ca 36 07      1370   1460 	jz	keyscani
0734  fe 9d         1371   1461 	cpi	keycsv
0736                1372   1462 KEYSCANI:
0736  cc 4c 07      1373   1463 	CZ	KEYSCANV
0739  b7            1374   1464 	ORA	A
073a  ca 44 07      1375   1465 	JZ	KEYSCANX
073d                1376   1466 KEYSCANP:
073d  12            1377   1467 	STAX	D		;INSERT SYMBOL IN MEMORY
073e  13            1378   1468 	INX	D
073f  0c            1379   1469 	INR	C
0740                1380   1470 KEYSCANH:
0740  23            1381   1471 	INX	H
0741  c3 b0 06      1382   1472 	JMP	KEYSCANL
                    1383   1473
                    1384   1474 ;
                    1385   1475 ;  Page 33
                    1386   1476 ;
                    1387   1477
0744                1388   1478 KEYSCANX:
0744  e1            1389   1479 	POP	H		;EXIT KEYWORD TRANSLATION
0745  12            1390   1480 	STAX	D		;END OF STATEMENT
0746  13            1391   1481 	INX	D
0747  12            1392   1482 	STAX	D		;END OF 'PROGRAM'
0748  13            1393   1483 	INX	D
0749  12            1394   1484 	STAX	D
074a  47            1395   1485 	MOV	B,A		;LENGTHIN BC
074b  c9            1396   1486 	RET
                    1397   1487
                    1398   1488 ;
                    1399   1489 ;  COPY BUFFER TEXT WITHOUT PROCESSING
                    1400   1490 ;
074c                1401   1491 KEYSCANV:
074c  12            1402   1492 	STAX	D		;COPY TEXT VERBATIM TO STOPPER
074d  0c            1403   1493 	INR	C
074e  13            1404   1494 	INX	D
074f  23            1405   1495 	INX	H
0750  7e            1406   1496 	MOV	A,M
0751  b7            1407   1497 	ORA	A
0752  c8            1408   1498 	RZ
0753  b8            1409   1499 	CMP	B
0754  c8            1410   1500 	RZ
0755  fe 22         1411   1501 	CPI	'"'		;STRING WITHIN TEXT?
0757  c2 4c 07      1412   1502 	JNZ	KEYSCANV
075a  c5            1413   1503 	PUSH	B
075b  47            1414   1504 	MOV	B,A
075c  cd 4c 07      1415   1505 	CALL	KEYSCANV
075f  f1            1416   1506 	POP	PSW
0760  47            1417   1507 	MOV	B,A
0761  7e            1418   1508 	MOV	A,M
0762  b7            1419   1509 	ORA	A		;STRING TERMINATE ON END OF LINE?
0763  c8            1420   1510 	RZ
0764  c3 4c 07      1421   1511 	JMP	KEYSCANV
                    1422   1512
                    1423   1513 ;
                    1424   1514 ;  Page 34
                    1425   1515 ;
                    1426   1516
                    1427   1517 ;
                    1428   1518 ;  LINE INPUT ROUTINE
                    1429   1519 ;
0767                1430   1520 INPTLNBS:
0767  2b            1431   1521 	DCX	H		;DELETE A CHARACTER FROM INPUT
0768  05            1432   1522 	DCR	B
0769  ca 74 07      1433   1523 	JZ	INPTLNRD
076c  cd aa 05      1434   1524 	CALL	PRNTCHRI	;print (val)
076f  5c            1435   1525 	DB	'\'
0770  0c            1436   1526 	inr	c		;char count
0771  c3 90 07      1437   1527 	JMP	INPTLINL
0774                1438   1528 INPTLNRD:
0774  21 db 07      1439   1529 	LXI	H,MSGSTARS	;BREAK ENTERED
0777  cd c2 0d      1440   1530 	CALL	PRNTMSG		;TELL HIM WE GOT IT
077a  05            1441   1531 	DCR	B		;BREAK AT BEGINNING MEANS BREAK
077b  ca d0 07      1442   1532 	JZ	INPTEXIT
                    1443   1533
077e                1444   1534 INPTCRLF:
077e  cd 5f 0d      1445   1535 	CALL	PRNTCRLF	;ON THE NEXT LINE
0781                1446   1536 INPTRQST:
0781  62            1447   1537 	MOV	H,D
0782  6b            1448   1538 	MOV	L,E		;PRINT USER'S PROMPT MESSAGE
0783  cd c2 0d      1449   1539 	CALL	PRNTMSG
0786  2a 95 03      1450   1540 	LHLD	INPTBUFR	;INPUT A LINE FROM RECEIVER
0789  01 00 01      1451   1541 	LXI	B,1*256
078c  cd aa 05      1452   1542 	CALL	PRNTCHRI	;print (val)
078f  20            1453   1543 	DB	' '		;OK, WE'RE READY FOR INPUT
0790                1454   1544 INPTLINL:
0790  36 00         1455   1545 	MVI	M,0		;MAINTAIN ENDING ZERO
0792  cd d1 05      1456   1546 	CALL	INPTCHAR
0795                1457   1547 INPTLINC:
0795  fe 07         1458   1548 	CPI	BEL
0797  ca b3 07      1459   1549 	JZ	INPTLNST	;BELL'S OK
079a  fe 0d         1460   1550 	CPI	CR
079c  ca cc 07      1461   1551 	JZ	INPTCRTN	;CARRIAGE RTN IS END OF LINE
079f  fe 08         1462   1552 	CPI	BS
07a1  ca 67 07      1463   1553 	JZ	INPTLNBS	;BACKSPACE IS DELETE
07a4  fe 03         1464   1554 	CPI	ETX		;CONTROL C IS ABORT
07a6  ca 74 07      1465   1555 	JZ	INPTLNRD	;FORGET THIS LINE, START OVER
07a9  fe 0c         1466   1556 	CPI	FF		;FORM FEEDS ARE ECHOED
07ab  ca c6 07      1467   1557 	JZ	INPTLNEC
07ae  fe 20         1468   1558 	CPI	' '
07b0  da 90 07      1469   1559 	JC	INPTLINL	;IGNORE OTHER CONTROL CHARS
                    1470   1560
                    1471   1561 ;
                    1472   1562 ;  Page 35
                    1473   1563 ;
                    1474   1564
07b3                1475   1565 INPTLNST:
07b3  77            1476   1566 	MOV	M,A		;STORE THE CHARACTER
07b4  78            1477   1567 	MOV	A,B
07b5  fe 9d         1478   1568 	CPI	LINESYZE
07b7  3e 07         1479   1569 	MVI	A,BEL
07b9  d2 c6 07      1480   1570 	JNC	INPTLNEC
07bc  04            1481   1571 	INR	B
07bd  b1            1482   1572 	ORA	C
07be  4e            1483   1573 	MOV	C,M
07bf  23            1484   1574 	INX	H
07c0  3e 0a         1485   1575 	MVI	A,LF
07c2  fc ae 05      1486   1576 	CM	PRNTCHRA
07c5  79            1487   1577 	MOV	A,C
07c6                1488   1578 INPTLNEC:
07c6  cd ae 05      1489   1579 	CALL	PRNTCHRA	;ac -> screen  ;ECHO CHARACTER
07c9  c3 90 07      1490   1580 	JMP	INPTLINL
07cc                1491   1581 INPTCRTN:
07cc  05            1492   1582 	DCR	B		;CARRIAGE RETURN AT BEGINNING
07cd  ca 7e 07      1493   1583 	JZ	INPTCRLF	;GETS ANOTHER TURN
07d0                1494   1584 INPTEXIT:
07d0  2a 95 03      1495   1585 	LHLD	INPTBUFR
07d3  2b            1496   1586 	DCX	H
07d4  cd 5f 0d      1497   1587 	CALL	PRNTCRLF
07d7  90            1498   1588 	SUB	B		;SET CONDITION CODES
07d8  3f            1499   1589 	CMC
07d9  9f            1500   1590 	SBB	A		;NS=NC=Z = NON-EMPTY LINE
07da  c9            1501   1591 	RET
                    1502   1592
07db                1503   1593 MSGSTARS:
07db  2a 2a 2a 00   1504   1594 	DB	'***',0
                    1505   1595
                    1506   1596 ;
                    1507   1597 ;  Page 36
                    1508   1598 ;
                    1509   1599
                    1510   1600 ;
                    1511   1601 ;  SET OPTIONS COMMAND
                    1512   1602 ;
07df                1513   1603 SETSTM:
07df  ca 05 06      1514   1604 	JZ	ERRASN		;TURN OPTION ON OR OFF
07e2  fe 99         1515   1605 	CPI	KEYLIS
07e4  ca 09 08      1516   1606 	JZ	SETSTMLS
07e7  f5            1517   1607 	PUSH	PSW		;SAVE OPTION
07e8  cd c1 03      1518   1608 	CALL	SCANNXT		;bscan ,
07eb  ca 05 06      1519   1609 	JZ	ERRASN
07ee  d6 91         1520   1610 	SUI	KEYON
07f0  47            1521   1611 	MOV	B,A		;SAVE FLAG
07f1  cd c1 03      1522   1612 	CALL	SCANNXT		;bscan +
07f4  f1            1523   1613 	POP	PSW		;WHICH OPTION
07f5  fe 89         1524   1614 	CPI	KEYGTO
07f7  ca 04 08      1525   1615 	JZ	SETSTMGT	;GOTO
07fa  fe 96         1526   1616 	CPI	KEYPRT
07fc  c2 05 06      1527   1617 	JNZ	ERRASN
07ff                1528   1618 SETSTMPR:
07ff  78            1529   1619 	MOV	A,B
0800  32 79 03      1530   1620 	sta	p3010		;used to be printflg **
0803  c9            1531   1621 	RET
0804                1532   1622 SETSTMGT:
0804  78            1533   1623 	MOV	A,B
0805  32 7c 03      1534   1624 	STA	TRACEFLG
0808  c9            1535   1625 	RET
0809                1536   1626 SETSTMLS:
0809  23            1537   1627 	INX	H
080a  cd 42 0c      1538   1628 	CALL	VALBYTE
080d  2f            1539   1629 	CMA			;FIND NEGATIVE OF BYTE
080e  3c            1540   1630 	INR	A
080f  32 b0 03      1541   1631 	STA	CURSLIM
0812  c9            1542   1632 	RET
                    1543   1633
                    1544   1634 ;
                    1545   1635 ;  DELETE COMMAND PROCESSOR
                    1546   1636 ;
0813                1547   1637 DELSTM:
0813  11 ff ff      1548   1638 	LXI	D,0FFFFH	;DELETE COMMAND
0816  cd fa 03      1549   1639 	CALL	SCANLPRZ
0819  e3            1550   1640 	XTHL			;SAVE SCAN POINTER
081a  eb            1551   1641 	XCHG
081b  cd d7 04      1552   1642 	CALL	CMHLLTDE	;VERITY  FIRST<=LAST
081e  da 05 06      1553   1643 	JC	ERRASN
0821  e5            1554   1644 	PUSH	H
0822  cd 46 04      1555   1645 	CALL	LINESRCH	;LOOK FOR FIRST LINE
0825  d1            1556   1646 	POP	D
0826  c5            1557   1647 	PUSH	B
0827  cd 46 04      1558   1648 	CALL	LINESRCH	;LOOK FOR LAST LINE
082a  c1            1559   1649 	POP	B
082b  cd a9 04      1560   1650 	CALL	LINEDEL
082e  e1            1561   1651 	POP	H
082f  c9            1562   1652 	RET
                    1563   1653
                    1564   1654 ;
                    1565   1655 ; Page 37
                    1566   1656 ;
                    1567   1657
                    1568   1658 ;
                    1569   1659 ;  LIST COMMAND PROCESSOR
                    1570   1660 ;
0830                1571   1661 LISSTM:
0830  11 00 00      1572   1662 	LXI	D,0		;LIST COMMAND
0833  01 ff ff      1573   1663 	LXI	B,0FFFFH	;TOTAL DEFAULT IS ENTIRE FILE
0836  ca 3c 08      1574   1664 	JZ	LISSTMSC
0839  01 00 00      1575   1665 	LXI	B,0		;ELSE DEFAULT IS ONLY ONE LINE
083c                1576   1666 LISSTMSC:
083c  cd fd 03      1577   1667 	CALL	SCANLPRM	;SCAN LINE PARAMETERS
083f  c2 05 06      1578   1668 	JNZ	ERRASN
0842  e3            1579   1669 	XTHL
0843  eb            1580   1670 	XCHG
0844  e5            1581   1671 	PUSH	H
0845  cd 46 04      1582   1672 	CALL	LINESRCH
0848  c5            1583   1673 	PUSH	B
0849                1584   1674 LISSTMLP:
0849  c1            1585   1675 	POP	B		;MOVE ON TO NEXT LINE
084a  d1            1586   1676 	POP	D
084b  e1            1587   1677 	POP	H
084c  cd 54 00      1588   1678 	CALL	SYSBREAK	;ALLOW BREAK
084f  ca e2 0a      1589   1679 	JZ	EXECUTEB
0852  c5            1590   1680 	PUSH	B
0853  e3            1591   1681 	XTHL
0854  cd 63 04      1592   1682 	CALL	LINELINK
0857  ca 86 08      1593   1683 	JZ	POPHLRET	;END OF PROGRAM, QUIT
085a  d5            1594   1684 	PUSH	D
085b  c5            1595   1685 	PUSH	B
085c  e5            1596   1686 	PUSH	H		;SAVE TEXT FOR LATER
085d  4e            1597   1687 	MOV	C,M		;FETCH LINE NUMBER
085e  23            1598   1688 	INX	H
085f  46            1599   1689 	MOV	B,M
0860  60            1600   1690 	MOV	H,B
0861  69            1601   1691 	MOV	L,C
0862  eb            1602   1692 	XCHG
0863  cd d7 04      1603   1693 	CALL	CMHLLTDE
0866  da 83 08      1604   1694 	JC	LISSTMXT	;LAST LINE REACHED?
0869  cd 5f 0d      1605   1695 	CALL	PRNTCRLF	;LIST CURRENT LINE
086c  eb            1606   1696 	XCHG
086d  cd 79 1d      1607   1697 	CALL	PRINTINT	;PRINT LINE NUMBER
0870  cd aa 05      1608   1698 	CALL	PRNTCHRI	;print (val)
0873  20            1609   1699 	DB	' '		;FOLLOWED BY BLANK
0874  e1            1610   1700 	POP	H
0875  cd 88 08      1611   1701 	CALL	LISEDIXP	;EXPAND TEXT
0878  cd c2 0d      1612   1702 	CALL	PRNTMSG		;AND PRINT IT
087b  21 a0 00      1613   1703 	LXI	H,0+LINESYZE+3
087e  39            1614   1704 	DAD 	SP
087f  f9            1615   1705 	SPHL			;DEALLOCATE EXPANDED TEXT
0880  c3 49 08      1616   1706 	JMP	LISSTMLP
                    1617   1707
                    1618   1708 ;
                    1619   1709 ;  Page 38
                    1620   1710 ;
0883                1621   1711 LISSTMXT:
0883  e1            1622   1712 	POP	H
0884                1623   1713 POPHL3RT:
0884  e1            1624   1714 	POP	H
0885  e1            1625   1715 	POP	H
0886                1626   1716 POPHLRET:
0886  e1            1627   1717 	POP	H
0887  c9            1628   1718 	RET
                    1629   1719
                    1630   1720
                    1631   1721 ;
                    1632   1722 ;  EXPAND KEYWORDS IN LINE / INVERSE OF KEYSCAN
                    1633   1723 ;
0888                1634   1724 LISEDIXP:
0888  0e 4e         1635   1725 	MVI	C,LINESYZE/2	;SPACE ENOUGH TO EXPAND LINE?
088a  cd ee 04      1636   1726 	CALL	SPACESTK
088d  eb            1637   1727 	XCHG			;SAVE POINTER TO LINE TO EXPAND
088e  c1            1638   1728 	POP	B		;AND CALLER
088f  21 60 ff      1639   1729 	LXI	H,0-LINESYZE-3
0892  39            1640   1730 	DAD	SP
0893  f9            1641   1731 	SPHL			;CREATE TEXT BUFFER ON STACK
0894  c5            1642   1732 	PUSH	B		;PUT BACK CALLER
0895  eb            1643   1733 	XCHG
0896  23            1644   1734 	INX	H
0897  23            1645   1735 	INX	H		;plus 2
0898  e5            1646   1736 	PUSH	H		;SAVE TEXT POINTER
0899  21 04 00      1647   1737 	LXI	H,4		;CREATE POINTER TO EXPAND TEXT
089c  39            1648   1738 	DAD	SP
089d  eb            1649   1739 	XCHG
089e  06 9d         1650   1740 	MVI	B,LINESYZE	;INITIALIZE LENGTH COUNTER
08a0  c3 a6 08      1651   1741 	JMP	LISEDIKD
08a3                1652   1742 LISEDISC:
08a3  cd f3 08      1653   1743 	CALL	LISEDIST	;STUFF ONE CHARACTER OF LINE
08a6                1654   1744 LISEDIKD:
08a6  e1            1655   1745 	POP	H		;DO REST OF LINE
08a7  7e            1656   1746 	MOV	A,M
08a8                1657   1747 LISEDINC:
08a8  23            1658   1748 	INX	H
08a9  fe 3a         1659   1749 	CPI	':'
08ab  c2 b6 08      1660   1750 	JNZ	LISEDIKT
08ae  7e            1661   1751 	MOV	A,M
08af  fe 8c         1662   1752 	CPI	KEYELS		;:ELSE BECOMES ELSE
08b1  ca a8 08      1663   1753 	JZ	LISEDINC
08b4  3e 3a         1664   1754 	MVI	A,':'
08b6                1665   1755 LISEDIKT:
08b6  a7            1666   1756 	ANA	A		;MOVE HIGH ORDER INTO S-FLAG
08b7  ca fa 08      1667   1757 	JZ	LISEDIXT
08ba  e5            1668   1758 	PUSH	H
08bb  f2 a3 08      1669   1759 	JP	LISEDISC
08be  4f            1670   1760 	MOV	C,A
                    1671   1761
                    1672   1762 ;
                    1673   1763 ;  Page 39
                    1674   1764 ;
                    1675   1765
08bf  21 a0 a3      1676   1766 	LXI	H,KEYLSBH*256+KEYLSBL
08c2  cd ed 08      1677   1767 	CALL	LISEDISB	;OPTIONAL BLANK BEFORE KEYWORD
08c5  21 1a 01      1678   1768 	LXI	H,KEYWORDS	;SEARCH FOR KEYWORD
08c8  c3 d0 08      1679   1769 	JMP	LISEDIKS
08cb                1680   1770 LISEDIKL:
08cb  b6            1681   1771 	ORA	M
08cc  23            1682   1772 	INX	H
08cd  f2 cb 08      1683   1773 	JP	LISEDIKL
08d0                1684   1774 LISEDIKS:
08d0  7e            1685   1775 	MOV	A,M		;FETCH KEYWORD NUMBER
08d1  f6 80         1686   1776 	ORI	080H
08d3  23            1687   1777 	INX	H
08d4  a9            1688   1778 	XRA	C
08d5  c2 cb 08      1689   1779 	JNZ	LISEDIKL
08d8                1690   1780 LISEDIKY:
08d8  7e            1691   1781 	MOV	A,M		;EXPAND KEYWORD
08d9  07            1692   1782 	RLC
08da  a7            1693   1783 	ANA	A		;HIGH-ORDER TO CARRY
08db  1f            1694   1784 	RAR
08dc  cd f3 08      1695   1785 	CALL	LISEDIST	;STUFF THIS CHARACTER
08df  23            1696   1786 	INX	H
08e0  d2 d8 08      1697   1787 	JNC	LISEDIKY	;DO THEM ALL
08e3  79            1698   1788 	MOV	A,C
08e4  21 82 a5      1699   1789 	LXI	H,KEYLSAH*256+KEYLSAL
08e7  cd ed 08      1700   1790 	CALL	LISEDISB	;OPTIONAL BLANK AFTER KEYWORD
08ea  c3 a6 08      1701   1791 	JMP	LISEDIKD
                    1702   1792
08ed                1703   1793 LISEDISB:
08ed  bd            1704   1794 	CMP	L		;INSERT BLANK IN LINE IF
08ee  d8            1705   1795 	RC			;L <= A < H
08ef  bc            1706   1796 	CMP	H
08f0  d0            1707   1797 	RNC
08f1  3e 20         1708   1798 	MVI	A,' '		;GENERATE BLANK
08f3                1709   1799 LISEDIST:
08f3  12            1710   1800 	STAX	D
08f4  13            1711   1801 	INX	D
08f5  05            1712   1802 	DCR	B
08f6  c0            1713   1803 	RNZ			;TRUNCATE TOO LONG A LINE
08f7  04            1714   1804 	INR	B
08f8  2b            1715   1805 	DCX	H
08f9  c9            1716   1806 	RET
                    1717   1807
08fa                1718   1808 LISEDIXT:
08fa  12            1719   1809 	STAX	D
08fb  3e 9e         1720   1810 	MVI	A,LINESYZE+1	;COMPUTE LENGTH OF OUTPUT
08fd  90            1721   1811 	SUB	B
08fe  47            1722   1812 	MOV	B,A
08ff  21 02 00      1723   1813 	LXI	H,2		;CREATE POINTER TO EXPAND TEXT
0902  39            1724   1814 	DAD	SP
0903  c9            1725   1815 	RET			;AND RETURN
                    1726   1816
                    1727   1817 ;
                    1728   1818 ;  Page 40
                    1729   1819 ;
                    1730   1820
                    1731   1821 ;
                    1732   1822 ;  EDIT COMMAND PROCESSOR
                    1733   1823 ;
0904                1734   1824 EDISTM:
0904  11 00 00      1735   1825 	LXI	D,0		;SCAN PARAMETERS
0907  cd fa 03      1736   1826 	CALL	SCANLPRZ
090a  e3            1737   1827 	XTHL			;SAVE SCAN,
090b  22 85 03      1738   1828 	SHLD	SCANPTR1	;AND OUTPUT LINE NUMBER
090e  cd 46 04      1739   1829 	CALL	LINESRCH	;LOOK UP LINE
0911  d2 60 0b      1740   1830 	JNC	ERRAUS		;NOT FOUND...
0914  60            1741   1831 	MOV	H,B
0915  69            1742   1832 	MOV	L,C
0916  23            1743   1833 	INX	H
0917  23            1744   1834 	INX	H		;plus 2
0918  cd 88 08      1745   1835 	CALL	LISEDIXP	;EXPAND LINE
091b  2a 85 03      1746   1836 	LHLD	SCANPTR1	;RECOVER LINE NUMBER
091e  e5            1747   1837 	PUSH	H
091f                1748   1838 EDISTMLS:
091f  cd d2 09      1749   1839 	CALL	EDISTMCR	;GIVE HIM A LOOK AT IT
0922  cd c2 0d      1750   1840 	CALL	PRNTMSG		;PRINT COPY OF TEXT
0925  cd d2 09      1751   1841 	CALL	EDISTMCR	;A NEW EDIT LINE
0928  0e 01         1752   1842 	MVI	C,1		;POSITION COUNTER
092a                1753   1843 EDISTMNX:
092a  cd e7 09      1754   1844 	CALL	EDISTMCH	;OK MASTER, TELL ME WHAT TO DO
092d  fe 20         1755   1845 	CPI	' '		;MOVE ALONG
092f  ca 4c 09      1756   1846 	JZ	EDISTMAD
0932  cd d2 03      1757   1847 	CALL	ALPHACHA	;CONVERT LOWER TO UPPER
0935  fe 44         1758   1848 	CPI	'D'		;DELETE
0937  ca 57 09      1759   1849 	JZ	EDISTMDL
093a  fe 49         1760   1850 	CPI	'I'		;INSERT
093c  ca 70 09      1761   1851 	JZ	EDISTMIN
093f  fe 52         1762   1852 	CPI	'R'		;REPLACE
0941  ca 8e 09      1763   1853 	JZ	EDISTMRP
0944                1764   1854 EDISTMER:
0944  3e 07         1765   1855 	MVI	A,BEL		;SQUAWK ABOUT ERROR
0946                1766   1856 EDISTMEC:
0946  cd ae 05      1767   1857 	CALL	PRNTCHRA	;ac -> screen
0949  c3 2a 09      1768   1858 	JMP	EDISTMNX
                    1769   1859
                    1770   1860 ;  ADVANCE
                    1771   1861 ;
094c                1772   1862 EDISTMAD:
094c  79            1773   1863 	MOV	A,C
094d  b8            1774   1864 	CMP	B		;CAN WE STILL ADVANCE?
094e  d2 44 09      1775   1865 	JNC	EDISTMER
0951  0c            1776   1866 	INR	C		;ADVANCE POSITION COUNTER
0952  7e            1777   1867 	MOV	A,M
0953  23            1778   1868 	INX	H		;PRINT CHARACTER PASSED OVER
0954  c3 46 09      1779   1869 	JMP	EDISTMEC
                    1780   1870
                    1781   1871 ;
                    1782   1872 ;  Page 41
                    1783   1873 ;
                    1784   1874
                    1785   1875 ;  DELETE
                    1786   1876 ;
0957                1787   1877 EDISTMDL:
0957  79            1788   1878 	MOV	A,C
0958  b8            1789   1879 	CMP	B		;ANYTHING TO DELETE?
0959  d2 44 09      1790   1880 	JNC	EDISTMER
095c  05            1791   1881 	DCR	B		;DECREASE CHARACTER COUNT
095d  e5            1792   1882 	PUSH	H		;SAVE CURRENT POSITION
095e  7e            1793   1883 	MOV	A,M
095f  cd ae 05      1794   1884 	CALL	PRNTCHRA	;LIST CHARACTER DELETED
0962  54            1795   1885 	MOV	D,H
0963  5d            1796   1886 	MOV	E,L
0964                1797   1887 EDISTMDM:
0964  23            1798   1888 	INX	H
0965  7e            1799   1889 	MOV	A,M		;MOVE THIS CHARACTER DOWNWARD
0966  12            1800   1890 	STAX	D
0967  13            1801   1891 	INX	D
0968  b7            1802   1892 	ORA	A
0969  c2 64 09      1803   1893 	JNZ	EDISTMDM
096c  e1            1804   1894 	POP	H
096d  c3 2a 09      1805   1895 	JMP	EDISTMNX
                    1806   1896
                    1807   1897 ;  INSERT
                    1808   1898 ;
0970                1809   1899 EDISTMIN:
0970  cd e7 09      1810   1900 	CALL	EDISTMCH	;GET SOMETHING TO PUT IN
0973  57            1811   1901 	MOV	D,A		;SAVE COPY OF CHARACTER
0974                1812   1902 EDISTMRI:
0974  78            1813   1903 	MOV	A,B
0975  fe 9d         1814   1904 	CPI	LINESYZE	;ROOM AT THE INNPUT BUFFER?
0977  d2 44 09      1815   1905 	JNC	EDISTMER
097a  04            1816   1906 	INR	B		;COUNT NEWCOMER
097b  0c            1817   1907 	INR	C		;NEXT ONE GOES AFTER HIM
097c  7a            1818   1908 	MOV	A,D
097d  cd ae 05      1819   1909 	CALL	PRNTCHRA	;ac -> screen  ;PRINT NEWCOMER
0980  e5            1820   1910 	PUSH	H		;SAVE CURRENT POSITION
0981                1821   1911 EDISTMIM:
0981  5e            1822   1912 	MOV	E,M
0982  77            1823   1913 	MOV	M,A		;MOVE CHARACTERS UP ONE BYTE
0983  b7            1824   1914 	ORA	A
0984  7b            1825   1915 	MOV	A,E
0985  23            1826   1916 	INX	H
0986  c2 81 09      1827   1917 	JNZ	EDISTMIM
0989  e1            1828   1918 	POP	H
098a  23            1829   1919 	INX	H
098b  c3 70 09      1830   1920 	JMP	EDISTMIN
                    1831   1921
                    1832   1922 ;
                    1833   1923 ;  Page 42
                    1834   1924 ;
                    1835   1925
                    1836   1926 ;  REPLACE
                    1837   1927 ;
098e                1838   1928 EDISTMRP:
098e  cd e7 09      1839   1929 	CALL	EDISTMCH	;GET UPDATE CHARACTER
0991  57            1840   1930 	MOV	D,A
0992  79            1841   1931 	MOV	A,C
0993  b8            1842   1932 	CMP	B		;REPLACING END OF LINE?
0994  d2 74 09      1843   1933 	JNC	EDISTMRI	;IF SO, GO TO INSERT
0997  72            1844   1934 	MOV	M,D		;UPDATE THE CHARACTER
0998  0c            1845   1935 	INR	C
0999  23            1846   1936 	INX	H
099a  7a            1847   1937 	MOV	A,D
099b  cd ae 05      1848   1938 	CALL	PRNTCHRA	;ac -> screen  ;PRINT NEWCOMER
099e  c3 8e 09      1849   1939 	JMP	EDISTMRP
                    1850   1940
                    1851   1941 ;  SEARCH
                    1852   1942 ;
09a1                1853   1943 EDISTMSR:
09a1  cd e7 09      1854   1944 	CALL	EDISTMCH	;FIND CHARACTER TO SEARCH FOR
09a4  cd d2 03      1855   1945 	CALL	ALPHACHA	;CONVERT TO STANDARD CASE
09a7  57            1856   1946 	MOV	D,A
09a8  1e 00         1857   1947 	MVI	E,0
09aa                1858   1948 EDISTMSL:
09aa  79            1859   1949 	MOV	A,C
09ab  b8            1860   1950 	CMP	B
09ac  d2 44 09      1861   1951 	JNC	EDISTMER	;NO MORE, TERMINATE SEARCH
09af  cd d1 03      1862   1952 	CALL	ALPHACHK	;FETCH CHARACTER IN STANDARD CASE
09b2  bb            1863   1953 	CMP	E
09b3  ca 2a 09      1864   1954 	JZ	EDISTMNX	;GOTTA MATCH?
09b6  cd ae 05      1865   1955 	CALL	PRNTCHRA	;ac -> screen  ;LIST FAILURES
09b9  0c            1866   1956 	INR	C
09ba  23            1867   1957 	INX	H
09bb  5a            1868   1958 	MOV	E,D
09bc  c3 aa 09      1869   1959 	JMP	EDISTMSL	;AND KEEP LOOKING
                    1870   1960
                    1871   1961 ;
                    1872   1962 ; Page 43
                    1873   1963 ;
                    1874   1964
09bf                1875   1965 EDISTMXT:
09bf  0d            1876   1966 	DCR	C		;BEGINNING CR MEANS DONE, UPDATE
09c0  c2 1f 09      1877   1967 	JNZ	EDISTMLS	;OTHERWISE, LIST, MORE EDITS
09c3  d1            1878   1968 	POP	D		;RETRIEVE LINE NUMBER
09c4  21 00 00      1879   1969 	LXI	H,0
09c7  39            1880   1970 	DAD	SP		;POINT TO TEXT
09c8  cd 6f 04      1881   1971 	CALL	LINEINS		;AND REINSERT
09cb                1882   1972 EDISTMQT:
09cb  21 a0 00      1883   1973 	LXI	H,0+LINESYZE+3
09ce  39            1884   1974 	DAD	SP
09cf  f9            1885   1975 	SPHL			;DEALLOCATE TEXT BUFFER
09d0  e1            1886   1976 	POP	H		;RECOVER SCAN POINTER
09d1  c9            1887   1977 	RET			;AND RETURN
                    1888   1978
                    1889   1979 ;  LIST LINE, PREPARE FOR UPDATES
                    1890   1980 ;
09d2                1891   1981 EDISTMCR:
09d2  d1            1892   1982 	POP	D
09d3  e1            1893   1983 	POP	H		;RETRIEVE COPY OF LINE NUMBER
09d4  e5            1894   1984 	PUSH	H		;SAVE IT,
09d5  d5            1895   1985 	PUSH	D
09d6  c5            1896   1986 	PUSH	B		;AND LINE LENGTH
09d7  cd 5f 0d      1897   1987 	CALL	PRNTCRLF
09da  cd 79 1d      1898   1988 	CALL	PRINTINT	;PRINT LINE NUMBER
09dd  cd aa 05      1899   1989 	CALL	PRNTCHRI	;print (val)
09e0  20            1900   1990 	DB	' '
09e1  21 06 00      1901   1991 	LXI	H,6
09e4  39            1902   1992 	DAD	SP		;CREATE POINTER TO TEXT BUFFER
09e5  c1            1903   1993 	POP	B
09e6  c9            1904   1994 	RET
                    1905   1995
                    1906   1996 ;  GET OPTION CHARACTER
                    1907   1997 ;
09e7                1908   1998 EDISTMCH:
09e7  cd d1 05      1909   1999 	CALL	INPTCHAR	;GET CHARACTER ROUTINE
09ea  fe 20         1910   2000 	CPI	' '
09ec  d0            1911   2001 	RNC			;NOT CONTROL, RETURN
09ed  fe 07         1912   2002 	CPI	BEL
09ef  c8            1913   2003 	RZ
09f0  d1            1914   2004 	POP	D		;REMOVE CALLER
09f1  fe 09         1915   2005 	CPI	HT		;SEARCH (TAB)
09f3  ca a1 09      1916   2006 	JZ	EDISTMSR
09f6  fe 0d         1917   2007 	CPI	CR		;LIST, OR UPDATE
09f8  ca bf 09      1918   2008 	JZ	EDISTMXT
09fb  fe 18         1919   2009 	CPI	ESC		;TERMINATE OPTION
09fd  ca 2a 09      1920   2010 	JZ	EDISTMNX
0a00  fe 03         1921   2011 	CPI	ETX		;ABORT, NO UPDATE
0a02  c2 44 09      1922   2012 	JNZ	EDISTMER
0a05  21 db 07      1923   2013 	LXI	H,MSGSTARS	;TYPE BREAK MESSAGE
0a08  cd c2 0d      1924   2014 	CALL	PRNTMSG
0a0b  d1            1925   2015 	POP	D
0a0c  c3 cb 09      1926   2016 	JMP	EDISTMQT
                    1927   2017
                    1928   2018 ;
                    1929   2019 ;  Page 44
                    1930   2020 ;
                    1931   2021
                    1932   2022 ;
                    1933   2023 ;  SCAN STACK FOR 'FOR' LOOP
                    1934   2024 ;
0010  =             1935   2025 FORBLCK	EQU	16		;SIZE OF 'FOR' STACK ENTRY
                    1936   2026
0a0f                1937   2027 FORCHK:
0a0f  21 04 00      1938   2028 	LXI	H,4		;LOOK FOR MARK ON STACK
0a12  39            1939   2029 	DAD	SP
0a13                1940   2030 FORCHKL:
0a13  7e            1941   2031 	MOV	A,M
0a14  23            1942   2032 	INX	H
0a15  fe 83         1943   2033 	CPI	KEYFOR
0a17  c0            1944   2034 	RNZ
0a18  3e 04         1945   2035 	MVI	A,TYPESING
0a1a  32 81 03      1946   2036 	STA	TYPEFLG		;SET CORRECT TYPE FLAG
0a1d  4e            1947   2037 	MOV	C,M		;MARK IS PRESENT
0a1e  23            1948   2038 	INX	H
0a1f  46            1949   2039 	MOV	B,M
0a20  23            1950   2040 	INX	H
0a21  e5            1951   2041 	PUSH	H
0a22  60            1952   2042 	MOV	H,B
0a23  69            1953   2043 	MOV	L,C
0a24  7a            1954   2044 	MOV	A,D		;LOOKING FOR PARTICULAR VARIABLE?
0a25  b3            1955   2045 	ORA	E
0a26  eb            1956   2046 	XCHG
0a27  ca 2e 0a      1957   2047 	JZ	FORCHKXT
0a2a  eb            1958   2048 	XCHG			;IS THIS IT?
0a2b  cd d7 04      1959   2049 	CALL	CMHLLTDE
0a2e                1960   2050 FORCHKXT:
0a2e  01 0d 00      1961   2051 	LXI	B,FORBLCK-3
0a31  e1            1962   2052 	POP	H
0a32  c8            1963   2053 	RZ
0a33  09            1964   2054 	DAD	B
0a34  c3 13 0a      1965   2055 	JMP	FORCHKL
                    1966   2056
                    1967   2057 ;
                    1968   2058 ;  FOR STATEMENT PROCESSOR
                    1969   2059 ;
0a37                1970   2060 FORSTM:
0a37  3e ab         1971   2061 	MVI	A,SCANPFLD	;FOR STATEMENT
0a39  32 7d 03      1972   2062 	STA	SCANPFLG
0a3c  cd c0 0b      1973   2063 	CALL	LETSTM
0a3f  cd ef 03      1974   2064 	CALL	TYPECHK
0a42  ea 18 0c      1975   2065 	JPE	ERRATM		;MUST BE SINGLE INDEX
0a45  e3            1976   2066 	XTHL			;SAVE SCANPTR, REMOVE CALLER
0a46  eb            1977   2067 	XCHG
0a47  22 8d 03      1978   2068 	SHLD	VARINDEX
0a4a  eb            1979   2069 	XCHG
0a4b  cd 0f 0a      1980   2070 	CALL	FORCHK
0a4e  d1            1981   2071 	POP	D
0a4f  c2 54 0a      1982   2072 	JNZ	FORSTMNF
0a52  09            1983   2073 	DAD	B
0a53  f9            1984   2074 	SPHL
0a54                1985   2075 FORSTMNF:
0a54  eb            1986   2076 	XCHG
0a55  0e 08         1987   2077 	MVI	C,(FORBLCK+1)/2
                    1988   2078
                    1989   2079 ;
                    1990   2080 ;  Page 45
                    1991   2081 ;
                    1992   2082
0a57  cd ee 04      1993   2083 	CALL	SPACESTK
                    1994   2084
0a5a  e5            1995   2085 	PUSH	H
0a5b  cd 7f 0b      1996   2086 	CALL	DATSTM		;FIND FIRST STATEMENT IN FOR LOOP
0a5e  e3            1997   2087 	XTHL			;AND SAVE
0a5f  e5            1998   2088 	PUSH	H
0a60  2a 89 03      1999   2089 	LHLD	CURLINE		;SAVE CURRENT LINE NUMBER
0a63  e3            2000   2090 	XTHL
0a64  cd b9 03      2001   2091 	CALL	SCANNXTV	;bscan (val)
0a67  a1            2002   2092 	DB	KEYTO		;SCAN LIMIT VALUE,
0a68  cd 07 0c      2003   2093 	CALL	VALNUMBR	;bscan numbr
0a6b  e5            2004   2094 	PUSH	H
0a6c  cd de 1b      2005   2095 	CALL	LDRGAC
0a6f  e1            2006   2096 	POP	H
0a70  c5            2007   2097 	PUSH	B		;SAVE ON STACK
0a71  d5            2008   2098 	PUSH	D
0a72  01 00 81      2009   2099 	LXI	B,08100H	;LOAD DEFAULT STEP=1.0
0a75  51            2010   2100 	MOV	D,C
0a76  5a            2011   2101 	MOV	E,D
0a77  7e            2012   2102 	MOV	A,M
0a78  fe a2         2013   2103 	CPI	KEYSTEP		;CHECK FOR EXPLICIT STEP SIZE
0a7a  3e 01         2014   2104 	MVI	A,001H
0a7c  c2 8d 0a      2015   2105 	JNZ	FORSTMST
0a7f  cd c1 03      2016   2106 	CALL	SCANNXT		;bscan +
0a82  cd 07 0c      2017   2107 	CALL	VALNUMBR	;bscan numbr
0a85  e5            2018   2108 	PUSH	H
0a86  cd de 1b      2019   2109 	CALL	LDRGAC
0a89  e1            2020   2110 	POP	H
0a8a  cd 7e 1c      2021   2111 	CALL	SIGNACC
0a8d                2022   2112 FORSTMST:
0a8d  c5            2023   2113 	PUSH	B		;SAVE STEP SIZE ON STACK
0a8e  d5            2024   2114 	PUSH	D
0a8f  f5            2025   2115 	PUSH	PSW		;SAVE DIRECTION
0a90  33            2026   2116 	INX	SP
0a91  e5            2027   2117 	PUSH	H
0a92  2a 8d 03      2028   2118 	LHLD	VARINDEX	;SAVE INDEX VARIABLE
0a95  e3            2029   2119 	XTHL
0a96                2030   2120 FORMARK:
0a96  06 83         2031   2121 	MVI	B,KEYFOR	;MARK STACK WITH 'FOR'
0a98  c5            2032   2122 	PUSH	B
0a99  33            2033   2123 	INX	SP
                    2034   2124
                    2035   2125 ;
                    2036   2126 ;  Page 46
                    2037   2127 ;
                    2038   2128
                    2039   2129 ;
                    2040   2130 ;  INTERPRETER EXECUTIVE
                    2041   2131 ;
0a9a                2042   2132 EXECUTEL:
0a9a  cd dd 0a      2043   2133 	CALL	BREAKCHK	;USER HAVE ANY COMMENTS?
0a9d  22 8d 03      2044   2134 	SHLD	PROGCNTR
0aa0  7e            2045   2135 	MOV	A,M
0aa1  fe 3a         2046   2136 	CPI	':'
0aa3  ca ba 0a      2047   2137 	JZ	EXECUTE		;MUTIPLE STATEMENTS ON LINE?
0aa6  b7            2048   2138 	ORA	A
0aa7  c2 05 06      2049   2139 	JNZ	ERRASN
0aaa  23            2050   2140 	INX	H		;END OF LINE,
0aab  7e            2051   2141 	MOV	A,M
0aac  23            2052   2142 	INX	H
0aad  b6            2053   2143 	ORA	M
0aae  23            2054   2144 	INX	H
0aaf  ca e6 0a      2055   2145 	JZ	ENDPROGM	;END OF PROGRAM?
0ab2  5e            2056   2146 	MOV	E,M
0ab3  23            2057   2147 	INX	H
0ab4  56            2058   2148 	MOV	D,M
0ab5  eb            2059   2149 	XCHG
0ab6  22 89 03      2060   2150 	SHLD	CURLINE		;MOVE TO NEXT LINE
0ab9  eb            2061   2151 	XCHG
0aba                2062   2152 EXECUTE:
0aba  cd c1 03      2063   2153 	CALL	SCANNXT		;bscan ,  ;EXECUTE STATEMENT
0abd  11 9a 0a      2064   2154 	LXI	D,EXECUTEL
0ac0  d5            2065   2155 	PUSH	D
0ac1                2066   2156 EXECUTEC:
0ac1  c8            2067   2157 	RZ
0ac2                2068   2158 EXECUTES:
0ac2  fe 80         2069   2159 	CPI	KEYSTM		;WHAT KIND OF STATEMENT?
0ac4  da c0 0b      2070   2160 	JC	LETSTM
0ac7  fe a0         2071   2161 	CPI	KEYSUGR
0ac9  d2 53 0c      2072   2162 	JNC	EXECUTE2
0acc  87            2073   2163 	ADD	A
0acd  4f            2074   2164 	MOV	C,A
0ace  06 00         2075   2165 	MVI	B,000H
0ad0  eb            2076   2166 	XCHG
0ad1  21 64 00      2077   2167 	LXI	H,STMTABL
0ad4  09            2078   2168 	DAD	B
0ad5  4e            2079   2169 	MOV	C,M
0ad6  23            2080   2170 	INX	H
0ad7  46            2081   2171 	MOV	B,M
0ad8  c5            2082   2172 	PUSH	B
0ad9  eb            2083   2173 	XCHG
0ada  c3 c1 03      2084   2174 	JMP	SCANNXT
                    2085   2175
                    2086   2176 ;
                    2087   2177 ;  Page 47
                    2088   2178 ;
                    2089   2179
0add                2090   2180 BREAKCHK:
0add  cd 54 00      2091   2181 	CALL	SYSBREAK	;TIME TO TAKE A BREAK?
0ae0                2092   2182 STPSTM:
0ae0  c0            2093   2183 	RNZ			;STOP STATEMENT
0ae1  3c            2094   2184 	INR	A
0ae2                2095   2185 EXECUTEB:
0ae2  22 8d 03      2096   2186 	SHLD	PROGCNTR
0ae5                2097   2187 INPSTMBR:
0ae5  c1            2098   2188 	POP	B		;THROW AWAY CALLER
0ae6                2099   2189 ENDPROGM:
0ae6  f5            2100   2190 	PUSH	PSW
0ae7  2a 89 03      2101   2191 	LHLD	CURLINE
0aea  7d            2102   2192 	MOV	A,L
0aeb  a4            2103   2193 	ANA	H
0aec  3c            2104   2194 	INR	A
0aed  ca f9 0a      2105   2195 	JZ	ENDSTMC
0af0  22 8b 03      2106   2196 	SHLD	CURLINES	;SAVE INFORMATION FOR CONTINUE
0af3  2a 8d 03      2107   2197 	LHLD	PROGCNTR
0af6  22 8f 03      2108   2198 	SHLD	PROGCNTS
0af9                2109   2199 ENDSTMC:
0af9  af            2110   2200 	XRA	A
0afa  32 7b 03      2111   2201 	STA	PRINTFLG
0afd  f1            2112   2202 	POP	PSW
0afe  21 f7 05      2113   2203 	LXI	H,MSGBREAK
0b01  c2 23 06      2114   2204 	JNZ	ERRMSGPR
0b04  c3 2f 06      2115   2205 	JMP	CMNDSTRT
                    2116   2206
0b07                2117   2207 CONSTM:
0b07  c0            2118   2208 	RNZ			;CONT COMMAND
0b08  1e 00         2119   2209 	MVI	E,ERRNCN-ERRN
0b0a  2a 8f 03      2120   2210 	LHLD	PROGCNTS
0b0d  7c            2121   2211 	MOV	A,H
0b0e  b5            2122   2212 	ORA	L
0b0f  ca 07 06      2123   2213 	JZ	ERRMSG
0b12  eb            2124   2214 	XCHG
0b13  2a 8b 03      2125   2215 	LHLD	CURLINES
0b16  22 89 03      2126   2216 	SHLD	CURLINE
0b19  eb            2127   2217 	XCHG
0b1a  c9            2128   2218 	RET
                    2129   2219
0b1b                2130   2220 RUNSTM:
0b1b  ca 18 05      2131   2221 	JZ	CLEARSET	;RUN COMMAND
0b1e  cd 1b 05      2132   2222 	CALL	CLEARVST
0b21  01 9a 0a      2133   2223 	LXI	B,EXECUTEL
0b24  c3 41 0b      2134   2224 	JMP	RUNSTMC
                    2135   2225
0b27                2136   2226 ENDSTM:
0b27  ca e2 0a      2137   2227 	JZ	EXECUTEB	;END STATEMENT
0b2a  cd b9 03      2138   2228 	CALL	SCANNXTV	;bscan (val)
0b2d  8a            2139   2229 	DB	KEYRUN
0b2e  c3 61 00      2140   2230 	JMP	SYSQUIT
                    2141   2231
                    2142   2232 ;
                    2143   2233 ;  Page 48
                    2144   2234 ;
                    2145   2235
                    2146   2236 ;
                    2147   2237 ;  GOSUB/GOTO STATEMENTS
                    2148   2238 ;
0b31                2149   2239 GSBSTM:
0b31  0e 03         2150   2240 	MVI	C,3		;GOSUB STATEMENT
0b33  cd ee 04      2151   2241 	CALL	SPACESTK
0b36  c1            2152   2242 	POP	B
0b37  e5            2153   2243 	PUSH	H
0b38  e5            2154   2244 	PUSH	H
0b39  2a 89 03      2155   2245 	LHLD	CURLINE
0b3c  e3            2156   2246 	XTHL
0b3d  16 8e         2157   2247 	MVI	D,KEYGSB	;MARK STACK WITH GOSUB
0b3f  d5            2158   2248 	PUSH	D
0b40  33            2159   2249 	INX	SP
0b41                2160   2250 RUNSTMC:
0b41  c5            2161   2251 	PUSH	B
0b42                2162   2252 GTOSTM:
0b42  cd 21 04      2163   2253 	CALL	SCANLINN	;GOTO STATEMENT
0b45  d5            2164   2254 	PUSH	D
0b46  cd 84 0b      2165   2255 	CALL 	REMSTM
0b49  d1            2166   2256 	POP	D
0b4a  e5            2167   2257 	PUSH	H
0b4b  cd 9f 0b      2168   2258 	CALL	TRACE
0b4e  2a 89 03      2169   2259 	LHLD	CURLINE
0b51  cd d7 04      2170   2260 	CALL	CMHLLTDE
0b54  e1            2171   2261 	POP	H
0b55  23            2172   2262 	INX	H
0b56  dc 49 04      2173   2263 	CC	LINESRCL
0b59  d4 46 04      2174   2264 	CNC	LINESRCH
0b5c  60            2175   2265 	MOV	H,B
0b5d  69            2176   2266 	MOV	L,C
0b5e  2b            2177   2267 	DCX	H
0b5f  d8            2178   2268 	RC
0b60                2179   2269 ERRAUS:
0b60  1e c5         2180   2270 	MVI	E,ERRNUS-ERRN
0b62  c3 07 06      2181   2271 	JMP	ERRMSG
                    2182   2272
                    2183   2273 ;
                    2184   2274 ;  RETURN STATEMENT
                    2185   2275 ;
0b65                2186   2276 RETSTM:
0b65  c0            2187   2277 	RNZ			;RETURN STATEMENT
0b66  16 ff         2188   2278 	MVI	D,0FFH
0b68  cd 0f 0a      2189   2279 	CALL	FORCHK		;KILL ACTIVE FOR LOOPS
0b6b  f9            2190   2280 	SPHL			;INSIDE SUBROUTINE
0b6c  fe 8e         2191   2281 	CPI	KEYGSB
0b6e  1e 76         2192   2282 	MVI	E,ERRNRG-ERRN
0b70  c2 07 06      2193   2283 	JNZ	ERRMSG
0b73  d1            2194   2284 	POP	D
0b74  cd 9f 0b      2195   2285 	CALL	TRACE
0b77  eb            2196   2286 	XCHG
0b78  22 89 03      2197   2287 	SHLD	CURLINE
0b7b  21 9a 0a      2198   2288 	LXI	H,EXECUTEL
0b7e  e3            2199   2289 	XTHL
                    2200   2290 ;	JMP	DATSTM
                    2201   2291
                    2202   2292 ;
                    2203   2293 ;  Page 49
                    2204   2294 ;
                    2205   2295
                    2206   2296 ;
                    2207   2297 ;  DATA/ELSE/REM STATEMENTS
                    2208   2298 ;
0b7f                2209   2299 DATSTM:
0b7f  0e 3a         2210   2300 	MVI	C,':'		;DATA STATEMENT
0b81  c3 86 0b      2211   2301 	JMP	SCAN2KEY
0b84                2212   2302 ELSSTM:
                    2213   2303
0b84                2214   2304 REMSTM:
0b84  0e 00         2215   2305 	MVI	C,000H		;REM STATEMENT
0b86                2216   2306 SCAN2KEY:
0b86  06 00         2217   2307 	MVI	B,000H		;SKIP TO KEYWORD IN C
0b88                2218   2308 DATRSKST:
0b88  79            2219   2309 	MOV	A,C		;SET UP TERMINATING BYTE
0b89  48            2220   2310 	MOV	C,B
0b8a  47            2221   2311 	MOV	B,A
0b8b                2222   2312 DATRSKIP:
0b8b  7e            2223   2313 	MOV	A,M		;SKIP TO TERMINATING BYTE
0b8c  b7            2224   2314 	ORA	A
0b8d  c8            2225   2315 	RZ
0b8e  b8            2226   2316 	CMP	B
0b8f  c8            2227   2317 	RZ
0b90  23            2228   2318 	INX	H
0b91  fe 22         2229   2319 	CPI	'"'		;STRING TO SKIP?
0b93  ca 88 0b      2230   2320 	JZ	DATRSKST
0b96  fe 8b         2231   2321 	CPI	KEYIF
0b98  c2 8b 0b      2232   2322 	JNZ	DATRSKIP
0b9b  14            2233   2323 	INR	D		;COUNT NUMBER OF IFS WE SKIP
0b9c  c3 8b 0b      2234   2324 	JMP	DATRSKIP
                    2235   2325
                    2236   2326 ;
                    2237   2327 ;  PROGRAM BRANCH TRACING
                    2238   2328 ;
0b9f                2239   2329 TRACE:
0b9f  3a 7c 03      2240   2330 	LDA	TRACEFLG	;TRACING?
0ba2  b7            2241   2331 	ORA	A
0ba3  c0            2242   2332 	RNZ
0ba4  c5            2243   2333 	PUSH	B
0ba5  d5            2244   2334 	PUSH	D		;SAVE DESTINATION LINE NUMBER
0ba6  cd aa 05      2245   2335 	CALL	PRNTCHRI	;print (val)
0ba9  5b            2246   2336 	DB	'['		;LEFT BRACKET
0baa  2a 89 03      2247   2337 	LHLD	CURLINE
0bad  cd 79 1d      2248   2338 	CALL	PRINTINT	;PRINT CURRENT LINE NUMBER
0bb0  cd aa 05      2249   2339 	CALL	PRNTCHRI	;print (val)
0bb3  2c            2250   2340 	DB	','
0bb4  e1            2251   2341 	POP	H
0bb5  e5            2252   2342 	PUSH	H
0bb6  cd 79 1d      2253   2343 	CALL	PRINTINT	;PRINT DESTINATION LINE NUMBER
0bb9  cd aa 05      2254   2344 	CALL	PRNTCHRI	;print (val)
0bbc  5d            2255   2345 	DB	']'		;RIGHT BRACKET
0bbd                2256   2346 POPDEBCR:
0bbd  d1            2257   2347 	POP	D
0bbe  c1            2258   2348 	POP	B
0bbf  c9            2259   2349 	RET
                    2260   2350
                    2261   2351 ;
                    2262   2352 ;  Page 50
                    2263   2353 ;
                    2264   2354
                    2265   2355 ;
                    2266   2356 ;  ASSIGNMENT STATEMENT PROCESSOR
                    2267   2357 ;
0bc0                2268   2358 LETSTM:
0bc0  cd 48 12      2269   2359 	CALL	VARSCAN		;LET STATEMENT
0bc3  cd b9 03      2270   2360 	CALL	SCANNXTV	;bscan (val)
0bc6  b5            2271   2361 	DB	KEYEQ
0bc7                2272   2362 ASSIGNVL:
0bc7  3a 81 03      2273   2363 	LDA	TYPEFLG
0bca  f5            2274   2364 	PUSH	PSW
0bcb  d5            2275   2365 	PUSH	D
0bcc  cd a9 0f      2276   2366 	CALL	VALEXPR		;bscan expr
0bcf  d1            2277   2367 	POP	D
0bd0  f1            2278   2368 	POP	PSW
0bd1                2279   2369 ASSIGN:
0bd1  eb            2280   2370 	XCHG			;MAKE THE ASSIGMENT
0bd2  d5            2281   2371 	PUSH	D		;SAVE SCAN
0bd3  e5            2282   2372 	PUSH	H		;SAVE VARIABLE
0bd4  cd fb 0b      2283   2373 	CALL	COERCE
0bd7  c2 e6 0b      2284   2374 	JNZ	LETSTMNM
0bda  cd ec 0b      2285   2375 	CALL	STRGUNIQ	;REMOVE CONFLICT PROBLEMS
0bdd  cd dd 11      2286   2376 	CALL	STRGRELT	;RELEASE STRING TEMPORARY
0be0  e1            2287   2377 	POP	H		;COPY DESCRIPTOR TO DESTINATION
0be1  cd ed 1b      2288   2378 	CALL	COPYVAL
0be4  e1            2289   2379 	POP	H
0be5  c9            2290   2380 	RET
                    2291   2381
0be6                2292   2382 LETSTMNM:
0be6  cd ea 1b      2293   2383 	CALL	LDMMAC		;MAKE NUMERIC ASSIGNMENT
0be9  d1            2294   2384 	POP	D
0bea  e1            2295   2385 	POP	H
0beb  c9            2296   2386 	RET
                    2297   2387
0bec                2298   2388 STRGUNIQ:
0bec  2a a9 03      2299   2389 	LHLD	ACCUMLTR	;GET STRING DESCRIPTOR
0bef  eb            2300   2390 	XCHG			;IS STRING IN STRING SPACE?
0bf0  cd c3 0c      2301   2391 	CALL	STRGTEST
0bf3  d0            2302   2392 	RNC
0bf4  cd d7 04      2303   2393 	CALL	CMHLLTDE	;VARIABLE REFERENCE?
0bf7  d4 7d 16      2304   2394 	CNC	STRGSTOR	;IF SO, MAKE NEW COPY
0bfa  c9            2305   2395 	RET
                    2306   2396
                    2307   2397 ;
                    2308   2398 ;  Page 51
                    2309   2399 ;
                    2310   2400
                    2311   2401 ;
                    2312   2402 ;  COERCE ACCUMULATOR TO TYPE IN A
                    2313   2403 ;
0bfb                2314   2404 COERCE:
0bfb  cd f2 03      2315   2405 	CALL	TYPECHKA
0bfe                2316   2406 COERCEF:
0bfe  e2 0a 0c      2317   2407 	JPO	CSINGLE
0c01  ca 11 0c      2318   2408 	JZ	CSTRING
0c04  c3 18 0c      2319   2409 	JMP	ERRATM
                    2320   2410
0c07                2321   2411 VALNUMBR:
0c07  cd a9 0f      2322   2412 	CALL	VALEXPR		;bscan expr
0c0a                2323   2413 CSINGLE:
0c0a  cd ef 03      2324   2414 	CALL	TYPECHK
0c0d  e0            2325   2415 	RPO
0c0e  c3 18 0c      2326   2416 	JMP	ERRATM
                    2327   2417
0c11                2328   2418 CSTRING:
0c11  cd ef 03      2329   2419 	CALL	TYPECHK
0c14  c8            2330   2420 	RZ
0c15  c3 18 0c      2331   2421 	JMP	ERRATM
                    2332   2422
0c18                2333   2423 ERRATM:
0c18  1e b0         2334   2424 	MVI	E,ERRNTM-ERRN
0c1a  c3 07 06      2335   2425 	JMP	ERRMSG
                    2336   2426
0c1d                2337   2427 VALINTDE:
0c1d  cd 07 0c      2338   2428 	CALL	VALNUMBR	;bscan numbr EVAL POSITIVE INTEGER EXPR
0c20                2339   2429 CINTPOS:
0c20  cd 7e 1c      2340   2430 	CALL	SIGNACC		;CONVERT TO INTEGER
0c23  fa 39 0c      2341   2431 	JM	ERRAFC
0c26                2342   2432 CINTEGER:
0c26  3a ac 03      2343   2433 	LDA	FLACCEXP
0c29  fe 90         2344   2434 	CPI	090H
0c2b  da 3c 1c      2345   2435 	JC	FIXAC
0c2e  01 80 90      2346   2436 	LXI	B,09080H
0c31  11 00 00      2347   2437 	LXI	D,00000H
0c34  cd 0f 1c      2348   2438 	CALL	FLCMP
0c37  51            2349   2439 	MOV	D,C
0c38  c8            2350   2440 	RZ
                    2351   2441
0c39                2352   2442 ERRAFC:
0c39  1e 2d         2353   2443 	MVI	E,ERRNFC-ERRN
0c3b  c3 07 06      2354   2444 	JMP	ERRMSG
                    2355   2445
0c3e                2356   2446 VALBYTE2:
0c3e  cd b9 03      2357   2447 	CALL	SCANNXTV	;bscan (val)
0c41  2c            2358   2448 	DB	','		;EVAL LATER BYTE ARGUMENTS
0c42                2359   2449 VALBYTE:
0c42  cd 07 0c      2360   2450 	CALL	VALNUMBR	;bscan numbr EVAL BYTE EXPRESSION
0c45                2361   2451 CBYTE:
0c45  cd 20 0c      2362   2452 	CALL	CINTPOS		;CONVERT ACC TO BYTE
0c48  7a            2363   2453 	MOV	A,D
0c49  b7            2364   2454 	ORA	A
0c4a  c2 39 0c      2365   2455 	JNZ	ERRAFC
                    2366   2456
                    2367   2457 ;
                    2368   2458 ;  Page 52
                    2369   2459 ;
                    2370   2460
0c4d  2b            2371   2461 	DCX	H
0c4e  cd c1 03      2372   2462 	CALL	SCANNXT		;bscan ,
0c51  7b            2373   2463 	MOV	A,E
0c52  c9            2374   2464 	RET
                    2375   2465
0c53                2376   2466 EXECUTE2:
0c53  fe c4         2377   2467 	CPI	KEYPORT		;PORT OUTPUT?
0c55  ca 2f 18      2378   2468 	JZ	PORSTM
0c58  fe c6         2379   2469 	CPI	KEYMEM		;MEMORY ALTERATION?
0c5a  ca 0d 18      2380   2470 	JZ	MEMSTM
                    2381   2471
                    2382   2472 ;
                    2383   2473 ;  MID-STRING ASSIGNMENT STATEMENT
                    2384   2474 ;
0c5d                2385   2475 MIDSTM:
0c5d  cd b9 03      2386   2476 	CALL	SCANNXTV	;bscan (val)
0c60  d1            2387   2477 	DB	KEYMID		;ENTER POINTING TO 'MID$'
0c61  cd b9 03      2388   2478 	CALL	SCANNXTV	;bscan (val)
0c64  28            2389   2479 	DB	'('
0c65  cd 48 12      2390   2480 	CALL	VARSCAN		;SCAN VARIABLE TO UPDATE
0c68  cd 11 0c      2391   2481 	CALL	CSTRING		;MAKE SURE IT'S A STRING
0c6b  d5            2392   2482 	PUSH	D		;SAVE REFERENCE
0c6c  e5            2393   2483 	PUSH	H
0c6d  cd c3 0c      2394   2484 	CALL	STRGTEST	;WHERE IS STRING NOW?
0c70  d5            2395   2485 	PUSH	D		;SHOULDN'T BE IN PROGRAM
0c71  d4 7d 16      2396   2486 	CNC	STRGSTOR	;OR ELSE WE MODIFY OURSELF
0c74  e1            2397   2487 	POP	H
0c75  cd ed 1b      2398   2488 	CALL	COPYVAL
0c78  e1            2399   2489 	POP	H		;CONTINUE SCAN
0c79  cd 3e 0c      2400   2490 	CALL	VALBYTE2	;SCAN STARTING POSITION
0c7c  b7            2401   2491 	ORA	A
0c7d  ca 39 0c      2402   2492 	JZ	ERRAFC		;MUST BE NON-ZERO
0c80  d5            2403   2493 	PUSH	D
0c81  1e ff         2404   2494 	MVI	E,0FFH
0c83  7e            2405   2495 	MOV	A,M
0c84  fe 29         2406   2496 	CPI	')'		;DEFAULT LENGTH?
0c86  c4 3e 0c      2407   2497 	CNZ	VALBYTE2	;SCAN LENGTH, IF GIVEN
0c89  cd b9 03      2408   2498 	CALL	SCANNXTV	;bscan (val)
0c8c  29            2409   2499 	DB	')'
0c8d  c1            2410   2500 	POP	B		;CONDENSE STACK
0c8e  51            2411   2501 	MOV	D,C
0c8f  d5            2412   2502 	PUSH	D
0c90  cd b9 03      2413   2503 	CALL	SCANNXTV	;bscan (val)
0c93  b5            2414   2504 	DB	KEYEQ
0c94  cd a9 0f      2415   2505 	CALL	VALEXPR		;bscan expr  ;EVALUATE RIGHT HAND SIDE
0c97  22 85 03      2416   2506 	SHLD	SCANPTR1
0c9a  cd 27 16      2417   2507 	CALL	LENFCTC		;RELEASE STRING RESOURCE
0c9d  4e            2418   2508 	MOV	C,M		;AND LOAD DESCRIPTOR
0c9e  23            2419   2509 	INX	H
0c9f  46            2420   2510 	MOV	B,M
0ca0  d1            2421   2511 	POP	D		;GET BACK LENGTH, START
0ca1  bb            2422   2512 	CMP	E
0ca2  d2 a6 0c      2423   2513 	JNC	MIDSTMLN	;LENMOV = MIN(LENI, LENS)
0ca5  5f            2424   2514 	MOV	E,A
0ca6                2425   2515 MIDSTMLN:
0ca6  e1            2426   2516 	POP	H		;RECOVER DESTINATION DESCRIPTOR
                    2427   2517
                    2428   2518 ;
                    2429   2519 ;  Page 53
                    2430   2520 ;
                    2431   2521
0ca7  7e            2432   2522 	MOV	A,M		;GET ITS LENGTH
0ca8  15            2433   2523 	DCR	D
0ca9  92            2434   2524 	SUB	D		;SUBTRACT STARTING POSITION
0caa  da bf 0c      2435   2525 	JC	MIDSTMXT	;NOTHING TO DO IF BEYOND
                    2436   2526
                    2437   2527 ;
                    2438   2528 ;  Page 54
                    2439   2529 ;
                    2440   2530
0cad  bb            2441   2531 	CMP	E
0cae  d2 b2 0c      2442   2532 	JNC	MIDSTMLM
0cb1  5f            2443   2533 	MOV	E,A
0cb2                2444   2534 MIDSTMLM:
0cb2  c5            2445   2535 	PUSH	B		;SAVE SOURCE ADDRESS
0cb3  cd e4 1b      2446   2536 	CALL	LDICBMM		;COMPUTE DESTINATION ADDRESS
0cb6  6a            2447   2537 	MOV	L,D
0cb7  26 00         2448   2538 	MVI	H,0
0cb9  09            2449   2539 	DAD	B
0cba  eb            2450   2540 	XCHG
0cbb  c1            2451   2541 	POP	B
0cbc  cd 2c 12      2452   2542 	CALL	COPYSTRG	;COPY STRING
0cbf                2453   2543 MIDSTMXT:
0cbf  2a 85 03      2454   2544 	LHLD	SCANPTR1
0cc2  c9            2455   2545 	RET
                    2456   2546
                    2457   2547 ;
                    2458   2548 ;  LOCATE STRING REFERENCE BY DE
                    2459   2549 ;
0cc3                2460   2550 STRGTEST:
0cc3  d5            2461   2551 	PUSH	D		;DE=STRING REFERENCE
0cc4  eb            2462   2552 	XCHG
0cc5  23            2463   2553 	INX	H		;GET ADDRESS OF STRING
0cc6  5e            2464   2554 	MOV	E,M
0cc7  23            2465   2555 	INX	H
0cc8  56            2466   2556 	MOV	D,M
0cc9  2a 9d 03      2467   2557 	LHLD	FREELIMT	;BOUNDARY
0ccc  cd d7 04      2468   2558 	CALL	CMHLLTDE	;NC = STRING IN PROGRAM
0ccf  d1            2469   2559 	POP	D		;C = STRIN IN BUFFER
0cd0  c9            2470   2560 	RET			;OR STRING SPACE
                    2471   2561
                    2472   2562 ;
                    2473   2563 ;  Page 55
                    2474   2564 ;
                    2475   2565
                    2476   2566 ;
                    2477   2567 ;  CASE/CONDITINAL STATEMENT PROCESSORS
                    2478   2568 ;
0cd1                2479   2569 ONSTM:
0cd1  cd 42 0c      2480   2570 	CALL	VALBYTE		;ON STATEMENT
0cd4  7e            2481   2571 	MOV	A,M
0cd5  47            2482   2572 	MOV	B,A
0cd6  fe 8e         2483   2573 	CPI	KEYGSB		;GOSUB RATHER THAN GOTO?
0cd8  ca e0 0c      2484   2574 	JZ	ONNSTMC
0cdb  cd b9 03      2485   2575 	CALL	SCANNXTV	;bscan (val)
0cde  89            2486   2576 	DB	KEYGTO		;MUST BE GOTO...
0cdf  2b            2487   2577 	DCX	H
0ce0                2488   2578 ONNSTMC:
0ce0  4b            2489   2579 	MOV	C,E
0ce1                2490   2580 ONNSTMSL:
0ce1  0d            2491   2581 	DCR	C		;LOOK FOR RIGHT LINE NUMBER
0ce2  78            2492   2582 	MOV	A,B
0ce3  ca c2 0a      2493   2583 	JZ	EXECUTES	;THEN EXECUTE STATEMENT
0ce6  cd 22 04      2494   2584 	CALL	SCANLINR
0ce9  fe 2c         2495   2585 	CPI	','
0ceb  c0            2496   2586 	RNZ
0cec  c3 e1 0c      2497   2587 	JMP	ONNSTMSL
                    2498   2588
                    2499   2589
                    2500   2590
0cef                2501   2591 IFSTM:
0cef  cd 07 0c      2502   2592 	CALL	VALNUMBR	;bscan numbr  ;IF STATEMENT
0cf2  7e            2503   2593 	MOV	A,M
0cf3  fe 89         2504   2594 	CPI	KEYGTO
0cf5  ca fc 0c      2505   2595 	JZ	IFNSTMC
0cf8  cd b9 03      2506   2596 	CALL	SCANNXTV	;bscan (val)
0cfb  a0            2507   2597 	DB	KEYTHEN
0cfc                2508   2598 IFNSTMC:
0cfc  cd 7e 1c      2509   2599 	CALL	SIGNACC		;TEST CONDITION
0cff  c2 12 0d      2510   2600 	JNZ	IFNSTMCH
0d02  16 01         2511   2601 	MVI	D,1
0d04                2512   2602 IFNSTMSK:
0d04  0e 8c         2513   2603 	MVI	C,KEYELS
0d06  cd 86 0b      2514   2604 	CALL	SCAN2KEY	;SKIP TO CORRESPONDING ELSE
0d09  b7            2515   2605 	ORA	A
0d0a  c8            2516   2606 	RZ			;OR END OF LINE
0d0b  cd c1 03      2517   2607 	CALL	SCANNXT		;bscan +
0d0e  15            2518   2608 	DCR	D
0d0f  c2 04 0d      2519   2609 	JNZ	IFNSTMSK
0d12                2520   2610 IFNSTMCH:
0d12  2b            2521   2611 	DCX	H		;bscan -
0d13  cd c1 03      2522   2612 	CALL	SCANNXT		;bscan ,  ;CHOICE MADE
0d16  da 42 0b      2523   2613 	JC	GTOSTM		;GOTO A LABEL,
0d19  c3 c1 0a      2524   2614 	JMP	EXECUTEC	;OR EXECUTE A STATEMENT
                    2525   2615
                    2526   2616 ;
                    2527   2617 ; Page 56
                    2528   2618 ;
                    2529   2619
                    2530   2620 ;
                    2531   2621 ;  PRINT STATEMENT PROCESSOR
                    2532   2622 ;
0d1c                2533   2623 PRTSTMN:
0d1c  fe a5         2534   2624 	CPI	KEYTAB		;TAB OPTION?
0d1e  ca 8c 0d      2535   2625 	JZ	PRNTOPTN
0d21  fe a6         2536   2626 	CPI	KEYSPC		;SPACE OPTION
0d23  ca 8c 0d      2537   2627 	JZ	PRNTOPTN
0d26  e5            2538   2628 	PUSH	H
0d27  fe 2c         2539   2629 	CPI	','
0d29  ca 78 0d      2540   2630 	JZ	PRNTCOMA
0d2c  fe 3b         2541   2631 	CPI	';'
0d2e  ca b9 0d      2542   2632 	JZ	PRNTSEMI
0d31  c1            2543   2633 	POP	B
0d32  cd a9 0f      2544   2634 	CALL	VALEXPR		;bscan expr
0d35  2b            2545   2635 	DCX	H		;bscan -
0d36  e5            2546   2636 	PUSH	H
0d37  cd ef 03      2547   2637 	CALL	TYPECHK
0d3a  ca 55 0d      2548   2638 	JZ	PRTSTRNG
0d3d  cd 5f 11      2549   2639 	CALL	VALSTRGN	;CREATE STRING FROM NUMBER
0d40  2a a9 03      2550   2640 	LHLD	ACCUMLTR	;VERIFY ROOM ENOUGH ON LINE
0d43  7e            2551   2641 	MOV	A,M
0d44  21 af 03      2552   2642 	LXI	H,CURSPOS
0d47  86            2553   2643 	ADD	M
0d48  23            2554   2644 	INX	H
0d49  86            2555   2645 	ADD	M
0d4a  dc 5f 0d      2556   2646 	CC	PRNTCRLF	;NO ROOM, FIND ANOTHER LINE
0d4d  cd cb 0d      2557   2647 	CALL	PRNTSTRT
0d50  cd aa 05      2558   2648 	CALL	PRNTCHRI	;print (val)
0d53  20            2559   2649 	DB	' '
0d54  3c            2560   2650 	INR	A
0d55                2561   2651 PRTSTRNG:
0d55  cc cb 0d      2562   2652 	CZ	PRNTSTRT	;SEND OUTPUT STRING
0d58  e1            2563   2653 	POP	H
0d59  cd c1 03      2564   2654 	CALL	SCANNXT		;bscan ,
0d5c                2565   2655 PRTSTM:
0d5c  c2 1c 0d      2566   2656 	JNZ	PRTSTMN		;PRINT STATEMENT
0d5f                2567   2657 PRNTCRLF:
0d5f  cd aa 05      2568   2658 	CALL	PRNTCHRI	;print (val)
0d62  0d            2569   2659 	DB	CR		;PRINT A CR, LF
0d63  cd aa 05      2570   2660 	CALL	PRNTCHRI	;print (val)
0d66  0a            2571   2661 	DB	LF
0d67                2572   2662 PRNTNULS:
0d67  3a ae 03      2573   2663 	LDA	NULLCNT		;PRINT NULLS AFTER CR
0d6a                2574   2664 PRNTNULL:
0d6a  3d            2575   2665 	DCR	A
0d6b  32 af 03      2576   2666 	STA	CURSPOS
0d6e  c8            2577   2667 	RZ
0d6f  f5            2578   2668 	PUSH	PSW
0d70  af            2579   2669 	XRA	A
0d71  cd ae 05      2580   2670 	CALL	PRNTCHRA	;ac -> screen
0d74  f1            2581   2671 	POP	PSW
0d75  c3 6a 0d      2582   2672 	JMP	PRNTNULL
                    2583   2673
                    2584   2674 ;
                    2585   2675 ;  Page 57
                    2586   2676 ;
                    2587   2677
0d78                2588   2678 PRNTCOMA:
0d78  3a af 03      2589   2679 	LDA	CURSPOS		;COMMA SEPARATOR
0d7b  fe 8c         2590   2680 	CPI	((LINESYZE/ITEMSIZE)-1)*ITEMSIZE
0d7d  d4 5f 0d      2591   2681 	CNC	PRNTCRLF
0d80  d2 b9 0d      2592   2682 	JNC	PRNTSEMI
0d83                2593   2683 PRNTCOML:
0d83  d6 0e         2594   2684 	SUI	ITEMSIZE
0d85  d2 83 0d      2595   2685 	JNC	PRNTCOML
0d88  2f            2596   2686 	CMA
0d89  c3 aa 0d      2597   2687 	JMP	PRNTCOMC
                    2598   2688
0d8c                2599   2689 PRNTOPTN:
0d8c  f5            2600   2690 	PUSH	PSW
0d8d  cd c1 03      2601   2691 	CALL	SCANNXT		;bscan +
0d90  cd bc 10      2602   2692 	CALL	VALPARNS	;GET OPTION PARAMETER
0d93  cd 0a 0c      2603   2693 	CALL	CSINGLE
0d96  cd 45 0c      2604   2694 	CALL	CBYTE
0d99  2b            2605   2695 	DCX	H
0d9a  f1            2606   2696 	POP	PSW
0d9b  fe a6         2607   2697 	CPI	KEYSPC
0d9d  e5            2608   2698 	PUSH	H
0d9e  7b            2609   2699 	MOV	A,E
0d9f  ca ab 0d      2610   2700 	JZ	PRNTBLNK
0da2  3a af 03      2611   2701 	LDA	CURSPOS
0da5  2f            2612   2702 	CMA
0da6  83            2613   2703 	ADD	E
0da7  d2 b9 0d      2614   2704 	JNC	PRNTSEMI
0daa                2615   2705 PRNTCOMC:
0daa  3c            2616   2706 	INR	A
0dab                2617   2707 PRNTBLNK:
0dab  47            2618   2708 	MOV	B,A		;PAD OUTPUT WITH A BLANKS
0dac  b7            2619   2709 	ORA	A
0dad  ca b9 0d      2620   2710 	JZ	PRNTSEMI
0db0  3e 20         2621   2711 	MVI	A,' '
0db2                2622   2712 PRNTBLNL:
0db2  cd ae 05      2623   2713 	CALL	PRNTCHRA	;ac -> screen
0db5  05            2624   2714 	DCR	B
0db6  c2 b2 0d      2625   2715 	JNZ	PRNTBLNL
0db9                2626   2716 PRNTSEMI:
0db9  e1            2627   2717 	POP	H
0dba  cd c1 03      2628   2718 	CALL	SCANNXT		;bscan ,
0dbd  c8            2629   2719 	RZ
0dbe  c3 1c 0d      2630   2720 	JMP	PRTSTMN
                    2631   2721
                    2632   2722 ;
                    2633   2723 ;  Page 58
                    2634   2724 ;
                    2635   2725
0dc1                2636   2726 PRNTNUMS:
0dc1  23            2637   2727 	INX	H		;SEND STRING TO TRANSMITTER
0dc2                2638   2728 PRNTMSG:
0dc2  c5            2639   2729 	PUSH	B
0dc3  d5            2640   2730 	PUSH	D
0dc4  01 bd 0b      2641   2731 	LXI	B,POPDEBCR
0dc7  c5            2642   2732 	PUSH	B
0dc8  cd 62 11      2643   2733 	CALL	VALSTRGZ	;STRING ENDS ON ZERO
0dcb                2644   2734 PRNTSTRT:
0dcb  cd bf 11      2645   2735 	CALL	STRGRELA
0dce  cd e3 1b      2646   2736 	CALL	LDDCBMM
0dd1  14            2647   2737 	INR	D
0dd2                2648   2738 PRNTSTRL:
0dd2  15            2649   2739 	DCR	D
0dd3  c8            2650   2740 	RZ
0dd4  0a            2651   2741 	LDAX	B
0dd5  cd ae 05      2652   2742 	CALL	PRNTCHRA	;ac -> screen
0dd8  fe 0d         2653   2743 	CPI	CR
0dda  cc 67 0d      2654   2744 	CZ	PRNTNULS
0ddd  03            2655   2745 	INX	B
0dde  c3 d2 0d      2656   2746 	JMP	PRNTSTRL
                    2657   2747
                    2658   2748 ;
                    2659   2749 ;  RETURN CURRENT POTITION ON OUTPUT LINE
                    2660   2750 ;
0de1                2661   2751 POSFCT:
0de1  3a af 03      2662   2752 	LDA	CURSPOS		;POS FUNCTION
0de4                2663   2753 FLOATA:
0de4  47            2664   2754 	MOV	B,A		;RETURN BYTE ANSWER
0de5  af            2665   2755 	XRA	A
0de6  c3 e4 17      2666   2756 	JMP	FLOATAB
                    2667   2757
                    2668   2758 ;
                    2669   2759 ;  PLOT STATEMENT
                    2670   2760 ;
0de9                2671   2761 PLTSTM:
0de9  cd 07 0c      2672   2762 	CALL	VALNUMBR	;bscan numbr  ;GET X-COORDINATE
0dec  cd 26 0c      2673   2763 	CALL	CINTEGER
0def  d5            2674   2764 	PUSH	D
0df0  cd b9 03      2675   2765 	CALL	SCANNXTV	;bscan (val)
0df3  2c            2676   2766 	DB	','
0df4  cd 07 0c      2677   2767 	CALL	VALNUMBR	;bscan numbr  ;GET Y-COORDINATE
0df7  cd 26 0c      2678   2768 	CALL	CINTEGER
0dfa  d5            2679   2769 	PUSH	D
0dfb  cd b9 03      2680   2770 	CALL	SCANNXTV	;bscan (val)
0dfe  2c            2681   2771 	DB	','
0dff  cd 07 0c      2682   2772 	CALL	VALNUMBR	;bscan numbr  ;GET OPERATION
0e02  cd 26 0c      2683   2773 	CALL	CINTEGER
0e05  7b            2684   2774 	MOV	A,E
0e06  d1            2685   2775 	POP	D
0e07  c1            2686   2776 	POP	B
0e08  e5            2687   2777 	PUSH	H
                    2688   2778 ;	CALL	SYSPLOT
0e09  e1            2689   2779 	POP	H
0e0a  c9            2690   2780 	RET
                    2691   2781
                    2692   2782 ;
                    2693   2783 ;  Page 59
                    2694   2784 ;
                    2695   2785
                    2696   2786 ;
                    2697   2787 ;  INPUT/READ STATEMENT PROCESSORS
                    2698   2788 ;
0e0b                2699   2789 MSGQUES:
0e0b  3f 3f 00      2700   2790 	DB	'??',0
0e0e                2701   2791 MSGREDO:
0e0e  3f 52 45 44   2702   2792 	DB	'?REDO FROM START',CR,LF,0
0e12  4f 20 46 52   2702   2793
0e16  4f 4d 20 53   2702   2794
0e1a  54 41 52 54   2702   2795
0e1e  0d 0a 00      2702   2796
0e21                2703   2797 MSGEXTRA:
0e21  3f 45 58 54   2704   2798 	DB	'?EXTRA IGNORED',CR,LF,0
0e25  52 41 20 49   2704   2799
0e29  47 4e 4f 52   2704   2800
0e2d  45 44 0d 0a   2704   2801
0e31  00            2704   2802
                    2705   2803
                    2706   2804 ;  INPUT
                    2707   2805 ;
0e32                2708   2806 INPSTM:
0e32  af            2709   2807 	XRA	A		;INPUT STATEMENT
0e33  32 7b 03      2710   2808 	STA	PRINTFLG	;TURN ON PRINTING
0e36                2711   2809 INPSTMRD:
0e36  e5            2712   2810 	PUSH	H		;SAVE SCAN IN CASE OF ERROR
0e37  0e 4e         2713   2811 	MVI	C,LINESYZE/2
0e39  cd ee 04      2714   2812 	CALL	SPACESTK
0e3c  eb            2715   2813 	XCHG
0e3d  2a 95 03      2716   2814 	LHLD	INPTBUFR	;SAVE ADDRESS OF CURRENT BUFFER
0e40  e5            2717   2815 	PUSH	H
0e41  21 60 ff      2718   2816 	LXI	H,0-LINESYZE-3
0e44  39            2719   2817 	DAD	SP
0e45  f9            2720   2818 	SPHL			;AND CREATE A NEW BUFFER
0e46  22 95 03      2721   2819 	SHLD	INPTBUFR
0e49  eb            2722   2820 	XCHG
0e4a  7e            2723   2821 	MOV	A,M
0e4b  fe 22         2724   2822 	CPI	'"'
0e4d  ca 5b 0e      2725   2823 	JZ	INPSTMPR
0e50  fe a3         2726   2824 	CPI	KEYPRM
0e52  11 0c 0e      2727   2825 	LXI	D,MSGQUES+1
0e55  c2 6d 0e      2728   2826 	JNZ	INPSTMIN
0e58  cd c1 03      2729   2827 	CALL	SCANNXT		;bscan +
0e5b                2730   2828 INPSTMPR:
0e5b  cd a9 0f      2731   2829 	CALL	VALEXPR		;bscan expr  ;OPTIONAL PROMPT STRING
0e5e  cd 11 0c      2732   2830 	CALL	CSTRING
0e61  cd b9 03      2733   2831 	CALL	SCANNXTV	;bscan (val)
0e64  3b            2734   2832 	DB	';'
0e65  e5            2735   2833 	PUSH	H
0e66  cd cb 0d      2736   2834 	CALL	PRNTSTRT
0e69  e1            2737   2835 	POP	H
0e6a  11 0d 0e      2738   2836 	LXI	D,MSGQUES+2
0e6d                2739   2837 INPSTMIN:
0e6d  e5            2740   2838 	PUSH	H
0e6e  cd 1c 0f      2741   2839 	CALL	DATAINPT
                    2742   2840
                    2743   2841 ;
                    2744   2842 ;  Page 60
                    2745   2843 ;
                    2746   2844
0e71  c3 7d 0e      2747   2845 	JMP	REAINPFS
                    2748   2846
                    2749   2847 ;  READ
                    2750   2848 ;
0e74                2751   2849 REASTM:
0e74  e5            2752   2850 	PUSH	H		;READ STATEMENT
0e75  2a 93 03      2753   2851 	LHLD	CURDATAP
0e78  7e            2754   2852 	MOV	A,M
0e79  b7            2755   2853 	ORA	A
0e7a  cc fa 0e      2756   2854 	CZ	DATASRCH	;GET DATA IF NECESSARY
                    2757   2855
0e7d                2758   2856 REAINPFS:
0e7d  32 7a 03      2759   2857 	STA	REAINPFL
0e80  c3 8e 0e      2760   2858 	JMP	REAINPLQ
0e83                2761   2859 REAINPLP:
0e83  cd b9 03      2762   2860 	CALL	SCANNXTV	;bscan (val)
0e86  2c            2763   2861 	DB	','
0e87  e3            2764   2862 	XTHL
0e88  7e            2765   2863 	MOV	A,M
0e89  fe 2c         2766   2864 	CPI	','
0e8b  c4 f0 0e      2767   2865 	CNZ	DATAGET
0e8e                2768   2866 REAINPLQ:
0e8e  e3            2769   2867 	XTHL
0e8f  7e            2770   2868 	MOV	A,M
0e90  fe a4         2771   2869 	CPI	KEYLINE		;LINE OPTION?
0e92  ca 3b 0f      2772   2870 	JZ	INPSTMLN
0e95  cd 48 12      2773   2871 	CALL	VARSCAN		;FIND NEXT VARIABLE TO BE INPUT
0e98  e3            2774   2872 	XTHL			;SAVE INPUT LIST POINTER
0e99  d5            2775   2873 	PUSH	D		;SAVE VARIABLE POINTER,
0e9a  3a 81 03      2776   2874 	LDA	TYPEFLG		;AND TYPE
0e9d  f5            2777   2875 	PUSH	PSW
0e9e  cd 24 0f      2778   2876 	CALL	REAINPDC	;DECODE INPUT
0ea1                2779   2877 REAINPLA:
0ea1  f1            2780   2878 	POP	PSW		;ASSIGN VALUE
0ea2  d1            2781   2879 	POP	D
0ea3  cd d1 0b      2782   2880 	CALL	ASSIGN
0ea6  2b            2783   2881 	DCX	H		;bscan -
0ea7  cd c1 03      2784   2882 	CALL	SCANNXT		;bscan ,
0eaa  ca b2 0e      2785   2883 	JZ	REAINPCM
0ead  fe 2c         2786   2884 	CPI	','		;DATA ITEMS SEPARTED BY COMMAS
0eaf  c2 e1 0e      2787   2885 	JNZ	REAINPER
0eb2                2788   2886 REAINPCM:
0eb2  e3            2789   2887 	XTHL
0eb3  2b            2790   2888 	DCX	H		;bscan -  ;MORE VARIABLES?
0eb4  cd c1 03      2791   2889 	CALL	SCANNXT		;bscan ,
0eb7  c2 83 0e      2792   2890 	JNZ	REAINPLP
0eba  d1            2793   2891 	POP	D		;END OF VARLIST
0ebb  3a 7a 03      2794   2892 	LDA	REAINPFL
0ebe  b7            2795   2893 	ORA	A
0ebf  eb            2796   2894 	XCHG
0ec0  c2 78 05      2797   2895 	JNZ	RESDTPTR
0ec3  d5            2798   2896 	PUSH	D
0ec4  f5            2799   2897 	PUSH	PSW
0ec5  b6            2800   2898 	ORA	M
0ec6  21 21 0e      2801   2899 	LXI	H,MSGEXTRA
0ec9                2802   2900 INPSTMER:
                    2803   2901
                    2804   2902 ;
                    2805   2903 ;  Page 61
                    2806   2904 ;
                    2807   2905
0ec9  c4 c2 0d      2808   2906 	CNZ	PRNTMSG
0ecc  f1            2809   2907 	POP	PSW
                    2810   2908
                    2811   2909 ;
                    2812   2910 ;  Page 62
                    2813   2911 ;
                    2814   2912
0ecd                2815   2913 INPSTMXT:
0ecd  d1            2816   2914 	POP	D		;RECOVER SCAN POINTER
0ece  21 a0 00      2817   2915 	LXI	H,0+LINESYZE+3
0ed1  39            2818   2916 	DAD	SP
0ed2  f9            2819   2917 	SPHL			;DEALLOCATE BUFFER
0ed3  e1            2820   2918 	POP	H
0ed4  22 95 03      2821   2919 	SHLD	INPTBUFR	;AND RESTORE ADDRESS OF OLD
0ed7  eb            2822   2920 	XCHG
0ed8  d1            2823   2921 	POP	D
0ed9  c8            2824   2922 	RZ
0eda  fa e5 0a      2825   2923 	JM	INPSTMBR	;BREAK TIME...
0edd  eb            2826   2924 	XCHG
0ede  c3 36 0e      2827   2925 	JMP	INPSTMRD	;OR REDO THE INPUT
                    2828   2926
0ee1                2829   2927 REAINPER:
0ee1  3a 7a 03      2830   2928 	LDA	REAINPFL
0ee4  b7            2831   2929 	ORA	A
0ee5  c2 ff 05      2832   2930 	JNZ	ERRDATA
0ee8  21 0e 0e      2833   2931 	LXI	H,MSGREDO
0eeb  3c            2834   2932 	INR	A
0eec  f5            2835   2933 	PUSH	PSW
0eed  c3 c9 0e      2836   2934 	JMP	INPSTMER
                    2837   2935
                    2838   2936 ;
                    2839   2937 ;  SEARCH FOR DATA STATEMENT
                    2840   2938 ;
0ef0                2841   2939 DATAGET:
0ef0  3a 7a 03      2842   2940 	LDA	REAINPFL
0ef3  b7            2843   2941 	ORA	A		;READ OR INPUT?
0ef4  11 0b 0e      2844   2942 	LXI	D,MSGQUES
0ef7  ca 1c 0f      2845   2943 	JZ	DATAINPT	;INPUT
0efa                2846   2944 DATASRCH:
0efa  cd 7f 0b      2847   2945 	CALL	DATSTM		;LOOK FOR NEXT DATA STATEMENT
0efd  b7            2848   2946 	ORA	A
0efe  c2 13 0f      2849   2947 	JNZ	DATASRCK
0f01  23            2850   2948 	INX	H
0f02  7e            2851   2949 	MOV	A,M
0f03  23            2852   2950 	INX	H
0f04  b6            2853   2951 	ORA	M
0f05  23            2854   2952 	INX	H
0f06  1e 61         2855   2953 	MVI	E,ERRNOD-ERRN
0f08  ca 07 06      2856   2954 	JZ	ERRMSG
0f0b  5e            2857   2955 	MOV	E,M
0f0c  23            2858   2956 	INX	H
0f0d  56            2859   2957 	MOV	D,M
0f0e  eb            2860   2958 	XCHG
0f0f  22 91 03      2861   2959 	SHLD	CURLDATA
0f12  eb            2862   2960 	XCHG
0f13                2863   2961 DATASRCK:
0f13  cd c1 03      2864   2962 	CALL	SCANNXT		;bscan ,
0f16  fe 80         2865   2963 	CPI	KEYDAT
0f18  c2 fa 0e      2866   2964 	JNZ	DATASRCH
0f1b  c9            2867   2965 	RET
                    2868   2966
0f1c                2869   2967 DATAINPT:
                    2870   2968
                    2871   2969 ;
                    2872   2970 ;  PAGE 63
                    2873   2971 ;
                    2874   2972
0f1c  cd 81 07      2875   2973 	CALL	INPTRQST
0f1f  c8            2876   2974 	RZ			;INPUT OK, RETURN
0f20  c1            2877   2975 	POP	B		;BREAK ***
0f21  c3 cd 0e      2878   2976 	JMP	INPSTMXT
                    2879   2977
0f24                2880   2978 REAINPDC:
0f24  cd c1 03      2881   2979 	CALL	SCANNXT		;bscan ,
0f27  cd ef 03      2882   2980 	CALL	TYPECHK
0f2a  7e            2883   2981 	MOV	A,M
0f2b  c2 cf 1c      2884   2982 	JNZ	DECODE		;READ/INPUT A NUMBER
0f2e  fe 22         2885   2983 	CPI	'"'
0f30  ca 68 11      2886   2984 	JZ	VALSTRGC
0f33  16 3a         2887   2985 	MVI	D,':'
0f35  06 2c         2888   2986 	MVI	B,','
0f37  2b            2889   2987 	DCX	H
0f38  c3 6b 11      2890   2988 	JMP	VALSTRGS	;READ/INPUT A STRING
                    2891   2989
0f3b                2892   2990 INPSTMLN:
0f3b  3a 7a 03      2893   2991 	LDA	REAINPFL	;LINE OPTION VALID ONLY
0f3e  b7            2894   2992 	ORA	A		;FOR INPUT STATEMENT
0f3f  c2 05 06      2895   2993 	JNZ	ERRASN
0f42  cd c1 03      2896   2994 	CALL	SCANNXT		;bscan +
0f45  cd 48 12      2897   2995 	CALL	VARSCAN
0f48  e3            2898   2996 	XTHL
0f49  d5            2899   2997 	PUSH	D
0f4a  3a 81 03      2900   2998 	LDA	TYPEFLG
0f4d  f5            2901   2999 	PUSH	PSW
0f4e  06 00         2902   3000 	MVI	B,0
0f50  cd 6a 11      2903   3001 	CALL	VALSTRGY	;SWALOW REST OF INPUT LINE
0f53  c3 a1 0e      2904   3002 	JMP	REAINPLA	;AND ASSIGN TO STRING VARIABLE
                    2905   3003
                    2906   3004 ;
                    2907   3005 ;  Page 64
                    2908   3006 ;
                    2909   3007
                    2910   3008 ;
                    2911   3009 ;  NEXT STATEMENT PROCESSOR
                    2912   3010 ;
0f56                2913   3011 NEXSTM:
0f56  11 00 00      2914   3012 	LXI	D,0		;NEXT STATEMENT
0f59                2915   3013 NEXSTML:
0f59  c4 48 12      2916   3014 	CNZ	VARSCAN
0f5c  22 8d 03      2917   3015 	SHLD	PROGCNTR
0f5f  cd 0f 0a      2918   3016 	CALL	FORCHK		;VERIFY WE'RE IN FOR LOOP
0f62  c2 94 0f      2919   3017 	JNZ	ERRANF
0f65  f9            2920   3018 	SPHL			;BACK UP STACK
0f66  d5            2921   3019 	PUSH	D
0f67  7e            2922   3020 	MOV	A,M		;RECOVER SIGN OF STEPSIZE
0f68  23            2923   3021 	INX	H
0f69  f5            2924   3022 	PUSH	PSW
0f6a  d5            2925   3023 	PUSH	D
0f6b  cd d0 1b      2926   3024 	CALL	LDRGACMM	;RECOVER STEP SIZE
0f6e  e3            2927   3025 	XTHL
0f6f  e5            2928   3026 	PUSH	H
0f70  cd b9 19      2929   3027 	CALL	FLADDM		;INCREMENT CONTROL VARIABLE
0f73  e1            2930   3028 	POP	H
0f74  cd ea 1b      2931   3029 	CALL	LDMMAC
0f77  e1            2932   3030 	POP	H
0f78  cd e1 1b      2933   3031 	CALL	LDRGMM
0f7b  e5            2934   3032 	PUSH	H
0f7c  cd 0f 1c      2935   3033 	CALL	FLCMP
0f7f  e1            2936   3034 	POP	H
0f80  c1            2937   3035 	POP	B
0f81  90            2938   3036 	SUB	B
0f82  cd e1 1b      2939   3037 	CALL	LDRGMM		;RECOER LINE NUMBR, PROGRAM CNTR
0f85  ca 99 0f      2940   3038 	JZ	NEXSTMC		;CHECK LIMIT
0f88  cd 9f 0b      2941   3039 	CALL	TRACE
0f8b  eb            2942   3040 	XCHG
0f8c  22 89 03      2943   3041 	SHLD	CURLINE
0f8f  60            2944   3042 	MOV	H,B
0f90  69            2945   3043 	MOV	L,C
0f91  c3 96 0a      2946   3044 	JMP	FORMARK
                    2947   3045
0f94                2948   3046 ERRANF:
0f94  1e 54         2949   3047 	MVI	E,ERRNNF-ERRN
0f96  c3 07 06      2950   3048 	JMP	ERRMSG
                    2951   3049
0f99                2952   3050 NEXSTMC:
0f99  f9            2953   3051 	SPHL			;END OF LOOP...
0f9a  2a 8d 03      2954   3052 	LHLD	PROGCNTR
0f9d  7e            2955   3053 	MOV	A,M
0f9e  fe 2c         2956   3054 	CPI	','
0fa0  c2 9a 0a      2957   3055 	JNZ	EXECUTEL	;MORE INDICES?
0fa3  cd c1 03      2958   3056 	CALL	SCANNXT		;bscan	,
0fa6  cd 59 0f      2959   3057 	CALL	NEXSTML
                    2960   3058
                    2961   3059 ;
                    2962   3060 ;  Page 65
                    2963   3061 ;
                    2964   3062
                    2965   3063 ;
                    2966   3064 ;  EVALUTATE AN EXPRESSION
                    2967   3065 ;
0fa9                2968   3066 VALEXPR:
0fa9  2b            2969   3067 	DCX	H		;SCAN & EVALUATE AN EXPRESSION
0faa  16 00         2970   3068 	MVI	D,0		;INITIAL PRECEDENCE=0
0fac                2971   3069 VALEXPRL:
0fac  d5            2972   3070 	PUSH	D
0fad  0e 01         2973   3071 	MVI	C,1
0faf  cd ee 04      2974   3072 	CALL	SPACESTK
0fb2  cd 83 10      2975   3073 	CALL	VALPRMRY	;bscan prmry
0fb5  22 87 03      2976   3074 	SHLD	SCANPTR2
0fb8                2977   3075 VALEXPRC:
0fb8  2a 87 03      2978   3076 	LHLD	SCANPTR2
0fbb                2979   3077 VALEXPRD:
0fbb  c1            2980   3078 	POP	B		;PREVIOUS PRECEDENCE
0fbc  78            2981   3079 	MOV	A,B
0fbd  fe 70         2982   3080 	CPI	PREDNUM
0fbf  d4 0a 0c      2983   3081 	CNC	CSINGLE
0fc2  7e            2984   3082 	MOV	A,M
0fc3  16 00         2985   3083 	MVI	D,000H
0fc5                2986   3084 VALEXPRR:
0fc5  d6 b4         2987   3085 	SUI	KEYREL		;RELATION?
0fc7  da e1 0f      2988   3086 	JC	VALEXPRO
0fca  fe 03         2989   3087 	CPI	KEYFCT-KEYREL
0fcc  d2 e1 0f      2990   3088 	JNC	VALEXPRO
0fcf  fe 01         2991   3089 	CPI	1		;YES
0fd1  17            2992   3090 	RAL
0fd2  aa            2993   3091 	XRA	D		;CONVERT 0,1,2 TO 1,2,4
0fd3  ba            2994   3092 	CMP	D
0fd4  57            2995   3093 	MOV	D,A
0fd5  da 05 06      2996   3094 	JC	ERRASN
0fd8  22 85 03      2997   3095 	SHLD	SCANPTR1
0fdb  cd c1 03      2998   3096 	CALL	SCANNXT		;bscan ,
0fde  c3 c5 0f      2999   3097 	JMP	VALEXPRR
                    3000   3098
0fe1                3001   3099 VALEXPRO:
0fe1  7a            3002   3100 	MOV	A,D
0fe2  b7            3003   3101 	ORA	A
0fe3  c2 1e 10      3004   3102 	JNZ	VALREL
0fe6  7e            3005   3103 	MOV	A,M
0fe7  22 85 03      3006   3104 	SHLD	SCANPTR1
0fea  d6 aa         3007   3105 	SUI	KEYOPR		;OPERATOR?
0fec  d8            3008   3106 	RC
0fed  fe 0a         3009   3107 	CPI	KEYREL-KEYOPR
0fef  d0            3010   3108 	RNC
0ff0  5f            3011   3109 	MOV	E,A		;YES
0ff1  cd ef 03      3012   3110 	CALL	TYPECHK		;STRING OPERANDS?
0ff4  b3            3013   3111 	ORA	E		;AND CATENATION OPERATOR?
0ff5  7b            3014   3112 	MOV	A,E
0ff6  ca ed 11      3015   3113 	JZ	VALCONCT	;YES
0ff9  83            3016   3114 	ADD	E
0ffa  83            3017   3115 	ADD	E
0ffb  5f            3018   3116 	MOV	E,A
0ffc  21 a4 00      3019   3117 	LXI	H,OPRTABL
                    3020   3118
                    3021   3119 ;
                    3022   3120 ;  Page 66
                    3023   3121 ;
                    3024   3122
0fff  19            3025   3123 	DAD	D
1000  78            3026   3124 	MOV	A,B
1001  56            3027   3125 	MOV	D,M
1002  ba            3028   3126 	CMP	D
1003  d0            3029   3127 	RNC
1004  23            3030   3128 	INX	H
1005  cd 0a 0c      3031   3129 	CALL	CSINGLE
1008                3032   3130 VALEXPR2:
1008  c5            3033   3131 	PUSH	B		;STACK OPERATION
1009  01 b8 0f      3034   3132 	LXI	B,VALEXPRC	;EVALUATE SECOND OPERAND
100c  c5            3035   3133 	PUSH	B
100d  42            3036   3134 	MOV	B,D
100e  4b            3037   3135 	MOV	C,E
100f  cd c3 1b      3038   3136 	CALL	PUSHAC
1012  50            3039   3137 	MOV	D,B
1013  59            3040   3138 	MOV	E,C
1014  4e            3041   3139 	MOV	C,M
1015  23            3042   3140 	INX	H
1016  46            3043   3141 	MOV	B,M
1017  c5            3044   3142 	PUSH	B
1018  2a 85 03      3045   3143 	LHLD	SCANPTR1
101b  c3 ac 0f      3046   3144 	JMP	VALEXPRL
                    3047   3145
                    3048   3146 ;
                    3049   3147 ;  EVALUATE A RELATION
                    3050   3148 ;
101e                3051   3149 VALREL:
101e  21 3b 10      3052   3150 	LXI	H,RELOPR	;SCAN & EVALUATE RELATION
1021  3a 81 03      3053   3151 	LDA	TYPEFLG
1024  07            3054   3152 	RLC
1025  07            3055   3153 	RLC
1026  07            3056   3154 	RLC
1027  b2            3057   3155 	ORA	D
1028  5f            3058   3156 	MOV	E,A
1029  16 64         3059   3157 	MVI	D,PREDREL
102b  78            3060   3158 	MOV	A,B
102c  ba            3061   3159 	CMP	D
102d  d0            3062   3160 	RNC
102e  c3 08 10      3063   3161 	JMP	VALEXPR2
                    3064   3162
1031                3065   3163 RELOPRXT:
1031  3c            3066   3164 	INR	A		;MATCH RESULF OF COMPARISON
1032  8f            3067   3165 	ADC	A		;-1,0,1 TO 1,2,4
1033  c1            3068   3166 	POP	B		;VERSUS RELATION TO BE TESTED
1034  a0            3069   3167 	ANA	B
1035  c6 ff         3070   3168 	ADI	-1
1037  9f            3071   3169 	SBB	A
1038  c3 97 1c      3072   3170 	JMP	FLOATBYT
                    3073   3171
                    3074   3172 ;
                    3075   3173 ;  Page 67
                    3076   3174 ;
                    3077   3175
103b                3078   3176 RELOPR:
103b  3d 10         3079   3177 	DW	RELOPRC		;COMPUTE RELATION
103d                3080   3178 RELOPRC:
103d  79            3081   3179 	MOV	A,C
103e  c1            3082   3180 	POP	B
103f  d1            3083   3181 	POP	D
1040  f5            3084   3182 	PUSH	PSW
1041  0f            3085   3183 	RRC
1042  0f            3086   3184 	RRC
1043  0f            3087   3185 	RRC
1044  e6 0f         3088   3186 	ANI	00FH
1046  cd fb 0b      3089   3187 	CALL	COERCE
1049  21 31 10      3090   3188 	LXI	H,RELOPRXT
104c  e5            3091   3189 	PUSH	H
104d  c2 0f 1c      3092   3190 	JNZ	FLCMP		;NUMERIC COMPARISON?
1050  3e 04         3093   3191 	MVI	A,TYPESING	;NO, STRING
1052  32 81 03      3094   3192 	STA	TYPEFLG
1055  d5            3095   3193 	PUSH	D
1056  cd bf 11      3096   3194 	CALL	STRGRELA	;RELEASE TEMP OF SECOND OPERAND
1059  d1            3097   3195 	POP	D
105a  4e            3098   3196 	MOV	C,M
105b  23            3099   3197 	INX	H
105c  c5            3100   3198 	PUSH	B		;SAVE LENGTH
105d  4e            3101   3199 	MOV	C,M
105e  23            3102   3200 	INX	H
105f  46            3103   3201 	MOV	B,M
1060  c5            3104   3202 	PUSH	B		;AND ADDRESS
1061  cd c3 11      3105   3203 	CALL	STRGRELD	;RELEASE TEMP OF FIRST OPERAND
1064  cd e3 1b      3106   3204 	CALL	LDDCBMM
1067  e1            3107   3205 	POP	H
1068  e3            3108   3206 	XTHL
1069  5d            3109   3207 	MOV	E,L
106a  e1            3110   3208 	POP	H
106b                3111   3209 RELOPRSL:
106b  7b            3112   3210 	MOV	A,E		;COMPARE CHARACTER BY CHARACTER
106c  b2            3113   3211 	ORA	D
106d  c8            3114   3212 	RZ
106e  7b            3115   3213 	MOV	A,E
106f  d6 01         3116   3214 	SUI	1
1071  d8            3117   3215 	RC
1072  af            3118   3216 	XRA	A
1073  ba            3119   3217 	CMP	D
1074  3c            3120   3218 	INR	A
1075  d0            3121   3219 	RNC
1076  15            3122   3220 	DCR	D
1077  1d            3123   3221 	DCR	E
1078  0a            3124   3222 	LDAX	B
1079  be            3125   3223 	CMP	M
107a  23            3126   3224 	INX	H
107b  03            3127   3225 	INX	B
107c  ca 6b 10      3128   3226 	JZ	RELOPRSL
107f  3f            3129   3227 	CMC
1080  c3 8b 1c      3130   3228 	JMP	CMPXT
                    3131   3229
                    3132   3230 ;
                    3133   3231 ;  Page 68
                    3134   3232 ;
                    3135   3233
                    3136   3234 ;
                    3137   3235 ;  EVALUATE A PRIMARY
                    3138   3236 ;
1083                3139   3237 VALPRMRY:
1083  3e 04         3140   3238 	MVI	A,TYPESING	;SCAN & EVALUATE A PRIMARY
1085  32 81 03      3141   3239 	STA	TYPEFLG
1088  cd c1 03      3142   3240 	CALL	SCANNXT		;bscan ,
108b  da cf 1c      3143   3241 	JC	DECODE		;NUMERIC CONSTANT?
108e  cd d1 03      3144   3242 	CALL	ALPHACHK
1091  da d9 10      3145   3243 	JC	VALVAR		;VARIABLE?
1094  fe aa         3146   3244 	CPI	KEYADD
1096  ca 83 10      3147   3245 	JZ	VALPRMRY
1099  fe 2e         3148   3246 	CPI	'.'
109b  ca cf 1c      3149   3247 	JZ	DECODE
109e  fe ab         3150   3248 	CPI	KEYSUB
10a0  ca c8 10      3151   3249 	JZ	VALUMINS
10a3  fe 22         3152   3250 	CPI	'"'		;STRING CONSTANT?
10a5  ca 68 11      3153   3251 	JZ	VALSTRGC
10a8  fe a8         3154   3252 	CPI	KEYNOT
10aa  ca 6d 19      3155   3253 	JZ	VALUNOT
10ad  fe a7         3156   3254 	CPI	KEYFN		;DEFINED FUNCTION?
10af  ca 3f 14      3157   3255 	JZ	VALFCTD
10b2  fe 8b         3158   3256 	CPI	KEYIF		;CONDITIONAL EXPRESSION?
10b4  ca f4 10      3159   3257 	JZ	VALCOND
10b7  d6 b7         3160   3258 	SUI	KEYFCT		;INSTRISIC FUNCTION?
10b9  d2 2e 11      3161   3259 	JNC	VALFCTN
10bc                3162   3260 VALPARNS:
10bc  cd b9 03      3163   3261 	CALL	SCANNXTV	;bscan (val)
10bf  28            3164   3262 	DB	'('
10c0                3165   3263 VALPARN2:
10c0  cd a9 0f      3166   3264 	CALL	VALEXPR		;bscan expr
10c3  cd b9 03      3167   3265 	CALL	SCANNXTV	;bscan (val)
10c6  29            3168   3266 	DB	')'
10c7  c9            3169   3267 	RET
                    3170   3268
10c8                3171   3269 VALUMINS:
10c8  16 7d         3172   3270 	MVI	D,PREDUMIN	;EVALUATE UNARY MINUS
10ca  cd ac 0f      3173   3271 	CALL	VALEXPRL
10cd  2a 87 03      3174   3272 	LHLD	SCANPTR2
10d0  e5            3175   3273 	PUSH	H
10d1  cd ae 1c      3176   3274 	CALL	CMACCS
10d4                3177   3275 VALRETNM:
10d4  cd 0a 0c      3178   3276 	CALL	CSINGLE
10d7  e1            3179   3277 	POP	H
10d8  c9            3180   3278 	RET
                    3181   3279
                    3182   3280 ;
                    3183   3281 ;  Page 69
                    3184   3282 ;
                    3185   3283
                    3186   3284 ;
                    3187   3285 ;  EVALUATE A VARIABLE
                    3188   3286 ;
10d9                3189   3287 VALVAR:
10d9  cd 48 12      3190   3288 	CALL	VARSCAN		;SCAN & EVALUATE VARIABLE
10dc  e5            3191   3289 	PUSH	H
10dd  d5            3192   3290 	PUSH	D
10de  eb            3193   3291 	XCHG
10df  1e d1         3194   3292 	MVI	E,ERRNUV-ERRN
10e1  c2 07 06      3195   3293 	JNZ	ERRMSG
10e4  22 a9 03      3196   3294 	SHLD	ACCUMLTR
10e7  cd ef 03      3197   3295 	CALL	TYPECHK
10ea  eb            3198   3296 	XCHG
10eb  21 a9 03      3199   3297 	LXI	H,ACCUMLTR
10ee  c4 ed 1b      3200   3298 	CNZ	COPYVAL
10f1  d1            3201   3299 	POP	D
10f2  e1            3202   3300 	POP	H
10f3  c9            3203   3301 	RET
                    3204   3302
                    3205   3303 ;
                    3206   3304 ;  EVALUATE CONDITIONAL EXPRESSION
                    3207   3305 ;
10f4                3208   3306 VALCOND:
10f4  cd c1 03      3209   3307 	CALL	SCANNXT		;bscan , EVAL CONDITIONAL EXPRESSION
10f7  cd 07 0c      3210   3308 	CALL	VALNUMBR	;bscan numbr
10fa  cd b9 03      3211   3309 	CALL	SCANNXTV	;bscan (val)
10fd  a0            3212   3310 	DB	KEYTHEN
10fe  cd 7e 1c      3213   3311 	CALL	SIGNACC
1101  ca 17 11      3214   3312 	JZ	VALCONDF
1104  cd a9 0f      3215   3313 	CALL	VALEXPR		;bscan expr  ;TRUE, EVALUATE THEN PORTION
1107  16 01         3216   3314 	MVI	D,1
1109                3217   3315 VALCNDTL:
1109  0e 82         3218   3316 	MVI	C,KEYEND
110b  cd 86 0b      3219   3317 	CALL	SCAN2KEY	;SKIP ELSE PORTION
110e  cd b9 03      3220   3318 	CALL	SCANNXTV	;bscan (val)
1111  82            3221   3319 	DB	KEYEND
1112  15            3222   3320 	DCR	D
1113  c2 09 11      3223   3321 	JNZ	VALCNDTL
1116  c9            3224   3322 	RET
                    3225   3323
1117                3226   3324 VALCONDF:
1117  16 01         3227   3325 	MVI	D,1
1119                3228   3326 VALCNDFL:
1119  0e 8c         3229   3327 	MVI	C,KEYELS	;FALSE, SKIP THEN PORTION
111b  cd 86 0b      3230   3328 	CALL	SCAN2KEY
111e  cd b9 03      3231   3329 	CALL	SCANNXTV	;bscan (val)
1121  8c            3232   3330 	DB	KEYELS
1122  15            3233   3331 	DCR	D
1123  c2 19 11      3234   3332 	JNZ	VALCNDFL
1126  cd a9 0f      3235   3333 	CALL	VALEXPR		;bscan expr  ;EVALUAGE ELSE PORTION
1129  cd b9 03      3236   3334 	CALL	SCANNXTV	;bscan (val)
112c  82            3237   3335 	DB	KEYEND
112d  c9            3238   3336 	RET
                    3239   3337
                    3240   3338 ;
                    3241   3339 ;  Page 70
                    3242   3340 ;
                    3243   3341
                    3244   3342 ;
                    3245   3343 ;  EVALUATE INSTRINSIC FUNCTION
                    3246   3344 ;
112e                3247   3345 VALFCTN:
112e  06 00         3248   3346 	MVI	B,000H		;Scan & EVALUATE INSTRINSIC FUNCTION
1130  07            3249   3347 	RLC
1131  4f            3250   3348 	MOV	C,A
1132  c5            3251   3349 	PUSH	B
1133  cd c1 03      3252   3350 	CALL	SCANNXT		;bscan ,
1136  79            3253   3351 	MOV	A,C
1137  fe 2f         3254   3352 	CPI	(KEYLFT-KEYFCT)*2-1	;LEFT$, MID$, OR RIGHT$
1139  da 4e 11      3255   3353 	JC	VALFCTAR
113c  cd b9 03      3256   3354 	CALL	SCANNXTV	;bscan (val)
113f  28            3257   3355 	DB	'('
1140  cd a9 0f      3258   3356 	CALL	VALEXPR		;bscan expr
1143  cd 11 0c      3259   3357 	CALL	CSTRING
1146  eb            3260   3358 	XCHG
1147  2a a9 03      3261   3359 	LHLD	ACCUMLTR
114a  e3            3262   3360 	XTHL			;PUSH STRING ONTO STACK
114b  c3 56 11      3263   3361 	JMP	VALFCTLK
                    3264   3362
114e                3265   3363 VALFCTAR:
114e  cd bc 10      3266   3364 	CALL	VALPARNS	;EVALUATE ARGUMENT TO FUNCTION
1151  e3            3267   3365 	XTHL
1152  11 d4 10      3268   3366 	LXI	D,VALRETNM
1155  d5            3269   3367 	PUSH	D
1156                3270   3368 VALFCTLK:
1156  01 c2 00      3271   3369 	LXI	B,FCTTABL	;BRANCH TO APPROPRIATE ROUTINE
1159  09            3272   3370 	DAD	B
115a  4e            3273   3371 	MOV	C,M
115b  23            3274   3372 	INX	H
115c  66            3275   3373 	MOV	H,M
115d  69            3276   3374 	MOV	L,C
115e  e9            3277   3375 	PCHL			;CALL FUNCTION
                    3278   3376
                    3279   3377 ;
                    3280   3378 ;  Page 71
                    3281   3379 ;
                    3282   3380
                    3283   3381 ;
                    3284   3382 ;  PROCESS STRING CONSTANT
                    3285   3383 ;
115f                3286   3384 VALSTRGN:
115f  cd 85 1d      3287   3385 	CALL	ENCODE		;CREATE STRING FROM NUMBER
1162                3288   3386 VALSTRGZ:
1162  06 80         3289   3387 	MVI	B,080H
1164  2b            3290   3388 	DCX	H
1165  c3 6a 11      3291   3389 	JMP	VALSTRGY
                    3292   3390
1168                3293   3391 VALSTRGC:
1168  06 22         3294   3392 	MVI	B,'"'		;SCAN & DECODE A STRING CONSTANT
116a                3295   3393 VALSTRGY:
116a  50            3296   3394 	MOV	D,B
116b                3297   3395 VALSTRGS:
116b  e5            3298   3396 	PUSH	H
116c  0e ff         3299   3397 	MVI	C,-1
116e                3300   3398 VALSTRGL:
116e  23            3301   3399 	INX	H		;FIND STRING LENGTH
116f  7e            3302   3400 	MOV	A,M
1170  0c            3303   3401 	INR	C
1171  b7            3304   3402 	ORA	A
1172  ca 7d 11      3305   3403 	JZ	VALSTRGE
1175  ba            3306   3404 	CMP	D
1176  ca 7d 11      3307   3405 	JZ	VALSTRGE
1179  b8            3308   3406 	CMP	B
117a  c2 6e 11      3309   3407 	JNZ	VALSTRGL
117d                3310   3408 VALSTRGE:
117d  fe 22         3311   3409 	CPI	'"'
117f  cc c1 03      3312   3410 	CZ	SCANNXT
1182  e3            3313   3411 	XTHL
1183  23            3314   3412 	INX	H
1184  eb            3315   3413 	XCHG
1185  79            3316   3414 	MOV	A,C
1186  cd 2c 15      3317   3415 	CALL	STRSTCDS
1189  eb            3318   3416 	XCHG
118a  cd c3 0c      3319   3417 	CALL	STRGTEST	;LOCATE STRING
118d  3f            3320   3418 	CMC
118e  1f            3321   3419 	RAR
118f  b0            3322   3420 	ORA	B
1190  f4 7d 16      3323   3421 	CP	STRGSTOR	;MAKE COPY OF CERTAIN BUFFERS
                    3324   3422
                    3325   3423 ;
                    3326   3424 ;  Page 72
                    3327   3425 ;
                    3328   3426
                    3329   3427 ;
                    3330   3428 ;  ALLOCATE STRING TEMPORARY
                    3331   3429 ;
1193                3332   3430 STRGALOT:
1193  11 82 03      3333   3431 	LXI	D,STRGTMPL	;USE CURRENT DESCRIPTOR
1196                3334   3432 STRGALOU:
1196  d5            3335   3433 	PUSH	D
1197  3e 03         3336   3434 	MVI	A,TYPESTRG	;RETURN STRING RESULT
1199  32 81 03      3337   3435 	STA	TYPEFLG
119c  2a a5 03      3338   3436 	LHLD	STRGTMPP	;IN A NEW STRING TEMPORARY
119f  22 a9 03      3339   3437 	SHLD	ACCUMLTR
11a2  eb            3340   3438 	XCHG
11a3  2a a7 03      3341   3439 	LHLD	STRGTLIM	;ANY MORE TEMPORARIES?
11a6  cd d7 04      3342   3440 	CALL	CMHLLTDE
11a9  da ba 11      3343   3441 	JC	ERRAST
11ac  eb            3344   3442 	XCHG
11ad  d1            3345   3443 	POP	D		;GET DESCRIPTOR
11ae  cd ed 1b      3346   3444 	CALL	COPYVAL		;COPY IT
11b1  22 a5 03      3347   3445 	SHLD	STRGTMPP
11b4  e1            3348   3446 	POP	H
11b5  c9            3349   3447 	RET
                    3350   3448
11b6                3351   3449 STRGALOV:
11b6  e5            3352   3450 	PUSH	H
11b7  c3 96 11      3353   3451 	JMP	STRGALOU
                    3354   3452
11ba                3355   3453 ERRAST:
11ba  1e 92         3356   3454 	MVI	E,ERRNST-ERRN
11bc  c3 07 06      3357   3455 	JMP	ERRMSG
                    3358   3456
                    3359   3457 ;
                    3360   3458 ;  Page 73
                    3361   3459 ;
                    3362   3460
                    3363   3461 ;
                    3364   3462 ;  RELEASE STRING RESOURCES
                    3365   3463 ;
11bf                3366   3464 STRGRELA:
11bf  2a a9 03      3367   3465 	LHLD	ACCUMLTR
11c2                3368   3466 STRGRELH:
11c2  eb            3369   3467 	XCHG
11c3                3370   3468 STRGRELD:
11c3  cd dd 11      3371   3469 	CALL	STRGRELT	;RELEASE TEMPORARY
11c6  eb            3372   3470 	XCHG
11c7  c0            3373   3471 	RNZ			;NOT OUR BOY
11c8  d5            3374   3472 	PUSH	D
11c9  50            3375   3473 	MOV	D,B
11ca  59            3376   3474 	MOV	E,C
11cb  1b            3377   3475 	DCX	D
11cc  4e            3378   3476 	MOV	C,M
11cd  2a a1 03      3379   3477 	LHLD	STRGFREE
11d0  cd d7 04      3380   3478 	CALL	CMHLLTDE
11d3  c2 86 08      3381   3479 	JNZ	POPHLRET
11d6  47            3382   3480 	MOV	B,A		;RELEASE STRING SPACE
11d7  09            3383   3481 	DAD	B
11d8  22 a1 03      3384   3482 	SHLD	STRGFREE
11db  e1            3385   3483 	POP	H
11dc  c9            3386   3484 	RET
                    3387   3485
                    3388   3486 ;
                    3389   3487 ;  RELEASE STRING TEMPORARY
                    3390   3488 ;
11dd                3391   3489 STRGRELT:
11dd  2a a5 03      3392   3490 	LHLD	STRGTMPP	;RELEASE STRING TEMPORARY
11e0  2b            3393   3491 	DCX	H
11e1  46            3394   3492 	MOV	B,M
11e2  2b            3395   3493 	DCX	H
11e3  4e            3396   3494 	MOV	C,M
11e4  2b            3397   3495 	DCX	H
11e5  cd d7 04      3398   3496 	CALL	CMHLLTDE
11e8  c0            3399   3497 	RNZ
11e9  22 a5 03      3400   3498 	SHLD	STRGTMPP	;RELEASE STRING TEMPORARY
11ec  c9            3401   3499 	RET
                    3402   3500
                    3403   3501 ;
                    3404   3502 ;  Page 74
                    3405   3503 ;
                    3406   3504
                    3407   3505 ;
                    3408   3506 ;  EVALUATE A CATENATION
                    3409   3507 ;
11ed                3410   3508 VALCONCT:
11ed  c5            3411   3509 	PUSH	B		;EVALUATE A CONCATENATION
11ee  e5            3412   3510 	PUSH	H
11ef  2a a9 03      3413   3511 	LHLD	ACCUMLTR	;SAVE FIRST OPERAND,
11f2  e3            3414   3512 	XTHL
11f3  cd 83 10      3415   3513 	CALL	VALPRMRY	;bscan prmry  ;EVALUATE SECOND
11f6  e3            3416   3514 	XTHL
11f7  cd 11 0c      3417   3515 	CALL	CSTRING
11fa  7e            3418   3516 	MOV	A,M		;ADD LENGTHS,
11fb  e5            3419   3517 	PUSH	H
11fc  2a a9 03      3420   3518 	LHLD	ACCUMLTR
11ff  e5            3421   3519 	PUSH	H
1200  86            3422   3520 	ADD	M
1201  1e 3b         3423   3521 	MVI	E,ERRNLS-ERRN
1203  da 07 06      3424   3522 	JC	ERRMSG
1206  cd 29 15      3425   3523 	CALL	STRNGEN		;AND ALLOCATE OUTPUT STRING
1209  d1            3426   3524 	POP	D
120a  cd c3 11      3427   3525 	CALL	STRGRELD	;RELEASE STRING TEMPORARIES
120d  e3            3428   3526 	XTHL
120e  cd c2 11      3429   3527 	CALL	STRGRELH
1211  e5            3430   3528 	PUSH	H
1212  2a 83 03      3431   3529 	LHLD	STRGTMPA	;COPY STRINGS TO OUTPUT STRING
1215  eb            3432   3530 	XCHG
1216  cd 24 12      3433   3531 	CALL	VALCONCP
1219  cd 24 12      3434   3532 	CALL	VALCONCP
121c  21 bb 0f      3435   3533 	LXI	H,VALEXPRD
121f  e3            3436   3534 	XTHL
1220  e5            3437   3535 	PUSH	H
1221  c3 93 11      3438   3536 	JMP	STRGALOT
                    3439   3537
1224                3440   3538 VALCONCP:
1224  e1            3441   3539 	POP	H		;COPY STRING FOR CATENATION
1225  e3            3442   3540 	XTHL
1226  7e            3443   3541 	MOV	A,M		;GET LENGTH,
1227  23            3444   3542 	INX	H
1228  4e            3445   3543 	MOV	C,M		;ADDRESS OF STRING
1229  23            3446   3544 	INX	H
122a  46            3447   3545 	MOV	B,M
122b  6f            3448   3546 	MOV	L,A
                    3449   3547
122c                3450   3548 COPYSTRG:
122c  2c            3451   3549 	INR	L		;COPY A STRING OF LENGTH L
122d                3452   3550 COPYSTRL:
122d  2d            3453   3551 	DCR	L		;FROM BC TO DE
122e  c8            3454   3552 	RZ
122f  0a            3455   3553 	LDAX	B
1230  12            3456   3554 	STAX	D
1231  03            3457   3555 	INX	B
1232  13            3458   3556 	INX	D
1233  c3 2d 12      3459   3557 	JMP	COPYSTRL
                    3460   3558
                    3461   3559 ;
                    3462   3560 ;  Page 75
                    3463   3561 ;
                    3464   3562
                    3465   3563 ;
                    3466   3564 ;  DIMENSION STATEMENT PROCESSING
                    3467   3565 ;
1236                3468   3566 DIMSTML:
1236  2b            3469   3567 	DCX	H
1237  cd c1 03      3470   3568 	CALL	SCANNXT		;bscan ,
123a  c8            3471   3569 	RZ
123b  cd b9 03      3472   3570 	CALL	SCANNXTV	;bscan (val)
123e  2c            3473   3571 	DB	','
123f                3474   3572 DIMSTM:
123f  01 36 12      3475   3573 	LXI	B,DIMSTML	;DIM STATEMENT
1242  c5            3476   3574 	PUSH	B
1243  3e 80         3477   3575 	MVI	A,080H
1245  c3 49 12      3478   3576 	JMP	VARSCANI
                    3479   3577
                    3480   3578 ;
                    3481   3579 ;  SCAN A VARIABLE NAME
                    3482   3580 ;
1248                3483   3581 VARSCAN:
1248  af            3484   3582 	XRA	A		;SCAN FOR VARIABLE
1249                3485   3583 VARSCANI:
1249  32 80 03      3486   3584 	STA	MATDMFLG
124c  06 00         3487   3585 	MVI	B,0*TYPEDEF
124e                3488   3586 VARSCNDF:
124e  cd d1 03      3489   3587 	CALL	ALPHACHK	;ENTRY TO SCAN FOR DEFINED FCT
1251  d2 05 06      3490   3588 	JNC	ERRASN
1254  b0            3491   3589 	ORA	B
1255  47            3492   3590 	MOV	B,A
1256  0e 3f         3493   3591 	MVI	C,'?'
1258  16 04         3494   3592 	MVI	D,TYPESING	;ASSUME NUMERIC VARIABLE
125a  cd c1 03      3495   3593 	CALL	SCANNXT		;bscan ,
125d  da 66 12      3496   3594 	JC	VARSCAND
1260  cd d1 03      3497   3595 	CALL	ALPHACHK
1263  d2 73 12      3498   3596 	JNC	VARSCANS
1266                3499   3597 VARSCAND:
1266  4f            3500   3598 	MOV	C,A
1267                3501   3599 VARSKIPL:
1267  cd c1 03      3502   3600 	CALL	SCANNXT		;bscan ,  ;SKIP EXTRA ALPHANUMERIC
126a  da 67 12      3503   3601 	JC	VARSKIPL	;CHARACTERS IN NAME
126d  cd d1 03      3504   3602 	CALL	ALPHACHK
1270  da 67 12      3505   3603 	JC	VARSKIPL
1273                3506   3604 VARSCANS:
1273  d6 24         3507   3605 	SUI	'$'		;STRING VARIABLE?
1275  c2 7d 12      3508   3606 	JNZ	VARNAME
1278  16 03         3509   3607 	MVI	D,TYPESTRG	;YES
127a  cd c1 03      3510   3608 	CALL	SCANNXT		;bscan ,
                    3511   3609
127d                3512   3610 VARNAME:
127d  78            3513   3611 	MOV	A,B		;TRANSLATE IDENT OT INTERNAL FORM
127e  d6 40         3514   3612 	SUI	'@'		;DEF/VARIABLE IS FIRST BIT
1280  07            3515   3613 	RLC			;FIRST CHAR IS NEXT FIVE BITS
1281  07            3516   3614 	RLC
1282  47            3517   3615 	MOV	B,A
1283  79            3518   3616 	MOV	A,C		;SECOND CHAR IS NEXT SIX BITS
1284  d6 30         3519   3617 	SUI	'0'
                    3520   3618
                    3521   3619 ;
                    3522   3620 ;  Page 76
                    3523   3621 ;
                    3524   3622
1286  0f            3525   3623 	RRC
1287  0f            3526   3624 	RRC
1288  0f            3527   3625 	RRC
1289  0f            3528   3626 	RRC
128a  4f            3529   3627 	MOV	C,A
128b  a8            3530   3628 	XRA	B		;PACK THREE BYTES INTO TWO
128c  e6 03         3531   3629 	ANI	0003H
128e  a8            3532   3630 	XRA	B
128f  47            3533   3631 	MOV	B,A
1290  7a            3534   3632 	MOV	A,D
1291  32 81 03      3535   3633 	STA	TYPEFLG
1294  a9            3536   3634 	XRA	C		;TYPE IS LAST FOUR BITS
1295  e6 0f         3537   3635 	ANI	00FH
1297  a9            3538   3636 	XRA	C
1298  4f            3539   3637 	MOV	C,A
                    3540   3638
1299  3a 7d 03      3541   3639 	LDA	SCANPFLG
129c  86            3542   3640 	ADD	M
129d  fe 28         3543   3641 	CPI	'('		;SUBSCRIPTED?
129f  ca 01 13      3544   3642 	JZ	MATSCANP
12a2  fe 5b         3545   3643 	CPI	'['		;BY LEFT BRACKET?
12a4  ca ff 12      3546   3644 	JZ	MATSCANB
12a7  af            3547   3645 	XRA	A
12a8  32 7d 03      3548   3646 	STA	SCANPFLG
12ab  e5            3549   3647 	PUSH	H
                    3550   3648
                    3551   3649 ;
                    3552   3650 ;  LOOK UP VARIABLE IN TABLE
                    3553   3651 ;
12ac  2a 99 03      3554   3652 	LHLD	VARTABLE
12af                3555   3653 VARSCANT:
12af  eb            3556   3654 	XCHG
12b0  2a 9b 03      3557   3655 	LHLD	MATTABLE
12b3  cd d7 04      3558   3656 	CALL	CMHLLTDE	;LOOK THROUGH VARIABLE TABLE
12b6  ca d0 12      3559   3657 	JZ	VARSCANF
12b9  1a            3560   3658 	LDAX	D
12ba  6f            3561   3659 	MOV	L,A
12bb  b9            3562   3660 	CMP	C
12bc  13            3563   3661 	INX	D
12bd  c2 c2 12      3564   3662 	JNZ	VARSCANM
12c0  1a            3565   3663 	LDAX	D
12c1  b8            3566   3664 	CMP	B
12c2                3567   3665 VARSCANM:
12c2  13            3568   3666 	INX	D
12c3  ca fd 12      3569   3667 	JZ	VARSCANX
12c6  7d            3570   3668 	MOV	A,L
12c7  e6 0f         3571   3669 	ANI	00FH		;ADDRESS NEXT ENTRY
12c9  6f            3572   3670 	MOV	L,A
12ca  26 00         3573   3671 	MVI	H,0
12cc  19            3574   3672 	DAD	D
12cd  c3 af 12      3575   3673 	JMP	VARSCANT
                    3576   3674
12d0                3577   3675 VARSCANF:
12d0  c5            3578   3676 	PUSH	B		;NOT FOUND, CREATE ENTRY
12d1  79            3579   3677 	MOV	A,C
12d2  e6 0f         3580   3678 	ANI	00FH
                    3581   3679
                    3582   3680 ;
                    3583   3681 ;  Page 77
                    3584   3682 ;
                    3585   3683
12d4  c6 02         3586   3684 	ADI	2
12d6  4f            3587   3685 	MOV	C,A
12d7  06 00         3588   3686 	MVI	B,0
12d9  eb            3589   3687 	XCHG
12da  2a 9d 03      3590   3688 	LHLD	FREELIMT
12dd  e5            3591   3689 	PUSH	H
12de  09            3592   3690 	DAD	B
12df  c1            3593   3691 	POP	B
12e0  e5            3594   3692 	PUSH	H
12e1  cd dd 04      3595   3693 	CALL	COPYCHK		;MOVE ARRAYS FOR SPACE
12e4  e1            3596   3694 	POP	H
12e5  22 9d 03      3597   3695 	SHLD	FREELIMT
12e8  60            3598   3696 	MOV	H,B
12e9  69            3599   3697 	MOV	L,C
12ea  22 9b 03      3600   3698 	SHLD	MATTABLE	;ALLOCATE, ZERO ENTRY
12ed                3601   3699 VARALLOC:
12ed  2b            3602   3700 	DCX	H	
12ee  36 00         3603   3701 	MVI	M,000H
12f0  cd d7 04      3604   3702 	CALL	CMHLLTDE
12f3  c2 ed 12      3605   3703 	JNZ	VARALLOC
12f6  d1            3606   3704 	POP	D
12f7  73            3607   3705 	MOV	M,E
12f8  23            3608   3706 	INX	H
12f9  72            3609   3707 	MOV	M,D
12fa  23            3610   3708 	INX	H
12fb  eb            3611   3709 	XCHG			;EXIT VARIABLE SCAN
12fc  b3            3612   3710 	ORA	E		;NZ=VAR NOT FOUND, CREATED
12fd                3613   3711 VARSCANX:
12fd  e1            3614   3712 	POP	H		;HL=SCAN POINTER
12fe  c9            3615   3713 	RET
                    3616   3714
                    3617   3715 ;
                    3618   3716 ;  LOOK UP ARRAY IN TABLE
                    3619   3717 ;
12ff                3620   3718 MATSCANB:
12ff  c6 01         3621   3719 	ADI	']'-'['+'('-')'	;(got me?)
1301                3622   3720 MATSCANP:
1301  c6 01         3623   3721 	ADI	')'-'('
1303  e5            3624   3722 	PUSH	H		;SCAN SUBSCRIPT OF VARIABLE
1304  2a 80 03      3625   3723 	LHLD	MATDMFLG
1307  b5            3626   3724 	ORA	L
1308  6f            3627   3725 	MOV	L,A
1309  e3            3628   3726 	XTHL			;SAVE DIMFLAG, CLOSE CHAR, TYPE
130a  16 00         3629   3727 	MVI	D,000H
130c                3630   3728 MATSCANL:
130c  d5            3631   3729 	PUSH	D		;SCAN SUBSCRIPT LIST
130d  c5            3632   3730 	PUSH	B
130e  cd c1 03      3633   3731 	CALL	SCANNXT		;scan ,
1311  cd 1d 0c      3634   3732 	CALL	VALINTDE	;EVALUATE SUBSCRIPT
1314  c1            3635   3733 	POP	B
1315  f1            3636   3734 	POP	PSW
1316  eb            3637   3735 	XCHG
1317  e3            3638   3736 	XTHL
1318  e5            3639   3737 	PUSH	H
1319  eb            3640   3738 	XCHG
131a  3c            3641   3739 	INR	A		;COUNT NUMBER OF SUBSCRIPTS
                    3642   3740
                    3643   3741 ;
                    3644   3742 ;  Page 78
                    3645   3743 ;
                    3646   3744
131b  57            3647   3745 	MOV	D,A
131c  7e            3648   3746 	MOV	A,M
131d  fe 2c         3649   3747 	CPI	','
131f  ca 0c 13      3650   3748 	JZ	MATSCANL
1322  e3            3651   3749 	XTHL
1323  22 80 03      3652   3750 	SHLD	MATDMFLG	;RESTORE DIMFLAG, TYPE
1326  7d            3653   3751 	MOV	A,L
1327  e1            3654   3752 	POP	H
1328  ae            3655   3753 	XRA	M
1329  87            3656   3754 	ADD	A		;CHECK FOR CORRECT CLOSER
132a  c2 05 06      3657   3755 	JNZ	ERRASN
132d  22 87 03      3658   3756 	SHLD	SCANPTR2
1330  d5            3659   3757 	PUSH	D
1331  2a 9b 03      3660   3758 	LHLD	MATTABLE	;LOOK FOR NAME IN
1334  c3 38 13      3661   3759 	JMP	MATSCANO	;MAT VARIABLE TABLE
1337                3662   3760 MATSCANN:
1337  19            3663   3761 	DAD	D
1338                3664   3762 MATSCANO:
1338  eb            3665   3763 	XCHG
1339  2a 9d 03      3666   3764 	LHLD	FREELIMT
133c  eb            3667   3765 	XCHG
133d  cd d7 04      3668   3766 	CALL	CMHLLTDE
1340  ca 66 13      3669   3767 	JZ	MATSCANC
1343  7e            3670   3768 	MOV	A,M
1344  b9            3671   3769 	CMP	C
1345  23            3672   3770 	INX	H
1346  c2 4b 13      3673   3771 	JNZ	MATSCANM
1349  7e            3674   3772 	MOV	A,M
134a  b8            3675   3773 	CMP	B
134b                3676   3774 MATSCANM:
134b  23            3677   3775 	INX	H
134c  5e            3678   3776 	MOV	E,M
134d  23            3679   3777 	INX	H
134e  56            3680   3778 	MOV	D,M
134f  23            3681   3779 	INX	H
1350  c2 37 13      3682   3780 	JNZ	MATSCANN
1353  3a 80 03      3683   3781 	LDA	MATDMFLG	;NAME FOUND
1356  b7            3684   3782 	ORA	A
1357  1e 10         3685   3783 	MVI	E,ERRNDD-ERRN
1359  fa 07 06      3686   3784 	JM	ERRMSG
135c  f1            3687   3785 	POP	PSW		;RIGHT NUMBER OF SUBSCRIPTS?
135d  be            3688   3786 	CMP	M
135e  ca ca 13      3689   3787 	JZ	MATSCANI
1361                3690   3788 ERRABS:
1361  1e 9f         3691   3789 	MVI	E,ERRNBS-ERRN
1363  c3 07 06      3692   3790 	JMP	ERRMSG
                    3693   3791
1366                3694   3792 MATSCANC:
1366  79            3695   3793 	MOV	A,C		;NAME NOT FOUND, CREATE NEW ENTRY
1367  e6 0f         3696   3794 	ANI	00FH
1369  5f            3697   3795 	MOV	E,A
136a  16 00         3698   3796 	MVI	D,0
136c  71            3699   3797 	MOV	M,C
136d  23            3700   3798 	INX	H
136e  70            3701   3799 	MOV	M,B
136f  23            3702   3800 	INX	H
                    3703   3801
                    3704   3802 ;
                    3705   3803 ;  Page 79
                    3706   3804 ;
                    3707   3805
1370  f1            3708   3806 	POP	PSW
1371  32 7f 03      3709   3807 	STA	MATSCCNT
1374  4f            3710   3808 	MOV	C,A
1375  cd ee 04      3711   3809 	CALL	SPACESTK
1378  22 85 03      3712   3810 	SHLD	SCANPTR1
137b  23            3713   3811 	INX	H
137c  23            3714   3812 	INX	H		;plus 2
137d  41            3715   3813 	MOV	B,C
137e  70            3716   3814 	MOV	M,B
137f  23            3717   3815 	INX	H
1380                3718   3816 MATSCNSB:
1380  3a 80 03      3719   3817 	LDA	MATDMFLG	;SET SUBSCRIPT RANGES
1383  b7            3720   3818 	ORA	A
1384  78            3721   3819 	MOV	A,B
1385  01 0b 00      3722   3820 	LXI	B,11		;DEFAULT RANGE=0-10
1388  f2 8d 13      3723   3821 	JP	MATSCNSD
138b  c1            3724   3822 	POP	B
138c  03            3725   3823 	INX	B
138d                3726   3824 MATSCNSD:
138d  71            3727   3825 	MOV	M,C
138e  23            3728   3826 	INX	H
138f  70            3729   3827 	MOV	M,B
1390  23            3730   3828 	INX	H
1391  f5            3731   3829 	PUSH	PSW
1392  e5            3732   3830 	PUSH	H
1393  cd ff 13      3733   3831 	CALL	MUL16		;UPDATE ARRAY SIZE
1396  eb            3734   3832 	XCHG
1397  e1            3735   3833 	POP	H
1398  c1            3736   3834 	POP	B
1399  05            3737   3835 	DCR	B
139a  c2 80 13      3738   3836 	JNZ	MATSCNSB
139d  42            3739   3837 	MOV	B,D
139e  4b            3740   3838 	MOV	C,E
139f  eb            3741   3839 	XCHG			;ALLOCATE ARRAY,
13a0  19            3742   3840 	DAD	D
13a1  da 61 13      3743   3841 	JC	ERRABS
13a4  cd fb 04      3744   3842 	CALL	SPACECHK
13a7  22 9d 03      3745   3843 	SHLD	FREELIMT
13aa                3746   3844 MATSCANZ:
13aa  2b            3747   3845 	DCX	H		;AND ZERO
13ab  36 00         3748   3846 	MVI	M,000H
13ad  cd d7 04      3749   3847 	CALL	CMHLLTDE
13b0  c2 aa 13      3750   3848 	JNZ	MATSCANZ
13b3  03            3751   3849 	INX	B		;SAVE ENTRY SIZE
13b4  67            3752   3850 	MOV	H,A
13b5  3a 80 03      3753   3851 	LDA	MATDMFLG
13b8  b7            3754   3852 	ORA	A
13b9  3a 7f 03      3755   3853 	LDA	MATSCCNT
13bc  6f            3756   3854 	MOV	L,A
13bd  29            3757   3855 	DAD	H
13be  09            3758   3856 	DAD	B
13bf  eb            3759   3857 	XCHG
13c0  2a 85 03      3760   3858 	LHLD	SCANPTR1	;AT BEGINNING OF ENTRY
13c3  73            3761   3859 	MOV	M,E
13c4  23            3762   3860 	INX	H
13c5  72            3763   3861 	MOV	M,D
                    3764   3862
                    3765   3863 ;
                    3766   3864 ;  Page 80
                    3767   3865 ;
                    3768   3866
13c6  23            3769   3867 	INX	H
13c7  fa f7 13      3770   3868 	JM	MATSCANX	;DIM ONLY?
13ca                3771   3869 MATSCANI:
13ca  23            3772   3870 	INX	H		;INITIALIZE SUBSCRIPT COMPUTATION
13cb  01 00 00      3773   3871 	LXI	B,0
13ce  c3 d2 13      3774   3872 	JMP	MATSCANS
13d1                3775   3873 MATSCANR:
13d1  e1            3776   3874 	POP	H		;COMPUTE SPECIFIC REFERENCE
13d2                3777   3875 MATSCANS:
13d2  5e            3778   3876 	MOV	E,M
13d3  23            3779   3877 	INX	H
13d4  56            3780   3878 	MOV	D,M
13d5  23            3781   3879 	INX	H
13d6  e3            3782   3880 	XTHL
13d7  f5            3783   3881 	PUSH	PSW
13d8  cd d7 04      3784   3882 	CALL	CMHLLTDE
13db  d2 61 13      3785   3883 	JNC	ERRABS
13de  e5            3786   3884 	PUSH	H
13df  cd ff 13      3787   3885 	CALL	MUL16
13e2  d1            3788   3886 	POP	D
13e3  19            3789   3887 	DAD	D
13e4  f1            3790   3888 	POP	PSW
13e5  3d            3791   3889 	DCR	A
13e6  44            3792   3890 	MOV	B,H
13e7  4d            3793   3891 	MOV	C,L
13e8  c2 d1 13      3794   3892 	JNZ	MATSCANR
13eb  3a 81 03      3795   3893 	LDA	TYPEFLG
13ee  5f            3796   3894 	MOV	E,A
13ef  16 00         3797   3895 	MVI	D,0
13f1  cd ff 13      3798   3896 	CALL	MUL16		;MULTIPLY BY ENTRY SIZE
13f4  c1            3799   3897 	POP	B
13f5  09            3800   3898 	DAD	B
13f6  eb            3801   3899 	XCHG
13f7                3802   3900 MATSCANX:
13f7  2a 87 03      3803   3901 	LHLD	SCANPTR2
13fa  cd c1 03      3804   3902 	CALL	SCANNXT		;bscan ,
13fd  bf            3805   3903 	CMP	A
13fe  c9            3806   3904 	RET
                    3807   3905
13ff                3808   3906 MUL16:
13ff  21 00 00      3809   3907 	LXI	H,0		;MULTIPLY BC*DE GIVING HL
1402  78            3810   3908 	MOV	A,B
1403  b1            3811   3909 	ORA	C
1404  c8            3812   3910 	RZ
1405  3e 10         3813   3911 	MVI	A,16
1407                3814   3912 MUL16LP:
1407  29            3815   3913 	DAD	H
1408  da 61 13      3816   3914 	JC	ERRABS
140b  eb            3817   3915 	XCHG
140c  29            3818   3916 	DAD	H
140d  eb            3819   3917 	XCHG
140e  d2 15 14      3820   3918 	JNC	MUL16XT
1411  09            3821   3919 	DAD	B
1412  da 61 13      3822   3920 	JC	ERRABS
1415                3823   3921 MUL16XT:
1415  3d            3824   3922 	DCR	A
                    3825   3923
                    3826   3924 ;
                    3827   3925 ;  Page 81
                    3828   3926 ;
                    3829   3927
1416  c2 07 14      3830   3928 	JNZ	MUL16LP
1419  c9            3831   3929 	RET
                    3832   3930
                    3833   3931 ;
                    3834   3932 ;  Page 82
                    3835   3933 ;
                    3836   3934
                    3837   3935 ;
                    3838   3936 ;  USER-DEFINED FUNCTION DEFINITION
                    3839   3937 ;
141a                3840   3938 DEFSTM:
141a  cd 1b 15      3841   3939 	CALL	SCANFNN		;DEF STATEMENT
141d  e5            3842   3940 	PUSH	H		;CHECK IF IN DIRECT MODE
141e  2a 89 03      3843   3941 	LHLD	CURLINE		;Z=DIRECT MODE
1421  23            3844   3942 	INX	H
1422  7c            3845   3943 	MOV	A,H
1423  b5            3846   3944 	ORA	L
1424  e1            3847   3945 	POP	H
1425  ca 16 15      3848   3946 	JZ	ERRAID
1428  eb            3849   3947 	XCHG			;SAVE REFERENCE TO DEFINITION
1429  73            3850   3948 	MOV	M,E
142a  23            3851   3949 	INX	H
142b  72            3852   3950 	MOV	M,D
142c  eb            3853   3951 	XCHG	
142d  7e            3854   3952 	MOV	A,M
142e  fe 28         3855   3953 	CPI	'('		;CHECK FOR VARLIST
1430                3856   3954 DEFSTML:
1430  c2 7f 0b      3857   3955 	JNZ	DATSTM
1433  cd c1 03      3858   3956 	CALL	SCANNXT		;bscan ,
1436  cd 48 12      3859   3957 	CALL	VARSCAN		;DEFINE VARIABLES IN LIST
1439  7e            3860   3958 	MOV	A,M
143a  fe 2c         3861   3959 	CPI	','
143c  c3 30 14      3862   3960 	JMP	DEFSTML
                    3863   3961
                    3864   3962 ;  USER-DEFINED FUNCTION EVALUATION
                    3865   3963 ;
143f                3866   3964 VALFCTD:
143f  cd 1b 15      3867   3965 	CALL	SCANFNN		;SCAN & EVALUATE USER DEFINED FUNCTION
1442  3a 81 03      3868   3966 	LDA	TYPEFLG		;SAVE TYPE OF FUNCTION
1445  b7            3869   3967 	ORA	A
1446  f5            3870   3968 	PUSH	PSW
1447  e5            3871   3969 	PUSH	H		;SAVE CALL ARGUMENTS
1448  eb            3872   3970 	XCHG
1449  7e            3873   3971 	MOV	A,M
144a  23            3874   3972 	INX	H
144b  66            3875   3973 	MOV	H,M		;FETCH FUNCTION DEFINITION
144c  6f            3876   3974 	MOV	L,A
144d  b4            3877   3975 	ORA	H
144e  1e b5         3878   3976 	MVI	E,ERRNUF-ERRN
1450  ca 07 06      3879   3977 	JZ	ERRMSG		;MUST BE DEFINED ...
                    3880   3978
                    3881   3979 ;
                    3882   3980 ;  Page 83
                    3883   3981 ;
                    3884   3982
1453  7e            3885   3983 	MOV	A,M
1454  fe 28         3886   3984 	CPI	'('		;PARAMETERS NEEDED?
1456  c2 bb 14      3887   3985 	JNZ	VALFCTNA	;APPARENTLY NOT
1459  cd c1 03      3888   3986 	CALL	SCANNXT		;bscan ,
145c  e3            3889   3987 	XTHL
145d  cd b9 03      3890   3988 	CALL	SCANNXTV	;bscan (val)
1460  28            3891   3989 	DB	'('		;MUST BE PARAMETERS IN CALL
1461  e3            3892   3990 	XTHL
1462  c3 6e 14      3893   3991 	JMP	VALFCTDM
                    3894   3992
                    3895   3993 ;  ARGUMENT SCANNING
                    3896   3994 ;
1465                3897   3995 VALFCTDL:
1465  cd b9 03      3898   3996 	CALL	SCANNXTV	;bscan (val)
1468  2c            3899   3997 	DB	','		;COMMAS BETWEEN ARGUMENTS
1469  e3            3900   3998 	XTHL
146a  cd b9 03      3901   3999 	CALL	SCANNXTV	;bscan (val)
146d  2c            3902   4000 	DB	','		;AND BETWEEN PARAMETERS
146e                3903   4001 VALFCTDM:
146e  0e 04         3904   4002 	MVI	C,4		;VERIFY SPACE ON STACK
1470  cd ee 04      3905   4003 	CALL	SPACESTK
1473  3e ab         3906   4004 	MVI	A,SCANPFLD	;SCAN NEXT PARAMETER
1475  32 7d 03      3907   4005 	STA	SCANPFLG
1478  cd d9 10      3908   4006 	CALL	VALVAR		;GET CURRENT VALUE OF PARAMETER
147b  22 85 03      3909   4007 	SHLD	SCANPTR1	;SAVE PARAMETER SCAN
147e  e1            3910   4008 	POP	H
147f  22 87 03      3911   4009 	SHLD	SCANPTR2	;SAVE ARGUMENT SCAN
1482  cd ef 03      3912   4010 	CALL	TYPECHK
1485  ca 8f 14      3913   4011 	JZ	VALFCTPS	;PUSH STRINGS DIFFERENTLY
1488  cd c4 1b      3914   4012 	CALL	PUSHAC1		;PUSH NUMERIC ACCUMULATOR
148b  e5            3915   4013 	PUSH	H		;SAVE VARIABLE'S ADDRESS
148c  c3 9c 14      3916   4014 	JMP	VALFCTPT
148f                3917   4015 VALFCTPS:
148f  cd b6 11      3918   4016 	CALL	STRGALOV	;COPY DESCRIPTOR TO TEMPORARY
1492  af            3919   4017 	XRA	A		;ELIMINATE ORIGINAL DESCRIPTOR
1493  1b            3920   4018 	DCX	D
1494  1b            3921   4019 	DCX	D
1495  1b            3922   4020 	DCX	D		;plus 3
1496  12            3923   4021 	STAX	D
1497  2a a9 03      3924   4022 	LHLD	ACCUMLTR	;GET ADDRESS OF DESCRIPTOR
149a  e5            3925   4023 	PUSH	H
149b  d5            3926   4024 	PUSH	D		;PUT IT BACK HERE LATER
                    3927   4025
                    3928   4026 ;
                    3929   4027 ;  Page 84
                    3930   4028 ;
149c                3931   4029 VALFCTPT:
149c  3a 81 03      3932   4030 	LDA	TYPEFLG		;SAVE TYPE OF PARAMETER
149f  37            3933   4031 	STC
14a0  d1            3934   4032 	POP	D
14a1  d5            3935   4033 	PUSH	D		;GET COPY OF ADDRESS
14a2  f5            3936   4034 	PUSH	PSW
14a3  2a 85 03      3937   4035 	LHLD	SCANPTR1	;SAVE PARAMETER SCAN
14a6  e5            3938   4036 	PUSH	H
14a7  2a 87 03      3939   4037 	LHLD	SCANPTR2
14aa  cd c7 0b      3940   4038 	CALL	ASSIGNVL	;UPDATE VALUE OF PARAMETER
14ad  7e            3941   4039 	MOV	A,M
14ae  fe 29         3942   4040 	CPI	')'
14b0  c2 65 14      3943   4041 	JNZ	VALFCTDL	;MORE ARGUMENTS
14b3  cd c1 03      3944   4042 	CALL	SCANNXT		;bscan (val)
14b6  e3            3945   4043 	XTHL
14b7  cd b9 03      3946   4044 	CALL	SCANNXTV	;bcscan (val)
14ba  29            3947   4045 	DB	')'		;MUST BE END OF PARAMETERS TOO
                    3948   4046
                    3949   4047 ;  EVALUATE EXPRESSION
                    3950   4048 ;
14bb                3951   4049 VALFCTNA:
14bb  cd b9 03      3952   4050 	CALL	SCANNXTV	;bscan (val)
14be  b5            3953   4051 	DB	KEYEQ		;LOOK FOR EQUALS SIGN
14bf  cd a9 0f      3954   4052 	CALL	VALEXPR		;bscan expr  ;EVALUATE FUNCTION
14c2  2b            3955   4053 	DCX	H
14c3  cd c1 03      3956   4054 	CALL	SCANNXT		;bscan ,
14c6  c2 05 06      3957   4055 	JNZ	ERRASN
14c9  e1            3958   4056 	POP	H
14ca  22 85 03      3959   4057 	SHLD	SCANPTR1
14cd  cd ef 03      3960   4058 	CALL	TYPECHK
14d0  c2 da 14      3961   4059 	JNZ	VALFCTRL
14d3  cd ec 0b      3962   4060 	CALL	STRGUNIQ
14d6  eb            3963   4061 	XCHG
14d7  22 a9 03      3964   4062 	SHLD	ACCUMLTR
                    3965   4063
                    3966   4064 ;
                    3967   4065 ;  Page 85
                    3968   4066 ;
                    3969   4067
                    3970   4068 ;  RESTORE PARAMETERS
                    3971   4069 ;
14da                3972   4070 VALFCTRL:
14da  f1            3973   4071 	POP	PSW		;RESTORE VALUES OF PARAMETERS
14db  d2 ff 14      3974   4072 	JNC	VALFCTCR
14de  e1            3975   4073 	POP	H
14df  cd f2 03      3976   4074 	CALL	TYPECHKA
14e2  ca f1 14      3977   4075 	JZ	VALFCTRS
14e5  c1            3978   4076 	POP	B
14e6  d1            3979   4077 	POP	D
14e7  73            3980   4078 	MOV	M,E		;RESTORE NUMERIC VALUE
14e8  23            3981   4079 	INX	H
14e9  72            3982   4080 	MOV	M,D
14ea  23            3983   4081 	INX	H
14eb  71            3984   4082 	MOV	M,C
14ec  23            3985   4083 	INX	H
14ed  70            3986   4084 	MOV	M,B
14ee  c3 da 14      3987   4085 	JMP	VALFCTRL
14f1                3988   4086 VALFCTRS:
14f1  d1            3989   4087 	POP	D		;RESTORE STRING VALUE
14f2  eb            3990   4088 	XCHG
14f3  22 a5 03      3991   4089 	SHLD	STRGTMPP	;DEALLOCATE TEMPORARY
14f6  eb            3992   4090 	XCHG
14f7  06 03         3993   4091 	MVI	B,TYPESTRG
14f9  cd f1 1b      3994   4092 	CALL	COPYVALL
14fc  c3 da 14      3995   4093 	JMP	VALFCTRL
                    3996   4094
14ff                3997   4095 VALFCTCR:
14ff  2a 85 03      3998   4096 	LHLD	SCANPTR1	;COERCE RESULT TO CORRECT TYPE
1502  cd f2 03      3999   4097 	CALL	TYPECHKA	
1505  c2 fe 0b      4000   4098 	JNZ	COERCEF
1508  cd 11 0c      4001   4099 	CALL	CSTRING		;STRING FUNCTION
150b  e5            4002   4100 	PUSH	H
150c  2a a9 03      4003   4101 	LHLD	ACCUMLTR
150f  eb            4004   4102 	XCHG
1510  cd dd 11      4005   4103 	CALL	STRGRELT
1513  c3 96 11      4006   4104 	JMP	STRGALOU
                    4007   4105
1516                4008   4106 ERRAID:
1516  1e 1a         4009   4107 	MVI	E,ERRNID-ERRN
1518  c3 07 06      4010   4108 	JMP	ERRMSG
                    4011   4109
151b                4012   4110 SCANFNN:
151b  cd b9 03      4013   4111 	CALL	SCANNXTV	;bscan (val)
151e  a7            4014   4112 	DB	KEYFN
151f  3e ab         4015   4113 	MVI	A,SCANPFLD
1521  32 7d 03      4016   4114 	STA	SCANPFLG
1524  06 20         4017   4115 	MVI	B,TYPEDEF
1526  c3 4e 12      4018   4116 	JMP	VARSCNDF
                    4019   4117
                    4020   4118 ;
                    4021   4119 ;  Page 86
                    4022   4120 ;
                    4023   4121
                    4024   4122 ;
                    4025   4123 ;  GENERATE A NEW CURRENT STRING
                    4026   4124 ;
1529                4027   4125 STRNGEN:
1529  cd 37 15      4028   4126 	CALL	STRGALOC	;GENERATE A NEW STRING,
152c                4029   4127 STRSTCDS:
152c  21 82 03      4030   4128 	LXI	H,STRGTMPL	;SET CURRENT STRING DESCRIPTOR
152f  e5            4031   4129 	PUSH	H
1530  77            4032   4130 	MOV	M,A
1531  23            4033   4131 	INX	H
1532  73            4034   4132 	MOV	M,E
1533  23            4035   4133 	INX	H
1534  72            4036   4134 	MOV	M,D
1535  e1            4037   4135 	POP	H
1536  c9            4038   4136 	RET
                    4039   4137
                    4040   4138 ;
                    4041   4139 ;  ALLOCATE STORAGE IN STRING SPACE
                    4042   4140 ;
1537                4043   4141 STRGALOC:
1537  b7            4044   4142 	ORA	A		;ALLOCATE SPACE FOR STRING,
1538  c3 3c 15      4045   4143 	JMP	STRGALAH	;SIZE IN A
153b                4046   4144 STRGALAG:
153b  f1            4047   4145 	POP	PSW		;ENTER FOR SECOND TRY
153c                4048   4146 STRGALAH:
153c  f5            4049   4147 	PUSH	PSW
153d  2a 9f 03      4050   4148 	LHLD	STCKBASE
1540  eb            4051   4149 	XCHG
1541  2a a1 03      4052   4150 	LHLD	STRGFREE
1544  2f            4053   4151 	CMA
1545  4f            4054   4152 	MOV	C,A
1546  06 ff         4055   4153 	MVI	B,0FFH
1548  09            4056   4154 	DAD	B
1549  23            4057   4155 	INX	H
154a  cd d7 04      4058   4156 	CALL	CMHLLTDE
154d  da 57 15      4059   4157 	JC	STRGALGC
1550  22 a1 03      4060   4158 	SHLD	STRGFREE
1553  23            4061   4159 	INX	H
1554  eb            4062   4160 	XCHG			;RETURNS:  DE=STRING ADDRESS
1555                4063   4161 POPAFRET:
1555  f1            4064   4162 	POP	PSW
1556  c9            4065   4163 	RET
                    4066   4164
1557                4067   4165 STRGALGC:
1557  f1            4068   4166 	POP	PSW		;COLLECT GARBAGE IN STRING SPACE
1558  1e 85         4069   4167 	MVI	E,ERRNOS-ERRN
155a  ca 07 06      4070   4168 	JZ	ERRMSG
155d  bf            4071   4169 	CMP	A
155e  f5            4072   4170 	PUSH	PSW
155f  01 3b 15      4073   4171 	LXI	B,STRGALAG	;THEN TRY ALLOCATION
1562  c5            4074   4172 	PUSH	B
                    4075   4173
                    4076   4174 ;
                    4077   4175 ;  Page 87
                    4078   4176 ;
                    4079   4177
                    4080   4178 ;
                    4081   4179 ;  COLLECT GARBAGE IN STRING SPACE
                    4082   4180 ;
1563                4083   4181 STRGGBCL:
1563  2a a3 03      4084   4182 	LHLD	STRGBASE	;MAKE ALL STRINGS UNSAFE
1566                4085   4183 STRGGBLP:
1566  22 a1 03      4086   4184 	SHLD	STRGFREE	;FIND HIGHEST UNSAFE STRING
1569  21 00 00      4087   4185 	LXI	H,0
156c  e5            4088   4186 	PUSH	H
156d  2a 9f 03      4089   4187 	LHLD	STCKBASE
1570  e5            4090   4188 	PUSH	H
1571  2a a3 03      4091   4189 	LHLD	STRGBASE	;SCAN TEMPORARIES,
1574  23            4092   4190 	INX	H
1575                4093   4191 STRGGBTL:
1575  eb            4094   4192 	XCHG
1576  2a a5 03      4095   4193 	LHLD	STRGTMPP
1579  eb            4096   4194 	XCHG
157a  cd d7 04      4097   4195 	CALL	CMHLLTDE
157d  01 75 15      4098   4196 	LXI	B,STRGGBTL
1580  c2 d7 15      4099   4197 	JNZ	STRGGBHI
1583  2a 99 03      4100   4198 	LHLD	VARTABLE	;SCAN REGULAR VARIABLES,
1586                4101   4199 STRGGBVR:
1586  eb            4102   4200 	XCHG
1587  2a 9b 03      4103   4201 	LHLD	MATTABLE
158a  eb            4104   4202 	XCHG
158b  cd d7 04      4105   4203 	CALL	CMHLLTDE
158e  ca a7 15      4106   4204 	JZ	STRGGNAV
1591  7e            4107   4205 	MOV	A,M
1592  23            4108   4206 	INX	H
1593  e6 0f         4109   4207 	ANI	00FH
1595  d6 03         4110   4208 	SUI	TYPESTRG
1597  5f            4111   4209 	MOV	E,A
1598  9f            4112   4210 	SBB	A
1599  57            4113   4211 	MOV	D,A
159a  7e            4114   4212 	MOV	A,M
159b  23            4115   4213 	INX	H
159c  e6 80         4116   4214 	ANI	080H		;DEFINITIONS ARE STRINGS
159e  19            4117   4215 	DAD	D
159f  b3            4118   4216 	ORA	E
15a0  cd d9 15      4119   4217 	CALL	STRGGBHV
15a3  c3 86 15      4120   4218 	JMP	STRGGBVR
                    4121   4219
15a6                4122   4220 STRGGBAL:
15a6  c1            4123   4221 	POP	B
15a7                4124   4222 STRGGNAV:
15a7  eb            4125   4223 	XCHG			;SCAN ARRAY VARIABLES
15a8  2a 9d 03      4126   4224 	LHLD	FREELIMT
15ab  eb            4127   4225 	XCHG
15ac  cd d7 04      4128   4226 	CALL	CMHLLTDE
15af  ca ff 15      4129   4227 	JZ	STRGGBMV
15b2  cd e1 1b      4130   4228 	CALL	LDRGMM
15b5  7b            4131   4229 	MOV	A,E
15b6  e5            4132   4230 	PUSH	H
15b7  09            4133   4231 	DAD	B
15b8  e6 0f         4134   4232 	ANI	00FH
                    4135   4233
                    4136   4234 ;
                    4137   4235 ;  Page 88
                    4138   4236 ;
                    4139   4237
15ba  fe 03         4140   4238 	CPI	TYPESTRG
15bc  c2 a6 15      4141   4239 	JNZ	STRGGBAL
15bf  22 85 03      4142   4240 	SHLD	SCANPTR1
15c2  e1            4143   4241 	POP	H
15c3  4e            4144   4242 	MOV	C,M
15c4  06 00         4145   4243 	MVI	B,000H
15c6  09            4146   4244 	DAD	B
15c7  09            4147   4245 	DAD	B
15c8  23            4148   4246 	INX	H
15c9                4149   4247 STRGGBAS:
15c9  eb            4150   4248 	XCHG			;LOOK THROUGH ENTIRE ARRAY
15ca  2a 85 03      4151   4249 	LHLD	SCANPTR1
15cd  eb            4152   4250 	XCHG
15ce  cd d7 04      4153   4251 	CALL	CMHLLTDE
15d1  ca a7 15      4154   4252 	JZ	STRGGNAV
15d4  01 c9 15      4155   4253 	LXI	B,STRGGBAS
15d7                4156   4254 STRGGBHI:
15d7  c5            4157   4255 	PUSH	B		;COMPARE THIS STRING ADDR TO MAX
15d8  af            4158   4256 	XRA	A
15d9                4159   4257 STRGGBHV:
15d9  4e            4160   4258 	MOV	C,M		;LOAD STRING DESCRIPTOR
15da  23            4161   4259 	INX	H
15db  5e            4162   4260 	MOV	E,M
15dc  23            4163   4261 	INX	H
15dd  56            4164   4262 	MOV	D,M
15de  23            4165   4263 	INX	H
15df  c0            4166   4264 	RNZ			;NOT A STRING VARIABLE
15e0  79            4167   4265 	MOV	A,C
15e1  b7            4168   4266 	ORA	A		;CHECK FOR ZERO LENGTH
15e2  c8            4169   4267 	RZ
15e3  44            4170   4268 	MOV	B,H		;ALREADY SAFE?
15e4  4d            4171   4269 	MOV	C,L
15e5  2a a1 03      4172   4270 	LHLD	STRGFREE
15e8  cd d7 04      4173   4271 	CALL	CMHLLTDE
15eb  60            4174   4272 	MOV	H,B
15ec  69            4175   4273 	MOV	L,C
15ed  d8            4176   4274 	RC
15ee  e1            4177   4275 	POP	H		;COMPARE WITH HIGHEST UNSAFE
15ef  e3            4178   4276 	XTHL
15f0  cd d7 04      4179   4277 	CALL	CMHLLTDE
15f3  e3            4180   4278 	XTHL
15f4  e5            4181   4279 	PUSH	H
15f5  60            4182   4280 	MOV	H,B
15f6  69            4183   4281 	MOV	L,C
15f7  d0            4184   4282 	RNC
15f8  c1            4185   4283 	POP	B		;SAVE NEW HIGHEST UNSAFE ADDR
15f9  f1            4186   4284 	POP	PSW
15fa  f1            4187   4285 	POP	PSW
15fb  e5            4188   4286 	PUSH	H
15fc  d5            4189   4287 	PUSH	D
15fd  c5            4190   4288 	PUSH	B
15fe  c9            4191   4289 	RET
                    4192   4290
                    4193   4291 ;
                    4194   4292 ;  Page 89
                    4195   4293 ;
                    4196   4294
15ff                4197   4295 STRGGBMV:
15ff  d1            4198   4296 	POP	D		;MAKE HIGHEST UNSAFE SAFE
1600  e1            4199   4297 	POP	H
1601  7d            4200   4298 	MOV	A,L
1602  b4            4201   4299 	ORA	H
1603  c8            4202   4300 	RZ			;ANY UNSAFE?
1604  2b            4203   4301 	DCX	H		;LOAD DESCRIPTOR
1605  46            4204   4302 	MOV	B,M
1606  2b            4205   4303 	DCX	H
1607  4e            4206   4304 	MOV	C,M
1608  e5            4207   4305 	PUSH	H
1609  2b            4208   4306 	DCX	H
160a  6e            4209   4307 	MOV	L,M		;FIND END OF STRING
160b  26 00         4210   4308 	MVI	H,000H
160d  09            4211   4309 	DAD	B
160e  50            4212   4310 	MOV	D,B
160f  59            4213   4311 	MOV	E,C
1610  2b            4214   4312 	DCX	H
1611  44            4215   4313 	MOV	B,H
1612  4d            4216   4314 	MOV	C,L
1613  2a a1 03      4217   4315 	LHLD	STRGFREE	;COPY IT TO END OF SAFE AREA
1616  cd e0 04      4218   4316 	CALL	COPYTEXT
1619  e1            4219   4317 	POP	H
161a  71            4220   4318 	MOV	M,C
161b  23            4221   4319 	INX	H
161c  70            4222   4320 	MOV	M,B
161d  60            4223   4321 	MOV	H,B
161e  69            4224   4322 	MOV	L,C
161f  2b            4225   4323 	DCX	H
1620  c3 66 15      4226   4324 	JMP	STRGGBLP	;EXTEND SAFE AREA
                    4227   4325
                    4228   4326 ;
                    4229   4327 ;  Page 90
                    4230   4328 ;
                    4231   4329
                    4232   4330 ;
                    4233   4331 ;  VARIOUS NUMERIC/STRING CONVERSION FUNCTIONS
                    4234   4332 ;
                    4235   4333
                    4236   4334 ;
                    4237   4335 ;  FIND LENGTH OF STRING
                    4238   4336 ;
1623                4239   4337 LENFCT:
1623  01 e4 0d      4240   4338 	LXI	B,FLOATA	;LEN FUNCTION
1626  c5            4241   4339 	PUSH	B
1627                4242   4340 LENFCTC:
1627  cd 11 0c      4243   4341 	CALL	CSTRING
162a  cd bf 11      4244   4342 	CALL	STRGRELA
162d  3e 04         4245   4343 	MVI	A,TYPESING
162f  32 81 03      4246   4344 	STA	TYPEFLG
1632  7e            4247   4345 	MOV	A,M
1633  b7            4248   4346 	ORA	A
1634  23            4249   4347 	INX	H
1635  c9            4250   4348 	RET
                    4251   4349
                    4252   4350 ;
                    4253   4351 ;  CONVERT CHARACTER TO BYTE
                    4254   4352 ;
1636                4255   4353 ASCFCT:
1636  cd 27 16      4256   4354 	CALL	LENFCTC		;ASC FUNCTION
1639  ca 39 0c      4257   4355 	JZ	ERRAFC
163c  4e            4258   4356 	MOV	C,M		;FETCH ADDRESS
163d  23            4259   4357 	INX	H
163e  46            4260   4358 	MOV	B,M
163f  0a            4261   4359 	LDAX	B		;THEN THE FIRST CHARACTER
1640  c3 e4 0d      4262   4360 	JMP	FLOATA
                    4263   4361
                    4264   4362 ;
                    4265   4363 ;  CONVERT BYTE TO CHARACTER
                    4266   4364 ;
1643                4267   4365 CHRFCT:
1643  3e 01         4268   4366 	MVI	A,1		;CHR$ FUNCTION
1645  cd 29 15      4269   4367 	CALL	STRNGEN
1648  cd 45 0c      4270   4368 	CALL	CBYTE
164b  2a 83 03      4271   4369 	LHLD	STRGTMPA
164e  73            4272   4370 	MOV	M,E
164f                4273   4371 VALRETST:
164f  c1            4274   4372 	POP	B		;STRING FUNCTION, REMOVE CSINGLE
1650  c3 93 11      4275   4373 	JMP	STRGALOT
                    4276   4374
                    4277   4375 ;
                    4278   4376 ;  Page 91
                    4279   4377 ;
                    4280   4378
                    4281   4379 ;
                    4282   4380 ;  DECODE NUMBER FROM STRING
                    4283   4381 ;
1653                4284   4382 VALFCT:
1653  cd 27 16      4285   4383 	CALL	LENFCTC		;VAL FUNCTION
1656  ca 30 1a      4286   4384 	JZ	ZEROAC
1659  5f            4287   4385 	MOV	E,A
165a  16 00         4288   4386 	MVI	D,0
165c  4e            4289   4387 	MOV	C,M
165d  23            4290   4388 	INX	H
165e  46            4291   4389 	MOV	B,M
165f  c5            4292   4390 	PUSH	B
1660  60            4293   4391 	MOV	H,B
1661  69            4294   4392 	MOV	L,C
1662  19            4295   4393 	DAD	D
1663  46            4296   4394 	MOV	B,M
1664  72            4297   4395 	MOV	M,D
1665  e3            4298   4396 	XTHL
1666  c5            4299   4397 	PUSH	B
1667  7e            4300   4398 	MOV	A,M
1668  cd cf 1c      4301   4399 	CALL	DECODE
166b  c1            4302   4400 	POP	B
166c  e1            4303   4401 	POP	H
166d  70            4304   4402 	MOV	M,B
166e  c9            4305   4403 	RET
                    4306   4404
                    4307   4405 ;
                    4308   4406 ;  ENCODE NUMBER IN STRING
                    4309   4407 ;
166f                4310   4408 STRFCT:
166f  cd 0a 0c      4311   4409 	CALL	CSINGLE		;STR$ FUNCTION
1672  cd 5f 11      4312   4410 	CALL	VALSTRGN	;CREATE STRING FROM NUMBER
1675  cd bf 11      4313   4411 	CALL	STRGRELA
1678  01 4f 16      4314   4412 	LXI	B,VALRETST
167b  c5            4315   4413 	PUSH	B
167c  eb            4316   4414 	XCHG
167d                4317   4415 STRGSTOR:
167d  eb            4318   4416 	XCHG
167e  7e            4319   4417 	MOV	A,M		;STORE STRING INTO STRING SPACE,
167f  e5            4320   4418 	PUSH	H		;LEAVE DESCRIPTOR IN STRGTMP
1680  cd 37 15      4321   4419 	CALL	STRGALOC
1683  e1            4322   4420 	POP	H
1684  cd e4 1b      4323   4421 	CALL	LDICBMM		;LOAD BUFFER ADDRESS
1687  cd 2c 15      4324   4422 	CALL	STRSTCDS
168a  e5            4325   4423 	PUSH	H
168b  6f            4326   4424 	MOV	L,A
168c  cd 2c 12      4327   4425 	CALL	COPYSTRG
168f                4328   4426 POPDERET:
168f  d1            4329   4427 	POP	D
1690  c9            4330   4428 	RET
                    4331   4429
                    4332   4430 ;
                    4333   4431 ;  Page 92
                    4334   4432 ;
                    4335   4433
                    4336   4434 ;
                    4337   4435 ;  CONVERT HEX STRING TO NUMBER
                    4338   4436 ;
1691                4339   4437 HXVFCT:
1691  cd 27 16      4340   4438 	CALL	LENFCTC		;DO INITIAL PROCESSING
1694  ca 30 1a      4341   4439 	JZ	ZEROAC
1697  5f            4342   4440 	MOV	E,A
1698  4e            4343   4441 	MOV	C,M
1699  23            4344   4442 	INX	H
169a  46            4345   4443 	MOV	B,M
169b  21 00 00      4346   4444 	LXI	H,0		;INITIAL OUTPUT TO ZERO
169e                4347   4445 HXVFCTL:
169e  0a            4348   4446 	LDAX	B		;FETCH CHARACTER
169f  03            4349   4447 	INX	B
16a0  fe 3a         4350   4448 	CPI	':'		;  VERIFY THAT IT'S HEX
16a2  d4 bc 16      4351   4449 	CNC	HXVFCTCH
16a5  d2 39 0c      4352   4450 	JNC	ERRAFC		;IF NOT, COMPLAIN
16a8  d6 30         4353   4451 	SUI	'0'
16aa  da 39 0c      4354   4452 	JC	ERRAFC		;MUST BE AT LEAST ZERO
16ad  29            4355   4453 	DAD	H
16ae  29            4356   4454 	DAD	H		;INCORPORATE NEW DIGIT
16af  29            4357   4455 	DAD	H
16b0  29            4358   4456 	DAD	H
16b1  b5            4359   4457 	ORA	L
16b2  6f            4360   4458 	MOV	L,A
16b3  1d            4361   4459 	DCR	E		;COUNT DIGITS
16b4  c2 9e 16      4362   4460 	JNZ	HXVFCTL
16b7                4363   4461 FLOATHL:
16b7  7c            4364   4462 	MOV	A,H		;CONVERT INTEGER IN HL TO FLOAT
16b8  45            4365   4463 	MOV	B,L
16b9  c3 e4 17      4366   4464 	JMP	FLOATAB
                    4367   4465
16bc                4368   4466 HXVFCTCH:
16bc  cd d2 03      4369   4467 	CALL	ALPHACHA	;CONVERT ANY ALPHA TO UPPER
16bf  d0            4370   4468 	RNC
16c0  d6 07         4371   4469 	SUI	'A'-'9'-1	;MOVE ALPHA TO AFTER DIGITS
16c2  fe 40         4372   4470 	CPI	'0'+16		;SET FLAGS CORRECTLY
16c4  c9            4373   4471 	RET
                    4374   4472
                    4375   4473 ;
                    4376   4474 ;  Page 93
                    4377   4475 ;
                    4378   4476
                    4379   4477 ;
                    4380   4478 ;  CONVERT BYTE TO TWO HEX CHARACTERS
                    4381   4479 ;
16c5                4382   4480 HEXFCT:
16c5  3e 02         4383   4481 	MVI	A,2		;ALLOCATE OUTPUT STRING
16c7  cd 29 15      4384   4482 	CALL	STRNGEN
16ca  3a ac 03      4385   4483 	LDA	FLACCEXP
16cd  cd 3c 1c      4386   4484 	CALL	FIXAC		;GET INPUT BYTE
16d0  21 4f 16      4387   4485 	LXI	H,VALRETST
16d3  e5            4388   4486 	PUSH	H
16d4  2a 83 03      4389   4487 	LHLD	STRGTMPA
16d7  cd da 16      4390   4488 	CALL	HEXFCTL
16da                4391   4489 HEXFCTL:
16da  7b            4392   4490 	MOV	A,E		;CONVERT ONE DIGIT
16db  07            4393   4491 	RLC
16dc  07            4394   4492 	RLC
16dd  07            4395   4493 	RLC
16de  07            4396   4494 	RLC
16df  5f            4397   4495 	MOV	E,A
16e0  e6 0f         4398   4496 	ANI	00FH
16e2  fe 0a         4399   4497 	CPI	10
16e4  3f            4400   4498 	CMC			;COVERT TO CHARACTER FORM
16e5  ce 30         4401   4499 	ACI	'0'
16e7  27            4402   4500 	DAA
16e8  77            4403   4501 	MOV	M,A
16e9  23            4404   4502 	INX	H
16ea  c9            4405   4503 	RET
                    4406   4504
                    4407   4505 ;
                    4408   4506 ;  TRANSLATE STRING TO UPPER CASE
                    4409   4507 ;
16eb                4410   4508 UPRFCT:
16eb  cd 11 0c      4411   4509 	CALL	CSTRING
16ee  2a a9 03      4412   4510 	LHLD	ACCUMLTR	;GET LENGTH OF OPERAND
16f1  e5            4413   4511 	PUSH	H
16f2  7e            4414   4512 	MOV	A,M
16f3  cd 29 15      4415   4513 	CALL	STRNGEN		;ALLOCATE OUTPUT STRING
16f6  d1            4416   4514 	POP	D
16f7  cd c3 11      4417   4515 	CALL	STRGRELD	;RELEASE INPUT STRING
16fa  cd e3 1b      4418   4516 	CALL	LDDCBMM
16fd  2a 83 03      4419   4517 	LHLD	STRGTMPA
1700  14            4420   4518 	INR	D
1701                4421   4519 UPRFCTL:
1701  15            4422   4520 	DCR	D		;TRANSLATE WHILE COPYING
1702  ca 4f 16      4423   4521 	JZ	VALRETST	;DONE
1705  0a            4424   4522 	LDAX	B
1706  cd d2 03      4425   4523 	CALL	ALPHACHA	;CONVER LOWER TO UPPER
1709  77            4426   4524 	MOV	M,A
170a  03            4427   4525 	INX	B
170b  23            4428   4526 	INX	H
170c  c3 01 17      4429   4527 	JMP	UPRFCTL
                    4430   4528
                    4431   4529 ;
                    4432   4530 ;  Page 94
                    4433   4531 ;
                    4434   4532
                    4435   4533 ;
                    4436   4534 ;  SUBSTRING FUNCTIONS
                    4437   4535 ;
170f                4438   4536 LFTFCT:
170f  cd 1f 17      4439   4537 	CALL	LEFRIGAR	;LEFT$ FUNCTION
1712  af            4440   4538 	XRA	A		;LEFT(X,N)=MID(X,1,N)
1713                4441   4539 LEFRIGMR:
1713  e3            4442   4540 	XTHL
1714  4f            4443   4541 	MOV	C,A		;C=START-1, B=LEN
1715                4444   4542 LEFRIGMD:
1715  e5            4445   4543 	PUSH	H		;RESOLVE DESIRED LEN WITH STRING
1716  7e            4446   4544 	MOV	A,M
1717  b8            4447   4545 	CMP	B
1718  da 29 17      4448   4546 	JC	LEFRIGMC
171b  78            4449   4547 	MOV	A,B
171c  c3 2b 17      4450   4548 	JMP	LEFRIGMB
                    4451   4549
171f                4452   4550 LEFRIGAR:
171f  eb            4453   4551 	XCHG			;INITIAL COMMON PROCESSING
1720  cd 3e 0c      4454   4552 	CALL	VALBYTE2	;FOR LEFT$, RIGHT$
1723  43            4455   4553 	MOV	B,E
1724  cd b9 03      4456   4554 	CALL	SCANNXTV	;bscan (val)
1727  29            4457   4555 	DB	')'
1728  c9            4458   4556 	RET
                    4459   4557
1729                4460   4558 LEFRIGMC:
1729  0e 00         4461   4559 	MVI	C,0
172b                4462   4560 LEFRIGMB:
172b  c5            4463   4561 	PUSH	B
172c  cd 37 15      4464   4562 	CALL	STRGALOC	;ALLOCATE ANSWER STRING
172f  c1            4465   4563 	POP	B
1730  e1            4466   4564 	POP	H
1731  e5            4467   4565 	PUSH	H
1732  23            4468   4566 	INX	H
1733  46            4469   4567 	MOV	B,M		;COMPUTE ADDRESSES FOR COPY
1734  23            4470   4568 	INX	H
1735  66            4471   4569 	MOV	H,M
1736  68            4472   4570 	MOV	L,B		;(from HL,MB)
1737  06 00         4473   4571 	MVI	B,0
1739  09            4474   4572 	DAD	B
173a  44            4475   4573 	MOV	B,H
173b  4d            4476   4574 	MOV	C,L
173c  cd 2c 15      4477   4575 	CALL	STRSTCDS
173f  6f            4478   4576 	MOV	L,A
1740  cd 2c 12      4479   4577 	CALL	COPYSTRG	;COPY
1743  d1            4480   4578 	POP	D
1744  cd c3 11      4481   4579 	CALL	STRGRELD
1747  c3 93 11      4482   4580 	JMP	STRGALOT
                    4483   4581
                    4484   4582 ;
                    4485   4583 ;  Page 95
                    4486   4584 ;
                    4487   4585
174a                4488   4586 RIGFCT:
174a  cd 1f 17      4489   4587 	CALL	LEFRIGAR	;RIGHT$ FUNCTION
174d  d1            4490   4588 	POP	D
174e  d5            4491   4589 	PUSH	D
174f  1a            4492   4590 	LDAX	D
1750  90            4493   4591 	SUB	B		;RIGHT(X,N)=MID(X,LEN(X)-N+1,N)
1751  c3 13 17      4494   4592 	JMP	LEFRIGMR
                    4495   4593
1754                4496   4594 MIDFCT:
1754  eb            4497   4595 	XCHG			;MID$ FUNCTION
1755  cd 3e 0c      4498   4596 	CALL	VALBYTE2	;SCAN STARTING POSITION
1758  43            4499   4597 	MOV	B,E
1759  b7            4500   4598 	ORA	A		;NON-ZERO STARTING POSITION?
175a  ca 39 0c      4501   4599 	JZ	ERRAFC
175d  c5            4502   4600 	PUSH	B
175e  1e ff         4503   4601 	MVI	E,0FFH
1760  7e            4504   4602 	MOV	A,M
1761  fe 29         4505   4603 	CPI	')'
1763  c4 3e 0c      4506   4604 	CNZ	VALBYTE2	;SCAN OPTIONAL THIRD ARGUMENT
1766  cd b9 03      4507   4605 	CALL	SCANNXTV	;bscan (val)
1769  29            4508   4606 	DB	')'
176a  f1            4509   4607 	POP	PSW		;COMPUTE STARTING BYTE AND LENGTH
176b  e3            4510   4608 	XTHL
176c  01 15 17      4511   4609 	LXI	B,LEFRIGMD
176f  c5            4512   4610 	PUSH	B
1770  3d            4513   4611 	DCR	A
1771  be            4514   4612 	CMP	M
1772  06 00         4515   4613 	MVI	B,0		;START > LENI => LENO=0
1774  d0            4516   4614 	RNC
1775  4f            4517   4615 	MOV	C,A
1776  7e            4518   4616 	MOV	A,M
1777  91            4519   4617 	SUB	C
1778  bb            4520   4618 	CMP	E
1779  47            4521   4619 	MOV	B,A
177a  d8            4522   4620 	RC			;LEN0 = MIN(LENI-START,LENR)
177b  43            4523   4621 	MOV	B,E
177c  c9            4524   4622 	RET
                    4525   4623
                    4526   4624 ;
                    4527   4625 ;  Page 96
                    4528   4626 ;
                    4529   4627
                    4530   4628 ;
                    4531   4629 ;  INDEX OF STRING FUNCTION
                    4532   4630 ;
177d                4533   4631 INSFCT:
177d  eb            4534   4632 	XCHG	
177e  cd b9 03      4535   4633 	CALL	SCANNXTV	;bscan (val)
1781  2c            4536   4634 	DB	','
1782  cd c0 10      4537   4635 	CALL	VALPARN2	;SCAN SECOND ARGUMENT
1785  e3            4538   4636 	XTHL			;SHUFFLE RETURN STACK
1786  01 86 08      4539   4637 	LXI	B,POPHLRET
1789  c5            4540   4638 	PUSH	B
178a  e5            4541   4639 	PUSH	H
178b  cd 27 16      4542   4640 	CALL	LENFCTC		;PROCESS  SECOND STRING
178e  e3            4543   4641 	XTHL
178f  f5            4544   4642 	PUSH	PSW
1790  ca b5 17      4545   4643 	JZ	INSFCTXT
1793  cd c2 11      4546   4644 	CALL	STRGRELH	;WORK ON FIRST STRING
1796  7e            4547   4645 	MOV	A,M
1797  c1            4548   4646 	POP	B
1798  d1            4549   4647 	POP	D
1799  90            4550   4648 	SUB	B		;COMPARE LENGTHS
179a  da 30 1a      4551   4649 	JC	ZEROAC		;TEST IS LONGER, NO MATCHES
179d  3c            4552   4650 	INR	A
179e  4f            4553   4651 	MOV	C,A		;SAVE NUMBER OF ATTEMPTS
179f  c5            4554   4652 	PUSH	B
17a0  cd e4 1b      4555   4653 	CALL	LDICBMM		;GET ADDRESS OF TARGET
17a3  eb            4556   4654 	XCHG
17a4  5e            4557   4655 	MOV	E,M		;GET ADDRESS OF MATCHER
17a5  23            4558   4656 	INX	H
17a6  56            4559   4657 	MOV	D,M
17a7  eb            4560   4658 	XCHG
17a8  d1            4561   4659 	POP	D		;RECOVER LENGTH, COUNTER
17a9  3e 01         4562   4660 	MVI	A,1
17ab                4563   4661 INSFCTSL:
17ab  d5            4564   4662 	PUSH	D		;SAVE LENGTH, COUNTER
17ac  f5            4565   4663 	PUSH	PSW		;SAVE POSITION
17ad  c5            4566   4664 	PUSH	B		;SAVE ADDRESSES
17ae  e5            4567   4665 	PUSH	H
17af  5a            4568   4666 	MOV	E,D
17b0  cd 6b 10      4569   4667 	CALL	RELOPRSL	;COMPARE STRINGS
17b3  e1            4570   4668 	POP	H		;RECOVER ADDRESSES
17b4  c1            4571   4669 	POP	B
17b5                4572   4670 INSFCTXT:
17b5  d1            4573   4671 	POP	D
17b6  7a            4574   4672 	MOV	A,D		;RECOVER POSITION
17b7  d1            4575   4673 	POP	D		;AND LENGTH, COUNTER
17b8  ca e4 0d      4576   4674 	JZ	FLOATA		;ANSWER FOUND, GIVE IT BACK
17bb  3c            4577   4675 	INR	A		;INCREMENT POSITION
17bc  03            4578   4676 	INX	B
17bd  1d            4579   4677 	DCR	E		;COUNT ATTEMPTS
17be  c2 ab 17      4580   4678 	JNZ	INSFCTSL	;KEEP TRYING
17c1  c3 30 1a      4581   4679 	JMP	ZEROAC		;OR NOMATCH
                    4582   4680
                    4583   4681 ;
                    4584   4682 ;  Page 97
                    4585   4683 ;
                    4586   4684
                    4587   4685 ;
                    4588   4686 ;  FUNCTION RETURNING AMOUNT OF REMAINING FREE SPACE
                    4589   4687 ;
17c4                4590   4688 FREFCT:
17c4  2a 9b 03      4591   4689 	LHLD	MATTABLE	;FRE FUNCTION
17c7  eb            4592   4690 	XCHG
17c8  21 00 00      4593   4691 	LXI	H,0
17cb  39            4594   4692 	DAD	SP
17cc  cd ef 03      4595   4693 	CALL	TYPECHK
17cf  c2 df 17      4596   4694 	JNZ	FREFCTNS
17d2  cd bf 11      4597   4695 	CALL	STRGRELA	;RETURN BYTES OF FREE STRNG SPACE
17d5  cd 63 15      4598   4696 	CALL	STRGGBCL
17d8  2a 9f 03      4599   4697 	LHLD	STCKBASE
17db  eb            4600   4698 	XCHG
17dc  2a a1 03      4601   4699 	LHLD	STRGFREE
17df                4602   4700 FREFCTNS:
17df  7d            4603   4701 	MOV	A,L
17e0  93            4604   4702 	SUB	E
17e1  47            4605   4703 	MOV	B,A
17e2  7c            4606   4704 	MOV	A,H
17e3  9a            4607   4705 	SBB	D
17e4                4608   4706 FLOATAB:
17e4  50            4609   4707 	MOV	D,B
17e5  1e 00         4610   4708 	MVI	E,000H
17e7  21 81 03      4611   4709 	LXI	H,TYPEFLG
17ea  36 04         4612   4710 	MVI	M,TYPESING
17ec  06 90         4613   4711 	MVI	B,090H
17ee  c3 9c 1c      4614   4712 	JMP	FLOATINT
                    4615   4713
                    4616   4714 ;
                    4617   4715 ;  MEMORY DIDDLING FACILITIES
                    4618   4716 ;
17f1                4619   4717 MEMFCT:
17f1  cd ef 03      4620   4718 	CALL	TYPECHK		;MEM FUNCTION
17f4  ca fe 17      4621   4719 	JZ	MEMFCTC
17f7  cd 26 0c      4622   4720 	CALL	CINTEGER
17fa  1a            4623   4721 	LDAX	D
17fb  c3 e4 0d      4624   4722 	JMP	FLOATA
17fe                4625   4723 MEMFCTC:
17fe  cd 27 16      4626   4724 	CALL	LENFCTC		;RELEASE ARGUMENT
1801  2a 97 03      4627   4725 	LHLD	PROGBASE
1804  ca b7 16      4628   4726 	JZ	FLOATHL		;ZERO LENGTH STRING=PROGBASE
1807  2a a7 03      4629   4727 	LHLD	STRGTLIM
180a  c3 b7 16      4630   4728 	JMP	FLOATHL		;OTHERWISE=UPPER LIMIT
                    4631   4729
180d                4632   4730 MEMSTM:
180d  cd c1 03      4633   4731 	CALL	SCANNXT		;bscan +  ;MEM STATEMENT
1810  cd bc 10      4634   4732 	CALL	VALPARNS
1813  cd 26 0c      4635   4733 	CALL	CINTEGER
1816  d5            4636   4734 	PUSH	D
1817  cd b9 03      4637   4735 	CALL	SCANNXTV	;bscan (val)
181a  b5            4638   4736 	DB	KEYEQ
181b  cd 42 0c      4639   4737 	CALL	VALBYTE
181e  d1            4640   4738 	POP	D
181f  12            4641   4739 	STAX	D
                    4642   4740
                    4643   4741 ;
                    4644   4742 ;  Page 98
                    4645   4743 ;
                    4646   4744
1820  c9            4647   4745 	RET
                    4648   4746
                    4649   4747 ;
                    4650   4748 ;  Page 99
                    4651   4749 ;
                    4652   4750
                    4653   4751 ;
                    4654   4752 ;  DIRECT I/O FACILITIES
                    4655   4753 ;
                    4656   4754
1821                4657   4755 PORFCT:
1821  cd 45 0c      4658   4756 	CALL	CBYTE		;PORT FUNCTION
1824  16 db         4659   4757 	MVI	D,OPCINP
1826  cd 6a 18      4660   4758 	CALL	INOTGEN
1829  cd b1 03      4661   4759 	CALL	INOTINS
182c  c3 e4 0d      4662   4760 	JMP	FLOATA
                    4663   4761
182f                4664   4762 PORSTM:
182f  cd c1 03      4665   4763 	CALL	SCANNXT		;bscan +  ;PORT STATEMENT
1832  cd bc 10      4666   4764 	CALL	VALPARNS
1835  cd 45 0c      4667   4765 	CALL	CBYTE
1838  d5            4668   4766 	PUSH	D
1839  cd b9 03      4669   4767 	CALL 	SCANNXTV	;bscan (val)
183c  b5            4670   4768 	DB	KEYEQ
183d  cd 42 0c      4671   4769 	CALL	VALBYTE
1840  d1            4672   4770 	POP	D
1841  16 d3         4673   4771 	MVI	D,OPCOUT
1843  cd 6a 18      4674   4772 	CALL	INOTGEN
1846  c3 b1 03      4675   4773 	JMP	INOTINS
                    4676   4774
1849                4677   4775 WAISTM:
1849  cd 42 0c      4678   4776 	CALL	VALBYTE		;WAIT STATEMENT
184c  d5            4679   4777 	PUSH	D
184d  cd 3e 0c      4680   4778 	CALL	VALBYTE2
1850  f5            4681   4779 	PUSH	PSW
1851  1e 00         4682   4780 	MVI	E,0
1853  c4 3e 0c      4683   4781 	CNZ	VALBYTE2
1856  c1            4684   4782 	POP	B
1857  4b            4685   4783 	MOV	C,E
1858  d1            4686   4784 	POP	D
1859  16 db         4687   4785 	MVI	D,OPCINP
185b  cd 6a 18      4688   4786 	CALL	INOTGEN
185e                4689   4787 WAISTMIN:
185e  cd 60 00      4690   4788 	CALL	SYSWAIT		;DO A SYSTEM WAIT
1861  cd b1 03      4691   4789 	CALL	INOTINS		;THEN CHECK DEVICE
1864  a9            4692   4790 	XRA	C
1865  a0            4693   4791 	ANA	B
1866  ca 5e 18      4694   4792 	JZ	WAISTMIN
1869  c9            4695   4793 	RET
                    4696   4794
186a                4697   4795 INOTGEN:
186a  e5            4698   4796 	PUSH	H		;GENERATE INPUT/OUTPUT FOLLOWED
186b  21 b1 03      4699   4797 	LXI	H,INOTINS	;BY RETURN
186e  72            4700   4798 	MOV	M,D
186f  23            4701   4799 	INX	H
1870  73            4702   4800 	MOV	M,E
1871  23            4703   4801 	INX	H
1872  36 c9         4704   4802 	MVI	M,OPCRET
1874  e1            4705   4803 	POP	H
1875  c9            4706   4804 	RET
                    4707   4805
                    4708   4806 ;
                    4709   4807 ;  Page 100
                    4710   4808 ;
                    4711   4809
                    4712   4810 ;
                    4713   4811 ;  CSAVE/CLOAD ROCESSORS
                    4714   4812 ;    save filename - save on diskette
                    4715   4813 ;    load filename - get from diskette
                    4716   4814 ;
                    4717   4815 ;  load and save programs from the disk
                    4718   4816 ;
b400  =             4719   4817 d14base	equ	0b400h
b000  =             4720   4818 fsprom	equ	0b000h
b39b  =             4721   4819 bootstart  equ	fsprom+39bh	;load image files
b8e0  =             4722   4820 directorylookup  equ  d14base+4e0h  ;find filename
b796  =             4723   4821 opens	equ	d14base+396h	;open stream
b7dc  =             4724   4822 puts	equ	d14base+3dch	;put char
b82d  =             4725   4823 closes	equ	d14base+42dh	;close stream
                    4726   4824 ;
1876                4727   4825 cldstm:
1876  cd cd 18      4728   4826 	call	setfilename	;parse filename
1879  cd e0 b8      4729   4827 	call	directorylookup
187c  d2 8b 18      4730   4828 	jnc	namenotfound
187f  cd 9b b3      4731   4829 	call	bootstart
1882  cd ee 18      4732   4830 	call	checkprogram
1885  cd 15 05      4733   4831 	call	newload		;reset program pointers
1888  c3 2f 06      4734   4832 	jmp	cmndstrt
188b                4735   4833 namenotfound:
188b  1e e1         4736   4834 	mvi	e,errnfi-errn	;file not saved
188d  c3 07 06      4737   4835 	jmp	errmsg
                    4738   4836
                    4739   4837
1890                4740   4838 csvstm:
1890  cd cd 18      4741   4839 	call	setfilename
1893  06 02         4742   4840 	mvi	b,2		;write enable
1895  cd 96 b7      4743   4841 	call	opens		;open stream (only one in D14)
1898  d2 c8 18      4744   4842 	jnc	cannotopen	; -disk full or other bad stuff
189b  cd ee 18      4745   4843 	call	checkprogram
189e  e5            4746   4844 	push	h		;save end pointer
189f  2a 97 03      4747   4845 	lhld	progbase	;first address
18a2  4d            4748   4846 	mov	c,l
18a3  cd dc b7      4749   4847 	call	puts
18a6  4c            4750   4848 	mov	c,h
18a7  cd dc b7      4751   4849 	call	puts
18aa  0e 00         4752   4850 	mvi	c,0		;start address = 0 for no start
18ac  cd dc b7      4753   4851 	call	puts
18af  cd dc b7      4754   4852 	call	puts
18b2  d1            4755   4853 	pop	d		;de has end address=1
18b3                4756   4854 saveloop:
18b3  4e            4757   4855 	mov	c,m		;get char
18b4  23            4758   4856 	inx	h
18b5  cd dc b7      4759   4857 	call	puts		;and send t file
18b8  7c            4760   4858 	mov	a,h		;is this the end?
18b9  ba            4761   4859 	cmp	d
18ba  c2 b3 18      4762   4860 	jnz	saveloop
18bd  7d            4763   4861 	mov	a,l
18be  bb            4764   4862 	cmp	e
18bf  c2 b3 18      4765   4863 	jnz	saveloop
18c2  cd 2d b8      4766   4864 	call	closes		;yes
                    4767   4865
                    4768   4866 ;
                    4769   4867 ;  Page 101
                    4770   4868 ;
                    4771   4869
18c5  c3 2f 06      4772   4870 	jmp	cmndstrt
18c8                4773   4871 cannotopen:
18c8  1e 09         4774   4872 	mvi	e,errnsl-errn
18ca  c3 07 06      4775   4873 	jmp	errmsg
                    4776   4874
                    4777   4875
                    4778   4876 ;  setfilename
                    4779   4877 ;    returns hl set to a filename string
                    4780   4878 ;
18cd                4781   4879 setfilename:
18cd  11 05 19      4782   4880 	lxi	d,filename+1
18d0  06 00         4783   4881 	mvi	b,0
18d2                4784   4882 sfnloop:
18d2  7e            4785   4883 	mov	a,m		;look at char
18d3  fe 00         4786   4884 	cpi	0
18d5  ca e4 18      4787   4885 	jz	sfndone
18d8  fe 20         4788   4886 	cpi	' '
18da  ca e4 18      4789   4887 	jz	sfndone
18dd  04            4790   4888 	inr	b		;up count
18de  23            4791   4889 	inx	h
18df  12            4792   4890 	stax	d
18e0  13            4793   4891 	inx	d
18e1  c3 d2 18      4794   4892 	jmp	sfnloop
18e4                4795   4893 sfndone:
18e4  21 04 19      4796   4894 	lxi	h,filename
18e7  af            4797   4895 	xra	a		;is the name non zero
18e8  b0            4798   4896 	ora	b
18e9  ca 05 06      4799   4897 	jz	errasn		;yes
18ec  77            4800   4898 	mov	m,a		;store count
18ed  c9            4801   4899 	ret
                    4802   4900
                    4803   4901
                    4804   4902 ;  checkprogram
                    4805   4903 ;    walk over the program looking for the end
                    4806   4904 ;    return last byte+1 in hl
                    4807   4905 ;
18ee                4808   4906 checkprogram:
18ee  2a 97 03      4809   4907 	lhld	progbase	;starts here
18f1                4810   4908 cprogloop:
18f1  7e            4811   4909 	mov	a,m		;pick up line length
18f2  23            4812   4910 	inx	h
18f3  b6            4813   4911 	ora	m
18f4  23            4814   4912 	inx	h
18f5  ca 03 19      4815   4913 	jz	cprogok		;if zero then all done
18f8  23            4816   4914 	inx	h
18f9  23            4817   4915 	inx	h		;skip line number
18fa                4818   4916 cprogloop2:
18fa  7e            4819   4917 	mov	a,m
18fb  b7            4820   4918 	ora	a
18fc  23            4821   4919 	inx	h
18fd  ca f1 18      4822   4920 	jz	cprogloop	;zero at the end of the line
1900  c3 fa 18      4823   4921 	jmp	cprogloop2
1903                4824   4922 cprogok:
1903  c9            4825   4923 	ret
1904                4826   4924 filename:  ds	60
                    4827   4925
                    4828   4926 ;
                    4829   4927 ;  Page 102
                    4830   4928 ;
                    4831   4929
                    4832   4930 ;
                    4833   4931 ;  LOGICAL OPERATORS
                    4834   4932 ;
                    4835   4933
                    4836   4934
1940                4837   4935 ORNOPR:
1940  b7            4838   4936 	ORA	A		;OR OPERATOR
1941  c3 45 19      4839   4937 	JMP	LOGOPRIC
1944                4840   4938 ANDOPR:
1944  af            4841   4939 	XRA	A		;AND OPERATOR
1945                4842   4940 LOGOPRIC:
1945  f5            4843   4941 	PUSH	PSW
1946  cd 0a 0c      4844   4942 	CALL	CSINGLE
1949  cd 26 0c      4845   4943 	CALL	CINTEGER
194c  f1            4846   4944 	POP	PSW
194d  eb            4847   4945 	XCHG
194e  c1            4848   4946 	POP	B
194f  e3            4849   4947 	XTHL
1950  eb            4850   4948 	XCHG
1951  cd d3 1b      4851   4949 	CALL	LDACRG
1954  f5            4852   4950 	PUSH	PSW
1955  cd 26 0c      4853   4951 	CALL	CINTEGER
1958  f1            4854   4952 	POP	PSW
1959  c1            4855   4953 	POP	B
195a  79            4856   4954 	MOV	A,C
195b  c2 65 19      4857   4955 	JNZ	ORNOPRFN
195e  a3            4858   4956 	ANA	E
195f  4f            4859   4957 	MOV	C,A
1960  78            4860   4958 	MOV	A,B
1961  a2            4861   4959 	ANA	D
1962  c3 69 19      4862   4960 	JMP	LOGOPRXT	;RETURN FROM AND
                    4863   4961
1965                4864   4962 ORNOPRFN:
1965  b3            4865   4963 	ORA	E
1966  4f            4866   4964 	MOV	C,A
1967  78            4867   4965 	MOV	A,B 
1968  b2            4868   4966 	ORA	D
1969                4869   4967 LOGOPRXT:
1969  41            4870   4968 	MOV	B,C
196a  c3 e4 17      4871   4969 	JMP	FLOATAB		;RETURN FROM OR
                    4872   4970
196d                4873   4971 VALUNOT:
196d  16 5a         4874   4972 	MVI	D,PREDNOT	;EVALUATE UNARY NOT
196f  cd ac 0f      4875   4973 	CALL	VALEXPRL
1972  cd 0a 0c      4876   4974 	CALL	CSINGLE
1975  cd 26 0c      4877   4975 	CALL	CINTEGER
1978  7b            4878   4976 	MOV	A,E
1979  2f            4879   4977 	CMA
197a  4f            4880   4978 	MOV	C,A
197b  7a            4881   4979 	MOV	A,D
197c  2f            4882   4980 	CMA
197d  cd 69 19      4883   4981 	CALL	LOGOPRXT
1980  c1            4884   4982 	POP	B
1981  c3 b8 0f      4885   4983 	JMP	VALEXPRC
                    4886   4984
                    4887   4985 ;
                    4888   4986 ;  Page 103
                    4889   4987 ;
                    4890   4988
                    4891   4989 ;
                    4892   4990 ;  MOD, MAXIMUM, MINIMUM OPERATORS
                    4893   4991 ;
                    4894   4992
                    4895   4993
1984                4896   4994 MODOPR:
1984  c1            4897   4995 	POP	B		;MODULO FUNCTION
1985  d1            4898   4996 	POP	D		;X MOD Y =
1986  d5            4899   4997 	PUSH	D		;X - INT(X/Y) * Y
1987  c5            4900   4998 	PUSH	B
1988  2a a9 03      4901   4999 	LHLD	ACCUMLTR
198b  e5            4902   5000 	PUSH	H
198c  2a ab 03      4903   5001 	LHLD	FLACCMSB
198f  e5            4904   5002 	PUSH	H
1990  cd 43 1b      4905   5003 	CALL	FLDIV
1993  cd b6 1c      4906   5004 	CALL	INTFCT
1996  c1            4907   5005 	POP	B
1997  d1            4908   5006 	POP	D
1998  cd b7 1a      4909   5007 	CALL	FLMUL
199b  c3 c5 19      4910   5008 	JMP	SUBOPR
                    4911   5009
199e                4912   5010 MAXOPR:
199e  c1            4913   5011 	POP	B
199f  d1            4914   5012 	POP	D
19a0  cd 0f 1c      4915   5013 	CALL	FLCMP		;COMPARE OPERANDS
19a3  c8            4916   5014 	RZ			;NO DIFFERENCE
19a4  da d3 1b      4917   5015 	JC	LDACRG		;REGISTERS LARGER
19a7  c3 de 1b      4918   5016 	JMP	LDRGAC		;ACUMULATOR LARGER
                    4919   5017
19aa                4920   5018 MINOPR:
19aa  c1            4921   5019 	POP	B
19ab  d1            4922   5020 	POP	D
19ac  cd 0f 1c      4923   5021 	CALL	FLCMP		;COMPARE OPERANDS
19af  c8            4924   5022 	RZ			;NO DIFFERENCE
19b0  d2 d3 1b      4925   5023 	JNC	LDACRG		;REGISTERS SMALLER
19b3  c3 de 1b      4926   5024 	JMP	LDRGAC		;ACCUMULATOR SMALLER
                    4927   5025
                    4928   5026 ;
                    4929   5027 ;  Page 104
                    4930   5028 ;
                    4931   5029
                    4932   5030 ;
                    4933   5031 ;  FLOATING POINT ADD/SUBTRACT ROUTINES
                    4934   5032 ;
                    4935   5033
                    4936   5034
19b6                4937   5035 FLADDHLF:
19b6  21 56 1e      4938   5036 	LXI	H,FLHALF
19b9                4939   5037 FLADDM:
19b9  cd e1 1b      4940   5038 	CALL	LDRGMM
19bc  c3 ca 19      4941   5039 	JMP	FLADD
                    4942   5040
19bf                4943   5041 FLMMMAC:
19bf  cd e1 1b      4944   5042 	CALL	LDRGMM		;COMPUTE MM-AC
19c2  c3 c7 19      4945   5043 	JMP	FLSUB
                    4946   5044
19c5                4947   5045 SUBOPR:
19c5  c1            4948   5046 	POP	B
19c6  d1            4949   5047 	POP	D
19c7                4950   5048 FLSUB:
19c7  cd ae 1c      4951   5049 	CALL	CMACCS		;SUBTRACT ACC FROM REGISTERS
19ca                4952   5050 FLADD:
19ca  78            4953   5051 	MOV	A,B		;ADD ACCUMULATOR TO REGISTERS
19cb  b7            4954   5052 	ORA	A
19cc  c8            4955   5053 	RZ
19cd  3a ac 03      4956   5054 	LDA	FLACCEXP
19d0  b7            4957   5055 	ORA	A
19d1  ca d3 1b      4958   5056 	JZ	LDACRG
19d4  90            4959   5057 	SUB	B
19d5  d2 e4 19      4960   5058 	JNC	FLADDMGC
19d8  2f            4961   5059 	CMA			;NEED LARGER IN AC, INTERCHANGE
19d9  3c            4962   5060 	INR	A
19da  eb            4963   5061 	XCHG
19db  cd c3 1b      4964   5062 	CALL	PUSHAC
19de  eb            4965   5063 	XCHG
19df  cd d3 1b      4966   5064 	CALL	LDACRG
19e2  c1            4967   5065 	POP	B
19e3  d1            4968   5066 	POP	D
19e4                4969   5067 FLADDMGC:
19e4  fe 19         4970   5068 	CPI	019H		;ARE MAGNITUDES ARE COMMENSURATE?
19e6  d0            4971   5069 	RNC
19e7  f5            4972   5070 	PUSH	PSW
19e8  cd fa 1b      4973   5071 	CALL	SIGNIFY
19eb  67            4974   5072 	MOV	H,A
19ec  f1            4975   5073 	POP	PSW
19ed  cd 91 1a      4976   5074 	CALL	SHIFTR0
19f0  b4            4977   5075 	ORA	H
19f1  21 a9 03      4978   5076 	LXI	H,ACCUMLTR
19f4  f2 0a 1a      4979   5077 	JP	FLADDIFF
19f7  cd 71 1a      4980   5078 	CALL	ADDM2CDE
19fa  d2 50 1a      4981   5079 	JNC	FLROUND
19fd  23            4982   5080 	INX	H
19fe  34            4983   5081 	INR	M
19ff  ca 6c 1a      4984   5082 	JZ	ERRAOV
1a02  2e 01         4985   5083 	MVI	L,001H
1a04  cd a7 1a      4986   5084 	CALL	SHIFTRLB
1a07  c3 50 1a      4987   5085 	JMP	FLROUND
                    4988   5086
                    4989   5087 ;
                    4990   5088 ;  Page 105
                    4991   5089 ;
                    4992   5090
1a0a                4993   5091 FLADDIFF:
1a0a  af            4994   5092 	XRA	A		;FIND DIFFERENCE
1a0b  90            4995   5093 	SUB	B
1a0c  47            4996   5094 	MOV	B,A
1a0d  7e            4997   5095 	MOV	A,M
1a0e  9b            4998   5096 	SBB	E
1a0f  5f            4999   5097 	MOV	E,A
1a10  23            5000   5098 	INX	H
1a11  7e            5001   5099 	MOV	A,M
1a12  9a            5002   5100 	SBB	D
1a13  57            5003   5101 	MOV	D,A
1a14  23            5004   5102 	INX	H
1a15  7e            5005   5103 	MOV	A,M
1a16  99            5006   5104 	SBB	C
1a17  4f            5007   5105 	MOV	C,A
1a18                5008   5106 NORMALZI:
1a18  dc 7d 1a      5009   5107 	CC	CMREGS
1a1b                5010   5108 NORMALIZ:
1a1b  68            5011   5109 	MOV	L,B		;NORMALIZE REGISTERS
1a1c  63            5012   5110 	MOV	H,E
1a1d  af            5013   5111 	XRA	A
1a1e                5014   5112 NORMAL8:
1a1e  47            5015   5113 	MOV	B,A		;NORMALIZE BY BYTES
1a1f  79            5016   5114 	MOV	A,C
1a20  b7            5017   5115 	ORA	A
1a21  c2 3d 1a      5018   5116 	JNZ	NORMAL1
1a24  4a            5019   5117 	MOV	C,D
1a25  54            5020   5118 	MOV	D,H
1a26  65            5021   5119 	MOV	H,L
1a27  6f            5022   5120 	MOV	L,A
1a28  78            5023   5121 	MOV	A,B
1a29  d6 08         5024   5122 	SUI	008H
1a2b  fe e0         5025   5123 	CPI	0E0H
1a2d  c2 1e 1a      5026   5124 	JNZ	NORMAL8
1a30                5027   5125 ZEROAC:
1a30  af            5028   5126 	XRA	A		;ZERO ACCUMULATOR
1a31                5029   5127 LDACCE:
1a31  32 ac 03      5030   5128 	STA	FLACCEXP
1a34  c9            5031   5129 	RET
                    5032   5130
1a35                5033   5131 NORMAL1L:
1a35  05            5034   5132 	DCR	B		;NORMALIZE BY BITS
1a36  29            5035   5133 	DAD	H
1a37  7a            5036   5134 	MOV	A,D
1a38  17            5037   5135 	RAL
1a39  57            5038   5136 	MOV	D,A
1a3a  79            5039   5137 	MOV	A,C
1a3b  8f            5040   5138 	ADC	A
1a3c  4f            5041   5139 	MOV	C,A
1a3d                5042   5140 NORMAL1:
1a3d  f2 35 1a      5043   5141 	JP	NORMAL1L
1a40  78            5044   5142 	MOV	A,B
1a41  5c            5045   5143 	MOV	E,H
1a42  45            5046   5144 	MOV	B,L
1a43  b7            5047   5145 	ORA	A
                    5048   5146
                    5049   5147 ;
                    5050   5148 ;  Page 106
                    5051   5149 ;
                    5052   5150
1a44  ca 50 1a      5053   5151 	JZ	FLROUND
1a47  21 ac 03      5054   5152 	LXI	H,FLACCEXP
1a4a  86            5055   5153 	ADD	M
1a4b  77            5056   5154 	MOV	M,A
1a4c  d2 30 1a      5057   5155 	JNC	ZEROAC
1a4f  c8            5058   5156 	RZ
1a50                5059   5157 FLROUND:
1a50  78            5060   5158 	MOV	A,B		;ROUND RESULT
1a51                5061   5159 FLROUNDV:
1a51  21 ac 03      5062   5160 	LXI	H,FLACCEXP
1a54  b7            5063   5161 	ORA	A
1a55  fc 62 1a      5064   5162 	CM	INCCDE
1a58  46            5065   5163 	MOV	B,M
1a59  23            5066   5164 	INX	H
1a5a  7e            5067   5165 	MOV	A,M
1a5b  e6 80         5068   5166 	ANI	080H
1a5d  a9            5069   5167 	XRA	C
1a5e  4f            5070   5168 	MOV	C,A
1a5f  c3 d3 1b      5071   5169 	JMP	LDACRG
                    5072   5170
1a62                5073   5171 INCCDE:
1a62  1c            5074   5172 	INR	E		;INCREMENT CDE
1a63  c0            5075   5173 	RNZ
1a64  14            5076   5174 	INR	D
1a65  c0            5077   5175 	RNZ
1a66  0c            5078   5176 	INR	C
1a67  c0            5079   5177 	RNZ
1a68  0e 80         5080   5178 	MVI	C,080H
1a6a  34            5081   5179 	INR	M
1a6b  c0            5082   5180 	RNZ
1a6c                5083   5181 ERRAOV:
1a6c  1e 6d         5084   5182 	MVI	E,ERRNOV-ERRN
1a6e  c3 07 06      5085   5183 	JMP	ERRMSG
                    5086   5184
1a71                5087   5185 ADDM2CDE:
1a71  7e            5088   5186 	MOV	A,M		;ADD MEMORY TO CDE
1a72  83            5089   5187 	ADD	E
1a73  5f            5090   5188 	MOV	E,A
1a74  23            5091   5189 	INX	H
1a75  7e            5092   5190 	MOV	A,M
1a76  8a            5093   5191 	ADC	D
1a77  57            5094   5192 	MOV	D,A
1a78  23            5095   5193 	INX	H
1a79  7e            5096   5194 	MOV	A,M
1a7a  89            5097   5195 	ADC	C
1a7b  4f            5098   5196 	MOV	C,A
1a7c  c9            5099   5197 	RET
                    5100   5198
                    5101   5199 ;
                    5102   5200 ;  Page 107
                    5103   5201 ;
                    5104   5202
1a7d                5105   5203 CMREGS:
1a7d  21 ad 03      5106   5204 	LXI	H,FLACCSSV	;COMPLEMENT SAVED SIGN, CDEB
1a80  7e            5107   5205 	MOV	A,M
1a81  2f            5108   5206 	CMA
1a82  77            5109   5207 	MOV	M,A
1a83  af            5110   5208 	XRA	A
1a84  6f            5111   5209 	MOV	L,A
1a85  90            5112   5210 	SUB	B
1a86  47            5113   5211 	MOV	B,A
1a87  7d            5114   5212 	MOV	A,L
1a88  9b            5115   5213 	SBB	E
1a89  5f            5116   5214 	MOV	E,A
1a8a  7d            5117   5215 	MOV	A,L
1a8b  9a            5118   5216 	SBB	D
1a8c  57            5119   5217 	MOV	D,A
1a8d  7d            5120   5218 	MOV	A,L
1a8e  99            5121   5219 	SBB	C
1a8f  4f            5122   5220 	MOV	C,A
1a90  c9            5123   5221 	RET
                    5124   5222
1a91                5125   5223 SHIFTR0:
1a91  06 00         5126   5224 	MVI	B,000H
1a93                5127   5225 SHIFTR:
1a93  d6 08         5128   5226 	SUI	008H		;SHIFT CDEB RIGHT BY A BITS
1a95  da a0 1a      5129   5227 	JC	SHIFTRB
1a98  43            5130   5228 	MOV	B,E
1a99  5a            5131   5229 	MOV	E,D
1a9a  51            5132   5230 	MOV	D,C
1a9b  0e 00         5133   5231 	MVI	C,000H
1a9d  c3 93 1a      5134   5232 	JMP	SHIFTR
1aa0                5135   5233 SHIFTRB:
1aa0  c6 09         5136   5234 	ADI	009H
1aa2  6f            5137   5235 	MOV	L,A
1aa3                5138   5236 SHIFTRBL:
1aa3  af            5139   5237 	XRA	A
1aa4  2d            5140   5238 	DCR	L
1aa5  c8            5141   5239 	RZ
1aa6  79            5142   5240 	MOV	A,C
1aa7                5143   5241 SHIFTRLB:
1aa7  1f            5144   5242 	RAR
1aa8  4f            5145   5243 	MOV	C,A
1aa9  7a            5146   5244 	MOV	A,D
1aaa  1f            5147   5245 	RAR
1aab  57            5148   5246 	MOV	D,A
1aac  7b            5149   5247 	MOV	A,E
1aad  1f            5150   5248 	RAR
1aae  5f            5151   5249 	MOV	E,A
1aaf  78            5152   5250 	MOV	A,B
1ab0  1f            5153   5251 	RAR
1ab1  47            5154   5252 	MOV	B,A
1ab2  c3 a3 1a      5155   5253 	JMP	SHIFTRBL
                    5156   5254
                    5157   5255 ;
                    5158   5256 ;  Page 108
                    5159   5257 ;
                    5160   5258
                    5161   5259 ;
                    5162   5260 ;  FLOATING POINT MULTIPLY ROUTINE
                    5163   5261 ;
                    5164   5262
1ab5                5165   5263 MULOPR:
1ab5  c1            5166   5264 	POP	B
1ab6  d1            5167   5265 	POP	D
1ab7                5168   5266 FLMUL:
1ab7  cd 7e 1c      5169   5267 	CALL	SIGNACC		;MULTIPLY REGISTERS BY ACC
1aba  c8            5170   5268 	RZ
1abb  2e 00         5171   5269 	MVI	L,000H
1abd  cd 0a 1b      5172   5270 	CALL	FLMLDVEX
1ac0  79            5173   5271 	MOV	A,C
1ac1  32 b1 03      5174   5272 	STA	FLSCR0
1ac4  eb            5175   5273 	XCHG
1ac5  22 b2 03      5176   5274 	SHLD	FLSCR1
1ac8  01 00 00      5177   5275 	LXI	B,0
1acb  50            5178   5276 	MOV	D,B
1acc  59            5179   5277 	MOV	E,C
1acd  21 1b 1a      5180   5278 	LXI	H,NORMALIZ	;NORMALIZE ANSWER AFTER
1ad0  e5            5181   5279 	PUSH	H
1ad1  21 d9 1a      5182   5280 	LXI	H,FLMULLP	;THREE TIMES THROUGH LOOP
1ad4  e5            5183   5281 	PUSH	H
1ad5  e5            5184   5282 	PUSH	H
1ad6  21 a9 03      5185   5283 	LXI	H,ACCUMLTR
1ad9                5186   5284 FLMULLP:
1ad9  7e            5187   5285 	MOV	A,M
1ada  23            5188   5286 	INX	H
1adb  b7            5189   5287 	ORA	A
1adc  ca 05 1b      5190   5288 	JZ	FLMULXT
1adf  e5            5191   5289 	PUSH	H
1ae0  2e 08         5192   5290 	MVI	L,008H
1ae2                5193   5291 FLMULLQ:
1ae2  1f            5194   5292 	RAR			;NEXT BIT OF MULTIPLIER
1ae3  67            5195   5293 	MOV	H,A
1ae4  79            5196   5294 	MOV	A,C
1ae5  d2 f3 1a      5197   5295 	JNC	FLMULNA
1ae8  e5            5198   5296 	PUSH	H
1ae9  2a b2 03      5199   5297 	LHLD	FLSCR1		;BIT ON, ADD MULTIPLICAND
1aec  19            5200   5298 	DAD	D
1aed  eb            5201   5299 	XCHG
1aee  e1            5202   5300 	POP	H
1aef  3a b1 03      5203   5301 	LDA	FLSCR0
1af2  89            5204   5302 	ADC	C
1af3                5205   5303 FLMULNA:
1af3  1f            5206   5304 	RAR			;SHIFT CDEB RIGHT ONE BIT
1af4  4f            5207   5305 	MOV	C,A
1af5  7a            5208   5306 	MOV	A,D
1af6  1f            5209   5307 	RAR
1af7  57            5210   5308 	MOV	D,A
1af8  7b            5211   5309 	MOV	A,E
1af9  1f            5212   5310 	RAR
1afa  5f            5213   5311 	MOV	E,A
1afb  78            5214   5312 	MOV	A,B
1afc  1f            5215   5313 	RAR
                    5216   5314
                    5217   5315 ;
                    5218   5316 ;  Page 109
                    5219   5317 ;
                    5220   5318
1afd  47            5221   5319 	MOV	B,A
1afe  2d            5222   5320 	DCR	L
1aff  7c            5223   5321 	MOV	A,H
1b00  c2 e2 1a      5224   5322 	JNZ	FLMULLQ
1b03  e1            5225   5323 	POP	H
1b04  c9            5226   5324 	RET
                    5227   5325
1b05                5228   5326 FLMULXT:
1b05  43            5229   5327 	MOV	B,E
1b06  5a            5230   5328 	MOV	E,D
1b07  51            5231   5329 	MOV	D,C
1b08  4f            5232   5330 	MOV	C,A
1b09  c9            5233   5331 	RET
                    5234   5332
1b0a                5235   5333 FLMLDVEX:
1b0a  78            5236   5334 	MOV	A,B		;COMPUTE EXP FOR MULTIPLY/DIVIDE
1b0b  b7            5237   5335 	ORA	A
1b0c  ca 2e 1b      5238   5336 	JZ	FLMLDVEZ
1b0f  7d            5239   5337 	MOV	A,L
1b10  21 ac 03      5240   5338 	LXI	H,FLACCEXP
1b13  ae            5241   5339 	XRA	M
1b14  80            5242   5340 	ADD	B
1b15  47            5243   5341 	MOV	B,A
1b16  1f            5244   5342 	RAR
1b17  a8            5245   5343 	XRA	B
1b18  78            5246   5344 	MOV	A,B
1b19  f2 2d 1b      5247   5345 	JP	FLMLDVEY
1b1c  c6 80         5248   5346 	ADI	080H
1b1e  77            5249   5347 	MOV	M,A
1b1f  ca 86 08      5250   5348 	JZ	POPHLRET
1b22  cd fa 1b      5251   5349 	CALL	SIGNIFY
1b25  77            5252   5350 	MOV	M,A
1b26  2b            5253   5351 	DCX	H
1b27  c9            5254   5352 	RET
                    5255   5353
1b28                5256   5354 EXPRNEXC:
1b28  cd 7e 1c      5257   5355 	CALL	SIGNACC		;RANGE EXECEEDED FOR EXP FUNCTION
1b2b  2f            5258   5356 	CMA			;RESULT DETERMINED BY SGN(X)
1b2c  e1            5259   5357 	POP	H
1b2d                5260   5358 FLMLDVEY:
1b2d  b7            5261   5359 	ORA	A
1b2e                5262   5360 FLMLDVEZ:
1b2e  e1            5263   5361 	POP	H
1b2f  f2 30 1a      5264   5362 	JP	ZEROAC
1b32  c3 6c 1a      5265   5363 	JMP	ERRAOV
                    5266   5364
                    5267   5365 ;
                    5268   5366 ;  Page 110
                    5269   5367 ;
                    5270   5368
                    5271   5369 ;
                    5272   5370 ;  FLOATING POINT DIVIDE ROUTINE
                    5273   5371 ;
                    5274   5372
                    5275   5373
1b35                5276   5374 FLDIVB10:
1b35  cd c3 1b      5277   5375 	CALL	PUSHAC		;COMPUTE AC/10
1b38  01 20 84      5278   5376 	LXI	B,08420H
1b3b  11 00 00      5279   5377 	LXI	D,00000H
1b3e  cd d3 1b      5280   5378 	CALL	LDACRG
1b41                5281   5379 DIVOPR:
1b41  c1            5282   5380 	POP	B
1b42  d1            5283   5381 	POP	D
1b43                5284   5382 FLDIV:
1b43  cd 7e 1c      5285   5383 	CALL	SIGNACC		;DIVIDE REGISTERS BY ACCUMULATOR
1b46  ca be 1b      5286   5384 	JZ	ERRAD0
1b49  2e ff         5287   5385 	MVI	L,0FFH
1b4b  cd 0a 1b      5288   5386 	CALL	FLMLDVEX
1b4e  34            5289   5387 	INR	M
1b4f  34            5290   5388 	INR	M		;plus 2
1b50  2b            5291   5389 	DCX	H
1b51  7e            5292   5390 	MOV	A,M
1b52  2f            5293   5391 	CMA
1b53  32 b3 03      5294   5392 	STA	FLSCR2
1b56  2b            5295   5393 	DCX	H
1b57  7e            5296   5394 	MOV	A,M
1b58  2f            5297   5395 	CMA
1b59  32 b2 03      5298   5396 	STA	FLSCR1
1b5c  2b            5299   5397 	DCX	H
1b5d  7e            5300   5398 	MOV	A,M
1b5e  2f            5301   5399 	CMA
1b5f  32 b1 03      5302   5400 	STA	FLSCR0
1b62  41            5303   5401 	MOV	B,C
1b63  eb            5304   5402 	XCHG
1b64  af            5305   5403 	XRA	A
1b65  4f            5306   5404 	MOV	C,A
1b66  57            5307   5405 	MOV	D,A
1b67  5f            5308   5406 	MOV	E,A
1b68  32 b4 03      5309   5407 	STA	FLSCR3
1b6b                5310   5408 FLDIVLP:
1b6b  e5            5311   5409 	PUSH	H
1b6c  c5            5312   5410 	PUSH	B
1b6d  37            5313   5411 	STC
1b6e  3a b1 03      5314   5412 	LDA	FLSCR0
1b71  8d            5315   5413 	ADC	L
1b72  6f            5316   5414 	MOV	L,A
1b73  3a b2 03      5317   5415 	LDA	FLSCR1
1b76  8c            5318   5416 	ADC	H
1b77  67            5319   5417 	MOV	H,A
1b78  3a b3 03      5320   5418 	LDA	FLSCR2
1b7b  88            5321   5419 	ADC	B
1b7c  47            5322   5420 	MOV	B,A
1b7d  3a b4 03      5323   5421 	LDA	FLSCR3
1b80  ce ff         5324   5422 	ACI	0FFH
1b82  d2 8e 1b      5325   5423 	JNC	FLDIVSF
1b85  32 b4 03      5326   5424 	STA	FLSCR3
                    5327   5425
                    5328   5426 ;
                    5329   5427 ;  Page 111
                    5330   5428 ;
                    5331   5429
1b88  f1            5332   5430 	POP	PSW		;TRIAL SUBRACT SUCCEEDED,
1b89  f1            5333   5431 	POP	PSW		;THROW AWAY SAVED DIVIDEND
1b8a  37            5334   5432 	STC
1b8b  c3 90 1b      5335   5433 	JMP	FLDIVSS
1b8e                5336   5434 FLDIVSF:
1b8e  c1            5337   5435 	POP	B		;TRIAL SUBTRACT FAILED, RESTORE
1b8f  e1            5338   5436 	POP	H
1b90                5339   5437 FLDIVSS:
1b90  79            5340   5438 	MOV	A,C
1b91  3c            5341   5439 	INR	A
1b92  3d            5342   5440 	DCR	A
1b93  1f            5343   5441 	RAR
1b94  fa 51 1a      5344   5442 	JM	FLROUNDV
1b97  17            5345   5443 	RAL
1b98  7b            5346   5444 	MOV	A,E
1b99  17            5347   5445 	RAL
1b9a  5f            5348   5446 	MOV	E,A
1b9b  7a            5349   5447 	MOV	A,D
1b9c  17            5350   5448 	RAL
1b9d  57            5351   5449 	MOV	D,A
1b9e  79            5352   5450 	MOV	A,C
1b9f  17            5353   5451 	RAL
1ba0  4f            5354   5452 	MOV	C,A
1ba1  29            5355   5453 	DAD	H
1ba2  78            5356   5454 	MOV	A,B
1ba3  17            5357   5455 	RAL
1ba4  47            5358   5456 	MOV	B,A
1ba5  3a b4 03      5359   5457 	LDA	FLSCR3
1ba8  17            5360   5458 	RAL
1ba9  32 b4 03      5361   5459 	STA	FLSCR3
1bac  79            5362   5460 	MOV	A,C
1bad  b2            5363   5461 	ORA	D
1bae  b3            5364   5462 	ORA	E
1baf  c2 6b 1b      5365   5463 	JNZ	FLDIVLP
1bb2  e5            5366   5464 	PUSH	H
1bb3  21 ac 03      5367   5465 	LXI	H,FLACCEXP
1bb6  35            5368   5466 	DCR	M
1bb7  e1            5369   5467 	POP	H
1bb8  c2 6b 1b      5370   5468 	JNZ	FLDIVLP	
1bbb  c3 6c 1a      5371   5469 	JMP	ERRAOV
                    5372   5470
1bbe                5373   5471 ERRAD0:
1bbe  1e 21         5374   5472 	MVI	E,ERRND0-ERRN
1bc0  c3 07 06      5375   5473 	JMP	ERRMSG
                    5376   5474
                    5377   5475 ;
                    5378   5476 ;  Page 112
                    5379   5477 ;
                    5380   5478
                    5381   5479 ;
                    5382   5480 ;  MISCELLANEOUS AUXILIARY ROUTINES
                    5383   5481 ;
                    5384   5482
                    5385   5483
                    5386   5484 ;
                    5387   5485 ;  CPY ACCUMULATOR TO STACK
                    5388   5486 ;
1bc3                5389   5487 PUSHAC:
1bc3  eb            5390   5488 	XCHG			;PUSH ACCUMULATOR ONTO STACK
1bc4                5391   5489 PUSHAC1:
1bc4  2a a9 03      5392   5490 	LHLD	ACCUMLTR
1bc7  e3            5393   5491 	XTHL
1bc8  e5            5394   5492 	PUSH	H
1bc9  2a ab 03      5395   5493 	LHLD	FLACCMSB
1bcc  e3            5396   5494 	XTHL
1bcd  e5            5397   5495 	PUSH	H
1bce  eb            5398   5496 	XCHG
1bcf  c9            5399   5497 	RET
                    5400   5498
                    5401   5499 ;
                    5402   5500 ;  LOAD ACCUMULATOR
                    5403   5501 ;
1bd0                5404   5502 LDRGACMM:
1bd0  cd e1 1b      5405   5503 	CALL	LDRGMM		;LOAD FLOATING ACC AND REGISTERS
1bd3                5406   5504 LDACRG:
1bd3  eb            5407   5505 	XCHG			;LOAD ACCUMULATOR FROM REGISTERS
1bd4  22 a9 03      5408   5506 	SHLD	ACCUMLTR
1bd7  60            5409   5507 	MOV	H,B
1bd8  69            5410   5508 	MOV	L,C
1bd9  22 ab 03      5411   5509 	SHLD	FLACCMSB
1bdc  eb            5412   5510 	XCHG
1bdd  c9            5413   5511 	RET
                    5414   5512
                    5415   5513 ;
                    5416   5514 ;  LOAD REGISTERS
                    5417   5515 ;
1bde                5418   5516 LDRGAC:
1bde  21 a9 03      5419   5517 	LXI	H,ACCUMLTR	;LOAD REGISTERS FROM ACCUMULATOR
1be1                5420   5518 LDRGMM:
1be1  5e            5421   5519 	MOV	E,M		;LOAD REGISTERS FROM FLOAT NUMBER
1be2  23            5422   5520 	INX	H
1be3                5423   5521 LDDCBMM:
1be3  56            5424   5522 	MOV	D,M		;LOAD REGISTERS FROM STRING
1be4                5425   5523 LDICBMM:
1be4  23            5426   5524 	INX	H
1be5  4e            5427   5525 	MOV	C,M
1be6  23            5428   5526 	INX	H
1be7  46            5429   5527 	MOV	B,M
1be8                5430   5528 INCHLRET:
1be8  23            5431   5529 	INX	H
1be9  c9            5432   5530 	RET
                    5433   5531
                    5434   5532 ;
                    5435   5533 ;  Page 113
                    5436   5534 ;
                    5437   5535
                    5438   5536 ;
                    5439   5537 ;  STORE ACCUMULATOR / COPY A VALUE
                    5440   5538 ;
1bea                5441   5539 LDMMAC:
1bea  11 a9 03      5442   5540 	LXI	D,ACCUMLTR	;LOAD MEMORY FROM ACCUMULATOR
1bed                5443   5541 COPYVAL:
1bed  3a 81 03      5444   5542 	LDA	TYPEFLG		;COPY VALUE FROM (DE) TO (HL)
1bf0  47            5445   5543 	MOV	B,A
1bf1                5446   5544 COPYVALL:
1bf1  1a            5447   5545 	LDAX	D
1bf2  77            5448   5546 	MOV	M,A
1bf3  13            5449   5547 	INX	D
1bf4  23            5450   5548 	INX	H
1bf5  05            5451   5549 	DCR	B
1bf6  c2 f1 1b      5452   5550 	JNZ	COPYVALL
1bf9  c9            5453   5551 	RET
                    5454   5552
                    5455   5553 ;
                    5456   5554 ;  TURN ON HIGH ORDER MANTISSA BITS OF ACCUMULATOR/REGISTERS
                    5457   5555 ;
1bfa                5458   5556 SIGNIFY:
1bfa  21 ab 03      5459   5557 	LXI	H,FLACCMSB	;SET ON HIGH-ORDER MANTISSA BITS,
1bfd  7e            5460   5558 	MOV	A,M		;AND SAVE SIGN IN FLACCSSV
1bfe  07            5461   5559 	RLC
1bff  37            5462   5560 	STC
1c00  1f            5463   5561 	RAR
1c01  77            5464   5562 	MOV	M,A		;FIRST ACCUMULATOR,
1c02  3f            5465   5563 	CMC
1c03  1f            5466   5564 	RAR
1c04  23            5467   5565 	INX	H
1c05  23            5468   5566 	INX	H
1c06  77            5469   5567 	MOV	M,A
1c07  79            5470   5568 	MOV	A,C
1c08  07            5471   5569 	RLC
1c09  37            5472   5570 	STC
1c0a  1f            5473   5571 	RAR
1c0b  4f            5474   5572 	MOV	C,A		;THEN REGISTERS
1c0c  1f            5475   5573 	RAR
1c0d  ae            5476   5574 	XRA	M
1c0e  c9            5477   5575 	RET
                    5478   5576
                    5479   5577 ;
                    5480   5578 ;  Page 114
                    5481   5579 ;
                    5482   5580
                    5483   5581 ;
                    5484   5582 ;  FLOATING POINT COMPARISON:  REGISTERS VS ACCUMULATOR
                    5485   5583 ;
1c0f                5486   5584 FLCMP:
1c0f  78            5487   5585 	MOV	A,B		;FLOATING COMPARE REGS TO ACC
1c10  b7            5488   5586 	ORA	A
1c11  ca 7e 1c      5489   5587 	JZ	SIGNACC
1c14  21 89 1c      5490   5588 	LXI	H,FLCMPXT
1c17  e5            5491   5589 	PUSH	H
1c18  cd 7e 1c      5492   5590 	CALL	SIGNACC
1c1b  79            5493   5591 	MOV	A,C
1c1c  c8            5494   5592 	RZ
1c1d  21 ab 03      5495   5593 	LXI	H,FLACCMSB
1c20  ae            5496   5594 	XRA	M
1c21  79            5497   5595 	MOV	A,C
1c22  f8            5498   5596 	RM
1c23  cd 29 1c      5499   5597 	CALL	FLCMPM
1c26  1f            5500   5598 	RAR
1c27  a9            5501   5599 	XRA	C
1c28  c9            5502   5600 	RET
                    5503   5601
1c29                5504   5602 FLCMPM:
1c29  23            5505   5603 	INX	H		;COMPARE MANTISSAS
1c2a  78            5506   5604 	MOV	A,B
1c2b  be            5507   5605 	CMP	M
1c2c  c0            5508   5606 	RNZ
1c2d  2b            5509   5607 	DCX	H
1c2e  79            5510   5608 	MOV	A,C
1c2f  be            5511   5609 	CMP	M
1c30  c0            5512   5610 	RNZ
1c31  2b            5513   5611 	DCX	H
1c32  7a            5514   5612 	MOV	A,D
1c33  be            5515   5613 	CMP	M
1c34  c0            5516   5614 	RNZ
1c35  2b            5517   5615 	DCX	H
1c36  7b            5518   5616 	MOV	A,E
1c37  96            5519   5617 	SUB	M
1c38  c0            5520   5618 	RNZ
1c39  e1            5521   5619 	POP	H
1c3a  e1            5522   5620 	POP	H
1c3b  c9            5523   5621 	RET
                    5524   5622
                    5525   5623 ;
                    5526   5624 ;  Page 115
                    5527   5625 ;
                    5528   5626
                    5529   5627 ;
                    5530   5628 ;  COMPUTER INTEGER PART OF ACCUMULATOR
                    5531   5629 ;
1c3c                5532   5630 FIXAC:
1c3c  47            5533   5631 	MOV	B,A		;LOAD REGS WITH FIX(AC)
1c3d  4f            5534   5632 	MOV	C,A
1c3e  57            5535   5633 	MOV	D,A
1c3f  5f            5536   5634 	MOV	E,A
1c40  b7            5537   5635 	ORA	A
1c41  c8            5538   5636 	RZ
1c42  e5            5539   5637 	PUSH	H
1c43  cd de 1b      5540   5638 	CALL	LDRGAC
1c46  cd fa 1b      5541   5639 	CALL	SIGNIFY
1c49  ae            5542   5640 	XRA	M
1c4a  67            5543   5641 	MOV	H,A
1c4b  fc 60 1c      5544   5642 	CM	DECCDE
1c4e  3e 98         5545   5643 	MVI	A,098H
1c50  90            5546   5644 	SUB	B
1c51  cd 91 1a      5547   5645 	CALL	SHIFTR0
1c54  7c            5548   5646 	MOV	A,H
1c55  17            5549   5647 	RAL
1c56  dc 62 1a      5550   5648 	CC	INCCDE
1c59  06 00         5551   5649 	MVI	B,000H
1c5b  dc 7d 1a      5552   5650 	CC	CMREGS
1c5e  e1            5553   5651 	POP	H
1c5f  c9            5554   5652 	RET
                    5555   5653
1c60                5556   5654 DECCDE:
1c60  1b            5557   5655 	DCX	D		;DECREMENT CDE
1c61  7a            5558   5656 	MOV	A,D
1c62  a3            5559   5657 	ANA	E
1c63  3c            5560   5658 	INR	A
1c64  c0            5561   5659 	RNZ
1c65  0d            5562   5660 	DCR	C
1c66  c9            5563   5661 	RET
                    5564   5662
1c67                5565   5663 FLMULB10:
1c67  cd de 1b      5566   5664 	CALL	LDRGAC		;MULTIPLY CONTENTS OF AC BY 10
1c6a  78            5567   5665 	MOV	A,B
1c6b  b7            5568   5666 	ORA	A
1c6c  c8            5569   5667 	RZ
1c6d  c6 02         5570   5668 	ADI	002H
1c6f  da 6c 1a      5571   5669 	JC	ERRAOV 
1c72  47            5572   5670 	MOV	B,A
1c73  cd ca 19      5573   5671 	CALL	FLADD		;AC=AC+4*AC
1c76  21 ac 03      5574   5672 	LXI	H,FLACCEXP
1c79  34            5575   5673 	INR	M		;AC=2*AC
1c7a  c0            5576   5674 	RNZ
1c7b  c3 6c 1a      5577   5675 	JMP	ERRAOV
                    5578   5676
1c7e                5579   5677 SIGNACC:
1c7e  3a ac 03      5580   5678 	LDA	FLACCEXP	;FIND SIGN OF ACCUMULATOR
1c81  b7            5581   5679 	ORA	A
1c82  c8            5582   5680 	RZ
1c83  3a ab 03      5583   5681 	LDA	FLACCMSB
                    5584   5682
                    5585   5683 ;
                    5586   5684 ;  Page 116
                    5587   5685 ;
                    5588   5686
1c86  c3 8a 1c      5589   5687 	JMP	SIGNXTND
1c89                5590   5688 FLCMPXT:
1c89  2f            5591   5689 	CMA
1c8a                5592   5690 SIGNXTND:
1c8a  17            5593   5691 	RAL
1c8b                5594   5692 CMPXT:
1c8b  9f            5595   5693 	SBB	A
1c8c  c0            5596   5694 	RNZ
1c8d  3c            5597   5695 	INR	A
1c8e  c9            5598   5696 	RET
                    5599   5697
1c8f                5600   5698 CMANSWR:
1c8f  21 ae 1c      5601   5699 	LXI	H,CMACCS	;F(X)=-F(0)
1c92  e3            5602   5700 	XTHL
1c93  e9            5603   5701 	PCHL
                    5604   5702
1c94                5605   5703 SGNFCT:
1c94  cd 7e 1c      5606   5704 	CALL	SIGNACC
1c97                5607   5705 FLOATBYT:
1c97  06 88         5608   5706 	MVI	B,088H
1c99  11 00 00      5609   5707 	LXI	D,0
1c9c                5610   5708 FLOATINT:
1c9c  21 ac 03      5611   5709 	LXI	H,FLACCEXP	;CONVERT INTEGER IN ADE TO FLOAT,
1c9f  4f            5612   5710 	MOV	C,A
1ca0  70            5613   5711 	MOV	M,B		;EXPONENT ASSUMED IN B
1ca1  06 00         5614   5712 	MVI	B,000H
1ca3  23            5615   5713 	INX	H
1ca4  36 80         5616   5714 	MVI	M,080H
1ca6  17            5617   5715 	RAL
1ca7  c3 18 1a      5618   5716 	JMP	NORMALZI
                    5619   5717
                    5620   5718 ;
                    5621   5719 ;  COMPUTE ABSOLUTE VALUE OF ACCUMULATOR
                    5622   5720 ;
1caa                5623   5721 ABSFCT:
1caa  cd 7e 1c      5624   5722 	CALL	SIGNACC		;ABS FUNCTION
1cad  f0            5625   5723 	RP
1cae                5626   5724 CMACCS:
1cae  21 ab 03      5627   5725 	LXI	H,FLACCMSB	;CHANGE SIGN OF ACCUMULATOR
1cb1  7e            5628   5726 	MOV	A,M
1cb2  ee 80         5629   5727 	XRI	080H
1cb4  77            5630   5728 	MOV	M,A
1cb5  c9            5631   5729 	RET
                    5632   5730
1cb6                5633   5731 INTFCT:
1cb6  21 ac 03      5634   5732 	LXI	H,FLACCEXP	;INT FUNCTION
1cb9  7e            5635   5733 	MOV	A,M
1cba  fe 98         5636   5734 	CPI	098H
1cbc  3a a9 03      5637   5735 	LDA	ACCUMLTR
1cbf  d0            5638   5736 	RNC
1cc0  7e            5639   5737 	MOV	A,M
1cc1  cd 3c 1c      5640   5738 	CALL	FIXAC
1cc4  36 98         5641   5739 	MVI	M,098H
1cc6  7b            5642   5740 	MOV	A,E
1cc7  f5            5643   5741 	PUSH	PSW
1cc8  79            5644   5742 	MOV	A,C
                    5645   5743
                    5646   5744 ;
                    5647   5745 ;  Page 117
                    5648   5746 ;
                    5649   5747
1cc9  17            5650   5748 	RAL
1cca  cd 18 1a      5651   5749 	CALL	NORMALZI
1ccd  f1            5652   5750 	POP	PSW
1cce  c9            5653   5751 	RET
                    5654   5752
                    5655   5753 ;
                    5656   5754 ;  Page 118
                    5657   5755 ;
                    5658   5756
                    5659   5757 ;
                    5660   5758 ;  FLOATING POINT DECODE ROUTINE
                    5661   5759 ;
                    5662   5760
                    5663   5761
1ccf                5664   5762 DECODE:
1ccf  fe 2d         5665   5763 	CPI	'-'		;DECODE EXTERNAL FORM OF NUMBER
1cd1  f5            5666   5764 	PUSH	PSW
1cd2  ca db 1c      5667   5765 	JZ	DECODEIN
1cd5  fe 2b         5668   5766 	CPI	'+'
1cd7  ca db 1c      5669   5767 	JZ	DECODEIN
1cda  2b            5670   5768 	DCX	H
1cdb                5671   5769 DECODEIN:
1cdb  cd 30 1a      5672   5770 	CALL	ZEROAC
1cde  47            5673   5771 	MOV	B,A
1cdf  57            5674   5772 	MOV	D,A
1ce0  5f            5675   5773 	MOV	E,A
1ce1  2f            5676   5774 	CMA
1ce2  4f            5677   5775 	MOV	C,A
1ce3                5678   5776 DECODELP:
1ce3  cd c1 03      5679   5777 	CALL	SCANNXT		;bscan ,
1ce6  da 4f 1d      5680   5778 	JC	DECDIGIT
1ce9  fe 2e         5681   5779 	CPI	'.'
1ceb  ca 2a 1d      5682   5780 	JZ	DECODEPT
1cee  fe 45         5683   5781 	CPI	'E'		;UPPER CASE E
1cf0  ca f8 1c      5684   5782 	JZ	DECODEXP
1cf3  fe 65         5685   5783 	CPI	'e'		;LOWER CASE E
1cf5  c2 2e 1d      5686   5784 	JNZ	DECODVAL
1cf8                5687   5785 DECODEXP:
1cf8  cd c1 03      5688   5786 	CALL	SCANNXT		;bscan ,
1cfb  e5            5689   5787 	PUSH	H
1cfc  21 10 1d      5690   5788 	LXI	H,DECODEXL
1cff  e3            5691   5789 	XTHL
1d00  15            5692   5790 	DCR	D
1d01  fe ab         5693   5791 	CPI	KEYSUB
1d03  c8            5694   5792 	RZ
1d04  fe 2d         5695   5793 	CPI	'-'
1d06  c8            5696   5794 	RZ
1d07  14            5697   5795 	INR	D
1d08  fe 2b         5698   5796 	CPI	'+'
1d0a  c8            5699   5797 	RZ
1d0b  fe aa         5700   5798 	CPI	KEYADD
1d0d  c8            5701   5799 	RZ
1d0e  f1            5702   5800 	POP	PSW
1d0f  2b            5703   5801 	DCX	H
1d10                5704   5802 DECODEXL:
1d10  cd c1 03      5705   5803 	CALL	SCANNXT		;bscan ,  ;SCAN EXPONENT
1d13  d2 22 1d      5706   5804 	JNC	DECODEXQ
1d16  7b            5707   5805 	MOV	A,E		;DECODE EXPONENT DIGIT
1d17  07            5708   5806 	RLC			;E=10*E+VAL(M)
1d18  07            5709   5807 	RLC
1d19  83            5710   5808 	ADD	E
1d1a  07            5711   5809 	RLC
1d1b  86            5712   5810 	ADD	M
1d1c  d6 30         5713   5811 	SUI	'0'
1d1e  5f            5714   5812 	MOV	E,A
                    5715   5813
                    5716   5814 ;
                    5717   5815 ;  Page 119
                    5718   5816 ;
                    5719   5817
1d1f  c3 10 1d      5720   5818 	JMP	DECODEXL
1d22                5721   5819 DECODEXQ:
1d22  14            5722   5820 	INR	D
1d23  c2 2e 1d      5723   5821 	JNZ	DECODVAL
1d26  af            5724   5822 	XRA	A
1d27  93            5725   5823 	SUB	E
1d28  5f            5726   5824 	MOV	E,A
1d29  0c            5727   5825 	INR	C
1d2a                5728   5826 DECODEPT:
1d2a  0c            5729   5827 	INR	C		;DECODE DECIMAL POINT
1d2b  ca e3 1c      5730   5828 	JZ	DECODELP
1d2e                5731   5829 DECODVAL:
1d2e  e5            5732   5830 	PUSH	H
1d2f  7b            5733   5831 	MOV	A,E
1d30  90            5734   5832 	SUB	B
1d31                5735   5833 DECDEXPA:
1d31  f4 47 1d      5736   5834 	CP	DECMULUP	;COMBINE MANTISSA, EXPONENT
1d34  f2 3d 1d      5737   5835 	JP	DECDEXAL
1d37  f5            5738   5836 	PUSH	PSW
1d38  cd 35 1b      5739   5837 	CALL	FLDIVB10
1d3b  f1            5740   5838 	POP	PSW
1d3c  3c            5741   5839 	INR	A
1d3d                5742   5840 DECDEXAL:
1d3d  c2 31 1d      5743   5841 	JNZ	DECDEXPA
1d40  d1            5744   5842 	POP	D
1d41  f1            5745   5843 	POP	PSW
1d42  cc ae 1c      5746   5844 	CZ	CMACCS
1d45  eb            5747   5845 	XCHG
1d46  c9            5748   5846 	RET
                    5749   5847
                    5750   5848 ;
                    5751   5849 ;  Page 120
                    5752   5850 ;
                    5753   5851
1d47                5754   5852 DECMULUP:
1d47  c8            5755   5853 	RZ
1d48                5756   5854 FLMLB10C:
1d48  f5            5757   5855 	PUSH	PSW
1d49  cd 67 1c      5758   5856 	CALL	FLMULB10
1d4c  f1            5759   5857 	POP	PSW
1d4d  3d            5760   5858 	DCR	A
1d4e  c9            5761   5859 	RET
                    5762   5860
1d4f                5763   5861 DECDIGIT:
1d4f  d5            5764   5862 	PUSH	D		;DECODE DIGIT OF NUMBER
1d50  57            5765   5863 	MOV	D,A
1d51  78            5766   5864 	MOV	A,B
1d52  89            5767   5865 	ADC	C
1d53  47            5768   5866 	MOV	B,A
1d54  c5            5769   5867 	PUSH	B
1d55  e5            5770   5868 	PUSH	H
1d56  d5            5771   5869 	PUSH	D
1d57  cd 67 1c      5772   5870 	CALL	FLMULB10
1d5a  f1            5773   5871 	POP	PSW
1d5b  d6 30         5774   5872 	SUI	'0'
1d5d  cd 66 1d      5775   5873 	CALL	DECDGADD
1d60  e1            5776   5874 	POP	H
1d61  c1            5777   5875 	POP	B
1d62  d1            5778   5876 	POP	D
1d63  c3 e3 1c      5779   5877 	JMP	DECODELP
                    5780   5878
1d66                5781   5879 DECDGADD:
1d66  cd c3 1b      5782   5880 	CALL	PUSHAC
1d69  cd 97 1c      5783   5881 	CALL	FLOATBYT
1d6c                5784   5882 ADDOPR:
1d6c  c1            5785   5883 	POP	B
1d6d  d1            5786   5884 	POP	D
1d6e  c3 ca 19      5787   5885 	JMP	FLADD
                    5788   5886
                    5789   5887 ;
                    5790   5888 ;  Page 121
                    5791   5889 ;
                    5792   5890
                    5793   5891 ;
                    5794   5892 ;  FLOATING POINT ENCODE ROUTINE
                    5795   5893 ;
1d71                5796   5894 ERRMSGIN:
1d71  e5            5797   5895 	PUSH	H		;PRINT CUR LINE NUMBER IN ERROR
1d72  21 eb 05      5798   5896 	LXI	H,MSGIN
1d75  cd c2 0d      5799   5897 	CALL	PRNTMSG
1d78  e1            5800   5898 	POP	H
1d79                5801   5899 PRINTINT:
1d79  e5            5802   5900 	PUSH	H		;PRINT AN INTEGER
1d7a  21 c1 0d      5803   5901 	LXI	H,PRNTNUMS
1d7d  e3            5804   5902 	XTHL
1d7e                5805   5903 ENCODEHL:
1d7e  eb            5806   5904 	XCHG			;ENCODE AN INTEGER
1d7f  af            5807   5905 	XRA	A
1d80  06 98         5808   5906 	MVI	B,098H
1d82  cd 9c 1c      5809   5907 	CALL	FLOATINT
1d85                5810   5908 ENCODE:
1d85  11 f3 ff      5811   5909 	LXI	D,-13		;ENCODE AC IN EXTERNAL FORM
1d88  2a 97 03      5812   5910 	LHLD	PROGBASE
1d8b  19            5813   5911 	DAD	D		;CREATE POINTER TO ENCODE BUFFER
1d8c  e5            5814   5912 	PUSH	H
1d8d  cd 7e 1c      5815   5913 	CALL	SIGNACC
1d90  36 20         5816   5914 	MVI	M,' '
1d92  f2 97 1d      5817   5915 	JP	ENCODFRS
1d95  36 2d         5818   5916 	MVI	M,'-'
1d97                5819   5917 ENCODFRS:
1d97  23            5820   5918 	INX	H
1d98  36 30         5821   5919 	MVI	M,'0'
1d9a  ca 41 1e      5822   5920 	JZ	ENCODZXT
1d9d  e5            5823   5921 	PUSH	H
1d9e  fc ae 1c      5824   5922 	CM	CMACCS
1da1  af            5825   5923 	XRA	A
1da2  f5            5826   5924 	PUSH	PSW
1da3  cd 47 1e      5827   5925 	CALL	ENCODCMP
1da6                5828   5926 ENCODUPL:
1da6  01 43 91      5829   5927 	LXI	B,09143H	;FORCE NUMBER TO RANGE
1da9  11 f8 4f      5830   5928 	LXI	D,04FF8H	;10**5 <= AC BY MULTIPLICATION
1dac  cd 0f 1c      5831   5929 	CALL	FLCMP
1daf  3d            5832   5930 	DCR	A
1db0  f2 c4 1d      5833   5931 	JP	ENCODRND
1db3  f1            5834   5932 	POP	PSW
1db4  cd 48 1d      5835   5933 	CALL	FLMLB10C
1db7  f5            5836   5934 	PUSH	PSW
1db8  c3 a6 1d      5837   5935 	JMP	ENCODUPL
                    5838   5936
1dbb                5839   5937 ENCODDNL:
1dbb  cd 35 1b      5840   5938 	CALL	FLDIVB10	;FORCE NUMBER TO RANGE
1dbe  f1            5841   5939 	POP	PSW		;AC < 10**6 BY DIVISION
1dbf  3c            5842   5940 	INR	A
1dc0  f5            5843   5941 	PUSH	PSW
1dc1  cd 47 1e      5844   5942 	CALL	ENCODCMP
1dc4                5845   5943 ENCODRND:
1dc4  cd b6 19      5846   5944 	CALL	FLADDHLF	;ROUND UP RESULT
1dc7  3c            5847   5945 	INR A
                    5848   5946
                    5849   5947 ;
                    5850   5948 ;  Page 122
                    5851   5949 ;
                    5852   5950
1dc8  cd 3c 1c      5853   5951 	CALL	FIXAC
1dcb  cd d3 1b      5854   5952 	CALL	LDACRG
1dce  01 06 02      5855   5953 	LXI	B,00206H	;D.DDDDD
1dd1  f1            5856   5954 	POP	PSW
1dd2  81            5857   5955 	ADD	C
1dd3  fa df 1d      5858   5956 	JM	ENCDEXPS
1dd6  fe 07         5859   5957 	CPI	007H
1dd8  d2 df 1d      5860   5958 	JNC	ENCDEXPS
1ddb  3c            5861   5959 	INR	A
1ddc  47            5862   5960 	MOV	B,A
1ddd  3e 01         5863   5961 	MVI	A,001H
1ddf                5864   5962 ENCDEXPS:
1ddf  3d            5865   5963 	DCR	A
1de0  e1            5866   5964 	POP	H
1de1  f5            5867   5965 	PUSH	PSW
1de2  11 5a 1e      5868   5966 	LXI	D,ENCDCOEF
1de5                5869   5967 ENCODDGL:
1de5  05            5870   5968 	DCR	B
1de6  36 2e         5871   5969 	MVI	M,'.'
1de8  cc e8 1b      5872   5970 	CZ	INCHLRET
1deb  c5            5873   5971 	PUSH	B
1dec  e5            5874   5972 	PUSH	H
1ded  d5            5875   5973 	PUSH	D
1dee  cd de 1b      5876   5974 	CALL	LDRGAC
1df1  e1            5877   5975 	POP	H
1df2  06 2f         5878   5976 	MVI	B,'0'-1		;GENERATE NEXT DIGIT
1df4                5879   5977 ENCODSBL:
1df4  04            5880   5978 	INR	B
1df5  7b            5881   5979 	MOV	A,E
1df6  96            5882   5980 	SUB	M
1df7  5f            5883   5981 	MOV	E,A
1df8  23            5884   5982 	INX	H
1df9  7a            5885   5983 	MOV	A,D
1dfa  9e            5886   5984 	SBB	M
1dfb  57            5887   5985 	MOV	D,A
1dfc  23            5888   5986 	INX	H
1dfd  79            5889   5987 	MOV	A,C
1dfe  9e            5890   5988 	SBB	M
1dff  4f            5891   5989 	MOV	C,A
1e00  2b            5892   5990 	DCX	H
1e01  2b            5893   5991 	DCX	H
1e02  d2 f4 1d      5894   5992 	JNC	ENCODSBL
1e05  cd 71 1a      5895   5993 	CALL	ADDM2CDE
1e08  23            5896   5994 	INX	H
1e09  cd d3 1b      5897   5995 	CALL	LDACRG
1e0c  eb            5898   5996 	XCHG
1e0d  e1            5899   5997 	POP	H
1e0e  70            5900   5998 	MOV	M,B
1e0f  23            5901   5999 	INX	H
1e10  c1            5902   6000 	POP	B
1e11  0d            5903   6001 	DCR	C
1e12  c2 e5 1d      5904   6002 	JNZ	ENCODDGL
1e15  05            5905   6003 	DCR	B
1e16  ca 25 1e      5906   6004 	JZ	ENCODEXP
1e19                5907   6005 ENCDRTZR:
1e19  2b            5908   6006 	DCX	H		;REMOVE TRAILING ZEROES
                    5909   6007
                    5910   6008 ;
                    5911   6009 ;  Page 123
                    5912   6010 ;
                    5913   6011
1e1a  7e            5914   6012 	MOV	A,M
1e1b  fe 30         5915   6013 	CPI	'0'
1e1d  ca 19 1e      5916   6014 	JZ	ENCDRTZR
1e20  fe 2e         5917   6015 	CPI	'.'		;REMOVE TRAILING DECIMAL POINT
1e22  c4 e8 1b      5918   6016 	CNZ	INCHLRET
1e25                5919   6017 ENCODEXP:
1e25  f1            5920   6018 	POP	PSW		;ENCODE EXPONENT
1e26  ca 44 1e      5921   6019 	JZ	ENCODEXT
1e29  36 45         5922   6020 	MVI	M,'E'
1e2b  23            5923   6021 	INX	H
1e2c  36 2b         5924   6022 	MVI	M,'+'
1e2e  f2 35 1e      5925   6023 	JP	ENCDEXPP
1e31  36 2d         5926   6024 	MVI	M,'-'
1e33  2f            5927   6025 	CMA
1e34  3c            5928   6026 	INR	A
1e35                5929   6027 ENCDEXPP:
1e35  06 2f         5930   6028 	MVI	B,'0'-1
1e37                5931   6029 ENCDEXPL:
1e37  04            5932   6030 	INR	B
1e38  d6 0a         5933   6031 	SUI	10
1e3a  d2 37 1e      5934   6032 	JNC	ENCDEXPL
1e3d  c6 3a         5935   6033 	ADI	'9'+1
1e3f  23            5936   6034 	INX	H
1e40  70            5937   6035 	MOV	M,B
1e41                5938   6036 ENCODZXT:
1e41  23            5939   6037 	INX	H
1e42  77            5940   6038 	MOV	M,A
1e43  23            5941   6039 	INX	H
1e44                5942   6040 ENCODEXT:
1e44  71            5943   6041 	MOV	M,C
1e45  e1            5944   6042 	POP	H
1e46  c9            5945   6043 	RET
                    5946   6044
1e47                5947   6045 ENCODCMP:
1e47  01 74 94      5948   6046 	LXI	B,09474H	;10**6
1e4a  11 f7 23      5949   6047 	LXI	D,023F7H
1e4d  cd 0f 1c      5950   6048 	CALL	FLCMP
1e50  e1            5951   6049 	POP	H
1e51  3d            5952   6050 	DCR	A
1e52  f2 bb 1d      5953   6051 	JP	ENCODDNL
1e55  e9            5954   6052 	PCHL
                    5955   6053
1e56                5956   6054 FLHALF:
1e56  00 00 00 80   5957   6055 	DB	000h, 000h, 000h, 080h	;1/2
                    5958   6056
1e5a                5959   6057 ENCDCOEF:
1e5a  a0 86 01      5960   6058 	db	0a0h, 086h, 001h	;10**5
1e5d  10 27 00      5961   6059 	db	010h, 027h, 000h	;10**4
1e60  e8 03 00      5962   6060 	db	0e8h, 003h, 000h	;10**3
1e63  64 00 00      5963   6061 	db	064h, 000h, 000h	;10**2
1e66  0a 00 00      5964   6062 	db	00ah, 000h, 000h	;10**1
1e69  01 00 00      5965   6063 	db	001h, 000h, 000h	;10**0
                    5966   6064
                    5967   6065 ;
                    5968   6066 ;  Page 124
                    5969   6067 ;
                    5970   6068
                    5971   6069 ;
                    5972   6070 ;  FLOATING POINT LOGARITHM ROUTINE
                    5973   6071 ;
                    5974   6072
1e6c                5975   6073 LOGCOEF:
1e6c  03            5976   6074 	DB	3
1e6d  aa 56 19 80   5977   6075 	db	0aah, 056h, 019h, 080h
1e71  f1 22 76 80   5978   6076 	db	0f1h, 022h, 076h, 080h
1e75  45 aa 38 82   5979   6077 	db	045h, 0aah, 038h, 082h
1e79                5980   6078 FLONE:
1e79  00 00 00 81   5981   6079 	db	000h, 000h, 000h, 081h	;1.0
1e7d                5982   6080 LOGFCT:
1e7d  cd 7e 1c      5983   6081 	CALL	SIGNACC		;LOG FUNCTION
1e80  3d            5984   6082 	DCR	A
1e81  fa 39 0c      5985   6083 	JM	ERRAFC
1e84  21 ac 03      5986   6084 	LXI	H,FLACCEXP
1e87  7e            5987   6085 	MOV	A,M
1e88  01 35 80      5988   6086 	LXI	B,08035H
1e8b  11 f3 04      5989   6087 	LXI	D,004F3H
1e8e  90            5990   6088 	SUB	B
1e8f  f5            5991   6089 	PUSH	PSW
1e90  70            5992   6090 	MOV	M,B
1e91  d5            5993   6091 	PUSH	D
1e92  c5            5994   6092 	PUSH	B
1e93  cd ca 19      5995   6093 	CALL	FLADD
1e96  c1            5996   6094 	POP	B
1e97  d1            5997   6095 	POP	D
1e98  04            5998   6096 	INR	B
1e99  cd 43 1b      5999   6097 	CALL	FLDIV
1e9c  21 79 1e      6000   6098 	LXI	H,FLONE
1e9f  cd bf 19      6001   6099 	CALL	FLMMMAC
1ea2  21 6c 1e      6002   6100 	LXI	H,LOGCOEF
1ea5  cd 66 1f      6003   6101 	CALL	FCTPOLY2
1ea8  01 80 80      6004   6102 	LXI	B,08080H
1eab  11 00 00      6005   6103 	LXI	D,00000H
1eae  cd ca 19      6006   6104 	CALL	FLADD
1eb1  f1            6007   6105 	POP	PSW
1eb2  cd 66 1d      6008   6106 	CALL	DECDGADD
1eb5                6009   6107 FLMULLN2:
1eb5  01 31 80      6010   6108 	LXI	B,08031H	;LN(2)=0.6931472
1eb8  11 18 72      6011   6109 	LXI	D,07218H
1ebb  c3 b7 1a      6012   6110 	JMP	FLMUL
                    6013   6111
                    6014   6112 ;
                    6015   6113 ;  Page 125
                    6016   6114 ;
                    6017   6115
                    6018   6116 ;
                    6019   6117 ;  FLOATING POINT SQUARE ROOT/EXPONENTIATION ROUTINE
                    6020   6118 ;
                    6021   6119
1ebe                6022   6120 SQRFCT:
1ebe  cd c3 1b      6023   6121 	CALL	PUSHAC		;SQR FUNCTION
1ec1  21 56 1e      6024   6122 	LXI	H,FLHALF	;SQR(X)=X**1/2
1ec4  cd d0 1b      6025   6123 	CALL	LDRGACMM
1ec7                6026   6124 EXPOPR:
1ec7  c1            6027   6125 	POP	B		;X**Y=EXP(LOG(X)*Y)
1ec8  d1            6028   6126 	POP	D
1ec9  cd 7e 1c      6029   6127 	CALL	SIGNACC
1ecc  ca 05 1f      6030   6128 	JZ	EXPFCT
1ecf  78            6031   6129 	MOV	A,B
1ed0  b7            6032   6130 	ORA	A
1ed1  ca 31 1a      6033   6131 	JZ	LDACCE
1ed4  d5            6034   6132 	PUSH	D
1ed5  c5            6035   6133 	PUSH	B
1ed6  79            6036   6134 	MOV	A,C
1ed7  f6 7f         6037   6135 	ORI	07FH
1ed9  cd de 1b      6038   6136 	CALL	LDRGAC
1edc  f2 ed 1e      6039   6137 	JP	EXPEXPOS
1edf  d5            6040   6138 	PUSH	D
1ee0  c5            6041   6139 	PUSH	B
1ee1  cd b6 1c      6042   6140 	CALL	INTFCT
1ee4  c1            6043   6141 	POP	B
1ee5  d1            6044   6142 	POP	D
1ee6  f5            6045   6143 	PUSH	PSW
1ee7  cd 0f 1c      6046   6144 	CALL	FLCMP
1eea  e1            6047   6145 	POP	H
1eeb  7c            6048   6146 	MOV	A,H
1eec  1f            6049   6147 	RAR
1eed                6050   6148 EXPEXPOS:
1eed  e1            6051   6149 	POP	H
1eee  22 ab 03      6052   6150 	SHLD	FLACCMSB
1ef1  e1            6053   6151 	POP	H
1ef2  22 a9 03      6054   6152 	SHLD	ACCUMLTR
1ef5  dc 8f 1c      6055   6153 	CC	CMANSWR
1ef8  cc ae 1c      6056   6154 	CZ	CMACCS
1efb  d5            6057   6155 	PUSH	D
1efc  c5            6058   6156 	PUSH	B
1efd  cd 7d 1e      6059   6157 	CALL	LOGFCT
1f00  c1            6060   6158 	POP	B
1f01  d1            6061   6159 	POP	D
1f02  cd b7 1a      6062   6160 	CALL	FLMUL
                    6063   6161
                    6064   6162 ;
                    6065   6163 ;  Page 126
                    6066   6164 ;
                    6067   6165
                    6068   6166 ;
                    6069   6167 ;  EXPONENTIAL FUNCTION ROUTINE
                    6070   6168 ;
                    6071   6169
                    6072   6170
1f05                6073   6171 EXPFCT:
1f05  cd c3 1b      6074   6172 	CALL	PUSHAC		;EXP FUNCTION
1f08  01 38 81      6075   6173 	LXI	B,08138H	;LOG(2)E=1.442695
1f0b  11 3b aa      6076   6174 	LXI	D,0AA3BH
1f0e  cd b7 1a      6077   6175 	CALL	FLMUL
1f11  3a ac 03      6078   6176 	LDA	FLACCEXP
1f14  fe 88         6079   6177 	CPI	088H
1f16  d2 28 1b      6080   6178 	JNC	EXPRNEXC
1f19  cd b6 1c      6081   6179 	CALL	INTFCT
1f1c  c6 80         6082   6180 	ADI	080H
1f1e  c6 02         6083   6181 	ADI	002H
1f20  da 28 1b      6084   6182 	JC	EXPRNEXC
1f23  f5            6085   6183 	PUSH	PSW
1f24  21 79 1e      6086   6184 	LXI	H,FLONE
1f27  cd b9 19      6087   6185 	CALL	FLADDM
1f2a  cd b5 1e      6088   6186 	CALL	FLMULLN2
1f2d  f1            6089   6187 	POP	PSW
1f2e  c1            6090   6188 	POP	B
1f2f  d1            6091   6189 	POP	D
1f30  f5            6092   6190 	PUSH	PSW
1f31  cd c7 19      6093   6191 	CALL	FLSUB
1f34  cd ae 1c      6094   6192 	CALL	CMACCS
1f37  21 45 1f      6095   6193 	LXI	H,EXPCOEF
1f3a  cd 75 1f      6096   6194 	CALL	FCTPOLY1
1f3d  11 00 00      6097   6195 	LXI	D,0
1f40  c1            6098   6196 	POP	B
1f41  4a            6099   6197 	MOV	C,D
1f42  c3 b7 1a      6100   6198 	JMP	FLMUL
                    6101   6199
1f45                6102   6200 EXPCOEF:
1f45  08            6103   6201 	DB	8
1f46  40 2e 94 74   6104   6202 	db	040h, 02eh, 094h, 074h
1f4a  70 4f 2e 77   6105   6203 	db	070h, 04fh, 02eh, 077h
1f4e  6e 02 88 7a   6106   6204 	db	06eh, 002h, 088h, 07ah
1f52  e6 a0 2a 7c   6107   6205 	db	0e6h, 0a0h, 02ah, 07ch
1f56  50 aa aa 7e   6108   6206 	db	050h, 0aah, 0aah, 07eh
1f5a  ff ff 7f 7f   6109   6207 	db	0ffh, 0ffh, 07fh, 07fh
1f5e  00 00 80 81   6110   6208 	db	000h, 000h, 080h, 081h
1f62  00 00 00 81   6111   6209 	db	000h, 000h, 000h, 081h
                    6112   6210
                    6113   6211 ;
                    6114   6212 ;  Page 127
                    6115   6213 ;
                    6116   6214
                    6117   6215 ;
                    6118   6216 ;  FLOATING POINT POLYNOMINAL EVALUATORS
                    6119   6217 ;
                    6120   6218
                    6121   6219
1f66                6122   6220 FCTPOLY2:
1f66  cd c3 1b      6123   6221 	CALL	PUSHAC		;POLYNOMIAL EVALUATOR
1f69  11 b5 1a      6124   6222 	LXI	D,MULOPR	;EVALUATE P(X**2)*X
1f6c  d5            6125   6223 	PUSH	D
1f6d  e5            6126   6224 	PUSH	H
1f6e  cd de 1b      6127   6225 	CALL	LDRGAC
1f71  cd b7 1a      6128   6226 	CALL	FLMUL
1f74  e1            6129   6227 	POP	H
1f75                6130   6228 FCTPOLY1:
1f75  cd c3 1b      6131   6229 	CALL	PUSHAC		;EVALUATE P(X)
1f78  7e            6132   6230 	MOV	A,M
1f79  23            6133   6231 	INX	H
1f7a  cd d0 1b      6134   6232 	CALL	LDRGACMM
1f7d                6135   6233 FCTPOLYL:
1f7d  c1            6136   6234 	POP	B
1f7e  d1            6137   6235 	POP	D
1f7f  3d            6138   6236 	DCR	A
1f80  c8            6139   6237 	RZ
1f81  d5            6140   6238 	PUSH	D
1f82  c5            6141   6239 	PUSH	B
1f83  f5            6142   6240 	PUSH	PSW
1f84  e5            6143   6241 	PUSH	H
1f85  cd b7 1a      6144   6242 	CALL	FLMUL
1f88  e1            6145   6243 	POP	H
1f89  cd e1 1b      6146   6244 	CALL	LDRGMM
1f8c  e5            6147   6245 	PUSH	H
1f8d  cd ca 19      6148   6246 	CALL	FLADD
1f90  e1            6149   6247 	POP	H
1f91  f1            6150   6248 	POP	PSW
1f92  c3 7d 1f      6151   6249 	JMP	FCTPOLYL
                    6152   6250
                    6153   6251 ;
                    6154   6252 ;  Page 128
                    6155   6253 ;
                    6156   6254
                    6157   6255 ;
                    6158   6256 ;  RANDOM NUMBER GENERATOR
                    6159   6257 ;
                    6160   6258
                    6161   6259
1f95                6162   6260 RNDFCT:
1f95  cd 7e 1c      6163   6261 	CALL	SIGNACC		;RND FUNCTION
1f98  fa b4 1f      6164   6262 	JM	RNDFCTUS	;<0 - INITIALIZE SEED
1f9b  21 b5 03      6165   6263 	LXI	H,RNDFCTSD
1f9e  cd d0 1b      6166   6264 	CALL	LDRGACMM
1fa1  c8            6167   6265 	RZ			;=0 - PREVIOUS VALUE
1fa2  01 35 98      6168   6266 	LXI	B,09835H
1fa5  11 7a 44      6169   6267 	LXI	D,0447AH
1fa8  cd b7 1a      6170   6268 	CALL	FLMUL		;>0 - NEXT VALUE
1fab  01 28 68      6171   6269 	LXI	B,06828H
1fae  11 46 b1      6172   6270 	LXI	D,0B146H
1fb1  cd ca 19      6173   6271 	CALL	FLADD
1fb4                6174   6272 RNDFCTUS:
1fb4  cd de 1b      6175   6273 	CALL	LDRGAC		;CHANGE SEED
1fb7  7b            6176   6274 	MOV	A,E
1fb8  59            6177   6275 	MOV	E,C
1fb9  4f            6178   6276 	MOV	C,A
1fba  36 80         6179   6277 	MVI	M,080H
1fbc  2b            6180   6278 	DCX	H
1fbd  46            6181   6279 	MOV	B,M
1fbe  36 80         6182   6280 	MVI	M,080H
1fc0  cd 1b 1a      6183   6281 	CALL	NORMALIZ
1fc3  21 b5 03      6184   6282 	LXI	H,RNDFCTSD
1fc6  c3 ea 1b      6185   6283 	JMP	LDMMAC
                    6186   6284
                    6187   6285 ;
                    6188   6286 ;  Page 129
                    6189   6287 ;
                    6190   6288
                    6191   6289 ;
                    6192   6290 ;  FLOATING POINT SINE/COSINE ROUTINES
                    6193   6291 ;
                    6194   6292
                    6195   6293
1fc9                6196   6294 COSFCT:
1fc9  21 13 20      6197   6295 	LXI	H,PIOVER2	;COS FUNCTION
1fcc  cd b9 19      6198   6296 	CALL	FLADDM
1fcf                6199   6297 SINFCT:
1fcf  cd c3 1b      6200   6298 	CALL	PUSHAC		;SIN FUNCTION
1fd2  01 49 83      6201   6299 	LXI	B,08349H	;Y=X*2*PI
1fd5  11 db 0f      6202   6300 	LXI	D,00FDBH
1fd8  cd d3 1b      6203   6301 	CALL	LDACRG
1fdb  c1            6204   6302 	POP	B
1fdc  d1            6205   6303 	POP	D
1fdd  cd 43 1b      6206   6304 	CALL	FLDIV
1fe0  cd c3 1b      6207   6305 	CALL	PUSHAC		;Y=Y MOD 1
1fe3  cd b6 1c      6208   6306 	CALL	INTFCT
1fe6  c1            6209   6307 	POP	B
1fe7  d1            6210   6308 	POP	D
1fe8  cd c7 19      6211   6309 	CALL	FLSUB
1feb  21 17 20      6212   6310 	LXI	H,FLQUART
1fee  cd bf 19      6213   6311 	CALL	FLMMMAC
1ff1  cd 7e 1c      6214   6312 	CALL	SIGNACC
1ff4  37            6215   6313 	STC
1ff5  f2 ff 1f      6216   6314 	JP	SINFCTC
1ff8  cd b6 19      6217   6315 	CALL	FLADDHLF
1ffb  cd 7e 1c      6218   6316 	CALL	SIGNACC
1ffe  b7            6219   6317 	ORA	A
1fff                6220   6318 SINFCTC:
1fff  f5            6221   6319 	PUSH	PSW
2000  f4 ae 1c      6222   6320 	CP	CMACCS
2003  21 17 20      6223   6321 	LXI	H,FLQUART
2006  cd b9 19      6224   6322 	CALL	FLADDM
2009  f1            6225   6323 	POP	PSW
200a  d4 ae 1c      6226   6324 	CNC	CMACCS
200d  21 1b 20      6227   6325 	LXI	H,COSCOEF
2010  c3 66 1f      6228   6326 	JMP	FCTPOLY2
                    6229   6327
2013                6230   6328 PIOVER2:
2013  db 0f 49 81   6231   6329 	db	0dbh, 00fh, 049h, 081h	;PI/2
                    6232   6330
                    6233   6331
2017                6234   6332 FLQUART:
2017  00 00 00 7f   6235   6333 	db	000h, 000h, 000h, 07fh	;1/4
                    6236   6334
201b                6237   6335 COSCOEF:
201b  05            6238   6336 	DB	5
201c  ba d7 1e 86   6239   6337 	db	0bah, 0d7h, 01eh, 086h
2020  64 26 99 87   6240   6338 	db	064h, 026h, 099h, 087h
2024  58 34 23 87   6241   6339 	db	058h, 034h, 023h, 087h
2028  e0 5d a5 86   6242   6340 	db	0e0h, 05dh, 0a5h, 086h
                    6243   6341
                    6244   6342 ;
                    6245   6343 ;  Page 130
                    6246   6344 ;
                    6247   6345
202c  da 0f 49 83   6248   6346 	db	0dah, 00fh, 049h, 083h
                    6249   6347
                    6250   6348 ;
                    6251   6349 ;  Page 131
                    6252   6350 ;
                    6253   6351
                    6254   6352 ;
                    6255   6353 ;  FLOATING POINT TANGENT/ARCTANGENT ROUTINES
                    6256   6354 ;
                    6257   6355
                    6258   6356
2030                6259   6357 TANFCT:
2030  cd c3 1b      6260   6358 	CALL	PUSHAC		;TAN FUNCTION
2033  cd cf 1f      6261   6359 	CALL	SINFCT
2036  c1            6262   6360 	POP	B		;TAN(X) = SIN(X)/COS(X)
2037  e1            6263   6361 	POP	H
2038  cd c3 1b      6264   6362 	CALL	PUSHAC
203b  eb            6265   6363 	XCHG
203c  cd d3 1b      6266   6364 	CALL	LDACRG
203f  cd c9 1f      6267   6365 	CALL	COSFCT
2042  c3 41 1b      6268   6366 	JMP	DIVOPR
                    6269   6367
2045                6270   6368 ATNFCT:
2045  cd 7e 1c      6271   6369 	CALL	SIGNACC
2048  fc 8f 1c      6272   6370 	CM	CMANSWR
204b  fc ae 1c      6273   6371 	CM	CMACCS
204e  3a ac 03      6274   6372 	LDA	FLACCEXP
2051  fe 81         6275   6373 	CPI	081H
2053  da 62 20      6276   6374 	JC	ATNFCTC
2056  01 00 81      6277   6375 	LXI	B,08100H
2059  51            6278   6376 	MOV	D,C
205a  59            6279   6377 	MOV	E,C
205b  cd 43 1b      6280   6378 	CALL	FLDIV
205e  21 bf 19      6281   6379 	LXI	H,FLMMMAC
2061  e5            6282   6380 	PUSH	H
2062                6283   6381 ATNFCTC:
2062  21 6c 20      6284   6382 	LXI	H,ATNCOEF
2065  cd 66 1f      6285   6383 	CALL	FCTPOLY2
2068  21 13 20      6286   6384 	LXI	H,PIOVER2
206b  c9            6287   6385 	RET
                    6288   6386
206c                6289   6387 ATNCOEF:
206c  09            6290   6388 	DB	9
206d  4a d7 3b 78   6291   6389 	db	04ah, 0d7h, 03bh, 078h
2071  02 6e 84 7b   6292   6390 	db	002h, 06eh, 084h, 07bh
2075  fe c1 2f 7c   6293   6391 	db	0feh, 0c1h, 02fh, 07ch
2079  74 31 9a 7d   6294   6392 	db	074h, 031h, 09ah, 07dh
207d  84 3d 5a 7d   6295   6393 	db	084h, 03dh, 05ah, 07dh
2081  c8 7f 91 7e   6296   6394 	db	0c8h, 07fh, 091h, 07eh
2085  e4 bb 4c 7e   6297   6395 	db	0e4h, 0bbh, 04ch, 07eh
2089  6c aa aa 7f   6298   6396 	db	06ch, 0aah, 0aah, 07fh
208d  00 00 00 81   6299   6397 	db	000h, 000h, 000h, 081h
                    6300   6398
                    6301   6399 ;
                    6302   6400 ;  Page 132
                    6303   6401 ;
                    6304   6402
2091                6305   6403 VERSNDAT:
2091  30 32 2f 30   6306   6404 	DB	'02/03/78',0
2095  33 2f 37 38   6306   6405
2099  00            6306   6406
                    6307   6407
                    6308   6408
209a                6309   6409 ENDINTRP:
209a  00            6310   6410 	DB	0		;END OF INTERPRETER
                    6311   6411
                    6312   6412 ;
                    6313   6413 ;  Page 133
                    6314   6414 ;
                    6315   6415
                    6316   6416 ;
                    6317   6417 ;  INITIALIZATION
                    6318   6418 ;
                    6319   6419
209b                6320   6420 INITIALZ:
                    6321   6421
209b  21 ff ff      6322   6422 	LXI	H,0FFFFH
209e  22 89 03      6323   6423 	SHLD	CURLINE
20a1  21 06 22      6324   6424 	LXI	H,INITSTCK
20a4  f9            6325   6425 	SPHL
20a5  22 9f 03      6326   6426 	SHLD	STCKBASE
20a8  af            6327   6427 	XRA	A
20a9  32 7b 03      6328   6428 	STA	PRINTFLG
20ac  cd 1a 00      6329   6429 	call	dclr
20af  cd 5f 0d      6330   6430 	CALL	PRNTCRLF
20b2  21 00 af      6331   6431 	LXI	H,LIMUPPER	;ADDRESS LAST BYTE
20b5  22 a7 03      6332   6432 	SHLD	STRGTLIM
20b8  11 e2 ff      6333   6433 	LXI	D,-10*3
20bb  19            6334   6434 	DAD	D
20bc  22 a3 03      6335   6435 	SHLD	STRGBASE
20bf  22 a1 03      6336   6436 	SHLD	STRGFREE
20c2  11 00 ff      6337   6437 	LXI	D,-256
20c5  19            6338   6438 	DAD	D
20c6  d2 07 05      6339   6439 	JNC	ERRAOM
20c9  e5            6340   6440 	PUSH	H
20ca  21 00 80      6341   6441 	LXI	H,LIMLOWER	;ADDRESS OF FIRST BYTE
20cd  11 0c 00      6342   6442 	LXI	D,12
20d0  19            6343   6443 	DAD	D
20d1  36 00         6344   6444 	MVI	M,000H
20d3  23            6345   6445 	INX	H
20d4  22 97 03      6346   6446 	SHLD	PROGBASE
20d7  e3            6347   6447 	XTHL
20d8  d1            6348   6448 	POP	D
20d9  f9            6349   6449 	SPHL
20da  22 9f 03      6350   6450 	SHLD	STCKBASE
20dd  21 f3 ff      6351   6451 	LXI	H,-13
20e0  39            6352   6452 	DAD	SP
20e1  f9            6353   6453 	SPHL
20e2  eb            6354   6454 	XCHG
20e3  cd fb 04      6355   6455 	CALL	SPACECHK
20e6  7b            6356   6456 	MOV	A,E
20e7  95            6357   6457 	SUB	L
20e8  6f            6358   6458 	MOV	L,A
20e9  7a            6359   6459 	MOV	A,D
20ea  9c            6360   6460 	SBB	H
20eb  67            6361   6461 	MOV	H,A
20ec  01 f0 ff      6362   6462 	LXI	B,-16
20ef  09            6363   6463 	DAD	B
20f0  cd 5f 0d      6364   6464 	CALL	PRNTCRLF
20f3  cd 79 1d      6365   6465 	CALL	PRINTINT
20f6  21 0c 21      6366   6466 	LXI	H,INITMFRE
20f9  cd c2 0d      6367   6467 	CALL	PRNTMSG
20fc  21 91 20      6368   6468 	LXI	H,VERSNDAT
20ff  cd c2 0d      6369   6469 	CALL	PRNTMSG
2102  cd 0d 05      6370   6470 	CALL	CLEARPGM
2105  21 61 06      6371   6471 	LXI	H,CMNDRSTR
                    6372   6472
                    6373   6473 ;
                    6374   6474 ;  Page 134
                    6375   6475 ;
                    6376   6476
2108  22 01 00      6377   6477 	SHLD	SYSINITJ+1
210b  e9            6378   6478 	PCHL
                    6379   6479
                    6380   6480
210c                6381   6481 INITMFRE:
210c  20 42 59 54   6382   6482 	DB	' BYTES FREE'
2110  45 53 20 46   6382   6483
2114  52 45 45      6382   6484
2117  0d 0a 0a      6383   6485 	DB	CR,LF,LF
211a  42 41 53 49   6384   6486 	db	'BASIC, Version of ', 0
211e  43 2c 20 56   6384   6487
2122  65 72 73 69   6384   6488
2126  6f 6e 20 6f   6384   6489
212a  66 20 00      6384   6490
212d                6385   6491 INITSTSP:
212d                6386   6492 	DS	30*2+LINESYZE	;INITIALIZE STACK SPACE
2206                6387   6493 INITSTCK:
2206                6388   6494 	DS	20
                    6389   6495
                    6390   6496
                    6391   6497
221a                6392   6498 	END

Symbol table

ABSFCT          1caa    ACCUMLTR        03a9    ADDM2CDE        1a71
ADDOPR          1d6c    ALPHACHA        03d2    ALPHACHK        03d1
ALPHACHL        03e1    ANDOPR          1944    ASCFCT          1636
ASSIGN          0bd1    ASSIGNVL        0bc7    ATNCOEF         206c
ATNFCT          2045    ATNFCTC         2062    AUTSTM          067a
AUTSTMBR        06a0    AUTSTMIN        066d    AUTSTMN         068b
AUTSTMS         067b    BASIC           0000*   BEL             0007
BOOTSTART       b39b    BREAKCHK        0add    BS              0008
CANNOTOPEN      18c8    CBYTE           0c45    CD1             0011*
CHARMTCH        03e4    CHECKPROGRAM    18ee    CHRFCT          1643
CINB            0011    CINTEGER        0c26    CINTPOS         0c20
CLDSTM          1876    CLEARPCN        0551    CLEARPGM        050d
CLEARSCREEN     0037    CLEARSET        0518    CLEARSTK        0521
CLEARVAR        0541    CLEARVST        051b    CLOSES          b82d
CLRSTM          057d    CMACCS          1cae    CMANSWR         1c8f
CMHLLTDE        04d7    CMNDINPT        0642    CMNDRSTR        0661
CMNDSTRT        062f    CMPXT           1c8b    CMREGS          1a7d
CO              0006    COERCE          0bfb    COERCEF         0bfe
CONSTM          0b07    COPYCHK         04dd    COPYSTRG        122c
COPYSTRL        122d    COPYTEXT        04e0    COPYTXTL        04e3
COPYVAL         1bed    COPYVALL        1bf1    COSCOEF         201b
COSFCT          1fc9    CPROGLOOP       18f1    CPROGLOOP2      18fa
CPROGOK         1903    CR              000d    CSINGLE         0c0a
CSTRING         0c11    CSVSTM          1890    CURDATAP        0393
CURLDATA        0391    CURLINE         0389    CURLINES        038b
CURSLIM         03b0    CURSPOS         03af    D14BASE         b400
DATAGET         0ef0    DATAINPT        0f1c    DATASRCH        0efa
DATASRCK        0f13    DATRSKIP        0b8b    DATRSKST        0b88
DATSTM          0b7f    DCLR            001a    DECCDE          1c60
DECDEXAL        1d3d    DECDEXPA        1d31    DECDGADD        1d66
DECDIGIT        1d4f    DECMULUP        1d47    DECODE          1ccf
DECODEIN        1cdb    DECODELP        1ce3    DECODEPT        1d2a
DECODEXL        1d10    DECODEXP        1cf8    DECODEXQ        1d22
DECODVAL        1d2e    DEFSTM          141a    DEFSTML         1430
DEL             007f*   DELSTM          0813    DIMSTM          123f
DIMSTML         1236    DIRECTORYLOOKUP b8e0    DIVOPR          1b41
EDISTM          0904    EDISTMAD        094c    EDISTMCH        09e7
EDISTMCR        09d2    EDISTMDL        0957    EDISTMDM        0964
EDISTMEC        0946    EDISTMER        0944    EDISTMIM        0981
EDISTMIN        0970    EDISTMLS        091f    EDISTMNX        092a
EDISTMQT        09cb    EDISTMRI        0974    EDISTMRP        098e
EDISTMSL        09aa    EDISTMSR        09a1    EDISTMXT        09bf
ELSSTM          0b84    ENCDCOEF        1e5a    ENCDEXPL        1e37
ENCDEXPP        1e35    ENCDEXPS        1ddf    ENCDRTZR        1e19
ENCODCMP        1e47    ENCODDGL        1de5    ENCODDNL        1dbb
ENCODE          1d85    ENCODEHL        1d7e    ENCODEXP        1e25
ENCODEXT        1e44    ENCODFRS        1d97    ENCODRND        1dc4
ENCODSBL        1df4    ENCODUPL        1da6    ENCODZXT        1e41
ENDINTRP        209a    ENDPROGM        0ae6    ENDSTM          0b27
ENDSTMC         0af9    ERRABS          1361    ERRAD0          1bbe
ERRAFC          0c39    ERRAID          1516    ERRANF          0f94
ERRAOM          0507    ERRAOV          1a6c    ERRASN          0605
ERRAST          11ba    ERRATM          0c18    ERRAUS          0b60
ERRDATA         05ff    ERRMSG          0607    ERRMSGIN        1d71
ERRMSGPR        0623    ERRN            0289    ERRNBS          0328
ERRNCN          0289    ERRND0          02aa    ERRNDD          0299
ERRNFC          02b6    ERRNFI          036a    ERRNID          02a3
ERRNLS          02c4    ERRNNF          02dd    ERRNOD          02ea
ERRNOM          02d0    ERRNOS          030e    ERRNOV          02f6
ERRNRG          02ff    ERRNSL          0292    ERRNSN          0332
ERRNST          031b    ERRNTM          0339    ERRNUF          033e
ERRNUS          034e    ERRNUV          035a    ESC             0018
ETX             0003    EXECUTE         0aba    EXECUTE2        0c53
EXECUTEB        0ae2    EXECUTEC        0ac1    EXECUTEL        0a9a
EXECUTES        0ac2    EXPCOEF         1f45    EXPEXPOS        1eed
EXPFCT          1f05    EXPOPR          1ec7    EXPRNEXC        1b28
FCTPOLY1        1f75    FCTPOLY2        1f66    FCTPOLYL        1f7d
FCTTABL         00c2    FF              000c    FILENAME        1904
FIXAC           1c3c    FLACCEXP        03ac    FLACCMSB        03ab
FLACCSSV        03ad    FLADD           19ca    FLADDHLF        19b6
FLADDIFF        1a0a    FLADDM          19b9    FLADDMGC        19e4
FLCMP           1c0f    FLCMPM          1c29    FLCMPXT         1c89
FLDIV           1b43    FLDIVB10        1b35    FLDIVLP         1b6b
FLDIVSF         1b8e    FLDIVSS         1b90    FLHALF          1e56
FLMLB10C        1d48    FLMLDVEX        1b0a    FLMLDVEY        1b2d
FLMLDVEZ        1b2e    FLMMMAC         19bf    FLMUL           1ab7
FLMULB10        1c67    FLMULLN2        1eb5    FLMULLP         1ad9
FLMULLQ         1ae2    FLMULNA         1af3    FLMULXT         1b05
FLOATA          0de4    FLOATAB         17e4    FLOATBYT        1c97
FLOATHL         16b7    FLOATINT        1c9c    FLONE           1e79
FLQUART         2017    FLROUND         1a50    FLROUNDV        1a51
FLSCR0          03b1    FLSCR1          03b2    FLSCR2          03b3
FLSCR3          03b4    FLSUB           19c7    FORBLCK         0010
FORCHK          0a0f    FORCHKL         0a13    FORCHKXT        0a2e
FORMARK         0a96    FORSTM          0a37    FORSTMNF        0a54
FORSTMST        0a8d    FREELIMT        039d    FREFCT          17c4
FREFCTNS        17df    FSPROM          b000    GOMONITOR       003d
GSBSTM          0b31    GTOSTM          0b42    HEXFCT          16c5
HEXFCTL         16da    HT              0009    HXVFCT          1691
HXVFCTCH        16bc    HXVFCTL         169e    IFNSTMC         0cfc
IFNSTMCH        0d12    IFNSTMSK        0d04    IFSTM           0cef
INCCDE          1a62    INCHLRET        1be8    INITIALZ        209b
INITMFRE        210c    INITSTCK        2206    INITSTSP        212d
INOTGEN         186a    INOTINS         03b1    INPSTM          0e32
INPSTMBR        0ae5    INPSTMER        0ec9    INPSTMIN        0e6d
INPSTMLN        0f3b    INPSTMPR        0e5b    INPSTMRD        0e36
INPSTMXT        0ecd    INPTBUFR        0395    INPTCHAR        05d1
INPTCRLF        077e    INPTCRTN        07cc    INPTEXIT        07d0
INPTLINC        0795*   INPTLINL        0790    INPTLNBS        0767
INPTLNEC        07c6    INPTLNRD        0774    INPTLNST        07b3
INPTRQST        0781    INSFCT          177d    INSFCTSL        17ab
INSFCTXT        17b5    INTFCT          1cb6    ITEMSIZE        000e
KEYABS          00b9    KEYADD          00aa    KEYAND          00b0
KEYASC          00ca    KEYATA          00c1    KEYAUT          0092
KEYCHR          00cb    KEYCLD          009c    KEYCLR          009b
KEYCON          0098    KEYCOS          00be    KEYCSV          009d
KEYDAT          0080    KEYDEF          0097    KEYDEL          0093
KEYDIM          0086    KEYDIV          00ad    KEYEDI          009a
KEYELS          008c    KEYEND          0082    KEYEQ           00b5
KEYEXP          00bd    KEYEXPT         00af    KEYFCT          00b7
KEYFN           00a7    KEYFOR          0083    KEYFRE          00c3
KEYGSB          008e    KEYGT           00b4    KEYGTO          0089
KEYHEX          00cc    KEYHXV          00cd    KEYIF           008b
KEYINPT         0085    KEYINS          00d2    KEYINT          00b8
KEYLEN          00c7    KEYLET          0088    KEYLFT          00cf
KEYLINE         00a4    KEYLIS          0099    KEYLOG          00bc
KEYLSAH         00a5    KEYLSAL         0082    KEYLSBH         00a3
KEYLSBL         00a0    KEYLT           00b6    KEYMAX          00b2
KEYMEM          00c6    KEYMID          00d1    KEYMIN          00b3
KEYMOD          00ae    KEYMUL          00ac    KEYNEW          009e
KEYNEX          0084    KEYNOT          00a8    KEYOFF          00a9
KEYON           0091    KEYOPR          00aa    KEYOR           00b1
KEYPLT          0094    KEYPORT         00c4    KEYPOS          00c5
KEYPRM          00a3    KEYPRT          0096    KEYREA          0087
KEYREL          00b4    KEYREM          0081    KEYRES          008d
KEYRET          008f    KEYRIG          00d0    KEYRND          00bb
KEYRUN          008a    KEYS            00d3    KEYSCAN         06a7
KEYSCANA        0702    KEYSCANB        0709    KEYSCANC        06ec
KEYSCAND        0723    KEYSCANF        0714    KEYSCANH        0740
KEYSCANI        0736    KEYSCANK        06ca    KEYSCANL        06b0
KEYSCANM        06e3    KEYSCANN        06e9    KEYSCANP        073d
KEYSCANV        074c    KEYSCANW        0703    KEYSCANX        0744
KEYSCANZ        06de    KEYSET          009f    KEYSGN          00b7
KEYSIN          00bf    KEYSPC          00a6    KEYSQR          00ba
KEYSTEP         00a2    KEYSTM          0080    KEYSTOP         0090
KEYSTR          00c8    KEYSUB          00ab    KEYSUGR         00a0
KEYTAB          00a5    KEYTAN          00c0    KEYTHEN         00a0
KEYTO           00a1    KEYUPR          00ce    KEYUSR          00c2
KEYVAL          00c9    KEYWADDS        00fa    KEYWAI          0095
KEYWORDS        011a    KEYWRD0         011a    KEYWRD1         0135
KEYWRD2         014a    KEYWRD3         0171    KEYWRD4         01ad
KEYWRD5         01d1    KEYWRD6         01ee    KEYWRD7         01fd
KEYWRD8         020d    KEYWRD9         0217    KEYWRDA         022a
KEYWRDB         022c    KEYWRDC         022e    KEYWRDD         0251
KEYWRDE         026a    KEYWRDF         027b    LDACCE          1a31
LDACRG          1bd3    LDDCBMM         1be3    LDICBMM         1be4
LDMMAC          1bea    LDRGAC          1bde    LDRGACMM        1bd0
LDRGMM          1be1    LEFRIGAR        171f    LEFRIGMB        172b
LEFRIGMC        1729    LEFRIGMD        1715    LEFRIGMR        1713
LENFCT          1623    LENFCTC         1627    LETSTM          0bc0
LETSTMNM        0be6    LF              000a    LFTFCT          170f
LIMLOWER        8000    LIMUPPER        af00    LINEDEL         04a9
LINEDELL        04b4    LINEDELU        04bf    LINEINS         046f
LINEINSL        049e    LINELINK        0463    LINESRCH        0446
LINESRCL        0449    LINESYZE        009d    LISEDIKD        08a6
LISEDIKL        08cb    LISEDIKS        08d0    LISEDIKT        08b6
LISEDIKY        08d8    LISEDINC        08a8    LISEDISB        08ed
LISEDISC        08a3    LISEDIST        08f3    LISEDIXP        0888
LISEDIXT        08fa    LISSTM          0830    LISSTMLP        0849
LISSTMSC        083c    LISSTMXT        0883    LOGCOEF         1e6c
LOGFCT          1e7d    LOGOPRIC        1945    LOGOPRXT        1969
MATDMFLG        0380    MATSCANB        12ff    MATSCANC        1366
MATSCANI        13ca    MATSCANL        130c    MATSCANM        134b
MATSCANN        1337    MATSCANO        1338    MATSCANP        1301
MATSCANR        13d1    MATSCANS        13d2    MATSCANX        13f7
MATSCANZ        13aa    MATSCCNT        037f    MATSCNSB        1380
MATSCNSD        138d    MATTABLE        039b    MAXOPR          199e
MEMFCT          17f1    MEMFCTC         17fe    MEMSTM          180d
MIDFCT          1754    MIDSTM          0c5d*   MIDSTMLM        0cb2
MIDSTMLN        0ca6    MIDSTMXT        0cbf    MINOPR          19aa
MODOPR          1984    MONITOR         b400    MSGBREAK        05f7
MSGERROR        05e4    MSGEXTRA        0e21    MSGIN           05eb
MSGOK           05f0    MSGQUES         0e0b    MSGREDO         0e0e
MSGSTARS        07db    MUL16           13ff    MUL16LP         1407
MUL16XT         1415    MULOPR          1ab5    NAMENOTFOUND    188b
NEWLOAD         0515    NEWSTM          050c    NEXSTM          0f56
NEXSTMC         0f99    NEXSTML         0f59    NOBREAK         005c
NORMAL1         1a3d    NORMAL1L        1a35    NORMAL8         1a1e
NORMALIZ        1a1b    NORMALZI        1a18    NULLCNT         03ae
ONNSTMC         0ce0    ONNSTMSL        0ce1    ONSTM           0cd1
OPCINP          00db    OPCOUT          00d3    OPCRET          00c9
OPENS           b796    OPRTABL         00a4    ORNOPR          1940
ORNOPRFN        1965    P3010           0379    PIOVER2         2013
PLTSTM          0de9    POPAFRET        1555    POPDEBCR        0bbd
POPDERET        168f*   POPHL3RT        0884    POPHLRET        0886
PORFCT          1821    PORSTM          182f    POSFCT          0de1
PREDNOT         005a    PREDNUM         0070    PREDREL         0064
PREDUMIN        007d    PRINTFLG        037b    PRINTINT        1d79
PRNTBLNK        0dab    PRNTBLNL        0db2    PRNTCHRA        05ae
PRNTCHRI        05aa    PRNTCHRW        05cc    PRNTCOMA        0d78
PRNTCOMC        0daa    PRNTCOML        0d83    PRNTCRLF        0d5f
PRNTMSG         0dc2    PRNTNULL        0d6a    PRNTNULS        0d67
PRNTNUMS        0dc1    PRNTOPTN        0d8c    PRNTSEMI        0db9
PRNTSTRL        0dd2    PRNTSTRT        0dcb    PROGBASE        0397
PROGCNTR        038d    PROGCNTS        038f    PRTSTM          0d5c
PRTSTMN         0d1c    PRTSTRNG        0d55    PUSHAC          1bc3
PUSHAC1         1bc4    PUTS            b7dc    REAINPCM        0eb2
REAINPDC        0f24    REAINPER        0ee1    REAINPFL        037a
REAINPFS        0e7d    REAINPLA        0ea1    REAINPLP        0e83
REAINPLQ        0e8e    REASTM          0e74    REENTERBASIC    0003*
RELOPR          103b    RELOPRC         103d    RELOPRSL        106b
RELOPRXT        1031    REMSTM          0b84    RESDTPTR        0578
RESSTM          0561    RESSTMBU        0577    RESSTMDF        0573
RETSTM          0b65    RIGFCT          174a    RNDFCT          1f95
RNDFCTSD        03b5    RNDFCTUS        1fb4    RUNSTM          0b1b
RUNSTMC         0b41    SAVELOOP        18b3    SCAN2KEY        0b86
SCANFNN         151b    SCANLINL        0425    SCANLINN        0421
SCANLINR        0422    SCANLPR1        0408    SCANLPR2        041a
SCANLPRM        03fd    SCANLPRZ        03fa    SCANNXT         03c1
SCANNXTV        03b9    SCANPFLD        00ab    SCANPFLE        037e*
SCANPFLG        037d    SCANPTR1        0385    SCANPTR2        0387
SETFILENAME     18cd    SETSTM          07df    SETSTMGT        0804
SETSTMLS        0809    SETSTMPR        07ff*   SFNDONE         18e4
SFNLOOP         18d2    SGNFCT          1c94    SHIFTR          1a93
SHIFTR0         1a91    SHIFTRB         1aa0    SHIFTRBL        1aa3
SHIFTRLB        1aa7    SI              000f    SIGNACC         1c7e
SIGNIFY         1bfa    SIGNXTND        1c8a    SINFCT          1fcf
SINFCTC         1fff    SPACECHK        04fb    SPACESTK        04ee
SQRFCT          1ebe    STCKBASE        039f    STMTABL         0064
STPSTM          0ae0    STRFCT          166f    STRGALAG        153b
STRGALAH        153c    STRGALGC        1557    STRGALOC        1537
STRGALOT        1193    STRGALOU        1196    STRGALOV        11b6
STRGBASE        03a3    STRGFREE        03a1    STRGGBAL        15a6
STRGGBAS        15c9    STRGGBCL        1563    STRGGBHI        15d7
STRGGBHV        15d9    STRGGBLP        1566    STRGGBMV        15ff
STRGGBTL        1575    STRGGBVR        1586    STRGGNAV        15a7
STRGRELA        11bf    STRGRELD        11c3    STRGRELH        11c2
STRGRELT        11dd    STRGSTOR        167d    STRGTEST        0cc3
STRGTLIM        03a7    STRGTMPA        0383    STRGTMPL        0382
STRGTMPP        03a5    STRGUNIQ        0bec    STRNGEN         1529
STRSTCDS        152c    SUBOPR          19c5    SYSBREAK        0054
SYSDISPL        0040    SYSINITJ        0000    SYSKEYIN        001c
SYSKEYINRET     002f    SYSKEYNONE      0033    SYSQUIT         0061
SYSWAIT         0060    TAB             0009*   TANFCT          2030
TRACE           0b9f    TRACEFLG        037c    TYPECHK         03ef
TYPECHKA        03f2    TYPEDEF         0020    TYPEDUBL        0008*
TYPEFLG         0381    TYPEINTG        0002*   TYPESING        0004
TYPESTRG        0003    UPRFCT          16eb    UPRFCTL         1701
VALBYTE         0c42    VALBYTE2        0c3e    VALCNDFL        1119
VALCNDTL        1109    VALCONCP        1224    VALCONCT        11ed
VALCOND         10f4    VALCONDF        1117    VALEXPR         0fa9
VALEXPR2        1008    VALEXPRC        0fb8    VALEXPRD        0fbb
VALEXPRL        0fac    VALEXPRO        0fe1    VALEXPRR        0fc5
VALFCT          1653    VALFCTAR        114e    VALFCTCR        14ff
VALFCTD         143f    VALFCTDL        1465    VALFCTDM        146e
VALFCTLK        1156    VALFCTN         112e    VALFCTNA        14bb
VALFCTPS        148f    VALFCTPT        149c    VALFCTRL        14da
VALFCTRS        14f1    VALINTDE        0c1d    VALNUMBR        0c07
VALPARN2        10c0    VALPARNS        10bc    VALPRMRY        1083
VALREL          101e    VALRETNM        10d4    VALRETST        164f
VALSTRGC        1168    VALSTRGE        117d    VALSTRGL        116e
VALSTRGN        115f    VALSTRGS        116b    VALSTRGY        116a
VALSTRGZ        1162    VALUMINS        10c8    VALUNOT         196d
VALVAR          10d9    VARALLOC        12ed    VARINDEX        038d
VARNAME         127d    VARSCAN         1248    VARSCAND        1266
VARSCANF        12d0    VARSCANI        1249    VARSCANM        12c2
VARSCANS        1273    VARSCANT        12af    VARSCANX        12fd
VARSCNDF        124e    VARSKIPL        1267    VARTABLE        0399
VERSNDAT        2091    WAISTM          1849    WAISTMIN        185e
XCO             001b    ZEROAC          1a30
